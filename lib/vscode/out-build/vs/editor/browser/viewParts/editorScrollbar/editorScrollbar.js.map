{"version":3,"file":"editorScrollbar.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/browser/viewParts/editorScrollbar/editorScrollbar.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { FastDomNode, createFastDomNode } from 'vs/base/browser/fastDomNode';\nimport { IMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { IOverviewRulerLayoutInfo, SmoothScrollableElement } from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport { ScrollableElementChangeOptions, ScrollableElementCreationOptions } from 'vs/base/browser/ui/scrollbar/scrollableElementOptions';\nimport { PartFingerprint, PartFingerprints, ViewPart } from 'vs/editor/browser/view/viewPart';\nimport { INewScrollPosition, ScrollType } from 'vs/editor/common/editorCommon';\nimport { RenderingContext, RestrictedRenderingContext } from 'vs/editor/common/view/renderingContext';\nimport { ViewContext } from 'vs/editor/common/view/viewContext';\nimport * as viewEvents from 'vs/editor/common/view/viewEvents';\nimport { getThemeTypeSelector } from 'vs/platform/theme/common/themeService';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\n\nexport class EditorScrollbar extends ViewPart {\n\n\tprivate readonly scrollbar: SmoothScrollableElement;\n\tprivate readonly scrollbarDomNode: FastDomNode<HTMLElement>;\n\n\tconstructor(\n\t\tcontext: ViewContext,\n\t\tlinesContent: FastDomNode<HTMLElement>,\n\t\tviewDomNode: FastDomNode<HTMLElement>,\n\t\toverflowGuardDomNode: FastDomNode<HTMLElement>\n\t) {\n\t\tsuper(context);\n\n\n\t\tconst options = this._context.configuration.options;\n\t\tconst scrollbar = options.get(EditorOption.scrollbar);\n\t\tconst mouseWheelScrollSensitivity = options.get(EditorOption.mouseWheelScrollSensitivity);\n\t\tconst fastScrollSensitivity = options.get(EditorOption.fastScrollSensitivity);\n\t\tconst scrollPredominantAxis = options.get(EditorOption.scrollPredominantAxis);\n\n\t\tconst scrollbarOptions: ScrollableElementCreationOptions = {\n\t\t\tlistenOnDomNode: viewDomNode.domNode,\n\t\t\tclassName: 'editor-scrollable' + ' ' + getThemeTypeSelector(context.theme.type),\n\t\t\tuseShadows: false,\n\t\t\tlazyRender: true,\n\n\t\t\tvertical: scrollbar.vertical,\n\t\t\thorizontal: scrollbar.horizontal,\n\t\t\tverticalHasArrows: scrollbar.verticalHasArrows,\n\t\t\thorizontalHasArrows: scrollbar.horizontalHasArrows,\n\t\t\tverticalScrollbarSize: scrollbar.verticalScrollbarSize,\n\t\t\tverticalSliderSize: scrollbar.verticalSliderSize,\n\t\t\thorizontalScrollbarSize: scrollbar.horizontalScrollbarSize,\n\t\t\thorizontalSliderSize: scrollbar.horizontalSliderSize,\n\t\t\thandleMouseWheel: scrollbar.handleMouseWheel,\n\t\t\talwaysConsumeMouseWheel: scrollbar.alwaysConsumeMouseWheel,\n\t\t\tarrowSize: scrollbar.arrowSize,\n\t\t\tmouseWheelScrollSensitivity: mouseWheelScrollSensitivity,\n\t\t\tfastScrollSensitivity: fastScrollSensitivity,\n\t\t\tscrollPredominantAxis: scrollPredominantAxis,\n\t\t\tscrollByPage: scrollbar.scrollByPage,\n\t\t};\n\n\t\tthis.scrollbar = this._register(new SmoothScrollableElement(linesContent.domNode, scrollbarOptions, this._context.viewLayout.getScrollable()));\n\t\tPartFingerprints.write(this.scrollbar.getDomNode(), PartFingerprint.ScrollableElement);\n\n\t\tthis.scrollbarDomNode = createFastDomNode(this.scrollbar.getDomNode());\n\t\tthis.scrollbarDomNode.setPosition('absolute');\n\t\tthis._setLayout();\n\n\t\t// When having a zone widget that calls .focus() on one of its dom elements,\n\t\t// the browser will try desperately to reveal that dom node, unexpectedly\n\t\t// changing the .scrollTop of this.linesContent\n\n\t\tconst onBrowserDesperateReveal = (domNode: HTMLElement, lookAtScrollTop: boolean, lookAtScrollLeft: boolean) => {\n\t\t\tconst newScrollPosition: INewScrollPosition = {};\n\n\t\t\tif (lookAtScrollTop) {\n\t\t\t\tconst deltaTop = domNode.scrollTop;\n\t\t\t\tif (deltaTop) {\n\t\t\t\t\tnewScrollPosition.scrollTop = this._context.viewLayout.getCurrentScrollTop() + deltaTop;\n\t\t\t\t\tdomNode.scrollTop = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (lookAtScrollLeft) {\n\t\t\t\tconst deltaLeft = domNode.scrollLeft;\n\t\t\t\tif (deltaLeft) {\n\t\t\t\t\tnewScrollPosition.scrollLeft = this._context.viewLayout.getCurrentScrollLeft() + deltaLeft;\n\t\t\t\t\tdomNode.scrollLeft = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._context.model.setScrollPosition(newScrollPosition, ScrollType.Immediate);\n\t\t};\n\n\t\t// I've seen this happen both on the view dom node & on the lines content dom node.\n\t\tthis._register(dom.addDisposableListener(viewDomNode.domNode, 'scroll', (e: Event) => onBrowserDesperateReveal(viewDomNode.domNode, true, true)));\n\t\tthis._register(dom.addDisposableListener(linesContent.domNode, 'scroll', (e: Event) => onBrowserDesperateReveal(linesContent.domNode, true, false)));\n\t\tthis._register(dom.addDisposableListener(overflowGuardDomNode.domNode, 'scroll', (e: Event) => onBrowserDesperateReveal(overflowGuardDomNode.domNode, true, false)));\n\t\tthis._register(dom.addDisposableListener(this.scrollbarDomNode.domNode, 'scroll', (e: Event) => onBrowserDesperateReveal(this.scrollbarDomNode.domNode, true, false)));\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t}\n\n\tprivate _setLayout(): void {\n\t\tconst options = this._context.configuration.options;\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\n\t\tthis.scrollbarDomNode.setLeft(layoutInfo.contentLeft);\n\n\t\tconst minimap = options.get(EditorOption.minimap);\n\t\tconst side = minimap.side;\n\t\tif (side === 'right') {\n\t\t\tthis.scrollbarDomNode.setWidth(layoutInfo.contentWidth + layoutInfo.minimap.minimapWidth);\n\t\t} else {\n\t\t\tthis.scrollbarDomNode.setWidth(layoutInfo.contentWidth);\n\t\t}\n\t\tthis.scrollbarDomNode.setHeight(layoutInfo.height);\n\t}\n\n\tpublic getOverviewRulerLayoutInfo(): IOverviewRulerLayoutInfo {\n\t\treturn this.scrollbar.getOverviewRulerLayoutInfo();\n\t}\n\n\tpublic getDomNode(): FastDomNode<HTMLElement> {\n\t\treturn this.scrollbarDomNode;\n\t}\n\n\tpublic delegateVerticalScrollbarMouseDown(browserEvent: IMouseEvent): void {\n\t\tthis.scrollbar.delegateVerticalScrollbarMouseDown(browserEvent);\n\t}\n\n\t// --- begin event handlers\n\n\tpublic override onConfigurationChanged(e: viewEvents.ViewConfigurationChangedEvent): boolean {\n\t\tif (\n\t\t\te.hasChanged(EditorOption.scrollbar)\n\t\t\t|| e.hasChanged(EditorOption.mouseWheelScrollSensitivity)\n\t\t\t|| e.hasChanged(EditorOption.fastScrollSensitivity)\n\t\t) {\n\t\t\tconst options = this._context.configuration.options;\n\t\t\tconst scrollbar = options.get(EditorOption.scrollbar);\n\t\t\tconst mouseWheelScrollSensitivity = options.get(EditorOption.mouseWheelScrollSensitivity);\n\t\t\tconst fastScrollSensitivity = options.get(EditorOption.fastScrollSensitivity);\n\t\t\tconst scrollPredominantAxis = options.get(EditorOption.scrollPredominantAxis);\n\t\t\tconst newOpts: ScrollableElementChangeOptions = {\n\t\t\t\thandleMouseWheel: scrollbar.handleMouseWheel,\n\t\t\t\tmouseWheelScrollSensitivity: mouseWheelScrollSensitivity,\n\t\t\t\tfastScrollSensitivity: fastScrollSensitivity,\n\t\t\t\tscrollPredominantAxis: scrollPredominantAxis\n\t\t\t};\n\t\t\tthis.scrollbar.updateOptions(newOpts);\n\t\t}\n\t\tif (e.hasChanged(EditorOption.layoutInfo)) {\n\t\t\tthis._setLayout();\n\t\t}\n\t\treturn true;\n\t}\n\tpublic override onScrollChanged(e: viewEvents.ViewScrollChangedEvent): boolean {\n\t\treturn true;\n\t}\n\tpublic override onThemeChanged(e: viewEvents.ViewThemeChangedEvent): boolean {\n\t\tthis.scrollbar.updateClassName('editor-scrollable' + ' ' + getThemeTypeSelector(this._context.theme.type));\n\t\treturn true;\n\t}\n\n\t// --- end event handlers\n\n\tpublic prepareRender(ctx: RenderingContext): void {\n\t\t// Nothing to do\n\t}\n\n\tpublic render(ctx: RestrictedRenderingContext): void {\n\t\tthis.scrollbar.renderNow();\n\t}\n}\n"]}