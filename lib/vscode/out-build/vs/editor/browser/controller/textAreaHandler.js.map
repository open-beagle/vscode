{"version":3,"sources":["vs/editor/browser/controller/textAreaHandler.ts"],"names":[],"mappings":"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","file":"textAreaHandler.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./textAreaHandler';\nimport * as nls from 'vs/nls';\nimport * as browser from 'vs/base/browser/browser';\nimport { FastDomNode, createFastDomNode } from 'vs/base/browser/fastDomNode';\nimport { IKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport * as platform from 'vs/base/common/platform';\nimport * as strings from 'vs/base/common/strings';\nimport { Configuration } from 'vs/editor/browser/config/configuration';\nimport { CopyOptions, ICompositionData, IPasteData, ITextAreaInputHost, TextAreaInput, ClipboardDataToCopy } from 'vs/editor/browser/controller/textAreaInput';\nimport { ISimpleModel, ITypeData, PagedScreenReaderStrategy, TextAreaState, _debugComposition } from 'vs/editor/browser/controller/textAreaState';\nimport { ViewController } from 'vs/editor/browser/view/viewController';\nimport { PartFingerprint, PartFingerprints, ViewPart } from 'vs/editor/browser/view/viewPart';\nimport { LineNumbersOverlay } from 'vs/editor/browser/viewParts/lineNumbers/lineNumbers';\nimport { Margin } from 'vs/editor/browser/viewParts/margin/margin';\nimport { RenderLineNumbersType, EditorOption, IComputedEditorOptions, EditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { BareFontInfo } from 'vs/editor/common/config/fontInfo';\nimport { WordCharacterClass, getMapForWordSeparators } from 'vs/editor/common/controller/wordCharacterClassifier';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { ScrollType } from 'vs/editor/common/editorCommon';\nimport { EndOfLinePreference } from 'vs/editor/common/model';\nimport { RenderingContext, RestrictedRenderingContext, HorizontalPosition } from 'vs/editor/common/view/renderingContext';\nimport { ViewContext } from 'vs/editor/common/view/viewContext';\nimport * as viewEvents from 'vs/editor/common/view/viewEvents';\nimport { AccessibilitySupport } from 'vs/platform/accessibility/common/accessibility';\nimport { IEditorAriaOptions } from 'vs/editor/browser/editorBrowser';\nimport { MOUSE_CURSOR_TEXT_CSS_CLASS_NAME } from 'vs/base/browser/ui/mouseCursor/mouseCursor';\n\nexport interface ITextAreaHandlerHelper {\n\tvisibleRangeForPositionRelativeToEditor(lineNumber: number, column: number): HorizontalPosition | null;\n}\n\nclass VisibleTextAreaData {\n\t_visibleTextAreaBrand: void;\n\n\tpublic readonly top: number;\n\tpublic readonly left: number;\n\tpublic readonly width: number;\n\n\tconstructor(top: number, left: number, width: number) {\n\t\tthis.top = top;\n\t\tthis.left = left;\n\t\tthis.width = width;\n\t}\n\n\tpublic setWidth(width: number): VisibleTextAreaData {\n\t\treturn new VisibleTextAreaData(this.top, this.left, width);\n\t}\n}\n\nconst canUseZeroSizeTextarea = (browser.isFirefox);\n\nexport class TextAreaHandler extends ViewPart {\n\n\tprivate readonly _viewController: ViewController;\n\tprivate readonly _viewHelper: ITextAreaHandlerHelper;\n\tprivate _scrollLeft: number;\n\tprivate _scrollTop: number;\n\n\tprivate _accessibilitySupport!: AccessibilitySupport;\n\tprivate _accessibilityPageSize!: number;\n\tprivate _contentLeft: number;\n\tprivate _contentWidth: number;\n\tprivate _contentHeight: number;\n\tprivate _fontInfo: BareFontInfo;\n\tprivate _lineHeight: number;\n\tprivate _emptySelectionClipboard: boolean;\n\tprivate _copyWithSyntaxHighlighting: boolean;\n\n\t/**\n\t * Defined only when the text area is visible (composition case).\n\t */\n\tprivate _visibleTextArea: VisibleTextAreaData | null;\n\tprivate _selections: Selection[];\n\tprivate _modelSelections: Selection[];\n\n\t/**\n\t * The position at which the textarea was rendered.\n\t * This is useful for hit-testing and determining the mouse position.\n\t */\n\tprivate _lastRenderPosition: Position | null;\n\n\tpublic readonly textArea: FastDomNode<HTMLTextAreaElement>;\n\tpublic readonly textAreaCover: FastDomNode<HTMLElement>;\n\tprivate readonly _textAreaInput: TextAreaInput;\n\n\tconstructor(context: ViewContext, viewController: ViewController, viewHelper: ITextAreaHandlerHelper) {\n\t\tsuper(context);\n\n\t\tthis._viewController = viewController;\n\t\tthis._viewHelper = viewHelper;\n\t\tthis._scrollLeft = 0;\n\t\tthis._scrollTop = 0;\n\n\t\tconst options = this._context.configuration.options;\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\n\t\tthis._setAccessibilityOptions(options);\n\t\tthis._contentLeft = layoutInfo.contentLeft;\n\t\tthis._contentWidth = layoutInfo.contentWidth;\n\t\tthis._contentHeight = layoutInfo.height;\n\t\tthis._fontInfo = options.get(EditorOption.fontInfo);\n\t\tthis._lineHeight = options.get(EditorOption.lineHeight);\n\t\tthis._emptySelectionClipboard = options.get(EditorOption.emptySelectionClipboard);\n\t\tthis._copyWithSyntaxHighlighting = options.get(EditorOption.copyWithSyntaxHighlighting);\n\n\t\tthis._visibleTextArea = null;\n\t\tthis._selections = [new Selection(1, 1, 1, 1)];\n\t\tthis._modelSelections = [new Selection(1, 1, 1, 1)];\n\t\tthis._lastRenderPosition = null;\n\n\t\t// Text Area (The focus will always be in the textarea when the cursor is blinking)\n\t\tthis.textArea = createFastDomNode(document.createElement('textarea'));\n\t\tPartFingerprints.write(this.textArea, PartFingerprint.TextArea);\n\t\tthis.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n\t\tthis.textArea.setAttribute('wrap', 'off');\n\t\tthis.textArea.setAttribute('autocorrect', 'off');\n\t\tthis.textArea.setAttribute('autocapitalize', 'off');\n\t\tthis.textArea.setAttribute('autocomplete', 'off');\n\t\tthis.textArea.setAttribute('spellcheck', 'false');\n\t\tthis.textArea.setAttribute('aria-label', this._getAriaLabel(options));\n\t\tthis.textArea.setAttribute('tabindex', String(options.get(EditorOption.tabIndex)));\n\t\tthis.textArea.setAttribute('role', 'textbox');\n\t\tthis.textArea.setAttribute('aria-roledescription', nls.localize('editor', \"editor\"));\n\t\tthis.textArea.setAttribute('aria-multiline', 'true');\n\t\tthis.textArea.setAttribute('aria-haspopup', 'false');\n\t\tthis.textArea.setAttribute('aria-autocomplete', 'both');\n\n\t\tif (options.get(EditorOption.domReadOnly) && options.get(EditorOption.readOnly)) {\n\t\t\tthis.textArea.setAttribute('readonly', 'true');\n\t\t}\n\n\t\tthis.textAreaCover = createFastDomNode(document.createElement('div'));\n\t\tthis.textAreaCover.setPosition('absolute');\n\n\t\tconst simpleModel: ISimpleModel = {\n\t\t\tgetLineCount: (): number => {\n\t\t\t\treturn this._context.model.getLineCount();\n\t\t\t},\n\t\t\tgetLineMaxColumn: (lineNumber: number): number => {\n\t\t\t\treturn this._context.model.getLineMaxColumn(lineNumber);\n\t\t\t},\n\t\t\tgetValueInRange: (range: Range, eol: EndOfLinePreference): string => {\n\t\t\t\treturn this._context.model.getValueInRange(range, eol);\n\t\t\t}\n\t\t};\n\n\t\tconst textAreaInputHost: ITextAreaInputHost = {\n\t\t\tgetDataToCopy: (generateHTML: boolean): ClipboardDataToCopy => {\n\t\t\t\tconst rawTextToCopy = this._context.model.getPlainTextToCopy(this._modelSelections, this._emptySelectionClipboard, platform.isWindows);\n\t\t\t\tconst newLineCharacter = this._context.model.getEOL();\n\n\t\t\t\tconst isFromEmptySelection = (this._emptySelectionClipboard && this._modelSelections.length === 1 && this._modelSelections[0].isEmpty());\n\t\t\t\tconst multicursorText = (Array.isArray(rawTextToCopy) ? rawTextToCopy : null);\n\t\t\t\tconst text = (Array.isArray(rawTextToCopy) ? rawTextToCopy.join(newLineCharacter) : rawTextToCopy);\n\n\t\t\t\tlet html: string | null | undefined = undefined;\n\t\t\t\tlet mode: string | null = null;\n\t\t\t\tif (generateHTML) {\n\t\t\t\t\tif (CopyOptions.forceCopyWithSyntaxHighlighting || (this._copyWithSyntaxHighlighting && text.length < 65536)) {\n\t\t\t\t\t\tconst richText = this._context.model.getRichTextToCopy(this._modelSelections, this._emptySelectionClipboard);\n\t\t\t\t\t\tif (richText) {\n\t\t\t\t\t\t\thtml = richText.html;\n\t\t\t\t\t\t\tmode = richText.mode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tisFromEmptySelection,\n\t\t\t\t\tmulticursorText,\n\t\t\t\t\ttext,\n\t\t\t\t\thtml,\n\t\t\t\t\tmode\n\t\t\t\t};\n\t\t\t},\n\t\t\tgetScreenReaderContent: (currentState: TextAreaState): TextAreaState => {\n\t\t\t\tif (this._accessibilitySupport === AccessibilitySupport.Disabled) {\n\t\t\t\t\t// We know for a fact that a screen reader is not attached\n\t\t\t\t\t// On OSX, we write the character before the cursor to allow for \"long-press\" composition\n\t\t\t\t\t// Also on OSX, we write the word before the cursor to allow for the Accessibility Keyboard to give good hints\n\t\t\t\t\tif (platform.isMacintosh) {\n\t\t\t\t\t\tconst selection = this._selections[0];\n\t\t\t\t\t\tif (selection.isEmpty()) {\n\t\t\t\t\t\t\tconst position = selection.getStartPosition();\n\n\t\t\t\t\t\t\tlet textBefore = this._getWordBeforePosition(position);\n\t\t\t\t\t\t\tif (textBefore.length === 0) {\n\t\t\t\t\t\t\t\ttextBefore = this._getCharacterBeforePosition(position);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (textBefore.length > 0) {\n\t\t\t\t\t\t\t\treturn new TextAreaState(textBefore, textBefore.length, textBefore.length, position, position);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn TextAreaState.EMPTY;\n\t\t\t\t}\n\n\t\t\t\tif (browser.isAndroid) {\n\t\t\t\t\t// when tapping in the editor on a word, Android enters composition mode.\n\t\t\t\t\t// in the `compositionstart` event we cannot clear the textarea, because\n\t\t\t\t\t// it then forgets to ever send a `compositionend`.\n\t\t\t\t\t// we therefore only write the current word in the textarea\n\t\t\t\t\tconst selection = this._selections[0];\n\t\t\t\t\tif (selection.isEmpty()) {\n\t\t\t\t\t\tconst position = selection.getStartPosition();\n\t\t\t\t\t\tconst [wordAtPosition, positionOffsetInWord] = this._getAndroidWordAtPosition(position);\n\t\t\t\t\t\tif (wordAtPosition.length > 0) {\n\t\t\t\t\t\t\treturn new TextAreaState(wordAtPosition, positionOffsetInWord, positionOffsetInWord, position, position);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn TextAreaState.EMPTY;\n\t\t\t\t}\n\n\t\t\t\treturn PagedScreenReaderStrategy.fromEditorSelection(currentState, simpleModel, this._selections[0], this._accessibilityPageSize, this._accessibilitySupport === AccessibilitySupport.Unknown);\n\t\t\t},\n\n\t\t\tdeduceModelPosition: (viewAnchorPosition: Position, deltaOffset: number, lineFeedCnt: number): Position => {\n\t\t\t\treturn this._context.model.deduceModelPositionRelativeToViewPosition(viewAnchorPosition, deltaOffset, lineFeedCnt);\n\t\t\t}\n\t\t};\n\n\t\tthis._textAreaInput = this._register(new TextAreaInput(textAreaInputHost, this.textArea));\n\n\t\tthis._register(this._textAreaInput.onKeyDown((e: IKeyboardEvent) => {\n\t\t\tthis._viewController.emitKeyDown(e);\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onKeyUp((e: IKeyboardEvent) => {\n\t\t\tthis._viewController.emitKeyUp(e);\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onPaste((e: IPasteData) => {\n\t\t\tlet pasteOnNewLine = false;\n\t\t\tlet multicursorText: string[] | null = null;\n\t\t\tlet mode: string | null = null;\n\t\t\tif (e.metadata) {\n\t\t\t\tpasteOnNewLine = (this._emptySelectionClipboard && !!e.metadata.isFromEmptySelection);\n\t\t\t\tmulticursorText = (typeof e.metadata.multicursorText !== 'undefined' ? e.metadata.multicursorText : null);\n\t\t\t\tmode = e.metadata.mode;\n\t\t\t}\n\t\t\tthis._viewController.paste(e.text, pasteOnNewLine, multicursorText, mode);\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onCut(() => {\n\t\t\tthis._viewController.cut();\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onType((e: ITypeData) => {\n\t\t\tif (e.replacePrevCharCnt || e.replaceNextCharCnt || e.positionDelta) {\n\t\t\t\t// must be handled through the new command\n\t\t\t\tif (_debugComposition) {\n\t\t\t\t\tconsole.log(` => compositionType: <<${e.text}>>, ${e.replacePrevCharCnt}, ${e.replaceNextCharCnt}, ${e.positionDelta}`);\n\t\t\t\t}\n\t\t\t\tthis._viewController.compositionType(e.text, e.replacePrevCharCnt, e.replaceNextCharCnt, e.positionDelta);\n\t\t\t} else {\n\t\t\t\tif (_debugComposition) {\n\t\t\t\t\tconsole.log(` => type: <<${e.text}>>`);\n\t\t\t\t}\n\t\t\t\tthis._viewController.type(e.text);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onSelectionChangeRequest((modelSelection: Selection) => {\n\t\t\tthis._viewController.setSelection(modelSelection);\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onCompositionStart((e) => {\n\t\t\tconst lineNumber = this._selections[0].startLineNumber;\n\t\t\tconst column = this._selections[0].startColumn + e.revealDeltaColumns;\n\n\t\t\tthis._context.model.revealRange(\n\t\t\t\t'keyboard',\n\t\t\t\ttrue,\n\t\t\t\tnew Range(lineNumber, column, lineNumber, column),\n\t\t\t\tviewEvents.VerticalRevealType.Simple,\n\t\t\t\tScrollType.Immediate\n\t\t\t);\n\n\t\t\t// Find range pixel position\n\t\t\tconst visibleRange = this._viewHelper.visibleRangeForPositionRelativeToEditor(lineNumber, column);\n\n\t\t\tif (visibleRange) {\n\t\t\t\tthis._visibleTextArea = new VisibleTextAreaData(\n\t\t\t\t\tthis._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber),\n\t\t\t\t\tvisibleRange.left,\n\t\t\t\t\tcanUseZeroSizeTextarea ? 0 : 1\n\t\t\t\t);\n\t\t\t\tthis._render();\n\t\t\t}\n\n\t\t\t// Show the textarea\n\t\t\tthis.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ime-input`);\n\n\t\t\tthis._viewController.compositionStart();\n\t\t\tthis._context.model.onCompositionStart();\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onCompositionUpdate((e: ICompositionData) => {\n\t\t\tif (!this._visibleTextArea) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// adjust width by its size\n\t\t\tthis._visibleTextArea = this._visibleTextArea.setWidth(measureText(e.data, this._fontInfo));\n\t\t\tthis._render();\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onCompositionEnd(() => {\n\n\t\t\tthis._visibleTextArea = null;\n\t\t\tthis._render();\n\n\t\t\tthis.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n\t\t\tthis._viewController.compositionEnd();\n\t\t\tthis._context.model.onCompositionEnd();\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onFocus(() => {\n\t\t\tthis._context.model.setHasFocus(true);\n\t\t}));\n\n\t\tthis._register(this._textAreaInput.onBlur(() => {\n\t\t\tthis._context.model.setHasFocus(false);\n\t\t}));\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t}\n\n\tprivate _getAndroidWordAtPosition(position: Position): [string, number] {\n\t\tconst ANDROID_WORD_SEPARATORS = '`~!@#$%^&*()-=+[{]}\\\\|;:\",.<>/?';\n\t\tconst lineContent = this._context.model.getLineContent(position.lineNumber);\n\t\tconst wordSeparators = getMapForWordSeparators(ANDROID_WORD_SEPARATORS);\n\n\t\tlet goingLeft = true;\n\t\tlet startColumn = position.column;\n\t\tlet goingRight = true;\n\t\tlet endColumn = position.column;\n\t\tlet distance = 0;\n\t\twhile (distance < 50 && (goingLeft || goingRight)) {\n\t\t\tif (goingLeft && startColumn <= 1) {\n\t\t\t\tgoingLeft = false;\n\t\t\t}\n\t\t\tif (goingLeft) {\n\t\t\t\tconst charCode = lineContent.charCodeAt(startColumn - 2);\n\t\t\t\tconst charClass = wordSeparators.get(charCode);\n\t\t\t\tif (charClass !== WordCharacterClass.Regular) {\n\t\t\t\t\tgoingLeft = false;\n\t\t\t\t} else {\n\t\t\t\t\tstartColumn--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (goingRight && endColumn > lineContent.length) {\n\t\t\t\tgoingRight = false;\n\t\t\t}\n\t\t\tif (goingRight) {\n\t\t\t\tconst charCode = lineContent.charCodeAt(endColumn - 1);\n\t\t\t\tconst charClass = wordSeparators.get(charCode);\n\t\t\t\tif (charClass !== WordCharacterClass.Regular) {\n\t\t\t\t\tgoingRight = false;\n\t\t\t\t} else {\n\t\t\t\t\tendColumn++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdistance++;\n\t\t}\n\n\t\treturn [lineContent.substring(startColumn - 1, endColumn - 1), position.column - startColumn];\n\t}\n\n\tprivate _getWordBeforePosition(position: Position): string {\n\t\tconst lineContent = this._context.model.getLineContent(position.lineNumber);\n\t\tconst wordSeparators = getMapForWordSeparators(this._context.configuration.options.get(EditorOption.wordSeparators));\n\n\t\tlet column = position.column;\n\t\tlet distance = 0;\n\t\twhile (column > 1) {\n\t\t\tconst charCode = lineContent.charCodeAt(column - 2);\n\t\t\tconst charClass = wordSeparators.get(charCode);\n\t\t\tif (charClass !== WordCharacterClass.Regular || distance > 50) {\n\t\t\t\treturn lineContent.substring(column - 1, position.column - 1);\n\t\t\t}\n\t\t\tdistance++;\n\t\t\tcolumn--;\n\t\t}\n\t\treturn lineContent.substring(0, position.column - 1);\n\t}\n\n\tprivate _getCharacterBeforePosition(position: Position): string {\n\t\tif (position.column > 1) {\n\t\t\tconst lineContent = this._context.model.getLineContent(position.lineNumber);\n\t\t\tconst charBefore = lineContent.charAt(position.column - 2);\n\t\t\tif (!strings.isHighSurrogate(charBefore.charCodeAt(0))) {\n\t\t\t\treturn charBefore;\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate _getAriaLabel(options: IComputedEditorOptions): string {\n\t\tconst accessibilitySupport = options.get(EditorOption.accessibilitySupport);\n\t\tif (accessibilitySupport === AccessibilitySupport.Disabled) {\n\t\t\treturn nls.localize('accessibilityOffAriaLabel', \"The editor is not accessible at this time. Press {0} for options.\", platform.isLinux ? 'Shift+Alt+F1' : 'Alt+F1');\n\t\t}\n\t\treturn options.get(EditorOption.ariaLabel);\n\t}\n\n\tprivate _setAccessibilityOptions(options: IComputedEditorOptions): void {\n\t\tthis._accessibilitySupport = options.get(EditorOption.accessibilitySupport);\n\t\tconst accessibilityPageSize = options.get(EditorOption.accessibilityPageSize);\n\t\tif (this._accessibilitySupport === AccessibilitySupport.Enabled && accessibilityPageSize === EditorOptions.accessibilityPageSize.defaultValue) {\n\t\t\t// If a screen reader is attached and the default value is not set we shuold automatically increase the page size to 500 for a better experience\n\t\t\tthis._accessibilityPageSize = 500;\n\t\t} else {\n\t\t\tthis._accessibilityPageSize = accessibilityPageSize;\n\t\t}\n\t}\n\n\t// --- begin event handlers\n\n\tpublic override onConfigurationChanged(e: viewEvents.ViewConfigurationChangedEvent): boolean {\n\t\tconst options = this._context.configuration.options;\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\n\t\tthis._setAccessibilityOptions(options);\n\t\tthis._contentLeft = layoutInfo.contentLeft;\n\t\tthis._contentWidth = layoutInfo.contentWidth;\n\t\tthis._contentHeight = layoutInfo.height;\n\t\tthis._fontInfo = options.get(EditorOption.fontInfo);\n\t\tthis._lineHeight = options.get(EditorOption.lineHeight);\n\t\tthis._emptySelectionClipboard = options.get(EditorOption.emptySelectionClipboard);\n\t\tthis._copyWithSyntaxHighlighting = options.get(EditorOption.copyWithSyntaxHighlighting);\n\t\tthis.textArea.setAttribute('aria-label', this._getAriaLabel(options));\n\t\tthis.textArea.setAttribute('tabindex', String(options.get(EditorOption.tabIndex)));\n\n\t\tif (e.hasChanged(EditorOption.domReadOnly) || e.hasChanged(EditorOption.readOnly)) {\n\t\t\tif (options.get(EditorOption.domReadOnly) && options.get(EditorOption.readOnly)) {\n\t\t\t\tthis.textArea.setAttribute('readonly', 'true');\n\t\t\t} else {\n\t\t\t\tthis.textArea.removeAttribute('readonly');\n\t\t\t}\n\t\t}\n\n\t\tif (e.hasChanged(EditorOption.accessibilitySupport)) {\n\t\t\tthis._textAreaInput.writeScreenReaderContent('strategy changed');\n\t\t}\n\n\t\treturn true;\n\t}\n\tpublic override onCursorStateChanged(e: viewEvents.ViewCursorStateChangedEvent): boolean {\n\t\tthis._selections = e.selections.slice(0);\n\t\tthis._modelSelections = e.modelSelections.slice(0);\n\t\tthis._textAreaInput.writeScreenReaderContent('selection changed');\n\t\treturn true;\n\t}\n\tpublic override onDecorationsChanged(e: viewEvents.ViewDecorationsChangedEvent): boolean {\n\t\t// true for inline decorations that can end up relayouting text\n\t\treturn true;\n\t}\n\tpublic override onFlushed(e: viewEvents.ViewFlushedEvent): boolean {\n\t\treturn true;\n\t}\n\tpublic override onLinesChanged(e: viewEvents.ViewLinesChangedEvent): boolean {\n\t\treturn true;\n\t}\n\tpublic override onLinesDeleted(e: viewEvents.ViewLinesDeletedEvent): boolean {\n\t\treturn true;\n\t}\n\tpublic override onLinesInserted(e: viewEvents.ViewLinesInsertedEvent): boolean {\n\t\treturn true;\n\t}\n\tpublic override onScrollChanged(e: viewEvents.ViewScrollChangedEvent): boolean {\n\t\tthis._scrollLeft = e.scrollLeft;\n\t\tthis._scrollTop = e.scrollTop;\n\t\treturn true;\n\t}\n\tpublic override onZonesChanged(e: viewEvents.ViewZonesChangedEvent): boolean {\n\t\treturn true;\n\t}\n\n\t// --- end event handlers\n\n\t// --- begin view API\n\n\tpublic isFocused(): boolean {\n\t\treturn this._textAreaInput.isFocused();\n\t}\n\n\tpublic focusTextArea(): void {\n\t\tthis._textAreaInput.focusTextArea();\n\t}\n\n\tpublic refreshFocusState() {\n\t\tthis._textAreaInput.refreshFocusState();\n\t}\n\n\tpublic getLastRenderData(): Position | null {\n\t\treturn this._lastRenderPosition;\n\t}\n\n\tpublic setAriaOptions(options: IEditorAriaOptions): void {\n\t\tif (options.activeDescendant) {\n\t\t\tthis.textArea.setAttribute('aria-haspopup', 'true');\n\t\t\tthis.textArea.setAttribute('aria-autocomplete', 'list');\n\t\t\tthis.textArea.setAttribute('aria-activedescendant', options.activeDescendant);\n\t\t} else {\n\t\t\tthis.textArea.setAttribute('aria-haspopup', 'false');\n\t\t\tthis.textArea.setAttribute('aria-autocomplete', 'both');\n\t\t\tthis.textArea.removeAttribute('aria-activedescendant');\n\t\t}\n\t\tif (options.role) {\n\t\t\tthis.textArea.setAttribute('role', options.role);\n\t\t}\n\t}\n\n\t// --- end view API\n\n\tprivate _primaryCursorPosition: Position = new Position(1, 1);\n\tprivate _primaryCursorVisibleRange: HorizontalPosition | null = null;\n\n\tpublic prepareRender(ctx: RenderingContext): void {\n\t\tthis._primaryCursorPosition = new Position(this._selections[0].positionLineNumber, this._selections[0].positionColumn);\n\t\tthis._primaryCursorVisibleRange = ctx.visibleRangeForPosition(this._primaryCursorPosition);\n\t}\n\n\tpublic render(ctx: RestrictedRenderingContext): void {\n\t\tthis._textAreaInput.writeScreenReaderContent('render');\n\t\tthis._render();\n\t}\n\n\tprivate _render(): void {\n\t\tif (this._visibleTextArea) {\n\t\t\t// The text area is visible for composition reasons\n\t\t\tthis._renderInsideEditor(\n\t\t\t\tnull,\n\t\t\t\tthis._visibleTextArea.top - this._scrollTop,\n\t\t\t\tthis._contentLeft + this._visibleTextArea.left - this._scrollLeft,\n\t\t\t\tthis._visibleTextArea.width,\n\t\t\t\tthis._lineHeight\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._primaryCursorVisibleRange) {\n\t\t\t// The primary cursor is outside the viewport => place textarea to the top left\n\t\t\tthis._renderAtTopLeft();\n\t\t\treturn;\n\t\t}\n\n\t\tconst left = this._contentLeft + this._primaryCursorVisibleRange.left - this._scrollLeft;\n\t\tif (left < this._contentLeft || left > this._contentLeft + this._contentWidth) {\n\t\t\t// cursor is outside the viewport\n\t\t\tthis._renderAtTopLeft();\n\t\t\treturn;\n\t\t}\n\n\t\tconst top = this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber) - this._scrollTop;\n\t\tif (top < 0 || top > this._contentHeight) {\n\t\t\t// cursor is outside the viewport\n\t\t\tthis._renderAtTopLeft();\n\t\t\treturn;\n\t\t}\n\n\t\t// The primary cursor is in the viewport (at least vertically) => place textarea on the cursor\n\n\t\tif (platform.isMacintosh) {\n\t\t\t// For the popup emoji input, we will make the text area as high as the line height\n\t\t\t// We will also make the fontSize and lineHeight the correct dimensions to help with the placement of these pickers\n\t\t\tthis._renderInsideEditor(\n\t\t\t\tthis._primaryCursorPosition,\n\t\t\t\ttop, left,\n\t\t\t\tcanUseZeroSizeTextarea ? 0 : 1, this._lineHeight\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._renderInsideEditor(\n\t\t\tthis._primaryCursorPosition,\n\t\t\ttop, left,\n\t\t\tcanUseZeroSizeTextarea ? 0 : 1, canUseZeroSizeTextarea ? 0 : 1\n\t\t);\n\t}\n\n\tprivate _renderInsideEditor(renderedPosition: Position | null, top: number, left: number, width: number, height: number): void {\n\t\tthis._lastRenderPosition = renderedPosition;\n\t\tconst ta = this.textArea;\n\t\tconst tac = this.textAreaCover;\n\n\t\tConfiguration.applyFontInfo(ta, this._fontInfo);\n\n\t\tta.setTop(top);\n\t\tta.setLeft(left);\n\t\tta.setWidth(width);\n\t\tta.setHeight(height);\n\n\t\ttac.setTop(0);\n\t\ttac.setLeft(0);\n\t\ttac.setWidth(0);\n\t\ttac.setHeight(0);\n\t}\n\n\tprivate _renderAtTopLeft(): void {\n\t\tthis._lastRenderPosition = null;\n\t\tconst ta = this.textArea;\n\t\tconst tac = this.textAreaCover;\n\n\t\tConfiguration.applyFontInfo(ta, this._fontInfo);\n\t\tta.setTop(0);\n\t\tta.setLeft(0);\n\t\ttac.setTop(0);\n\t\ttac.setLeft(0);\n\n\t\tif (canUseZeroSizeTextarea) {\n\t\t\tta.setWidth(0);\n\t\t\tta.setHeight(0);\n\t\t\ttac.setWidth(0);\n\t\t\ttac.setHeight(0);\n\t\t\treturn;\n\t\t}\n\n\t\t// (in WebKit the textarea is 1px by 1px because it cannot handle input to a 0x0 textarea)\n\t\t// specifically, when doing Korean IME, setting the textarea to 0x0 breaks IME badly.\n\n\t\tta.setWidth(1);\n\t\tta.setHeight(1);\n\t\ttac.setWidth(1);\n\t\ttac.setHeight(1);\n\n\t\tconst options = this._context.configuration.options;\n\n\t\tif (options.get(EditorOption.glyphMargin)) {\n\t\t\ttac.setClassName('monaco-editor-background textAreaCover ' + Margin.OUTER_CLASS_NAME);\n\t\t} else {\n\t\t\tif (options.get(EditorOption.lineNumbers).renderType !== RenderLineNumbersType.Off) {\n\t\t\t\ttac.setClassName('monaco-editor-background textAreaCover ' + LineNumbersOverlay.CLASS_NAME);\n\t\t\t} else {\n\t\t\t\ttac.setClassName('monaco-editor-background textAreaCover');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction measureText(text: string, fontInfo: BareFontInfo): number {\n\t// adjust width by its size\n\tconst canvasElem = <HTMLCanvasElement>document.createElement('canvas');\n\tconst context = canvasElem.getContext('2d')!;\n\tcontext.font = createFontString(fontInfo);\n\tconst metrics = context.measureText(text);\n\n\tif (browser.isFirefox) {\n\t\treturn metrics.width + 2; // +2 for Japanese...\n\t} else {\n\t\treturn metrics.width;\n\t}\n}\n\nfunction createFontString(bareFontInfo: BareFontInfo): string {\n\treturn doCreateFontString('normal', bareFontInfo.fontWeight, bareFontInfo.fontSize, bareFontInfo.lineHeight, bareFontInfo.fontFamily);\n}\n\nfunction doCreateFontString(fontStyle: string, fontWeight: string, fontSize: number, lineHeight: number, fontFamily: string): string {\n\t// The full font syntax is:\n\t// style | variant | weight | stretch | size/line-height | fontFamily\n\t// (https://developer.mozilla.org/en-US/docs/Web/CSS/font)\n\t// But it appears Edge and IE11 cannot properly parse `stretch`.\n\treturn `${fontStyle} normal ${fontWeight} ${fontSize}px / ${lineHeight}px ${fontFamily}`;\n}\n"]}