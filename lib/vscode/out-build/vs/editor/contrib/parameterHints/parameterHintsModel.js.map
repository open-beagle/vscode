{"version":3,"file":"parameterHintsModel.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/contrib/parameterHints/parameterHintsModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, createCancelablePromise, Delayer } from 'vs/base/common/async';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { ICursorSelectionChangedEvent } from 'vs/editor/common/controller/cursorEvents';\nimport { CharacterSet } from 'vs/editor/common/core/characterClassifier';\nimport * as modes from 'vs/editor/common/modes';\nimport { provideSignatureHelp } from 'vs/editor/contrib/parameterHints/provideSignatureHelp';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\n\nexport interface TriggerContext {\n\treadonly triggerKind: modes.SignatureHelpTriggerKind;\n\treadonly triggerCharacter?: string;\n}\n\nnamespace ParameterHintState {\n\texport const enum Type {\n\t\tDefault,\n\t\tActive,\n\t\tPending,\n\t}\n\n\texport const Default = { type: Type.Default } as const;\n\n\texport class Pending {\n\t\treadonly type = Type.Pending;\n\t\tconstructor(\n\t\t\treadonly request: CancelablePromise<modes.SignatureHelpResult | undefined | null>,\n\t\t\treadonly previouslyActiveHints: modes.SignatureHelp | undefined,\n\t\t) { }\n\t}\n\n\texport class Active {\n\t\treadonly type = Type.Active;\n\t\tconstructor(\n\t\t\treadonly hints: modes.SignatureHelp\n\t\t) { }\n\t}\n\n\texport type State = typeof Default | Pending | Active;\n}\n\nexport class ParameterHintsModel extends Disposable {\n\n\tprivate static readonly DEFAULT_DELAY = 120; // ms\n\n\tprivate readonly _onChangedHints = this._register(new Emitter<modes.SignatureHelp | undefined>());\n\tpublic readonly onChangedHints = this._onChangedHints.event;\n\n\tprivate readonly editor: ICodeEditor;\n\tprivate triggerOnType = false;\n\tprivate _state: ParameterHintState.State = ParameterHintState.Default;\n\tprivate _pendingTriggers: TriggerContext[] = [];\n\tprivate readonly _lastSignatureHelpResult = this._register(new MutableDisposable<modes.SignatureHelpResult>());\n\tprivate triggerChars = new CharacterSet();\n\tprivate retriggerChars = new CharacterSet();\n\n\tprivate readonly throttledDelayer: Delayer<boolean>;\n\tprivate triggerId = 0;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tdelay: number = ParameterHintsModel.DEFAULT_DELAY\n\t) {\n\t\tsuper();\n\n\t\tthis.editor = editor;\n\n\t\tthis.throttledDelayer = new Delayer(delay);\n\n\t\tthis._register(this.editor.onDidBlurEditorWidget(() => this.cancel()));\n\t\tthis._register(this.editor.onDidChangeConfiguration(() => this.onEditorConfigurationChange()));\n\t\tthis._register(this.editor.onDidChangeModel(e => this.onModelChanged()));\n\t\tthis._register(this.editor.onDidChangeModelLanguage(_ => this.onModelChanged()));\n\t\tthis._register(this.editor.onDidChangeCursorSelection(e => this.onCursorChange(e)));\n\t\tthis._register(this.editor.onDidChangeModelContent(e => this.onModelContentChange()));\n\t\tthis._register(modes.SignatureHelpProviderRegistry.onDidChange(this.onModelChanged, this));\n\t\tthis._register(this.editor.onDidType(text => this.onDidType(text)));\n\n\t\tthis.onEditorConfigurationChange();\n\t\tthis.onModelChanged();\n\t}\n\n\tprivate get state() { return this._state; }\n\tprivate set state(value: ParameterHintState.State) {\n\t\tif (this._state.type === ParameterHintState.Type.Pending) {\n\t\t\tthis._state.request.cancel();\n\t\t}\n\t\tthis._state = value;\n\t}\n\n\tcancel(silent: boolean = false): void {\n\t\tthis.state = ParameterHintState.Default;\n\n\t\tthis.throttledDelayer.cancel();\n\n\t\tif (!silent) {\n\t\t\tthis._onChangedHints.fire(undefined);\n\t\t}\n\t}\n\n\ttrigger(context: TriggerContext, delay?: number): void {\n\t\tconst model = this.editor.getModel();\n\t\tif (!model || !modes.SignatureHelpProviderRegistry.has(model)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst triggerId = ++this.triggerId;\n\n\t\tthis._pendingTriggers.push(context);\n\t\tthis.throttledDelayer.trigger(() => {\n\t\t\treturn this.doTrigger(triggerId);\n\t\t}, delay)\n\t\t\t.catch(onUnexpectedError);\n\t}\n\n\tpublic next(): void {\n\t\tif (this.state.type !== ParameterHintState.Type.Active) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst length = this.state.hints.signatures.length;\n\t\tconst activeSignature = this.state.hints.activeSignature;\n\t\tconst last = (activeSignature % length) === (length - 1);\n\t\tconst cycle = this.editor.getOption(EditorOption.parameterHints).cycle;\n\n\t\t// If there is only one signature, or we're on last signature of list\n\t\tif ((length < 2 || last) && !cycle) {\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateActiveSignature(last && cycle ? 0 : activeSignature + 1);\n\t}\n\n\tpublic previous(): void {\n\t\tif (this.state.type !== ParameterHintState.Type.Active) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst length = this.state.hints.signatures.length;\n\t\tconst activeSignature = this.state.hints.activeSignature;\n\t\tconst first = activeSignature === 0;\n\t\tconst cycle = this.editor.getOption(EditorOption.parameterHints).cycle;\n\n\t\t// If there is only one signature, or we're on first signature of list\n\t\tif ((length < 2 || first) && !cycle) {\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateActiveSignature(first && cycle ? length - 1 : activeSignature - 1);\n\t}\n\n\tprivate updateActiveSignature(activeSignature: number) {\n\t\tif (this.state.type !== ParameterHintState.Type.Active) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.state = new ParameterHintState.Active({ ...this.state.hints, activeSignature });\n\t\tthis._onChangedHints.fire(this.state.hints);\n\t}\n\n\tprivate async doTrigger(triggerId: number): Promise<boolean> {\n\t\tconst isRetrigger = this.state.type === ParameterHintState.Type.Active || this.state.type === ParameterHintState.Type.Pending;\n\t\tconst activeSignatureHelp = this.getLastActiveHints();\n\t\tthis.cancel(true);\n\n\t\tif (this._pendingTriggers.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst context: TriggerContext = this._pendingTriggers.reduce(mergeTriggerContexts);\n\t\tthis._pendingTriggers = [];\n\n\t\tconst triggerContext = {\n\t\t\ttriggerKind: context.triggerKind,\n\t\t\ttriggerCharacter: context.triggerCharacter,\n\t\t\tisRetrigger: isRetrigger,\n\t\t\tactiveSignatureHelp: activeSignatureHelp\n\t\t};\n\n\t\tif (!this.editor.hasModel()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst model = this.editor.getModel();\n\t\tconst position = this.editor.getPosition();\n\n\t\tthis.state = new ParameterHintState.Pending(\n\t\t\tcreateCancelablePromise(token => provideSignatureHelp(model, position, triggerContext, token)),\n\t\t\tactiveSignatureHelp);\n\n\t\ttry {\n\t\t\tconst result = await this.state.request;\n\n\t\t\t// Check that we are still resolving the correct signature help\n\t\t\tif (triggerId !== this.triggerId) {\n\t\t\t\tresult?.dispose();\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!result || !result.value.signatures || result.value.signatures.length === 0) {\n\t\t\t\tresult?.dispose();\n\t\t\t\tthis._lastSignatureHelpResult.clear();\n\t\t\t\tthis.cancel();\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tthis.state = new ParameterHintState.Active(result.value);\n\t\t\t\tthis._lastSignatureHelpResult.value = result;\n\t\t\t\tthis._onChangedHints.fire(this.state.hints);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (triggerId === this.triggerId) {\n\t\t\t\tthis.state = ParameterHintState.Default;\n\t\t\t}\n\t\t\tonUnexpectedError(error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate getLastActiveHints(): modes.SignatureHelp | undefined {\n\t\tswitch (this.state.type) {\n\t\t\tcase ParameterHintState.Type.Active: return this.state.hints;\n\t\t\tcase ParameterHintState.Type.Pending: return this.state.previouslyActiveHints;\n\t\t\tdefault: return undefined;\n\t\t}\n\t}\n\n\tprivate get isTriggered(): boolean {\n\t\treturn this.state.type === ParameterHintState.Type.Active\n\t\t\t|| this.state.type === ParameterHintState.Type.Pending\n\t\t\t|| this.throttledDelayer.isTriggered();\n\t}\n\n\tprivate onModelChanged(): void {\n\t\tthis.cancel();\n\n\t\t// Update trigger characters\n\t\tthis.triggerChars = new CharacterSet();\n\t\tthis.retriggerChars = new CharacterSet();\n\n\t\tconst model = this.editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const support of modes.SignatureHelpProviderRegistry.ordered(model)) {\n\t\t\tfor (const ch of support.signatureHelpTriggerCharacters || []) {\n\t\t\t\tthis.triggerChars.add(ch.charCodeAt(0));\n\n\t\t\t\t// All trigger characters are also considered retrigger characters\n\t\t\t\tthis.retriggerChars.add(ch.charCodeAt(0));\n\t\t\t}\n\n\t\t\tfor (const ch of support.signatureHelpRetriggerCharacters || []) {\n\t\t\t\tthis.retriggerChars.add(ch.charCodeAt(0));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onDidType(text: string) {\n\t\tif (!this.triggerOnType) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastCharIndex = text.length - 1;\n\t\tconst triggerCharCode = text.charCodeAt(lastCharIndex);\n\n\t\tif (this.triggerChars.has(triggerCharCode) || this.isTriggered && this.retriggerChars.has(triggerCharCode)) {\n\t\t\tthis.trigger({\n\t\t\t\ttriggerKind: modes.SignatureHelpTriggerKind.TriggerCharacter,\n\t\t\t\ttriggerCharacter: text.charAt(lastCharIndex),\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate onCursorChange(e: ICursorSelectionChangedEvent): void {\n\t\tif (e.source === 'mouse') {\n\t\t\tthis.cancel();\n\t\t} else if (this.isTriggered) {\n\t\t\tthis.trigger({ triggerKind: modes.SignatureHelpTriggerKind.ContentChange });\n\t\t}\n\t}\n\n\tprivate onModelContentChange(): void {\n\t\tif (this.isTriggered) {\n\t\t\tthis.trigger({ triggerKind: modes.SignatureHelpTriggerKind.ContentChange });\n\t\t}\n\t}\n\n\tprivate onEditorConfigurationChange(): void {\n\t\tthis.triggerOnType = this.editor.getOption(EditorOption.parameterHints).enabled;\n\n\t\tif (!this.triggerOnType) {\n\t\t\tthis.cancel();\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tthis.cancel(true);\n\t\tsuper.dispose();\n\t}\n}\n\nfunction mergeTriggerContexts(previous: TriggerContext, current: TriggerContext) {\n\tswitch (current.triggerKind) {\n\t\tcase modes.SignatureHelpTriggerKind.Invoke:\n\t\t\t// Invoke overrides previous triggers.\n\t\t\treturn current;\n\n\t\tcase modes.SignatureHelpTriggerKind.ContentChange:\n\t\t\t// Ignore content changes triggers\n\t\t\treturn previous;\n\n\t\tcase modes.SignatureHelpTriggerKind.TriggerCharacter:\n\t\tdefault:\n\t\t\treturn current;\n\t}\n}\n"]}