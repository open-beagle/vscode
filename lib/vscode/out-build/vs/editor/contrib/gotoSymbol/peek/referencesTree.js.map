{"version":3,"sources":["vs/editor/contrib/gotoSymbol/peek/referencesTree.ts"],"names":[],"mappings":"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","file":"referencesTree.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ReferencesModel, FileReferences, OneReference } from '../referencesModel';\nimport { ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { ITreeRenderer, ITreeNode, IAsyncDataSource } from 'vs/base/browser/ui/tree/tree';\nimport { IconLabel } from 'vs/base/browser/ui/iconLabel/iconLabel';\nimport { CountBadge } from 'vs/base/browser/ui/countBadge/countBadge';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { attachBadgeStyler } from 'vs/platform/theme/common/styler';\nimport * as dom from 'vs/base/browser/dom';\nimport { localize } from 'vs/nls';\nimport { getBaseLabel } from 'vs/base/common/labels';\nimport { dirname, basename } from 'vs/base/common/resources';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IListAccessibilityProvider } from 'vs/base/browser/ui/list/listWidget';\nimport { IListVirtualDelegate, IKeyboardNavigationLabelProvider, IIdentityProvider } from 'vs/base/browser/ui/list/list';\nimport { IKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { FuzzyScore, createMatches, IMatch } from 'vs/base/common/filters';\nimport { HighlightedLabel } from 'vs/base/browser/ui/highlightedlabel/highlightedLabel';\n\n//#region data source\n\nexport type TreeElement = FileReferences | OneReference;\n\nexport class DataSource implements IAsyncDataSource<ReferencesModel | FileReferences, TreeElement> {\n\n\tconstructor(@ITextModelService private readonly _resolverService: ITextModelService) { }\n\n\thasChildren(element: ReferencesModel | FileReferences | TreeElement): boolean {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn true;\n\t\t}\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetChildren(element: ReferencesModel | FileReferences | TreeElement): TreeElement[] | Promise<TreeElement[]> {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn element.groups;\n\t\t}\n\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn element.resolve(this._resolverService).then(val => {\n\t\t\t\t// if (element.failure) {\n\t\t\t\t// \t// refresh the element on failure so that\n\t\t\t\t// \t// we can update its rendering\n\t\t\t\t// \treturn tree.refresh(element).then(() => val.children);\n\t\t\t\t// }\n\t\t\t\treturn val.children;\n\t\t\t});\n\t\t}\n\n\t\tthrow new Error('bad tree');\n\t}\n}\n\n//#endregion\n\nexport class Delegate implements IListVirtualDelegate<TreeElement> {\n\tgetHeight(): number {\n\t\treturn 23;\n\t}\n\tgetTemplateId(element: FileReferences | OneReference): string {\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn FileReferencesRenderer.id;\n\t\t} else {\n\t\t\treturn OneReferenceRenderer.id;\n\t\t}\n\t}\n}\n\nexport class StringRepresentationProvider implements IKeyboardNavigationLabelProvider<TreeElement> {\n\n\tconstructor(@IKeybindingService private readonly _keybindingService: IKeybindingService) { }\n\n\tgetKeyboardNavigationLabel(element: TreeElement): { toString(): string; } {\n\t\tif (element instanceof OneReference) {\n\t\t\tconst parts = element.parent.getPreview(element)?.preview(element.range);\n\t\t\tif (parts) {\n\t\t\t\treturn parts.value;\n\t\t\t}\n\t\t}\n\t\t// FileReferences or unresolved OneReference\n\t\treturn basename(element.uri);\n\t}\n\n\tmightProducePrintableCharacter(event: IKeyboardEvent): boolean {\n\t\treturn this._keybindingService.mightProducePrintableCharacter(event);\n\t}\n}\n\nexport class IdentityProvider implements IIdentityProvider<TreeElement> {\n\n\tgetId(element: TreeElement): { toString(): string; } {\n\t\treturn element instanceof OneReference ? element.id : element.uri;\n\t}\n}\n\n//#region render: File\n\nclass FileReferencesTemplate extends Disposable {\n\n\treadonly file: IconLabel;\n\treadonly badge: CountBadge;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\t@ILabelService private readonly _uriLabel: ILabelService,\n\t\t@IThemeService themeService: IThemeService,\n\t) {\n\t\tsuper();\n\t\tconst parent = document.createElement('div');\n\t\tparent.classList.add('reference-file');\n\t\tthis.file = this._register(new IconLabel(parent, { supportHighlights: true }));\n\n\t\tthis.badge = new CountBadge(dom.append(parent, dom.$('.count')));\n\t\tthis._register(attachBadgeStyler(this.badge, themeService));\n\n\t\tcontainer.appendChild(parent);\n\t}\n\n\tset(element: FileReferences, matches: IMatch[]) {\n\t\tlet parent = dirname(element.uri);\n\t\tthis.file.setLabel(getBaseLabel(element.uri), this._uriLabel.getUriLabel(parent, { relative: true }), { title: this._uriLabel.getUriLabel(element.uri), matches });\n\t\tconst len = element.children.length;\n\t\tthis.badge.setCount(len);\n\t\tif (len > 1) {\n\t\t\tthis.badge.setTitleFormat(localize('referencesCount', \"{0} references\", len));\n\t\t} else {\n\t\t\tthis.badge.setTitleFormat(localize('referenceCount', \"{0} reference\", len));\n\t\t}\n\t}\n}\n\nexport class FileReferencesRenderer implements ITreeRenderer<FileReferences, FuzzyScore, FileReferencesTemplate> {\n\n\tstatic readonly id = 'FileReferencesRenderer';\n\n\treadonly templateId: string = FileReferencesRenderer.id;\n\n\tconstructor(@IInstantiationService private readonly _instantiationService: IInstantiationService) { }\n\n\trenderTemplate(container: HTMLElement): FileReferencesTemplate {\n\t\treturn this._instantiationService.createInstance(FileReferencesTemplate, container);\n\t}\n\trenderElement(node: ITreeNode<FileReferences, FuzzyScore>, index: number, template: FileReferencesTemplate): void {\n\t\ttemplate.set(node.element, createMatches(node.filterData));\n\t}\n\tdisposeTemplate(templateData: FileReferencesTemplate): void {\n\t\ttemplateData.dispose();\n\t}\n}\n\n//#endregion\n\n//#region render: Reference\nclass OneReferenceTemplate {\n\n\treadonly label: HighlightedLabel;\n\n\tconstructor(container: HTMLElement) {\n\t\tthis.label = new HighlightedLabel(container, false);\n\t}\n\n\tset(element: OneReference, score?: FuzzyScore): void {\n\t\tconst preview = element.parent.getPreview(element)?.preview(element.range);\n\t\tif (!preview || !preview.value) {\n\t\t\t// this means we FAILED to resolve the document or the value is the empty string\n\t\t\tthis.label.set(`${basename(element.uri)}:${element.range.startLineNumber + 1}:${element.range.startColumn + 1}`);\n\t\t} else {\n\t\t\t// render search match as highlight unless\n\t\t\t// we have score, then render the score\n\t\t\tconst { value, highlight } = preview;\n\t\t\tif (score && !FuzzyScore.isDefault(score)) {\n\t\t\t\tthis.label.element.classList.toggle('referenceMatch', false);\n\t\t\t\tthis.label.set(value, createMatches(score));\n\t\t\t} else {\n\t\t\t\tthis.label.element.classList.toggle('referenceMatch', true);\n\t\t\t\tthis.label.set(value, [highlight]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class OneReferenceRenderer implements ITreeRenderer<OneReference, FuzzyScore, OneReferenceTemplate> {\n\n\tstatic readonly id = 'OneReferenceRenderer';\n\n\treadonly templateId: string = OneReferenceRenderer.id;\n\n\trenderTemplate(container: HTMLElement): OneReferenceTemplate {\n\t\treturn new OneReferenceTemplate(container);\n\t}\n\trenderElement(node: ITreeNode<OneReference, FuzzyScore>, index: number, templateData: OneReferenceTemplate): void {\n\t\ttemplateData.set(node.element, node.filterData);\n\t}\n\tdisposeTemplate(): void {\n\t}\n}\n\n//#endregion\n\n\nexport class AccessibilityProvider implements IListAccessibilityProvider<FileReferences | OneReference> {\n\n\tgetWidgetAriaLabel(): string {\n\t\treturn localize('treeAriaLabel', \"References\");\n\t}\n\n\tgetAriaLabel(element: FileReferences | OneReference): string | null {\n\t\treturn element.ariaMessage;\n\t}\n}\n"]}