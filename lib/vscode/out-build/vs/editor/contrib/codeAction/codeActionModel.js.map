{"version":3,"file":"codeActionModel.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/contrib/codeAction/codeActionModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, createCancelablePromise, TimeoutTimer } from 'vs/base/common/async';\nimport { isPromiseCanceledError } from 'vs/base/common/errors';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { isEqual } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { CodeActionProviderRegistry, CodeActionTriggerType } from 'vs/editor/common/modes';\nimport { IContextKey, IContextKeyService, RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { IMarkerService } from 'vs/platform/markers/common/markers';\nimport { IEditorProgressService, Progress } from 'vs/platform/progress/common/progress';\nimport { CodeActionSet, getCodeActions } from './codeAction';\nimport { CodeActionTrigger } from './types';\n\nexport const SUPPORTED_CODE_ACTIONS = new RawContextKey<string>('supportedCodeAction', '');\n\nexport type TriggeredCodeAction = undefined | {\n\treadonly selection: Selection;\n\treadonly trigger: CodeActionTrigger;\n\treadonly position: Position;\n};\n\nclass CodeActionOracle extends Disposable {\n\n\tprivate readonly _autoTriggerTimer = this._register(new TimeoutTimer());\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _markerService: IMarkerService,\n\t\tprivate readonly _signalChange: (triggered: TriggeredCodeAction) => void,\n\t\tprivate readonly _delay: number = 250,\n\t) {\n\t\tsuper();\n\t\tthis._register(this._markerService.onMarkerChanged(e => this._onMarkerChanges(e)));\n\t\tthis._register(this._editor.onDidChangeCursorPosition(() => this._onCursorChange()));\n\t}\n\n\tpublic trigger(trigger: CodeActionTrigger): TriggeredCodeAction {\n\t\tconst selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);\n\t\treturn this._createEventAndSignalChange(trigger, selection);\n\t}\n\n\tprivate _onMarkerChanges(resources: readonly URI[]): void {\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (resources.some(resource => isEqual(resource, model.uri))) {\n\t\t\tthis._autoTriggerTimer.cancelAndSet(() => {\n\t\t\t\tthis.trigger({ type: CodeActionTriggerType.Auto });\n\t\t\t}, this._delay);\n\t\t}\n\t}\n\n\tprivate _onCursorChange(): void {\n\t\tthis._autoTriggerTimer.cancelAndSet(() => {\n\t\t\tthis.trigger({ type: CodeActionTriggerType.Auto });\n\t\t}, this._delay);\n\t}\n\n\tprivate _getRangeOfMarker(selection: Selection): Range | undefined {\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn undefined;\n\t\t}\n\t\tfor (const marker of this._markerService.read({ resource: model.uri })) {\n\t\t\tconst markerRange = model.validateRange(marker);\n\t\t\tif (Range.intersectRanges(markerRange, selection)) {\n\t\t\t\treturn Range.lift(markerRange);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _getRangeOfSelectionUnlessWhitespaceEnclosed(trigger: CodeActionTrigger): Selection | undefined {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst model = this._editor.getModel();\n\t\tconst selection = this._editor.getSelection();\n\t\tif (selection.isEmpty() && trigger.type === CodeActionTriggerType.Auto) {\n\t\t\tconst { lineNumber, column } = selection.getPosition();\n\t\t\tconst line = model.getLineContent(lineNumber);\n\t\t\tif (line.length === 0) {\n\t\t\t\t// empty line\n\t\t\t\treturn undefined;\n\t\t\t} else if (column === 1) {\n\t\t\t\t// look only right\n\t\t\t\tif (/\\s/.test(line[0])) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else if (column === model.getLineMaxColumn(lineNumber)) {\n\t\t\t\t// look only left\n\t\t\t\tif (/\\s/.test(line[line.length - 1])) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// look left and right\n\t\t\t\tif (/\\s/.test(line[column - 2]) && /\\s/.test(line[column - 1])) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn selection;\n\t}\n\n\tprivate _createEventAndSignalChange(trigger: CodeActionTrigger, selection: Selection | undefined): TriggeredCodeAction {\n\t\tconst model = this._editor.getModel();\n\t\tif (!selection || !model) {\n\t\t\t// cancel\n\t\t\tthis._signalChange(undefined);\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst markerRange = this._getRangeOfMarker(selection);\n\t\tconst position = markerRange ? markerRange.getStartPosition() : selection.getStartPosition();\n\n\t\tconst e: TriggeredCodeAction = {\n\t\t\ttrigger,\n\t\t\tselection,\n\t\t\tposition\n\t\t};\n\t\tthis._signalChange(e);\n\t\treturn e;\n\t}\n}\n\nexport namespace CodeActionsState {\n\n\texport const enum Type {\n\t\tEmpty,\n\t\tTriggered,\n\t}\n\n\texport const Empty = { type: Type.Empty } as const;\n\n\texport class Triggered {\n\t\treadonly type = Type.Triggered;\n\n\t\tpublic readonly actions: Promise<CodeActionSet>;\n\n\t\tconstructor(\n\t\t\tpublic readonly trigger: CodeActionTrigger,\n\t\t\tpublic readonly rangeOrSelection: Range | Selection,\n\t\t\tpublic readonly position: Position,\n\t\t\tprivate readonly _cancellablePromise: CancelablePromise<CodeActionSet>,\n\t\t) {\n\t\t\tthis.actions = _cancellablePromise.catch((e): CodeActionSet => {\n\t\t\t\tif (isPromiseCanceledError(e)) {\n\t\t\t\t\treturn emptyCodeActionSet;\n\t\t\t\t}\n\t\t\t\tthrow e;\n\t\t\t});\n\t\t}\n\n\t\tpublic cancel() {\n\t\t\tthis._cancellablePromise.cancel();\n\t\t}\n\t}\n\n\texport type State = typeof Empty | Triggered;\n}\n\nconst emptyCodeActionSet: CodeActionSet = {\n\tallActions: [],\n\tvalidActions: [],\n\tdispose: () => { },\n\tdocumentation: [],\n\thasAutoFix: false\n};\n\nexport class CodeActionModel extends Disposable {\n\n\tprivate readonly _codeActionOracle = this._register(new MutableDisposable<CodeActionOracle>());\n\tprivate _state: CodeActionsState.State = CodeActionsState.Empty;\n\tprivate readonly _supportedCodeActions: IContextKey<string>;\n\n\tprivate readonly _onDidChangeState = this._register(new Emitter<CodeActionsState.State>());\n\tpublic readonly onDidChangeState = this._onDidChangeState.event;\n\n\t#isDisposed = false;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _markerService: IMarkerService,\n\t\tcontextKeyService: IContextKeyService,\n\t\tprivate readonly _progressService?: IEditorProgressService\n\t) {\n\t\tsuper();\n\t\tthis._supportedCodeActions = SUPPORTED_CODE_ACTIONS.bindTo(contextKeyService);\n\n\t\tthis._register(this._editor.onDidChangeModel(() => this._update()));\n\t\tthis._register(this._editor.onDidChangeModelLanguage(() => this._update()));\n\t\tthis._register(CodeActionProviderRegistry.onDidChange(() => this._update()));\n\n\t\tthis._update();\n\t}\n\n\toverride dispose(): void {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#isDisposed = true;\n\n\t\tsuper.dispose();\n\t\tthis.setState(CodeActionsState.Empty, true);\n\t}\n\n\tprivate _update(): void {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._codeActionOracle.value = undefined;\n\n\t\tthis.setState(CodeActionsState.Empty);\n\n\t\tconst model = this._editor.getModel();\n\t\tif (model\n\t\t\t&& CodeActionProviderRegistry.has(model)\n\t\t\t&& !this._editor.getOption(EditorOption.readOnly)\n\t\t) {\n\t\t\tconst supportedActions: string[] = [];\n\t\t\tfor (const provider of CodeActionProviderRegistry.all(model)) {\n\t\t\t\tif (Array.isArray(provider.providedCodeActionKinds)) {\n\t\t\t\t\tsupportedActions.push(...provider.providedCodeActionKinds);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._supportedCodeActions.set(supportedActions.join(' '));\n\n\t\t\tthis._codeActionOracle.value = new CodeActionOracle(this._editor, this._markerService, trigger => {\n\t\t\t\tif (!trigger) {\n\t\t\t\t\tthis.setState(CodeActionsState.Empty);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst actions = createCancelablePromise(token => getCodeActions(model, trigger.selection, trigger.trigger, Progress.None, token));\n\t\t\t\tif (trigger.trigger.type === CodeActionTriggerType.Invoke) {\n\t\t\t\t\tthis._progressService?.showWhile(actions, 250);\n\t\t\t\t}\n\n\t\t\t\tthis.setState(new CodeActionsState.Triggered(trigger.trigger, trigger.selection, trigger.position, actions));\n\n\t\t\t}, undefined);\n\t\t\tthis._codeActionOracle.value.trigger({ type: CodeActionTriggerType.Auto });\n\t\t} else {\n\t\t\tthis._supportedCodeActions.reset();\n\t\t}\n\t}\n\n\tpublic trigger(trigger: CodeActionTrigger) {\n\t\tif (this._codeActionOracle.value) {\n\t\t\tthis._codeActionOracle.value.trigger(trigger);\n\t\t}\n\t}\n\n\tprivate setState(newState: CodeActionsState.State, skipNotify?: boolean) {\n\t\tif (newState === this._state) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Cancel old request\n\t\tif (this._state.type === CodeActionsState.Type.Triggered) {\n\t\t\tthis._state.cancel();\n\t\t}\n\n\t\tthis._state = newState;\n\n\t\tif (!skipNotify && !this.#isDisposed) {\n\t\t\tthis._onDidChangeState.fire(newState);\n\t\t}\n\t}\n}\n"]}