{"version":3,"sources":["vs/editor/contrib/codeAction/lightBulbWidget.ts"],"names":[],"mappings":"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","file":"lightBulbWidget.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { GlobalMouseMoveMonitor, IStandardMouseMoveEventData, standardMouseMoveMerger } from 'vs/base/browser/globalMouseMoveMonitor';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport 'vs/css!./lightBulbWidget';\nimport { ContentWidgetPositionPreference, ICodeEditor, IContentWidget, IContentWidgetPosition } from 'vs/editor/browser/editorBrowser';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { TextModel } from 'vs/editor/common/model/textModel';\nimport { CodeActionSet } from 'vs/editor/contrib/codeAction/codeAction';\nimport * as nls from 'vs/nls';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { registerThemingParticipant, IColorTheme, ICssStyleCollector } from 'vs/platform/theme/common/themeService';\nimport { editorLightBulbForeground, editorLightBulbAutoFixForeground, editorBackground } from 'vs/platform/theme/common/colorRegistry';\nimport { Gesture } from 'vs/base/browser/touch';\nimport type { CodeActionTrigger } from 'vs/editor/contrib/codeAction/types';\nimport { Codicon } from 'vs/base/common/codicons';\n\nnamespace LightBulbState {\n\n\texport const enum Type {\n\t\tHidden,\n\t\tShowing,\n\t}\n\n\texport const Hidden = { type: Type.Hidden } as const;\n\n\texport class Showing {\n\t\treadonly type = Type.Showing;\n\n\t\tconstructor(\n\t\t\tpublic readonly actions: CodeActionSet,\n\t\t\tpublic readonly trigger: CodeActionTrigger,\n\t\t\tpublic readonly editorPosition: IPosition,\n\t\t\tpublic readonly widgetPosition: IContentWidgetPosition,\n\t\t) { }\n\t}\n\n\texport type State = typeof Hidden | Showing;\n}\n\n\nexport class LightBulbWidget extends Disposable implements IContentWidget {\n\n\tprivate static readonly _posPref = [ContentWidgetPositionPreference.EXACT];\n\n\tprivate readonly _domNode: HTMLDivElement;\n\n\tprivate readonly _onClick = this._register(new Emitter<{ x: number; y: number; actions: CodeActionSet; trigger: CodeActionTrigger }>());\n\tpublic readonly onClick = this._onClick.event;\n\n\tprivate _state: LightBulbState.State = LightBulbState.Hidden;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _quickFixActionId: string,\n\t\tprivate readonly _preferredFixActionId: string,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService\n\t) {\n\t\tsuper();\n\t\tthis._domNode = document.createElement('div');\n\t\tthis._domNode.className = Codicon.lightBulb.classNames;\n\n\t\tthis._editor.addContentWidget(this);\n\n\t\tthis._register(this._editor.onDidChangeModelContent(_ => {\n\t\t\t// cancel when the line in question has been removed\n\t\t\tconst editorModel = this._editor.getModel();\n\t\t\tif (this.state.type !== LightBulbState.Type.Showing || !editorModel || this.state.editorPosition.lineNumber >= editorModel.getLineCount()) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}));\n\n\t\tGesture.ignoreTarget(this._domNode);\n\t\tthis._register(dom.addStandardDisposableGenericMouseDownListner(this._domNode, e => {\n\t\t\tif (this.state.type !== LightBulbState.Type.Showing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Make sure that focus / cursor location is not lost when clicking widget icon\n\t\t\tthis._editor.focus();\n\t\t\te.preventDefault();\n\t\t\t// a bit of extra work to make sure the menu\n\t\t\t// doesn't cover the line-text\n\t\t\tconst { top, height } = dom.getDomNodePagePosition(this._domNode);\n\t\t\tconst lineHeight = this._editor.getOption(EditorOption.lineHeight);\n\n\t\t\tlet pad = Math.floor(lineHeight / 3);\n\t\t\tif (this.state.widgetPosition.position !== null && this.state.widgetPosition.position.lineNumber < this.state.editorPosition.lineNumber) {\n\t\t\t\tpad += lineHeight;\n\t\t\t}\n\n\t\t\tthis._onClick.fire({\n\t\t\t\tx: e.posx,\n\t\t\t\ty: top + height + pad,\n\t\t\t\tactions: this.state.actions,\n\t\t\t\ttrigger: this.state.trigger,\n\t\t\t});\n\t\t}));\n\t\tthis._register(dom.addDisposableListener(this._domNode, 'mouseenter', (e: MouseEvent) => {\n\t\t\tif ((e.buttons & 1) !== 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// mouse enters lightbulb while the primary/left button\n\t\t\t// is being pressed -> hide the lightbulb and block future\n\t\t\t// showings until mouse is released\n\t\t\tthis.hide();\n\t\t\tconst monitor = new GlobalMouseMoveMonitor<IStandardMouseMoveEventData>();\n\t\t\tmonitor.startMonitoring(<HTMLElement>e.target, e.buttons, standardMouseMoveMerger, () => { }, () => {\n\t\t\t\tmonitor.dispose();\n\t\t\t});\n\t\t}));\n\t\tthis._register(this._editor.onDidChangeConfiguration(e => {\n\t\t\t// hide when told to do so\n\t\t\tif (e.hasChanged(EditorOption.lightbulb) && !this._editor.getOption(EditorOption.lightbulb).enabled) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}));\n\n\t\tthis._updateLightBulbTitleAndIcon();\n\t\tthis._register(this._keybindingService.onDidUpdateKeybindings(this._updateLightBulbTitleAndIcon, this));\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._editor.removeContentWidget(this);\n\t}\n\n\tgetId(): string {\n\t\treturn 'LightBulbWidget';\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tgetPosition(): IContentWidgetPosition | null {\n\t\treturn this._state.type === LightBulbState.Type.Showing ? this._state.widgetPosition : null;\n\t}\n\n\tpublic update(actions: CodeActionSet, trigger: CodeActionTrigger, atPosition: IPosition) {\n\t\tif (actions.validActions.length <= 0) {\n\t\t\treturn this.hide();\n\t\t}\n\n\t\tconst options = this._editor.getOptions();\n\t\tif (!options.get(EditorOption.lightbulb).enabled) {\n\t\t\treturn this.hide();\n\t\t}\n\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn this.hide();\n\t\t}\n\n\t\tconst { lineNumber, column } = model.validatePosition(atPosition);\n\n\t\tconst tabSize = model.getOptions().tabSize;\n\t\tconst fontInfo = options.get(EditorOption.fontInfo);\n\t\tconst lineContent = model.getLineContent(lineNumber);\n\t\tconst indent = TextModel.computeIndentLevel(lineContent, tabSize);\n\t\tconst lineHasSpace = fontInfo.spaceWidth * indent > 22;\n\t\tconst isFolded = (lineNumber: number) => {\n\t\t\treturn lineNumber > 2 && this._editor.getTopForLineNumber(lineNumber) === this._editor.getTopForLineNumber(lineNumber - 1);\n\t\t};\n\n\t\tlet effectiveLineNumber = lineNumber;\n\t\tif (!lineHasSpace) {\n\t\t\tif (lineNumber > 1 && !isFolded(lineNumber - 1)) {\n\t\t\t\teffectiveLineNumber -= 1;\n\t\t\t} else if (!isFolded(lineNumber + 1)) {\n\t\t\t\teffectiveLineNumber += 1;\n\t\t\t} else if (column * fontInfo.spaceWidth < 22) {\n\t\t\t\t// cannot show lightbulb above/below and showing\n\t\t\t\t// it inline would overlay the cursor...\n\t\t\t\treturn this.hide();\n\t\t\t}\n\t\t}\n\n\t\tthis.state = new LightBulbState.Showing(actions, trigger, atPosition, {\n\t\t\tposition: { lineNumber: effectiveLineNumber, column: 1 },\n\t\t\tpreference: LightBulbWidget._posPref\n\t\t});\n\t\tthis._editor.layoutContentWidget(this);\n\t}\n\n\tpublic hide(): void {\n\t\tthis.state = LightBulbState.Hidden;\n\t\tthis._editor.layoutContentWidget(this);\n\t}\n\n\tprivate get state(): LightBulbState.State { return this._state; }\n\n\tprivate set state(value) {\n\t\tthis._state = value;\n\t\tthis._updateLightBulbTitleAndIcon();\n\t}\n\n\tprivate _updateLightBulbTitleAndIcon(): void {\n\t\tif (this.state.type === LightBulbState.Type.Showing && this.state.actions.hasAutoFix) {\n\t\t\t// update icon\n\t\t\tthis._domNode.classList.remove(...Codicon.lightBulb.classNamesArray);\n\t\t\tthis._domNode.classList.add(...Codicon.lightbulbAutofix.classNamesArray);\n\n\t\t\tconst preferredKb = this._keybindingService.lookupKeybinding(this._preferredFixActionId);\n\t\t\tif (preferredKb) {\n\t\t\t\tthis.title = nls.localize('prefferedQuickFixWithKb', \"Show Fixes. Preferred Fix Available ({0})\", preferredKb.getLabel());\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// update icon\n\t\tthis._domNode.classList.remove(...Codicon.lightbulbAutofix.classNamesArray);\n\t\tthis._domNode.classList.add(...Codicon.lightBulb.classNamesArray);\n\n\t\tconst kb = this._keybindingService.lookupKeybinding(this._quickFixActionId);\n\t\tif (kb) {\n\t\t\tthis.title = nls.localize('quickFixWithKb', \"Show Fixes ({0})\", kb.getLabel());\n\t\t} else {\n\t\t\tthis.title = nls.localize('quickFix', \"Show Fixes\");\n\t\t}\n\t}\n\n\tprivate set title(value: string) {\n\t\tthis._domNode.title = value;\n\t}\n}\n\nregisterThemingParticipant((theme: IColorTheme, collector: ICssStyleCollector) => {\n\n\tconst editorBackgroundColor = theme.getColor(editorBackground)?.transparent(0.7);\n\n\t// Lightbulb Icon\n\tconst editorLightBulbForegroundColor = theme.getColor(editorLightBulbForeground);\n\tif (editorLightBulbForegroundColor) {\n\t\tcollector.addRule(`\n\t\t.monaco-editor .contentWidgets ${Codicon.lightBulb.cssSelector} {\n\t\t\tcolor: ${editorLightBulbForegroundColor};\n\t\t\tbackground-color: ${editorBackgroundColor};\n\t\t}`);\n\t}\n\n\t// Lightbulb Auto Fix Icon\n\tconst editorLightBulbAutoFixForegroundColor = theme.getColor(editorLightBulbAutoFixForeground);\n\tif (editorLightBulbAutoFixForegroundColor) {\n\t\tcollector.addRule(`\n\t\t.monaco-editor .contentWidgets ${Codicon.lightbulbAutofix.cssSelector} {\n\t\t\tcolor: ${editorLightBulbAutoFixForegroundColor};\n\t\t\tbackground-color: ${editorBackgroundColor};\n\t\t}`);\n\t}\n\n});\n"]}