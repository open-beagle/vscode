{"version":3,"file":"findController.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/contrib/find/test/findController.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAqBhG,IAAa,kBAAkB,GAA/B,MAAa,kBAAmB,SAAQ,qCAAoB;QAO3D,YACC,MAAmB,EACC,iBAAqC,EACxC,cAA+B,EAC7B,gBAAmC;YAEtD,KAAK,CAAC,MAAM,EAAE,iBAAiB,EAAE,cAAc,EAAE,gBAAgB,CAAC,CAAC;YAV7D,uBAAkB,GAAY,KAAK,CAAC;YAW1C,IAAI,CAAC,iBAAiB,GAAG,sCAA0B,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;YAC9E,IAAI,CAAC,qBAAqB,GAAG,IAAI,eAAO,CAAO,EAAE,CAAC,CAAC;YACnD,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACvB,CAAC;QAEkB,KAAK,CAAC,MAAM,CAAC,IAAuB;YACtD,MAAM,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAEzB,IAAI,IAAI,CAAC,WAAW,0BAAuC,EAAE;gBAC5D,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;aACrB;YAED,IAAI,YAAY,GAAG,IAAI,CAAC,WAAW,2BAAwC,CAAC;YAC5E,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;QAC1C,CAAC;KACD,CAAA;IA7BY,kBAAkB;QAS5B,WAAA,+BAAkB,CAAA;QAClB,WAAA,yBAAe,CAAA;QACf,WAAA,oCAAiB,CAAA;OAXP,kBAAkB,CA6B9B;IA7BY,gDAAkB;IA+B/B,SAAS,aAAa,CAAC,GAAc;QACpC,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,GAAG,CAAC,WAAW,EAAE,GAAG,CAAC,aAAa,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC;IACjF,CAAC;IAED,SAAS,aAAa,CAAC,oBAA2C,EAAE,MAAmB,EAAE,MAAoB,EAAE,IAAU;QACxH,OAAO,oBAAoB,CAAC,cAAc,CAAC,CAAC,QAAQ,EAAE,EAAE;YACvD,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;QACzE,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,gBAAgB,EAAE,KAAK,IAAI,EAAE;QAClC,MAAM,UAAU,GAA4B,EAAE,CAAC;QAC/C,IAAI,cAAc,GAAG,EAAE,CAAC;QACxB,MAAM,iBAAiB,GAAG,IAAI,qCAAiB,EAAE,CAAC;QAClD,iBAAiB,CAAC,GAAG,CAAC,yBAAe,EAAE;YACtC,aAAa,EAAE,SAAS;YACxB,iBAAiB,EAAE,aAAK,CAAC,IAAI;YAC7B,gBAAgB,EAAE,aAAK,CAAC,IAAI;YAC5B,eAAe,EAAE,aAAK,CAAC,IAAI;YAC3B,GAAG,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC;YACrC,UAAU,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC;YAC9C,SAAS,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,SAAU;YACtC,KAAK,EAAE,CAAC,GAAW,EAAE,KAAU,EAAE,EAAE,GAAG,UAAU,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YAC1F,MAAM,EAAE,GAAG,EAAE,CAAC,SAAS;YACvB,KAAK,EAAE,GAAG,EAAE,CAAC,KAAK;YAClB,KAAK,EAAE,GAAG,EAAE,GAAG,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YAC1C,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE;YACd,UAAU,EAAE,GAAG,EAAE,GAAG,CAAC;YACrB,OAAO,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC;SAClB,CAAC,CAAC;QAEtB,IAAI,QAAQ,CAAC,WAAW,EAAE;YACzB,iBAAiB,CAAC,GAAG,CAAC,oCAAiB,EAAO;gBAC7C,YAAY,EAAE,GAAG,EAAE,CAAC,cAAc;gBAClC,aAAa,EAAE,CAAC,KAAU,EAAE,EAAE,GAAG,cAAc,GAAG,KAAK,CAAC,CAAC,CAAC;aAC1D,CAAC,CAAC;SACH;QAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;cAyEM;QAEN,IAAI,CAAC,2DAA2D,EAAE,KAAK,IAAI,EAAE;YAC5E,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;aACL,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,cAAc,GAAG,EAAE,CAAC;gBACpB,+DAA+D;gBAC/D,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,SAAS,GAAG,cAAc,CAAC,QAAQ,EAAE,CAAC;gBAC5C,MAAM,mBAAmB,GAAG,IAAI,oCAAmB,EAAE,CAAC;gBAEtD,uCAAuC;gBACvC,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,cAAc;gBACd,SAAS,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,GAAG,EAAE,EAAE,IAAI,CAAC,CAAC;gBAC9C,SAAS,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,IAAI,EAAE,EAAE,IAAI,CAAC,CAAC;gBAC/C,SAAS,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,KAAK,EAAE,EAAE,IAAI,CAAC,CAAC;gBAEhD,gCAAgC;gBAChC,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE5E,qCAAqC;gBACrC,cAAc,CAAC,eAAe,EAAE,CAAC;gBACjC,cAAc,CAAC,QAAQ,GAAG,KAAK,CAAC;gBAEhC,iFAAiF;gBACjF,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE5E,wDAAwD;gBACxD,MAAM,CAAC,YAAY,EAAE,CAAC;gBACtB,MAAM,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,6BAAa,CAAC,MAAM,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC3E,MAAM,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,6BAAa,CAAC,MAAM,CAAC,IAAI,mBAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC/E,MAAM,CAAC,YAAY,EAAE,CAAC;gBAEtB,iDAAiD;gBACjD,QAAQ;gBACR,QAAQ;gBACR,QAAQ;gBACR,QAAQ;gBACR,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,QAAQ,EAAG,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;gBAEhE,0CAA0C;gBAC1C,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE5E,+FAA+F;gBAC/F,MAAM,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAE5C,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBAClD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;gBAEnD,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,iEAAiE,EAAE,KAAK,IAAI,EAAE;YAClF,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,mCAAmC;aACnC,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAC7D,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,mBAAmB,GAAG,IAAI,oCAAmB,EAAE,CAAC;gBAEtD,MAAM,CAAC,WAAW,CAAC;oBAClB,UAAU,EAAE,CAAC;oBACb,MAAM,EAAE,CAAC;iBACT,CAAC,CAAC;gBAEH,MAAM,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC5C,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;gBAE9E,MAAM,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC5C,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;gBAE7E,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,6EAA6E,EAAE,KAAK,IAAI,EAAE;YAC9F,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,iBAAiB;gBACjB,iBAAiB;gBACjB,kBAAkB;aAClB,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,mBAAmB,GAAG,IAAI,oCAAmB,EAAE,CAAC;gBAEtD,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;gBAEhD,cAAc,CAAC,WAAW,EAAE,CAAC;gBAC7B,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,MAAM,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC5C,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;gBAE7E,MAAM,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC5C,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;gBAE7E,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,yFAAyF,EAAE,KAAK,IAAI,EAAE;YAC1G,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,MAAM;aACN,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,MAAM,eAAe,GAAG,MAAM,CAAC;gBAC/B,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,mBAAmB,GAAG,IAAI,oCAAmB,EAAE,CAAC;gBAEtD,cAAc,CAAC,WAAW,EAAE,CAAC;gBAC7B,cAAc,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;gBAChD,MAAM,cAAc,CAAC,KAAK,CAAC;oBAC1B,kBAAkB,EAAE,KAAK;oBACzB,6BAA6B,EAAE,MAAM;oBACrC,mCAAmC,EAAE,KAAK;oBAC1C,WAAW,wBAAqC;oBAChD,aAAa,EAAE,KAAK;oBACpB,iBAAiB,EAAE,KAAK;oBACxB,IAAI,EAAE,IAAI;iBACV,CAAC,CAAC;gBACH,MAAM,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC5C,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,uCAAsB,CAAC,CAAC;gBAE1E,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,eAAe,CAAC,CAAC;gBAE5E,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE;YAC7E,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,iBAAiB;gBACjB,iBAAiB;gBACjB,iBAAiB;aACjB,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAC7D,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,cAAc,CAAC,KAAK,CAAC;oBAC1B,kBAAkB,EAAE,KAAK;oBACzB,6BAA6B,EAAE,MAAM;oBACrC,mCAAmC,EAAE,KAAK;oBAC1C,WAAW,uBAAoC;oBAC/C,aAAa,EAAE,KAAK;oBACpB,iBAAiB,EAAE,KAAK;oBACxB,IAAI,EAAE,IAAI;iBACV,CAAC,CAAC;gBAEH,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;gBAEhE,cAAc,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC;oBAChC,WAAW,EAAE,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;iBACpC,EAAE,KAAK,CAAC,CAAC;gBAEV,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEvF,cAAc,CAAC,eAAe,EAAE,CAAC;gBACjC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;YACjE,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE;YACvF,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,mDAAmD;aACnD,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAE5G,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,cAAc,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,cAAc,EAAE,aAAa,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,KAAK,CAAC,CAAC;gBAC7G,cAAc,CAAC,eAAe,EAAE,CAAC;gBAEjC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,aAAa,EAAG,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE;oBAClE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;iBACd,CAAC,CAAC;gBAEH,cAAc,CAAC,OAAO,EAAE,CAAC;gBAEzB,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,iDAAiD,CAAC,CAAC;gBAE7F,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE;YAC9E,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,EAAE;gBACF,OAAO;gBACP,OAAO;aACP,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAE5G,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,cAAc,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,GAAG,EAAE,aAAa,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,KAAK,CAAC,CAAC;gBAClG,cAAc,CAAC,eAAe,EAAE,CAAC;gBAEjC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,aAAa,EAAG,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE;oBAClE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;iBACZ,CAAC,CAAC;gBAEH,cAAc,CAAC,OAAO,EAAE,CAAC;gBAEzB,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,iBAAiB,CAAC,CAAC;gBAE7D,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;YACnE,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,UAAU;gBACV,EAAE;gBACF,UAAU;aACV,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAC7D,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,4BAA4B,GAAG,IAAI,6CAA4B,EAAE,CAAC;gBAExE,eAAe;gBACf,cAAc,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,KAAK,CAAC,CAAC;gBAE3D,mBAAmB;gBACnB,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE/C,SAAS;gBACT,MAAM,4BAA4B,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAErD,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,aAAa,EAAG,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE;oBAClE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;iBACZ,CAAC,CAAC;gBAEH,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,oEAAoE,EAAE,KAAK,IAAI,EAAE;YACrF,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,UAAU;gBACV,EAAE;gBACF,UAAU;aACV,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,4BAA4B,GAAG,IAAI,6CAA4B,EAAE,CAAC;gBAExE,2BAA2B;gBAC3B,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,eAAe;gBACf,cAAc,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,KAAK,CAAC,CAAC;gBAE3D,mBAAmB;gBACnB,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE/C,SAAS;gBACT,MAAM,4BAA4B,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAErD,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,aAAa,EAAG,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE;oBAClE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;iBACZ,CAAC,CAAC;gBAEH,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,iFAAiF,EAAE,KAAK,IAAI,EAAE;YAClG,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;aACL,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAE5G,mBAAmB;gBACnB,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE/C,2BAA2B;gBAC3B,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC/C,MAAM,4BAA4B,GAAG,IAAI,6CAA4B,EAAE,CAAC;gBACxE,MAAM,4BAA4B,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBACrD,MAAM,SAAS,GAAG,cAAc,CAAC,QAAQ,EAAE,CAAC;gBAE5C,MAAM,CAAC,eAAe,CAAC,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC,aAAa,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;gBAEpF,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC/C,MAAM,4BAA4B,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAErD,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,2DAA2D,EAAE,KAAK,IAAI,EAAE;YAC5E,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;aACL,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAC7D,cAAc,GAAG,EAAE,CAAC;gBACpB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,CAAC,YAAY,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE/C,MAAM,4BAA4B,GAAG,IAAI,6CAA4B,EAAE,CAAC;gBACxE,4BAA4B,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAE/C,MAAM,SAAS,GAAG,cAAc,CAAC,QAAQ,EAAE,CAAC;gBAC5C,MAAM,CAAC,eAAe,CAAC,SAAS,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBACtD,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;QAC5D,IAAI,UAAU,GAA4B,EAAE,CAAC;QAC7C,UAAU,CAAC,gBAAgB,CAAC,GAAG,KAAK,CAAC;QACrC,UAAU,CAAC,kBAAkB,CAAC,GAAG,KAAK,CAAC;QACvC,UAAU,CAAC,kBAAkB,CAAC,GAAG,KAAK,CAAC;QACvC,MAAM,iBAAiB,GAAG,IAAI,qCAAiB,EAAE,CAAC;QAClD,iBAAiB,CAAC,GAAG,CAAC,yBAAe,EAAE;YACtC,aAAa,EAAE,SAAS;YACxB,iBAAiB,EAAE,aAAK,CAAC,IAAI;YAC7B,gBAAgB,EAAE,aAAK,CAAC,IAAI;YAC5B,eAAe,EAAE,aAAK,CAAC,IAAI;YAC3B,GAAG,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC;YACrC,UAAU,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC;YAC9C,SAAS,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,SAAU;YACtC,KAAK,EAAE,CAAC,GAAW,EAAE,KAAU,EAAE,EAAE,GAAG,UAAU,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YAC1F,MAAM,EAAE,GAAG,EAAE,CAAC,SAAS;YACvB,KAAK,EAAE,GAAG,EAAE,CAAC,KAAK;YAClB,KAAK,EAAE,GAAG,EAAE,GAAG,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YAC1C,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE;YACd,UAAU,EAAE,GAAG,EAAE,GAAG,CAAC;YACrB,OAAO,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC;SAClB,CAAC,CAAC;QAEtB,IAAI,CAAC,WAAW,EAAE,KAAK,IAAI,EAAE;YAC5B,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,KAAK;gBACL,KAAK;gBACL,KAAK;gBACL,KAAK;aACL,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,UAAU,GAAG,EAAE,gBAAgB,EAAE,KAAK,EAAE,kBAAkB,EAAE,IAAI,EAAE,kBAAkB,EAAE,KAAK,EAAE,CAAC;gBAC9F,+DAA+D;gBAC/D,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,SAAS,GAAG,cAAc,CAAC,QAAQ,EAAE,CAAC;gBAE5C,uCAAuC;gBACvC,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,cAAc;gBACd,SAAS,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,KAAK,EAAE,EAAE,IAAI,CAAC,CAAC;gBAChD,sDAAsD;gBACtD,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE5E,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,UAAU,GAAG,EAAE,gBAAgB,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAE,kBAAkB,EAAE,IAAI,EAAE,CAAC;QAE9F,IAAI,CAAC,WAAW,EAAE,KAAK,IAAI,EAAE;YAC5B,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,KAAK;gBACL,IAAI;gBACJ,KAAK;gBACL,KAAK;aACL,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,oBAAoB,EAAE,EAAE;gBACtF,UAAU,GAAG,EAAE,gBAAgB,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAE,kBAAkB,EAAE,IAAI,EAAE,CAAC;gBAC9F,+DAA+D;gBAC/D,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,SAAS,GAAG,cAAc,CAAC,QAAQ,EAAE,CAAC;gBAE5C,uCAAuC;gBACvC,MAAM,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,gCAAe,CAAC,CAAC;gBAEnE,aAAa;gBACb,SAAS,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,IAAI,EAAE,EAAE,IAAI,CAAC,CAAC;gBAC/C,qDAAqD;gBACrD,MAAM,CAAC,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,YAAY,EAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE5E,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;YAC5C,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,KAAK;gBACL,IAAI;gBACJ,KAAK;gBACL,KAAK;aACL,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAC7D,UAAU,GAAG,EAAE,gBAAgB,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAE,kBAAkB,EAAE,IAAI,EAAE,CAAC;gBAC9F,+DAA+D;gBAC/D,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,cAAc,CAAC,WAAW,EAAE,CAAC;gBAC7B,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,gBAAgB,CAAC,EAAE,IAAI,CAAC,CAAC;gBAEvD,cAAc,CAAC,OAAO,EAAE,CAAC;YAC1B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,oEAAoE,EAAE,KAAK,IAAI,EAAE;YACrF,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,iBAAiB;gBACjB,iBAAiB;gBACjB,iBAAiB;aACjB,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,IAAI,EAAE,EAAE,mBAAmB,EAAE,QAAQ,EAAE,mBAAmB,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAClI,uBAAuB;gBACvB,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,MAAM,UAAU,GAAsB;oBACrC,kBAAkB,EAAE,KAAK;oBACzB,6BAA6B,EAAE,MAAM;oBACrC,mCAAmC,EAAE,KAAK;oBAC1C,WAAW,uBAAoC;oBAC/C,aAAa,EAAE,KAAK;oBACpB,iBAAiB,EAAE,IAAI;oBACvB,IAAI,EAAE,IAAI;iBACV,CAAC;gBAEF,MAAM,CAAC,YAAY,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC3C,cAAc,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;gBACjC,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;gBAE3F,cAAc,CAAC,eAAe,EAAE,CAAC;gBAEjC,MAAM,CAAC,aAAa,CAAC,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC7E,cAAc,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;gBACjC,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YACvH,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE;YACzE,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,iBAAiB;gBACjB,iBAAiB;gBACjB,iBAAiB;aACjB,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,IAAI,EAAE,EAAE,mBAAmB,EAAE,QAAQ,EAAE,mBAAmB,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAClI,uBAAuB;gBACvB,MAAM,CAAC,YAAY,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAE5G,MAAM,cAAc,CAAC,KAAK,CAAC;oBAC1B,kBAAkB,EAAE,KAAK;oBACzB,6BAA6B,EAAE,MAAM;oBACrC,mCAAmC,EAAE,KAAK;oBAC1C,WAAW,uBAAoC;oBAC/C,aAAa,EAAE,KAAK;oBACpB,iBAAiB,EAAE,IAAI;oBACvB,IAAI,EAAE,IAAI;iBACV,CAAC,CAAC;gBAEH,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;YACrE,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE;YACtE,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,iBAAiB;gBACjB,iBAAiB;gBACjB,iBAAiB;aACjB,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,IAAI,EAAE,EAAE,mBAAmB,EAAE,QAAQ,EAAE,mBAAmB,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBAClI,uBAAuB;gBACvB,MAAM,CAAC,YAAY,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAE5G,MAAM,cAAc,CAAC,KAAK,CAAC;oBAC1B,kBAAkB,EAAE,KAAK;oBACzB,6BAA6B,EAAE,MAAM;oBACrC,mCAAmC,EAAE,KAAK;oBAC1C,WAAW,uBAAoC;oBAC/C,aAAa,EAAE,KAAK;oBACpB,iBAAiB,EAAE,IAAI;oBACvB,IAAI,EAAE,IAAI;iBACV,CAAC,CAAC;gBAEH,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5F,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAGH,IAAI,CAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE;YACnF,MAAM,CAAA,GAAA,wCAAuB,CAAA,CAAC;gBAC7B,iBAAiB;gBACjB,iBAAiB;gBACjB,iBAAiB;aACjB,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,IAAI,EAAE,EAAE,mBAAmB,EAAE,WAAW,EAAE,mBAAmB,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;gBACrI,uBAAuB;gBACvB,MAAM,CAAC,YAAY,CAAC,IAAI,aAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM,cAAc,GAAG,MAAM,CAAC,kCAAkC,CAAC,kBAAkB,CAAC,EAAE,EAAE,kBAAkB,CAAC,CAAC;gBAE5G,MAAM,cAAc,CAAC,KAAK,CAAC;oBAC1B,kBAAkB,EAAE,KAAK;oBACzB,6BAA6B,EAAE,MAAM;oBACrC,mCAAmC,EAAE,KAAK;oBAC1C,WAAW,uBAAoC;oBAC/C,aAAa,EAAE,KAAK;oBACpB,iBAAiB,EAAE,IAAI;oBACvB,IAAI,EAAE,IAAI;iBACV,CAAC,CAAC;gBAEH,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,qBAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5F,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { Delayer } from 'vs/base/common/async';\nimport { Event } from 'vs/base/common/event';\nimport * as platform from 'vs/base/common/platform';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction } from 'vs/editor/browser/editorExtensions';\nimport { EditOperation } from 'vs/editor/common/core/editOperation';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { CommonFindController, FindStartFocusAction, IFindStartOptions, NextMatchFindAction, NextSelectionMatchFindAction, StartFindAction, StartFindReplaceAction, StartFindWithSelectionAction } from 'vs/editor/contrib/find/findController';\nimport { CONTEXT_FIND_INPUT_FOCUSED } from 'vs/editor/contrib/find/findModel';\nimport { withAsyncTestCodeEditor } from 'vs/editor/test/browser/testCodeEditor';\nimport { IClipboardService } from 'vs/platform/clipboard/common/clipboardService';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\n\nexport class TestFindController extends CommonFindController {\n\n\tpublic hasFocus: boolean;\n\tpublic delayUpdateHistory: boolean = false;\n\n\tprivate _findInputFocused: IContextKey<boolean>;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IClipboardService clipboardService: IClipboardService\n\t) {\n\t\tsuper(editor, contextKeyService, storageService, clipboardService);\n\t\tthis._findInputFocused = CONTEXT_FIND_INPUT_FOCUSED.bindTo(contextKeyService);\n\t\tthis._updateHistoryDelayer = new Delayer<void>(50);\n\t\tthis.hasFocus = false;\n\t}\n\n\tprotected override async _start(opts: IFindStartOptions): Promise<void> {\n\t\tawait super._start(opts);\n\n\t\tif (opts.shouldFocus !== FindStartFocusAction.NoFocusChange) {\n\t\t\tthis.hasFocus = true;\n\t\t}\n\n\t\tlet inputFocused = opts.shouldFocus === FindStartFocusAction.FocusFindInput;\n\t\tthis._findInputFocused.set(inputFocused);\n\t}\n}\n\nfunction fromSelection(slc: Selection): number[] {\n\treturn [slc.startLineNumber, slc.startColumn, slc.endLineNumber, slc.endColumn];\n}\n\nfunction executeAction(instantiationService: IInstantiationService, editor: ICodeEditor, action: EditorAction, args?: any): Promise<void> {\n\treturn instantiationService.invokeFunction((accessor) => {\n\t\treturn Promise.resolve(action.runEditorCommand(accessor, editor, args));\n\t});\n}\n\nsuite('FindController', async () => {\n\tconst queryState: { [key: string]: any; } = {};\n\tlet clipboardState = '';\n\tconst serviceCollection = new ServiceCollection();\n\tserviceCollection.set(IStorageService, {\n\t\t_serviceBrand: undefined,\n\t\tonDidChangeTarget: Event.None,\n\t\tonDidChangeValue: Event.None,\n\t\tonWillSaveState: Event.None,\n\t\tget: (key: string) => queryState[key],\n\t\tgetBoolean: (key: string) => !!queryState[key],\n\t\tgetNumber: (key: string) => undefined!,\n\t\tstore: (key: string, value: any) => { queryState[key] = value; return Promise.resolve(); },\n\t\tremove: () => undefined,\n\t\tisNew: () => false,\n\t\tflush: () => { return Promise.resolve(); },\n\t\tkeys: () => [],\n\t\tlogStorage: () => { },\n\t\tmigrate: () => { throw new Error(); }\n\t} as IStorageService);\n\n\tif (platform.isMacintosh) {\n\t\tserviceCollection.set(IClipboardService, <any>{\n\t\t\treadFindText: () => clipboardState,\n\t\t\twriteFindText: (value: any) => { clipboardState = value; }\n\t\t});\n\t}\n\n\t/* test('stores to the global clipboard buffer on start find action', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet startFindAction = new StartFindAction();\n\t\t\t// I select ABC on the first line\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 4));\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tstartFindAction.run(null, editor);\n\n\t\t\tassert.deepStrictEqual(findController.getGlobalBufferTerm(), findController.getState().searchString);\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('reads from the global clipboard buffer on next find action if buffer exists', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = 'ABC';\n\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet findState = findController.getState();\n\t\t\tlet nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\tnextMatchFindAction.run(null, editor);\n\t\t\tassert.strictEqual(findState.searchString, 'ABC');\n\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('writes to the global clipboard buffer when text changes', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet findState = findController.getState();\n\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\tassert.deepStrictEqual(findController.getGlobalBufferTerm(), 'ABC');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t}); */\n\n\ttest('issue #1857: F3, Find Next, acts like \"Find Under Cursor\"', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\t\t\tconst nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'A' }, true);\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\t// The first ABC is highlighted.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\t// I hit Esc to exit the Find dialog.\n\t\t\tfindController.closeFindWidget();\n\t\t\tfindController.hasFocus = false;\n\n\t\t\t// The cursor is now at end of the first line, with ABC on that line highlighted.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\t// I hit delete to remove it and change the text to XYZ.\n\t\t\teditor.pushUndoStop();\n\t\t\teditor.executeEdits('test', [EditOperation.delete(new Range(1, 1, 1, 4))]);\n\t\t\teditor.executeEdits('test', [EditOperation.insert(new Position(1, 1), 'XYZ')]);\n\t\t\teditor.pushUndoStop();\n\n\t\t\t// At this point the text editor looks like this:\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\tassert.strictEqual(editor.getModel()!.getLineContent(1), 'XYZ');\n\n\t\t\t// The cursor is at end of the first line.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 4, 1, 4]);\n\n\t\t\t// I hit F3 to \"Find Next\" to find the next occurrence of ABC, but instead it searches for XYZ.\n\t\t\tawait nextMatchFindAction.run(null, editor);\n\n\t\t\tassert.strictEqual(findState.searchString, 'ABC');\n\t\t\tassert.strictEqual(findController.hasFocus, false);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #3090: F3 does not loop with two matches on a single line', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'import nls = require(\\'vs/nls\\');'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\teditor.setPosition({\n\t\t\t\tlineNumber: 1,\n\t\t\t\tcolumn: 9\n\t\t\t});\n\n\t\t\tawait nextMatchFindAction.run(null, editor);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 26, 1, 29]);\n\n\t\t\tawait nextMatchFindAction.run(null, editor);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 8, 1, 11]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #6149: Auto-escape highlighted text for search and replace regex mode', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3  * 5)',\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\teditor.setSelection(new Selection(1, 9, 1, 13));\n\n\t\t\tfindController.toggleRegex();\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tawait nextMatchFindAction.run(null, editor);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 9, 2, 13]);\n\n\t\t\tawait nextMatchFindAction.run(null, editor);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 9, 1, 13]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #41027: Don\\'t replace find input value on replace action if find input is active', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'test',\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tconst testRegexString = 'tes.';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\tfindController.toggleRegex();\n\t\t\tfindController.setSearchString(testRegexString);\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.FocusFindInput,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: false,\n\t\t\t\tloop: true\n\t\t\t});\n\t\t\tawait nextMatchFindAction.run(null, editor);\n\t\t\tawait executeAction(instantiationService, editor, StartFindReplaceAction);\n\n\t\t\tassert.strictEqual(findController.getState().searchString, testRegexString);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #9043: Clear search scope when find widget is hidden', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: false,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.strictEqual(findController.getState().searchScope, null);\n\n\t\t\tfindController.getState().change({\n\t\t\t\tsearchScope: [new Range(1, 1, 1, 5)]\n\t\t\t}, false);\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Range(1, 1, 1, 5)]);\n\n\t\t\tfindController.closeFindWidget();\n\t\t\tassert.strictEqual(findController.getState().searchScope, null);\n\t\t});\n\t});\n\n\ttest('issue #18111: Regex replace with single space replaces with no space', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'HRESULT OnAmbientPropertyChange(DISPID   dispid);'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tfindController.getState().change({ searchString: '\\\\b\\\\s{3}\\\\b', replaceString: ' ', isRegex: true }, false);\n\t\t\tfindController.moveToNextMatch();\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[1, 39, 1, 42]\n\t\t\t]);\n\n\t\t\tfindController.replace();\n\n\t\t\tassert.deepStrictEqual(editor.getValue(), 'HRESULT OnAmbientPropertyChange(DISPID dispid);');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #24714: Regular expression with ^ in search & replace', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'',\n\t\t\t'line2',\n\t\t\t'line3'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tfindController.getState().change({ searchString: '^', replaceString: 'x', isRegex: true }, false);\n\t\t\tfindController.moveToNextMatch();\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[2, 1, 2, 1]\n\t\t\t]);\n\n\t\t\tfindController.replace();\n\n\t\t\tassert.deepStrictEqual(editor.getValue(), '\\nxline2\\nline3');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #38232: Find Next Selection, regex enabled', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'([funny]',\n\t\t\t'',\n\t\t\t'([funny]'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextSelectionMatchFindAction = new NextSelectionMatchFindAction();\n\n\t\t\t// toggle regex\n\t\t\tfindController.getState().change({ isRegex: true }, false);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 9));\n\n\t\t\t// cmd+f3\n\t\t\tawait nextSelectionMatchFindAction.run(null, editor);\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[3, 1, 3, 9]\n\t\t\t]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #38232: Find Next Selection, regex enabled, find widget open', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'([funny]',\n\t\t\t'',\n\t\t\t'([funny]'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextSelectionMatchFindAction = new NextSelectionMatchFindAction();\n\n\t\t\t// cmd+f - open find widget\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// toggle regex\n\t\t\tfindController.getState().change({ isRegex: true }, false);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 9));\n\n\t\t\t// cmd+f3\n\t\t\tawait nextSelectionMatchFindAction.run(null, editor);\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[3, 1, 3, 9]\n\t\t\t]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #47400, CMD+E supports feeding multiple line of text into the find widget', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t\t// cmd+f - open find widget\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\teditor.setSelection(new Selection(1, 1, 2, 4));\n\t\t\tconst startFindWithSelectionAction = new StartFindWithSelectionAction();\n\t\t\tawait startFindWithSelectionAction.run(null, editor);\n\t\t\tconst findState = findController.getState();\n\n\t\t\tassert.deepStrictEqual(findState.searchString.split(/\\r\\n|\\r|\\n/g), ['ABC', 'ABC']);\n\n\t\t\teditor.setSelection(new Selection(3, 1, 3, 1));\n\t\t\tawait startFindWithSelectionAction.run(null, editor);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #109756, CMD+E with empty cursor should always work', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\teditor.setSelection(new Selection(1, 2, 1, 2));\n\n\t\t\tconst startFindWithSelectionAction = new StartFindWithSelectionAction();\n\t\t\tstartFindWithSelectionAction.run(null, editor);\n\n\t\t\tconst findState = findController.getState();\n\t\t\tassert.deepStrictEqual(findState.searchString, 'ABC');\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n});\n\nsuite('FindController query options persistence', async () => {\n\tlet queryState: { [key: string]: any; } = {};\n\tqueryState['editor.isRegex'] = false;\n\tqueryState['editor.matchCase'] = false;\n\tqueryState['editor.wholeWord'] = false;\n\tconst serviceCollection = new ServiceCollection();\n\tserviceCollection.set(IStorageService, {\n\t\t_serviceBrand: undefined,\n\t\tonDidChangeTarget: Event.None,\n\t\tonDidChangeValue: Event.None,\n\t\tonWillSaveState: Event.None,\n\t\tget: (key: string) => queryState[key],\n\t\tgetBoolean: (key: string) => !!queryState[key],\n\t\tgetNumber: (key: string) => undefined!,\n\t\tstore: (key: string, value: any) => { queryState[key] = value; return Promise.resolve(); },\n\t\tremove: () => undefined,\n\t\tisNew: () => false,\n\t\tflush: () => { return Promise.resolve(); },\n\t\tkeys: () => [],\n\t\tlogStorage: () => { },\n\t\tmigrate: () => { throw new Error(); }\n\t} as IStorageService);\n\n\ttest('matchCase', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'abc',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tqueryState = { 'editor.isRegex': false, 'editor.matchCase': true, 'editor.wholeWord': false };\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\t\t\t// The second ABC is highlighted as matchCase is true.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 1, 2, 4]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\tqueryState = { 'editor.isRegex': false, 'editor.matchCase': false, 'editor.wholeWord': true };\n\n\ttest('wholeWord', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'AB',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tqueryState = { 'editor.isRegex': false, 'editor.matchCase': false, 'editor.wholeWord': true };\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type AB.\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\t// The second AB is highlighted as wholeWord is true.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 1, 2, 3]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('toggling options is saved', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'AB',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tqueryState = { 'editor.isRegex': false, 'editor.matchCase': false, 'editor.wholeWord': true };\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tfindController.toggleRegex();\n\t\t\tassert.strictEqual(queryState['editor.isRegex'], true);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #27083: Update search scope once find widget becomes visible', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findConfig: IFindStartOptions = {\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t};\n\n\t\t\teditor.setSelection(new Range(1, 1, 2, 1));\n\t\t\tfindController.start(findConfig);\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 1, 2, 1)]);\n\n\t\t\tfindController.closeFindWidget();\n\n\t\t\teditor.setSelections([new Selection(1, 1, 2, 1), new Selection(2, 1, 2, 5)]);\n\t\t\tfindController.start(findConfig);\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 1, 2, 1), new Selection(2, 1, 2, 5)]);\n\t\t});\n\t});\n\n\ttest('issue #58604: Do not update searchScope if it is empty', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 2, 1, 2));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, null);\n\t\t});\n\t});\n\n\ttest('issue #58604: Update searchScope if it is not empty', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 2, 1, 3));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 2, 1, 3)]);\n\t\t});\n\t});\n\n\n\ttest('issue #27083: Find in selection when multiple lines are selected', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'multiline', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 6, 2, 1));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 6, 2, 1)]);\n\t\t});\n\t});\n});\n"]}