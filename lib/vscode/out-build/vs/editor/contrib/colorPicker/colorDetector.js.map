{"version":3,"file":"colorDetector.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/contrib/colorPicker/colorDetector.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAoBhG,MAAM,cAAc,GAAG,GAAG,CAAC;IAE3B,IAAa,aAAa,GAA1B,MAAa,aAAc,SAAQ,sBAAU;QAkB5C,YAA6B,OAAoB,EACX,kBAAsC,EACnC,qBAA4C;YAEpF,KAAK,EAAE,CAAC;YAJoB,YAAO,GAAP,OAAO,CAAa;YACX,uBAAkB,GAAlB,kBAAkB,CAAoB;YACnC,0BAAqB,GAArB,qBAAqB,CAAuB;YAdpE,oBAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,2BAAe,EAAE,CAAC,CAAC;YAIjE,oBAAe,GAAa,EAAE,CAAC;YAC/B,gBAAW,GAAG,IAAI,GAAG,EAAsB,CAAC;YAE5C,uBAAkB,GAAa,EAAE,CAAC;YACzB,sBAAiB,GAAG,IAAI,GAAG,EAAU,CAAC;YAStD,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,gBAAgB,CAAC,GAAG,EAAE;gBAC5C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;gBACnC,IAAI,CAAC,cAAc,EAAE,CAAC;YACvB,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,wBAAwB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;YAC9E,IAAI,CAAC,SAAS,CAAC,6BAAqB,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;YAC/E,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,wBAAwB,CAAC,GAAG,EAAE;gBACpD,IAAI,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC;gBACpC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;gBACnC,IAAI,aAAa,KAAK,IAAI,CAAC,UAAU,EAAE;oBACtC,IAAI,IAAI,CAAC,UAAU,EAAE;wBACpB,IAAI,CAAC,cAAc,EAAE,CAAC;qBACtB;yBAAM;wBACN,IAAI,CAAC,oBAAoB,EAAE,CAAC;qBAC5B;iBACD;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;YAC1B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC5B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,IAAI,CAAC,cAAc,EAAE,CAAC;QACvB,CAAC;QAED,SAAS;YACR,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YACtC,IAAI,CAAC,KAAK,EAAE;gBACX,OAAO,KAAK,CAAC;aACb;YACD,MAAM,UAAU,GAAG,KAAK,CAAC,qBAAqB,EAAE,CAAC;YACjD,kEAAkE;YAClE,MAAM,gBAAgB,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAK,UAAU,CAAC,QAAQ,CAAC,CAAC;YACtF,IAAI,gBAAgB,EAAE;gBACrB,MAAM,eAAe,GAAI,gBAAwB,CAAC,iBAAiB,CAAC,CAAC,CAAC,uDAAuD;gBAC7H,IAAI,eAAe,IAAI,eAAe,CAAC,QAAQ,CAAC,KAAK,SAAS,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;oBAC7F,OAAO,eAAe,CAAC,QAAQ,CAAC,CAAC;iBACjC;aACD;YAED,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,0BAA8B,CAAC;QAC7D,CAAC;QAED,MAAM,CAAC,GAAG,CAAC,MAAmB;YAC7B,OAAO,MAAM,CAAC,eAAe,CAAgB,IAAI,CAAC,EAAE,CAAC,CAAC;QACvD,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,IAAI,EAAE,CAAC;YACZ,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAC5B,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;QAEO,cAAc;YACrB,IAAI,CAAC,IAAI,EAAE,CAAC;YAEZ,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACrB,OAAO;aACP;YACD,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YAEtC,IAAI,CAAC,KAAK,IAAI,CAAC,6BAAqB,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;gBAChD,OAAO;aACP;YAED,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAuB,CAAC,GAAG,EAAE;gBAClE,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;oBACxB,IAAI,CAAC,aAAa,GAAG,IAAI,oBAAY,EAAE,CAAC;oBACxC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,GAAG,EAAE;wBACpC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;wBAC1B,IAAI,CAAC,YAAY,EAAE,CAAC;oBACrB,CAAC,EAAE,aAAa,CAAC,cAAc,CAAC,CAAC;iBACjC;YACF,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,YAAY,EAAE,CAAC;QACrB,CAAC;QAEO,YAAY;YACnB,IAAI,CAAC,eAAe,GAAG,CAAA,GAAA,+BAAuB,CAAA,CAAC,KAAK,CAAC,EAAE;gBACtD,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;gBACtC,IAAI,CAAC,KAAK,EAAE;oBACX,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;iBAC3B;gBACD,OAAO,CAAA,GAAA,iBAAS,CAAA,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;YAChC,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,UAAU,EAAE,EAAE;gBACxC,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;gBACnC,IAAI,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;gBACvC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC7B,CAAC,EAAE,0BAAiB,CAAC,CAAC;QACvB,CAAC;QAEO,IAAI;YACX,IAAI,IAAI,CAAC,aAAa,EAAE;gBACvB,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,CAAC;gBAC5B,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;aAC1B;YACD,IAAI,IAAI,CAAC,eAAe,EAAE;gBACzB,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC;gBAC9B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;aAC5B;YACD,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;QAC9B,CAAC;QAEO,iBAAiB,CAAC,UAAwB;YACjD,MAAM,WAAW,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBACxC,KAAK,EAAE;oBACN,eAAe,EAAE,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe;oBAClD,WAAW,EAAE,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW;oBAC1C,aAAa,EAAE,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,aAAa;oBAC9C,SAAS,EAAE,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,SAAS;iBACtC;gBACD,OAAO,EAAE,kCAAsB,CAAC,KAAK;aACrC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,eAAe,EAAE,WAAW,CAAC,CAAC;YAExF,IAAI,CAAC,WAAW,GAAG,IAAI,GAAG,EAAsB,CAAC;YACjD,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAClF,CAAC;QAEO,qBAAqB,CAAC,SAAuB;YACpD,IAAI,WAAW,GAA4B,EAAE,CAAC;YAC9C,IAAI,mBAAmB,GAA+B,EAAE,CAAC;YAEzD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,IAAI,WAAW,CAAC,MAAM,GAAG,cAAc,EAAE,CAAC,EAAE,EAAE;gBACjF,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC;gBACjE,MAAM,IAAI,GAAG,IAAI,YAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,CAAC,EAAE,KAAK,CAAC,CAAC;gBACrG,IAAI,MAAM,GAAG,CAAA,GAAA,WAAI,CAAA,CAAC,QAAQ,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;gBAChF,IAAI,KAAK,GAAG,QAAQ,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,GAAG,CAAC;gBAC/D,IAAI,GAAG,GAAG,WAAW,GAAG,MAAM,CAAC;gBAE/B,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,EAAE;oBAClE,IAAI,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,GAAG,EAAE;wBACnD,MAAM,EAAE;4BACP,WAAW,EAAE,GAAG;4BAChB,MAAM,EAAE,kBAAkB;4BAC1B,MAAM,EAAE,qBAAqB;4BAC7B,KAAK,EAAE,OAAO;4BACd,MAAM,EAAE,OAAO;4BACf,eAAe,EAAE,KAAK;yBACtB;wBACD,IAAI,EAAE;4BACL,MAAM,EAAE;gCACP,MAAM,EAAE,kBAAkB;6BAC1B;yBACD;qBACD,EAAE,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;iBAC5B;gBAED,mBAAmB,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;gBAChC,WAAW,CAAC,IAAI,CAAC;oBAChB,KAAK,EAAE;wBACN,eAAe,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe;wBAC7D,WAAW,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW;wBACrD,aAAa,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,aAAa;wBACzD,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,SAAS;qBACjD;oBACD,OAAO,EAAE,IAAI,CAAC,kBAAkB,CAAC,wBAAwB,CAAC,GAAG,EAAE,IAAI,CAAC;iBACpE,CAAC,CAAC;aACH;YAED,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBACxC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,EAAE;oBAClC,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;iBACtD;YACF,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,kBAAkB,EAAE,WAAW,CAAC,CAAC;QAC/F,CAAC;QAEO,oBAAoB;YAC3B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;YAC/E,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC;YAErF,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBACxC,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;YACvD,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,YAAY,CAAC,QAAkB;YAC9B,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YACtC,IAAI,CAAC,KAAK,EAAE;gBACX,OAAO,IAAI,CAAC;aACZ;YAED,MAAM,WAAW,GAAG,KAAK;iBACvB,qBAAqB,CAAC,aAAK,CAAC,aAAa,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;iBAC9D,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAE1C,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC7B,OAAO,IAAI,CAAC;aACZ;YAED,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,EAAE,CAAE,CAAC;QACjD,CAAC;KACD,CAAA;IAxNuB,gBAAE,GAAW,8BAA8B,CAAC;IAEnD,4BAAc,GAAG,IAAI,CAAC,CAAC,KAAK;IAJhC,aAAa;QAmBvB,WAAA,sCAAkB,CAAA;QAClB,WAAA,qCAAqB,CAAA;OApBX,aAAa,CA0NzB;IA1NY,sCAAa;IA4N1B,CAAA,GAAA,6CAA0B,CAAA,CAAC,aAAa,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, TimeoutTimer, createCancelablePromise } from 'vs/base/common/async';\nimport { RGBA } from 'vs/base/common/color';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { hash } from 'vs/base/common/hash';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { IModelDeltaDecoration } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { ColorProviderRegistry } from 'vs/editor/common/modes';\nimport { IColorData, getColors } from 'vs/editor/contrib/colorPicker/color';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\n\nconst MAX_DECORATORS = 500;\n\nexport class ColorDetector extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID: string = 'editor.contrib.colorDetector';\n\n\tstatic readonly RECOMPUTE_TIME = 1000; // ms\n\n\tprivate readonly _localToDispose = this._register(new DisposableStore());\n\tprivate _computePromise: CancelablePromise<IColorData[]> | null;\n\tprivate _timeoutTimer: TimeoutTimer | null;\n\n\tprivate _decorationsIds: string[] = [];\n\tprivate _colorDatas = new Map<string, IColorData>();\n\n\tprivate _colorDecoratorIds: string[] = [];\n\tprivate readonly _decorationsTypes = new Set<string>();\n\n\tprivate _isEnabled: boolean;\n\n\tconstructor(private readonly _editor: ICodeEditor,\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis._register(_editor.onDidChangeModel(() => {\n\t\t\tthis._isEnabled = this.isEnabled();\n\t\t\tthis.onModelChanged();\n\t\t}));\n\t\tthis._register(_editor.onDidChangeModelLanguage(() => this.onModelChanged()));\n\t\tthis._register(ColorProviderRegistry.onDidChange(() => this.onModelChanged()));\n\t\tthis._register(_editor.onDidChangeConfiguration(() => {\n\t\t\tlet prevIsEnabled = this._isEnabled;\n\t\t\tthis._isEnabled = this.isEnabled();\n\t\t\tif (prevIsEnabled !== this._isEnabled) {\n\t\t\t\tif (this._isEnabled) {\n\t\t\t\t\tthis.onModelChanged();\n\t\t\t\t} else {\n\t\t\t\t\tthis.removeAllDecorations();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._timeoutTimer = null;\n\t\tthis._computePromise = null;\n\t\tthis._isEnabled = this.isEnabled();\n\t\tthis.onModelChanged();\n\t}\n\n\tisEnabled(): boolean {\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn false;\n\t\t}\n\t\tconst languageId = model.getLanguageIdentifier();\n\t\t// handle deprecated settings. [languageId].colorDecorators.enable\n\t\tconst deprecatedConfig = this._configurationService.getValue<{}>(languageId.language);\n\t\tif (deprecatedConfig) {\n\t\t\tconst colorDecorators = (deprecatedConfig as any)['colorDecorators']; // deprecatedConfig.valueOf('.colorDecorators.enable');\n\t\t\tif (colorDecorators && colorDecorators['enable'] !== undefined && !colorDecorators['enable']) {\n\t\t\t\treturn colorDecorators['enable'];\n\t\t\t}\n\t\t}\n\n\t\treturn this._editor.getOption(EditorOption.colorDecorators);\n\t}\n\n\tstatic get(editor: ICodeEditor): ColorDetector {\n\t\treturn editor.getContribution<ColorDetector>(this.ID);\n\t}\n\n\toverride dispose(): void {\n\t\tthis.stop();\n\t\tthis.removeAllDecorations();\n\t\tsuper.dispose();\n\t}\n\n\tprivate onModelChanged(): void {\n\t\tthis.stop();\n\n\t\tif (!this._isEnabled) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._editor.getModel();\n\n\t\tif (!model || !ColorProviderRegistry.has(model)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._localToDispose.add(this._editor.onDidChangeModelContent(() => {\n\t\t\tif (!this._timeoutTimer) {\n\t\t\t\tthis._timeoutTimer = new TimeoutTimer();\n\t\t\t\tthis._timeoutTimer.cancelAndSet(() => {\n\t\t\t\t\tthis._timeoutTimer = null;\n\t\t\t\t\tthis.beginCompute();\n\t\t\t\t}, ColorDetector.RECOMPUTE_TIME);\n\t\t\t}\n\t\t}));\n\t\tthis.beginCompute();\n\t}\n\n\tprivate beginCompute(): void {\n\t\tthis._computePromise = createCancelablePromise(token => {\n\t\t\tconst model = this._editor.getModel();\n\t\t\tif (!model) {\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}\n\t\t\treturn getColors(model, token);\n\t\t});\n\t\tthis._computePromise.then((colorInfos) => {\n\t\t\tthis.updateDecorations(colorInfos);\n\t\t\tthis.updateColorDecorators(colorInfos);\n\t\t\tthis._computePromise = null;\n\t\t}, onUnexpectedError);\n\t}\n\n\tprivate stop(): void {\n\t\tif (this._timeoutTimer) {\n\t\t\tthis._timeoutTimer.cancel();\n\t\t\tthis._timeoutTimer = null;\n\t\t}\n\t\tif (this._computePromise) {\n\t\t\tthis._computePromise.cancel();\n\t\t\tthis._computePromise = null;\n\t\t}\n\t\tthis._localToDispose.clear();\n\t}\n\n\tprivate updateDecorations(colorDatas: IColorData[]): void {\n\t\tconst decorations = colorDatas.map(c => ({\n\t\t\trange: {\n\t\t\t\tstartLineNumber: c.colorInfo.range.startLineNumber,\n\t\t\t\tstartColumn: c.colorInfo.range.startColumn,\n\t\t\t\tendLineNumber: c.colorInfo.range.endLineNumber,\n\t\t\t\tendColumn: c.colorInfo.range.endColumn\n\t\t\t},\n\t\t\toptions: ModelDecorationOptions.EMPTY\n\t\t}));\n\n\t\tthis._decorationsIds = this._editor.deltaDecorations(this._decorationsIds, decorations);\n\n\t\tthis._colorDatas = new Map<string, IColorData>();\n\t\tthis._decorationsIds.forEach((id, i) => this._colorDatas.set(id, colorDatas[i]));\n\t}\n\n\tprivate updateColorDecorators(colorData: IColorData[]): void {\n\t\tlet decorations: IModelDeltaDecoration[] = [];\n\t\tlet newDecorationsTypes: { [key: string]: boolean } = {};\n\n\t\tfor (let i = 0; i < colorData.length && decorations.length < MAX_DECORATORS; i++) {\n\t\t\tconst { red, green, blue, alpha } = colorData[i].colorInfo.color;\n\t\t\tconst rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\n\t\t\tlet subKey = hash(`rgba(${rgba.r},${rgba.g},${rgba.b},${rgba.a})`).toString(16);\n\t\t\tlet color = `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;\n\t\t\tlet key = 'colorBox-' + subKey;\n\n\t\t\tif (!this._decorationsTypes.has(key) && !newDecorationsTypes[key]) {\n\t\t\t\tthis._codeEditorService.registerDecorationType(key, {\n\t\t\t\t\tbefore: {\n\t\t\t\t\t\tcontentText: ' ',\n\t\t\t\t\t\tborder: 'solid 0.1em #000',\n\t\t\t\t\t\tmargin: '0.1em 0.2em 0 0.2em',\n\t\t\t\t\t\twidth: '0.8em',\n\t\t\t\t\t\theight: '0.8em',\n\t\t\t\t\t\tbackgroundColor: color\n\t\t\t\t\t},\n\t\t\t\t\tdark: {\n\t\t\t\t\t\tbefore: {\n\t\t\t\t\t\t\tborder: 'solid 0.1em #eee'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, undefined, this._editor);\n\t\t\t}\n\n\t\t\tnewDecorationsTypes[key] = true;\n\t\t\tdecorations.push({\n\t\t\t\trange: {\n\t\t\t\t\tstartLineNumber: colorData[i].colorInfo.range.startLineNumber,\n\t\t\t\t\tstartColumn: colorData[i].colorInfo.range.startColumn,\n\t\t\t\t\tendLineNumber: colorData[i].colorInfo.range.endLineNumber,\n\t\t\t\t\tendColumn: colorData[i].colorInfo.range.endColumn\n\t\t\t\t},\n\t\t\t\toptions: this._codeEditorService.resolveDecorationOptions(key, true)\n\t\t\t});\n\t\t}\n\n\t\tthis._decorationsTypes.forEach(subType => {\n\t\t\tif (!newDecorationsTypes[subType]) {\n\t\t\t\tthis._codeEditorService.removeDecorationType(subType);\n\t\t\t}\n\t\t});\n\n\t\tthis._colorDecoratorIds = this._editor.deltaDecorations(this._colorDecoratorIds, decorations);\n\t}\n\n\tprivate removeAllDecorations(): void {\n\t\tthis._decorationsIds = this._editor.deltaDecorations(this._decorationsIds, []);\n\t\tthis._colorDecoratorIds = this._editor.deltaDecorations(this._colorDecoratorIds, []);\n\n\t\tthis._decorationsTypes.forEach(subType => {\n\t\t\tthis._codeEditorService.removeDecorationType(subType);\n\t\t});\n\t}\n\n\tgetColorData(position: Position): IColorData | null {\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst decorations = model\n\t\t\t.getDecorationsInRange(Range.fromPositions(position, position))\n\t\t\t.filter(d => this._colorDatas.has(d.id));\n\n\t\tif (decorations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._colorDatas.get(decorations[0].id)!;\n\t}\n}\n\nregisterEditorContribution(ColorDetector.ID, ColorDetector);\n"]}