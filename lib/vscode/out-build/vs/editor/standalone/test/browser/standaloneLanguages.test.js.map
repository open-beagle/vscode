{"version":3,"file":"standaloneLanguages.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/standalone/test/browser/standaloneLanguages.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { Color } from 'vs/base/common/color';\nimport { Emitter } from 'vs/base/common/event';\nimport { Token } from 'vs/editor/common/core/token';\nimport { IState, LanguageId, LanguageIdentifier, MetadataConsts } from 'vs/editor/common/modes';\nimport { TokenTheme } from 'vs/editor/common/modes/supports/tokenization';\nimport { ILineTokens, IToken, TokenizationSupport2Adapter, TokensProvider } from 'vs/editor/standalone/browser/standaloneLanguages';\nimport { IStandaloneTheme, IStandaloneThemeData, IStandaloneThemeService } from 'vs/editor/standalone/common/standaloneThemeService';\nimport { ColorIdentifier } from 'vs/platform/theme/common/colorRegistry';\nimport { ColorScheme } from 'vs/platform/theme/common/theme';\nimport { IFileIconTheme, IColorTheme, ITokenStyle } from 'vs/platform/theme/common/themeService';\n\nsuite('TokenizationSupport2Adapter', () => {\n\n\tconst languageIdentifier = new LanguageIdentifier('tttt', LanguageId.PlainText);\n\tconst tokenMetadata = (languageIdentifier.id << MetadataConsts.LANGUAGEID_OFFSET);\n\n\tclass MockTokenTheme extends TokenTheme {\n\t\tprivate counter = 0;\n\t\tconstructor() {\n\t\t\tsuper(null!, null!);\n\t\t}\n\t\tpublic override match(languageId: LanguageId, token: string): number {\n\t\t\treturn (\n\t\t\t\t((this.counter++) << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t| (languageId << MetadataConsts.LANGUAGEID_OFFSET)\n\t\t\t) >>> 0;\n\t\t}\n\t}\n\n\tclass MockThemeService implements IStandaloneThemeService {\n\t\tdeclare readonly _serviceBrand: undefined;\n\t\tpublic setTheme(themeName: string): string {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic setAutoDetectHighContrast(autoDetectHighContrast: boolean): void {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic defineTheme(themeName: string, themeData: IStandaloneThemeData): void {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic getColorTheme(): IStandaloneTheme {\n\t\t\treturn {\n\t\t\t\tlabel: 'mock',\n\n\t\t\t\ttokenTheme: new MockTokenTheme(),\n\n\t\t\t\tthemeName: ColorScheme.LIGHT,\n\n\t\t\t\ttype: ColorScheme.LIGHT,\n\n\t\t\t\tgetColor: (color: ColorIdentifier, useDefault?: boolean): Color => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t},\n\n\t\t\t\tdefines: (color: ColorIdentifier): boolean => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t},\n\n\t\t\t\tgetTokenStyleMetadata: (type: string, modifiers: string[], modelLanguage: string): ITokenStyle | undefined => {\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tsemanticHighlighting: false,\n\n\t\t\t\ttokenColorMap: []\n\t\t\t};\n\t\t}\n\t\tsetColorMapOverride(colorMapOverride: Color[] | null): void {\n\t\t}\n\t\tpublic getFileIconTheme(): IFileIconTheme {\n\t\t\treturn {\n\t\t\t\thasFileIcons: false,\n\t\t\t\thasFolderIcons: false,\n\t\t\t\thidesExplorerArrows: false\n\t\t\t};\n\t\t}\n\t\tpublic readonly onDidColorThemeChange = new Emitter<IColorTheme>().event;\n\t\tpublic readonly onDidFileIconThemeChange = new Emitter<IFileIconTheme>().event;\n\t}\n\n\tclass MockState implements IState {\n\t\tpublic static readonly INSTANCE = new MockState();\n\t\tprivate constructor() { }\n\t\tpublic clone(): IState {\n\t\t\treturn this;\n\t\t}\n\t\tpublic equals(other: IState): boolean {\n\t\t\treturn this === other;\n\t\t}\n\t}\n\n\tfunction testBadTokensProvider(providerTokens: IToken[], offsetDelta: number, expectedClassicTokens: Token[], expectedModernTokens: number[]): void {\n\n\t\tclass BadTokensProvider implements TokensProvider {\n\t\t\tpublic getInitialState(): IState {\n\t\t\t\treturn MockState.INSTANCE;\n\t\t\t}\n\t\t\tpublic tokenize(line: string, state: IState): ILineTokens {\n\t\t\t\treturn {\n\t\t\t\t\ttokens: providerTokens,\n\t\t\t\t\tendState: MockState.INSTANCE\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst adapter = new TokenizationSupport2Adapter(new MockThemeService(), languageIdentifier, new BadTokensProvider());\n\n\t\tconst actualClassicTokens = adapter.tokenize('whatever', true, MockState.INSTANCE, offsetDelta);\n\t\tassert.deepStrictEqual(actualClassicTokens.tokens, expectedClassicTokens);\n\n\t\tconst actualModernTokens = adapter.tokenize2('whatever', true, MockState.INSTANCE, offsetDelta);\n\t\tconst modernTokens: number[] = [];\n\t\tfor (let i = 0; i < actualModernTokens.tokens.length; i++) {\n\t\t\tmodernTokens[i] = actualModernTokens.tokens[i];\n\t\t}\n\t\tassert.deepStrictEqual(modernTokens, expectedModernTokens);\n\t}\n\n\ttest('tokens always start at index 0 (no offset delta)', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 7, scopes: 'foo' },\n\t\t\t\t{ startIndex: 0, scopes: 'bar' }\n\t\t\t],\n\t\t\t0,\n\t\t\t[\n\t\t\t\tnew Token(0, 'foo', languageIdentifier.language),\n\t\t\t\tnew Token(0, 'bar', languageIdentifier.language),\n\t\t\t],\n\t\t\t[\n\t\t\t\t0, tokenMetadata | (0 << MetadataConsts.FOREGROUND_OFFSET),\n\t\t\t\t0, tokenMetadata | (1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('tokens always start after each other (no offset delta)', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 0, scopes: 'foo' },\n\t\t\t\t{ startIndex: 5, scopes: 'bar' },\n\t\t\t\t{ startIndex: 3, scopes: 'foo' },\n\t\t\t],\n\t\t\t0,\n\t\t\t[\n\t\t\t\tnew Token(0, 'foo', languageIdentifier.language),\n\t\t\t\tnew Token(5, 'bar', languageIdentifier.language),\n\t\t\t\tnew Token(5, 'foo', languageIdentifier.language),\n\t\t\t],\n\t\t\t[\n\t\t\t\t0, tokenMetadata | (0 << MetadataConsts.FOREGROUND_OFFSET),\n\t\t\t\t5, tokenMetadata | (1 << MetadataConsts.FOREGROUND_OFFSET),\n\t\t\t\t5, tokenMetadata | (2 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('tokens always start at index 0 (with offset delta)', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 7, scopes: 'foo' },\n\t\t\t\t{ startIndex: 0, scopes: 'bar' }\n\t\t\t],\n\t\t\t7,\n\t\t\t[\n\t\t\t\tnew Token(7, 'foo', languageIdentifier.language),\n\t\t\t\tnew Token(7, 'bar', languageIdentifier.language),\n\t\t\t],\n\t\t\t[\n\t\t\t\t7, tokenMetadata | (0 << MetadataConsts.FOREGROUND_OFFSET),\n\t\t\t\t7, tokenMetadata | (1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('tokens always start after each other (with offset delta)', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 0, scopes: 'foo' },\n\t\t\t\t{ startIndex: 5, scopes: 'bar' },\n\t\t\t\t{ startIndex: 3, scopes: 'foo' },\n\t\t\t],\n\t\t\t7,\n\t\t\t[\n\t\t\t\tnew Token(7, 'foo', languageIdentifier.language),\n\t\t\t\tnew Token(12, 'bar', languageIdentifier.language),\n\t\t\t\tnew Token(12, 'foo', languageIdentifier.language),\n\t\t\t],\n\t\t\t[\n\t\t\t\t7, tokenMetadata | (0 << MetadataConsts.FOREGROUND_OFFSET),\n\t\t\t\t12, tokenMetadata | (1 << MetadataConsts.FOREGROUND_OFFSET),\n\t\t\t\t12, tokenMetadata | (2 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t]\n\t\t);\n\t});\n\n});\n"]}