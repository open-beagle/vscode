{"version":3,"file":"editableTextModelTestUtils.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/test/common/model/editableTextModelTestUtils.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { Position } from 'vs/editor/common/core/position';\nimport { EndOfLinePreference, EndOfLineSequence, IIdentifiedSingleEditOperation } from 'vs/editor/common/model';\nimport { MirrorTextModel } from 'vs/editor/common/model/mirrorTextModel';\nimport { TextModel } from 'vs/editor/common/model/textModel';\nimport { IModelContentChangedEvent } from 'vs/editor/common/model/textModelEvents';\nimport { createTextModel } from 'vs/editor/test/common/editorTestUtils';\n\nexport function testApplyEditsWithSyncedModels(original: string[], edits: IIdentifiedSingleEditOperation[], expected: string[], inputEditsAreInvalid: boolean = false): void {\n\tlet originalStr = original.join('\\n');\n\tlet expectedStr = expected.join('\\n');\n\n\tassertSyncedModels(originalStr, (model, assertMirrorModels) => {\n\t\t// Apply edits & collect inverse edits\n\t\tlet inverseEdits = model.applyEdits(edits, true);\n\n\t\t// Assert edits produced expected result\n\t\tassert.deepStrictEqual(model.getValue(EndOfLinePreference.LF), expectedStr);\n\n\t\tassertMirrorModels();\n\n\t\t// Apply the inverse edits\n\t\tlet inverseInverseEdits = model.applyEdits(inverseEdits, true);\n\n\t\t// Assert the inverse edits brought back model to original state\n\t\tassert.deepStrictEqual(model.getValue(EndOfLinePreference.LF), originalStr);\n\n\t\tif (!inputEditsAreInvalid) {\n\t\t\tconst simplifyEdit = (edit: IIdentifiedSingleEditOperation) => {\n\t\t\t\treturn {\n\t\t\t\t\tidentifier: edit.identifier,\n\t\t\t\t\trange: edit.range,\n\t\t\t\t\ttext: edit.text,\n\t\t\t\t\tforceMoveMarkers: edit.forceMoveMarkers || false,\n\t\t\t\t\tisAutoWhitespaceEdit: edit.isAutoWhitespaceEdit || false\n\t\t\t\t};\n\t\t\t};\n\t\t\t// Assert the inverse of the inverse edits are the original edits\n\t\t\tassert.deepStrictEqual(inverseInverseEdits.map(simplifyEdit), edits.map(simplifyEdit));\n\t\t}\n\n\t\tassertMirrorModels();\n\t});\n}\n\nconst enum AssertDocumentLineMappingDirection {\n\tOffsetToPosition,\n\tPositionToOffset\n}\n\nfunction assertOneDirectionLineMapping(model: TextModel, direction: AssertDocumentLineMappingDirection, msg: string): void {\n\tlet allText = model.getValue();\n\n\tlet line = 1, column = 1, previousIsCarriageReturn = false;\n\tfor (let offset = 0; offset <= allText.length; offset++) {\n\t\t// The position coordinate system cannot express the position between \\r and \\n\n\t\tlet position: Position = new Position(line, column + (previousIsCarriageReturn ? -1 : 0));\n\n\t\tif (direction === AssertDocumentLineMappingDirection.OffsetToPosition) {\n\t\t\tlet actualPosition = model.getPositionAt(offset);\n\t\t\tassert.strictEqual(actualPosition.toString(), position.toString(), msg + ' - getPositionAt mismatch for offset ' + offset);\n\t\t} else {\n\t\t\t// The position coordinate system cannot express the position between \\r and \\n\n\t\t\tlet expectedOffset: number = offset + (previousIsCarriageReturn ? -1 : 0);\n\t\t\tlet actualOffset = model.getOffsetAt(position);\n\t\t\tassert.strictEqual(actualOffset, expectedOffset, msg + ' - getOffsetAt mismatch for position ' + position.toString());\n\t\t}\n\n\t\tif (allText.charAt(offset) === '\\n') {\n\t\t\tline++;\n\t\t\tcolumn = 1;\n\t\t} else {\n\t\t\tcolumn++;\n\t\t}\n\n\t\tpreviousIsCarriageReturn = (allText.charAt(offset) === '\\r');\n\t}\n}\n\nfunction assertLineMapping(model: TextModel, msg: string): void {\n\tassertOneDirectionLineMapping(model, AssertDocumentLineMappingDirection.PositionToOffset, msg);\n\tassertOneDirectionLineMapping(model, AssertDocumentLineMappingDirection.OffsetToPosition, msg);\n}\n\n\nexport function assertSyncedModels(text: string, callback: (model: TextModel, assertMirrorModels: () => void) => void, setup: ((model: TextModel) => void) | null = null): void {\n\tlet model = createTextModel(text, TextModel.DEFAULT_CREATION_OPTIONS, null);\n\tmodel.setEOL(EndOfLineSequence.LF);\n\tassertLineMapping(model, 'model');\n\n\tif (setup) {\n\t\tsetup(model);\n\t\tassertLineMapping(model, 'model');\n\t}\n\n\tlet mirrorModel2 = new MirrorTextModel(null!, model.getLinesContent(), model.getEOL(), model.getVersionId());\n\tlet mirrorModel2PrevVersionId = model.getVersionId();\n\n\tmodel.onDidChangeContent((e: IModelContentChangedEvent) => {\n\t\tlet versionId = e.versionId;\n\t\tif (versionId < mirrorModel2PrevVersionId) {\n\t\t\tconsole.warn('Model version id did not advance between edits (2)');\n\t\t}\n\t\tmirrorModel2PrevVersionId = versionId;\n\t\tmirrorModel2.onEvents(e);\n\t});\n\n\tlet assertMirrorModels = () => {\n\t\tassertLineMapping(model, 'model');\n\t\tassert.strictEqual(mirrorModel2.getText(), model.getValue(), 'mirror model 2 text OK');\n\t\tassert.strictEqual(mirrorModel2.version, model.getVersionId(), 'mirror model 2 version OK');\n\t};\n\n\tcallback(model, assertMirrorModels);\n\n\tmodel.dispose();\n\tmirrorModel2.dispose();\n}\n"]}