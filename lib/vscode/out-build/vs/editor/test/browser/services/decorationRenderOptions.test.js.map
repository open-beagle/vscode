{"version":3,"file":"decorationRenderOptions.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/test/browser/services/decorationRenderOptions.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport * as platform from 'vs/base/common/platform';\nimport { URI } from 'vs/base/common/uri';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { CodeEditorServiceImpl, GlobalStyleSheet } from 'vs/editor/browser/services/codeEditorServiceImpl';\nimport { IDecorationRenderOptions } from 'vs/editor/common/editorCommon';\nimport { IResourceEditorInput } from 'vs/platform/editor/common/editor';\nimport { TestColorTheme, TestThemeService } from 'vs/platform/theme/test/common/testThemeService';\n\nconst themeServiceMock = new TestThemeService();\n\nclass TestCodeEditorServiceImpl extends CodeEditorServiceImpl {\n\tgetActiveCodeEditor(): ICodeEditor | null {\n\t\treturn null;\n\t}\n\n\topenCodeEditor(input: IResourceEditorInput, source: ICodeEditor | null, sideBySide?: boolean): Promise<ICodeEditor | null> {\n\t\treturn Promise.resolve(null);\n\t}\n}\n\nclass TestGlobalStyleSheet extends GlobalStyleSheet {\n\n\tpublic rules: string[] = [];\n\n\tconstructor() {\n\t\tsuper(null!);\n\t}\n\n\tpublic override insertRule(rule: string, index?: number): void {\n\t\tthis.rules.unshift(rule);\n\t}\n\n\tpublic override removeRulesContainingSelector(ruleName: string): void {\n\t\tfor (let i = 0; i < this.rules.length; i++) {\n\t\t\tif (this.rules[i].indexOf(ruleName) >= 0) {\n\t\t\t\tthis.rules.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic read(): string {\n\t\treturn this.rules.join('\\n');\n\t}\n}\n\nsuite('Decoration Render Options', () => {\n\tlet options: IDecorationRenderOptions = {\n\t\tgutterIconPath: URI.parse('https://github.com/microsoft/vscode/blob/main/resources/linux/code.png'),\n\t\tgutterIconSize: 'contain',\n\t\tbackgroundColor: 'red',\n\t\tborderColor: 'yellow'\n\t};\n\ttest('register and resolve decoration type', () => {\n\t\tlet s = new TestCodeEditorServiceImpl(null, themeServiceMock);\n\t\ts.registerDecorationType('example', options);\n\t\tassert.notStrictEqual(s.resolveDecorationOptions('example', false), undefined);\n\t});\n\ttest('remove decoration type', () => {\n\t\tlet s = new TestCodeEditorServiceImpl(null, themeServiceMock);\n\t\ts.registerDecorationType('example', options);\n\t\tassert.notStrictEqual(s.resolveDecorationOptions('example', false), undefined);\n\t\ts.removeDecorationType('example');\n\t\tassert.throws(() => s.resolveDecorationOptions('example', false));\n\t});\n\n\tfunction readStyleSheet(styleSheet: TestGlobalStyleSheet): string {\n\t\treturn styleSheet.read();\n\t}\n\n\ttest('css properties', () => {\n\t\tconst styleSheet = new TestGlobalStyleSheet();\n\t\tconst s = new TestCodeEditorServiceImpl(styleSheet, themeServiceMock);\n\t\ts.registerDecorationType('example', options);\n\t\tconst sheet = readStyleSheet(styleSheet);\n\t\tassert(sheet.indexOf(`{background:url('https://github.com/microsoft/vscode/blob/main/resources/linux/code.png') center center no-repeat;background-size:contain;}`) >= 0);\n\t\tassert(sheet.indexOf(`{background-color:red;border-color:yellow;box-sizing: border-box;}`) >= 0);\n\t});\n\n\ttest('theme color', () => {\n\t\tconst options: IDecorationRenderOptions = {\n\t\t\tbackgroundColor: { id: 'editorBackground' },\n\t\t\tborderColor: { id: 'editorBorder' },\n\t\t};\n\n\t\tconst styleSheet = new TestGlobalStyleSheet();\n\t\tconst themeService = new TestThemeService(new TestColorTheme({\n\t\t\teditorBackground: '#FF0000'\n\t\t}));\n\t\tconst s = new TestCodeEditorServiceImpl(styleSheet, themeService);\n\t\ts.registerDecorationType('example', options);\n\t\tassert.strictEqual(readStyleSheet(styleSheet), '.monaco-editor .ced-example-0 {background-color:#ff0000;border-color:transparent;box-sizing: border-box;}');\n\n\t\tthemeService.setTheme(new TestColorTheme({\n\t\t\teditorBackground: '#EE0000',\n\t\t\teditorBorder: '#00FFFF'\n\t\t}));\n\t\tassert.strictEqual(readStyleSheet(styleSheet), '.monaco-editor .ced-example-0 {background-color:#ee0000;border-color:#00ffff;box-sizing: border-box;}');\n\n\t\ts.removeDecorationType('example');\n\t\tassert.strictEqual(readStyleSheet(styleSheet), '');\n\t});\n\n\ttest('theme overrides', () => {\n\t\tconst options: IDecorationRenderOptions = {\n\t\t\tcolor: { id: 'editorBackground' },\n\t\t\tlight: {\n\t\t\t\tcolor: '#FF00FF'\n\t\t\t},\n\t\t\tdark: {\n\t\t\t\tcolor: '#000000',\n\t\t\t\tafter: {\n\t\t\t\t\tcolor: { id: 'infoForeground' }\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst styleSheet = new TestGlobalStyleSheet();\n\t\tconst themeService = new TestThemeService(new TestColorTheme({\n\t\t\teditorBackground: '#FF0000',\n\t\t\tinfoForeground: '#444444'\n\t\t}));\n\t\tconst s = new TestCodeEditorServiceImpl(styleSheet, themeService);\n\t\ts.registerDecorationType('example', options);\n\t\tconst expected = [\n\t\t\t'.vs-dark.monaco-editor .ced-example-4::after, .hc-black.monaco-editor .ced-example-4::after {color:#444444 !important;}',\n\t\t\t'.vs-dark.monaco-editor .ced-example-1, .hc-black.monaco-editor .ced-example-1 {color:#000000 !important;}',\n\t\t\t'.vs.monaco-editor .ced-example-1 {color:#FF00FF !important;}',\n\t\t\t'.monaco-editor .ced-example-1 {color:#ff0000 !important;}'\n\t\t].join('\\n');\n\t\tassert.strictEqual(readStyleSheet(styleSheet), expected);\n\n\t\ts.removeDecorationType('example');\n\t\tassert.strictEqual(readStyleSheet(styleSheet), '');\n\t});\n\n\ttest('css properties, gutterIconPaths', () => {\n\t\tconst styleSheet = new TestGlobalStyleSheet();\n\t\tconst s = new TestCodeEditorServiceImpl(styleSheet, themeServiceMock);\n\n\t\t// URI, only minimal encoding\n\t\ts.registerDecorationType('example', { gutterIconPath: URI.parse('data:image/svg+xml;base64,PHN2ZyB4b+') });\n\t\tassert(readStyleSheet(styleSheet).indexOf(`{background:url('data:image/svg+xml;base64,PHN2ZyB4b+') center center no-repeat;}`) > 0);\n\t\ts.removeDecorationType('example');\n\n\t\tfunction assertBackground(url1: string, url2: string) {\n\t\t\tconst actual = readStyleSheet(styleSheet);\n\t\t\tassert(\n\t\t\t\tactual.indexOf(`{background:url('${url1}') center center no-repeat;}`) > 0\n\t\t\t\t|| actual.indexOf(`{background:url('${url2}') center center no-repeat;}`) > 0\n\t\t\t);\n\t\t}\n\n\t\tif (platform.isWindows) {\n\t\t\t// windows file path (used as string)\n\t\t\ts.registerDecorationType('example', { gutterIconPath: URI.file('c:\\\\files\\\\miles\\\\more.png') });\n\t\t\tassertBackground('file:///c:/files/miles/more.png', 'vscode-file://vscode-app/c:/files/miles/more.png');\n\t\t\ts.removeDecorationType('example');\n\n\t\t\t// single quote must always be escaped/encoded\n\t\t\ts.registerDecorationType('example', { gutterIconPath: URI.file('c:\\\\files\\\\foo\\\\b\\'ar.png') });\n\t\t\tassertBackground('file:///c:/files/foo/b%27ar.png', 'vscode-file://vscode-app/c:/files/foo/b%27ar.png');\n\t\t\ts.removeDecorationType('example');\n\t\t} else {\n\t\t\t// unix file path (used as string)\n\t\t\ts.registerDecorationType('example', { gutterIconPath: URI.file('/Users/foo/bar.png') });\n\t\t\tassertBackground('file:///Users/foo/bar.png', 'vscode-file://vscode-app/Users/foo/bar.png');\n\t\t\ts.removeDecorationType('example');\n\n\t\t\t// single quote must always be escaped/encoded\n\t\t\ts.registerDecorationType('example', { gutterIconPath: URI.file('/Users/foo/b\\'ar.png') });\n\t\t\tassertBackground('file:///Users/foo/b%27ar.png', 'vscode-file://vscode-app/Users/foo/b%27ar.png');\n\t\t\ts.removeDecorationType('example');\n\t\t}\n\n\t\ts.registerDecorationType('example', { gutterIconPath: URI.parse('http://test/pa\\'th') });\n\t\tassert(readStyleSheet(styleSheet).indexOf(`{background:url('http://test/pa%27th') center center no-repeat;}`) > 0);\n\t\ts.removeDecorationType('example');\n\t});\n});\n"]}