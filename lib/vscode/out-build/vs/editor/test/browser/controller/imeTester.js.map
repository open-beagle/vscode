{"version":3,"file":"imeTester.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/test/browser/controller/imeTester.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createFastDomNode } from 'vs/base/browser/fastDomNode';\nimport { ITextAreaInputHost, TextAreaInput } from 'vs/editor/browser/controller/textAreaInput';\nimport { ISimpleModel, PagedScreenReaderStrategy, TextAreaState } from 'vs/editor/browser/controller/textAreaState';\nimport { Position } from 'vs/editor/common/core/position';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { EndOfLinePreference } from 'vs/editor/common/model';\nimport * as dom from 'vs/base/browser/dom';\n\n// To run this test, open imeTester.html\n\nclass SingleLineTestModel implements ISimpleModel {\n\n\tprivate _line: string;\n\n\tconstructor(line: string) {\n\t\tthis._line = line;\n\t}\n\n\t_setText(text: string) {\n\t\tthis._line = text;\n\t}\n\n\tgetLineMaxColumn(lineNumber: number): number {\n\t\treturn this._line.length + 1;\n\t}\n\n\tgetValueInRange(range: IRange, eol: EndOfLinePreference): string {\n\t\treturn this._line.substring(range.startColumn - 1, range.endColumn - 1);\n\t}\n\n\tgetModelLineContent(lineNumber: number): string {\n\t\treturn this._line;\n\t}\n\n\tgetLineCount(): number {\n\t\treturn 1;\n\t}\n}\n\nclass TestView {\n\n\tprivate readonly _model: SingleLineTestModel;\n\n\tconstructor(model: SingleLineTestModel) {\n\t\tthis._model = model;\n\t}\n\n\tpublic paint(output: HTMLElement) {\n\t\tdom.clearNode(output);\n\t\tfor (let i = 1; i <= this._model.getLineCount(); i++) {\n\t\t\tconst textNode = document.createTextNode(this._model.getModelLineContent(i));\n\t\t\toutput.appendChild(textNode);\n\t\t\tconst br = document.createElement('br');\n\t\t\toutput.appendChild(br);\n\t\t}\n\t}\n}\n\nfunction doCreateTest(description: string, inputStr: string, expectedStr: string): HTMLElement {\n\tlet cursorOffset: number = 0;\n\tlet cursorLength: number = 0;\n\n\tlet container = document.createElement('div');\n\tcontainer.className = 'container';\n\n\tlet title = document.createElement('div');\n\ttitle.className = 'title';\n\n\tconst inputStrStrong = document.createElement('strong');\n\tinputStrStrong.innerText = inputStr;\n\n\ttitle.innerText = description + '. Type ';\n\ttitle.appendChild(inputStrStrong);\n\n\tcontainer.appendChild(title);\n\n\tlet startBtn = document.createElement('button');\n\tstartBtn.innerText = 'Start';\n\tcontainer.appendChild(startBtn);\n\n\n\tlet input = document.createElement('textarea');\n\tinput.setAttribute('rows', '10');\n\tinput.setAttribute('cols', '40');\n\tcontainer.appendChild(input);\n\n\tlet model = new SingleLineTestModel('some  text');\n\n\tconst textAreaInputHost: ITextAreaInputHost = {\n\t\tgetDataToCopy: () => {\n\t\t\treturn {\n\t\t\t\tisFromEmptySelection: false,\n\t\t\t\tmulticursorText: null,\n\t\t\t\ttext: '',\n\t\t\t\thtml: undefined,\n\t\t\t\tmode: null\n\t\t\t};\n\t\t},\n\t\tgetScreenReaderContent: (currentState: TextAreaState): TextAreaState => {\n\t\t\tconst selection = new Range(1, 1 + cursorOffset, 1, 1 + cursorOffset + cursorLength);\n\n\t\t\treturn PagedScreenReaderStrategy.fromEditorSelection(currentState, model, selection, 10, true);\n\t\t},\n\t\tdeduceModelPosition: (viewAnchorPosition: Position, deltaOffset: number, lineFeedCnt: number): Position => {\n\t\t\treturn null!;\n\t\t}\n\t};\n\n\tlet handler = new TextAreaInput(textAreaInputHost, createFastDomNode(input));\n\n\tlet output = document.createElement('pre');\n\toutput.className = 'output';\n\tcontainer.appendChild(output);\n\n\tlet check = document.createElement('pre');\n\tcheck.className = 'check';\n\tcontainer.appendChild(check);\n\n\tlet br = document.createElement('br');\n\tbr.style.clear = 'both';\n\tcontainer.appendChild(br);\n\n\tlet view = new TestView(model);\n\n\tlet updatePosition = (off: number, len: number) => {\n\t\tcursorOffset = off;\n\t\tcursorLength = len;\n\t\thandler.writeScreenReaderContent('selection changed');\n\t\thandler.focusTextArea();\n\t};\n\n\tlet updateModelAndPosition = (text: string, off: number, len: number) => {\n\t\tmodel._setText(text);\n\t\tupdatePosition(off, len);\n\t\tview.paint(output);\n\n\t\tlet expected = 'some ' + expectedStr + ' text';\n\t\tif (text === expected) {\n\t\t\tcheck.innerText = '[GOOD]';\n\t\t\tcheck.className = 'check good';\n\t\t} else {\n\t\t\tcheck.innerText = '[BAD]';\n\t\t\tcheck.className = 'check bad';\n\t\t}\n\t\tcheck.appendChild(document.createTextNode(expected));\n\t};\n\n\thandler.onType((e) => {\n\t\tconsole.log('type text: ' + e.text + ', replaceCharCnt: ' + e.replacePrevCharCnt);\n\t\tlet text = model.getModelLineContent(1);\n\t\tlet preText = text.substring(0, cursorOffset - e.replacePrevCharCnt);\n\t\tlet postText = text.substring(cursorOffset + cursorLength);\n\t\tlet midText = e.text;\n\n\t\tupdateModelAndPosition(preText + midText + postText, (preText + midText).length, 0);\n\t});\n\n\tview.paint(output);\n\n\tstartBtn.onclick = function () {\n\t\tupdateModelAndPosition('some  text', 5, 0);\n\t\tinput.focus();\n\t};\n\n\treturn container;\n}\n\nconst TESTS = [\n\t{ description: 'Japanese IME 1', in: 'sennsei [Enter]', out: 'せんせい' },\n\t{ description: 'Japanese IME 2', in: 'konnichiha [Enter]', out: 'こんいちは' },\n\t{ description: 'Japanese IME 3', in: 'mikann [Enter]', out: 'みかん' },\n\t{ description: 'Korean IME 1', in: 'gksrmf [Space]', out: '한글 ' },\n\t{ description: 'Chinese IME 1', in: '.,', out: '。，' },\n\t{ description: 'Chinese IME 2', in: 'ni [Space] hao [Space]', out: '你好' },\n\t{ description: 'Chinese IME 3', in: 'hazni [Space]', out: '哈祝你' },\n\t{ description: 'Mac dead key 1', in: '`.', out: '`.' },\n\t{ description: 'Mac hold key 1', in: 'e long press and 1', out: 'é' }\n];\n\nTESTS.forEach((t) => {\n\tdocument.body.appendChild(doCreateTest(t.description, t.in, t.out));\n});\n"]}