{"version":3,"file":"textResourceConfigurationServiceImpl.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/editor/common/services/textResourceConfigurationServiceImpl.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { IPosition, Position } from 'vs/editor/common/core/position';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport { IModelService } from 'vs/editor/common/services/modelService';\nimport { ITextResourceConfigurationService, ITextResourceConfigurationChangeEvent } from 'vs/editor/common/services/textResourceConfigurationService';\nimport { IConfigurationService, ConfigurationTarget, IConfigurationValue, IConfigurationChangeEvent } from 'vs/platform/configuration/common/configuration';\n\nexport class TextResourceConfigurationService extends Disposable implements ITextResourceConfigurationService {\n\n\tpublic _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeConfiguration: Emitter<ITextResourceConfigurationChangeEvent> = this._register(new Emitter<ITextResourceConfigurationChangeEvent>());\n\tpublic readonly onDidChangeConfiguration: Event<ITextResourceConfigurationChangeEvent> = this._onDidChangeConfiguration.event;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IModeService private readonly modeService: IModeService,\n\t) {\n\t\tsuper();\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => this._onDidChangeConfiguration.fire(this.toResourceConfigurationChangeEvent(e))));\n\t}\n\n\tgetValue<T>(resource: URI | undefined, section?: string): T;\n\tgetValue<T>(resource: URI | undefined, at?: IPosition, section?: string): T;\n\tgetValue<T>(resource: URI | undefined, arg2?: any, arg3?: any): T {\n\t\tif (typeof arg3 === 'string') {\n\t\t\treturn this._getValue(resource, Position.isIPosition(arg2) ? arg2 : null, arg3);\n\t\t}\n\t\treturn this._getValue(resource, null, typeof arg2 === 'string' ? arg2 : undefined);\n\t}\n\n\tupdateValue(resource: URI, key: string, value: any, configurationTarget?: ConfigurationTarget): Promise<void> {\n\t\tconst language = this.getLanguage(resource, null);\n\t\tconst configurationValue = this.configurationService.inspect(key, { resource, overrideIdentifier: language });\n\t\tif (configurationTarget === undefined) {\n\t\t\tconfigurationTarget = this.deriveConfigurationTarget(configurationValue, language);\n\t\t}\n\t\tswitch (configurationTarget) {\n\t\t\tcase ConfigurationTarget.MEMORY:\n\t\t\t\treturn this._updateValue(key, value, configurationTarget, configurationValue.memory?.override, resource, language);\n\t\t\tcase ConfigurationTarget.WORKSPACE_FOLDER:\n\t\t\t\treturn this._updateValue(key, value, configurationTarget, configurationValue.workspaceFolder?.override, resource, language);\n\t\t\tcase ConfigurationTarget.WORKSPACE:\n\t\t\t\treturn this._updateValue(key, value, configurationTarget, configurationValue.workspace?.override, resource, language);\n\t\t\tcase ConfigurationTarget.USER_REMOTE:\n\t\t\t\treturn this._updateValue(key, value, configurationTarget, configurationValue.userRemote?.override, resource, language);\n\t\t\tdefault:\n\t\t\t\treturn this._updateValue(key, value, configurationTarget, configurationValue.userLocal?.override, resource, language);\n\t\t}\n\t}\n\n\tprivate _updateValue(key: string, value: any, configurationTarget: ConfigurationTarget, overriddenValue: any | undefined, resource: URI, language: string | null): Promise<void> {\n\t\tif (language && overriddenValue !== undefined) {\n\t\t\treturn this.configurationService.updateValue(key, value, { resource, overrideIdentifier: language }, configurationTarget);\n\t\t} else {\n\t\t\treturn this.configurationService.updateValue(key, value, { resource }, configurationTarget);\n\t\t}\n\t}\n\n\tprivate deriveConfigurationTarget(configurationValue: IConfigurationValue<any>, language: string | null): ConfigurationTarget {\n\t\tif (language) {\n\t\t\tif (configurationValue.memory?.override !== undefined) {\n\t\t\t\treturn ConfigurationTarget.MEMORY;\n\t\t\t}\n\t\t\tif (configurationValue.workspaceFolder?.override !== undefined) {\n\t\t\t\treturn ConfigurationTarget.WORKSPACE_FOLDER;\n\t\t\t}\n\t\t\tif (configurationValue.workspace?.override !== undefined) {\n\t\t\t\treturn ConfigurationTarget.WORKSPACE;\n\t\t\t}\n\t\t\tif (configurationValue.userRemote?.override !== undefined) {\n\t\t\t\treturn ConfigurationTarget.USER_REMOTE;\n\t\t\t}\n\t\t\tif (configurationValue.userLocal?.override !== undefined) {\n\t\t\t\treturn ConfigurationTarget.USER_LOCAL;\n\t\t\t}\n\t\t}\n\t\tif (configurationValue.memory?.value !== undefined) {\n\t\t\treturn ConfigurationTarget.MEMORY;\n\t\t}\n\t\tif (configurationValue.workspaceFolder?.value !== undefined) {\n\t\t\treturn ConfigurationTarget.WORKSPACE_FOLDER;\n\t\t}\n\t\tif (configurationValue.workspace?.value !== undefined) {\n\t\t\treturn ConfigurationTarget.WORKSPACE;\n\t\t}\n\t\tif (configurationValue.userRemote?.value !== undefined) {\n\t\t\treturn ConfigurationTarget.USER_REMOTE;\n\t\t}\n\t\treturn ConfigurationTarget.USER_LOCAL;\n\t}\n\n\tprivate _getValue<T>(resource: URI | undefined, position: IPosition | null, section: string | undefined): T {\n\t\tconst language = resource ? this.getLanguage(resource, position) : undefined;\n\t\tif (typeof section === 'undefined') {\n\t\t\treturn this.configurationService.getValue<T>({ resource, overrideIdentifier: language });\n\t\t}\n\t\treturn this.configurationService.getValue<T>(section, { resource, overrideIdentifier: language });\n\t}\n\n\tprivate getLanguage(resource: URI, position: IPosition | null): string | null {\n\t\tconst model = this.modelService.getModel(resource);\n\t\tif (model) {\n\t\t\treturn position ? this.modeService.getLanguageIdentifier(model.getLanguageIdAtPosition(position.lineNumber, position.column))!.language : model.getLanguageIdentifier().language;\n\t\t}\n\t\treturn this.modeService.getModeIdByFilepathOrFirstLine(resource);\n\t}\n\n\tprivate toResourceConfigurationChangeEvent(configurationChangeEvent: IConfigurationChangeEvent): ITextResourceConfigurationChangeEvent {\n\t\treturn {\n\t\t\taffectedKeys: configurationChangeEvent.affectedKeys,\n\t\t\taffectsConfiguration: (resource: URI, configuration: string) => {\n\t\t\t\tconst overrideIdentifier = this.getLanguage(resource, null);\n\t\t\t\treturn configurationChangeEvent.affectsConfiguration(configuration, { resource, overrideIdentifier });\n\t\t\t}\n\t\t};\n\t}\n}\n"]}