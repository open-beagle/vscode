{"version":3,"file":"extHostNotebook.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/api/common/extHostNotebook.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from 'vs/base/common/async';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IRelativePattern } from 'vs/base/common/glob';\nimport { hash } from 'vs/base/common/hash';\nimport { IdGenerator } from 'vs/base/common/idGenerator';\nimport { Disposable, DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { isFalsyOrWhitespace } from 'vs/base/common/strings';\nimport { assertIsDefined } from 'vs/base/common/types';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { Cache } from 'vs/workbench/api/common/cache';\nimport { ExtHostNotebookShape, IMainContext, IModelAddedData, INotebookCellStatusBarListDto, INotebookDocumentPropertiesChangeData, INotebookDocumentsAndEditorsDelta, INotebookDocumentShowOptions, INotebookEditorAddData, INotebookEditorPropertiesChangeData, INotebookEditorViewColumnInfo, MainContext, MainThreadNotebookDocumentsShape, MainThreadNotebookEditorsShape, MainThreadNotebookShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { CommandsConverter, ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtensionStoragePaths } from 'vs/workbench/api/common/extHostStoragePaths';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport * as extHostTypes from 'vs/workbench/api/common/extHostTypes';\nimport { CellEditType, IImmediateCellEditOperation, INotebookExclusiveDocumentFilter, NotebookCellsChangedEventDto, NotebookCellsChangeType, NotebookDataDto, NullablePartialNotebookCellMetadata } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport type * as vscode from 'vscode';\nimport { ExtHostCell, ExtHostNotebookDocument } from './extHostNotebookDocument';\nimport { ExtHostNotebookEditor } from './extHostNotebookEditor';\n\n\nexport class NotebookEditorDecorationType {\n\n\tprivate static readonly _Keys = new IdGenerator('NotebookEditorDecorationType');\n\n\treadonly value: vscode.NotebookEditorDecorationType;\n\n\tconstructor(proxy: MainThreadNotebookEditorsShape, options: vscode.NotebookDecorationRenderOptions) {\n\t\tconst key = NotebookEditorDecorationType._Keys.nextId();\n\t\tproxy.$registerNotebookEditorDecorationType(key, typeConverters.NotebookDecorationRenderOptions.from(options));\n\n\t\tthis.value = {\n\t\t\tkey,\n\t\t\tdispose() {\n\t\t\t\tproxy.$removeNotebookEditorDecorationType(key);\n\t\t\t}\n\t\t};\n\t}\n}\n\n\ntype NotebookContentProviderData = {\n\treadonly provider: vscode.NotebookContentProvider;\n\treadonly extension: IExtensionDescription;\n};\n\nexport class ExtHostNotebookController implements ExtHostNotebookShape {\n\tprivate static _notebookStatusBarItemProviderHandlePool: number = 0;\n\n\tprivate readonly _notebookProxy: MainThreadNotebookShape;\n\tprivate readonly _notebookDocumentsProxy: MainThreadNotebookDocumentsShape;\n\tprivate readonly _notebookEditorsProxy: MainThreadNotebookEditorsShape;\n\n\tprivate readonly _notebookContentProviders = new Map<string, NotebookContentProviderData>();\n\tprivate readonly _notebookStatusBarItemProviders = new Map<number, vscode.NotebookCellStatusBarItemProvider>();\n\tprivate readonly _documents = new ResourceMap<ExtHostNotebookDocument>();\n\tprivate readonly _editors = new Map<string, ExtHostNotebookEditor>();\n\tprivate readonly _commandsConverter: CommandsConverter;\n\tprivate readonly _onDidChangeNotebookEditorSelection = new Emitter<vscode.NotebookEditorSelectionChangeEvent>();\n\treadonly onDidChangeNotebookEditorSelection = this._onDidChangeNotebookEditorSelection.event;\n\tprivate readonly _onDidChangeNotebookEditorVisibleRanges = new Emitter<vscode.NotebookEditorVisibleRangesChangeEvent>();\n\treadonly onDidChangeNotebookEditorVisibleRanges = this._onDidChangeNotebookEditorVisibleRanges.event;\n\tprivate readonly _onDidChangeNotebookDocumentMetadata = new Emitter<vscode.NotebookDocumentMetadataChangeEvent>();\n\treadonly onDidChangeNotebookDocumentMetadata = this._onDidChangeNotebookDocumentMetadata.event;\n\tprivate readonly _onDidChangeNotebookCells = new Emitter<vscode.NotebookCellsChangeEvent>();\n\treadonly onDidChangeNotebookCells = this._onDidChangeNotebookCells.event;\n\tprivate readonly _onDidChangeCellOutputs = new Emitter<vscode.NotebookCellOutputsChangeEvent>();\n\treadonly onDidChangeCellOutputs = this._onDidChangeCellOutputs.event;\n\tprivate readonly _onDidChangeCellMetadata = new Emitter<vscode.NotebookCellMetadataChangeEvent>();\n\treadonly onDidChangeCellMetadata = this._onDidChangeCellMetadata.event;\n\tprivate readonly _onDidChangeActiveNotebookEditor = new Emitter<vscode.NotebookEditor | undefined>();\n\treadonly onDidChangeActiveNotebookEditor = this._onDidChangeActiveNotebookEditor.event;\n\tprivate readonly _onDidChangeCellExecutionState = new Emitter<vscode.NotebookCellExecutionStateChangeEvent>();\n\treadonly onDidChangeNotebookCellExecutionState = this._onDidChangeCellExecutionState.event;\n\n\tprivate _activeNotebookEditor: ExtHostNotebookEditor | undefined;\n\tget activeNotebookEditor(): vscode.NotebookEditor | undefined {\n\t\treturn this._activeNotebookEditor?.apiEditor;\n\t}\n\tprivate _visibleNotebookEditors: ExtHostNotebookEditor[] = [];\n\tget visibleNotebookEditors(): vscode.NotebookEditor[] {\n\t\treturn this._visibleNotebookEditors.map(editor => editor.apiEditor);\n\t}\n\n\tprivate _onDidOpenNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\tonDidOpenNotebookDocument: Event<vscode.NotebookDocument> = this._onDidOpenNotebookDocument.event;\n\tprivate _onDidCloseNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\tonDidCloseNotebookDocument: Event<vscode.NotebookDocument> = this._onDidCloseNotebookDocument.event;\n\tprivate _onDidSaveNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\tonDidSaveNotebookDocument: Event<vscode.NotebookDocument> = this._onDidSaveNotebookDocument.event;\n\tprivate _onDidChangeVisibleNotebookEditors = new Emitter<vscode.NotebookEditor[]>();\n\tonDidChangeVisibleNotebookEditors = this._onDidChangeVisibleNotebookEditors.event;\n\n\tprivate _activeExecutions = new ResourceMap<NotebookCellExecutionTask>();\n\n\tprivate _statusBarCache = new Cache<IDisposable>('NotebookCellStatusBarCache');\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tcommands: ExtHostCommands,\n\t\tprivate _textDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate _textDocuments: ExtHostDocuments,\n\t\tprivate readonly logService: ILogService,\n\t\tprivate readonly _extensionStoragePaths: IExtensionStoragePaths,\n\t) {\n\t\tthis._notebookProxy = mainContext.getProxy(MainContext.MainThreadNotebook);\n\t\tthis._notebookDocumentsProxy = mainContext.getProxy(MainContext.MainThreadNotebookDocuments);\n\t\tthis._notebookEditorsProxy = mainContext.getProxy(MainContext.MainThreadNotebookEditors);\n\t\tthis._commandsConverter = commands.converter;\n\n\t\tcommands.registerArgumentProcessor({\n\t\t\t// Serialized INotebookCellActionContext\n\t\t\tprocessArgument: (arg) => {\n\t\t\t\tif (arg && arg.$mid === 12) {\n\t\t\t\t\tconst notebookUri = arg.notebookEditor?.notebookUri;\n\t\t\t\t\tconst cellHandle = arg.cell.handle;\n\n\t\t\t\t\tconst data = this._documents.get(notebookUri);\n\t\t\t\t\tconst cell = data?.getCell(cellHandle);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\treturn cell.apiCell;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\t}\n\n\tgetEditorById(editorId: string): ExtHostNotebookEditor | undefined {\n\t\treturn this._editors.get(editorId);\n\t}\n\n\tgetIdByEditor(editor: vscode.NotebookEditor): string | undefined {\n\t\tfor (const [id, candidate] of this._editors) {\n\t\t\tif (candidate.apiEditor === editor) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tget notebookDocuments() {\n\t\treturn [...this._documents.values()];\n\t}\n\n\tlookupNotebookDocument(uri: URI): ExtHostNotebookDocument | undefined {\n\t\treturn this._documents.get(uri);\n\t}\n\n\tprivate _getNotebookDocument(uri: URI): ExtHostNotebookDocument {\n\t\tconst result = this._documents.get(uri);\n\t\tif (!result) {\n\t\t\tthrow new Error(`NO notebook document for '${uri}'`);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _getProviderData(viewType: string): NotebookContentProviderData {\n\t\tconst result = this._notebookContentProviders.get(viewType);\n\t\tif (!result) {\n\t\t\tthrow new Error(`NO provider for '${viewType}'`);\n\t\t}\n\t\treturn result;\n\t}\n\n\tregisterNotebookContentProvider(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tprovider: vscode.NotebookContentProvider,\n\t\toptions?: vscode.NotebookDocumentContentOptions & {\n\t\t\tviewOptions?: {\n\t\t\t\tdisplayName: string;\n\t\t\t\tfilenamePattern: (vscode.GlobPattern | { include: vscode.GlobPattern; exclude: vscode.GlobPattern })[];\n\t\t\t\texclusive?: boolean;\n\t\t\t};\n\t\t}\n\t): vscode.Disposable {\n\t\tif (isFalsyOrWhitespace(viewType)) {\n\t\t\tthrow new Error(`viewType cannot be empty or just whitespace`);\n\t\t}\n\t\tif (this._notebookContentProviders.has(viewType)) {\n\t\t\tthrow new Error(`Notebook provider for '${viewType}' already registered`);\n\t\t}\n\n\t\tthis._notebookContentProviders.set(viewType, { extension, provider });\n\n\n\t\tlet listener: IDisposable | undefined;\n\t\tif (provider.onDidChangeNotebookContentOptions) {\n\t\t\tlistener = provider.onDidChangeNotebookContentOptions(() => {\n\t\t\t\tconst internalOptions = typeConverters.NotebookDocumentContentOptions.from(provider.options);\n\t\t\t\tthis._notebookProxy.$updateNotebookProviderOptions(viewType, internalOptions);\n\t\t\t});\n\t\t}\n\n\t\tconst viewOptionsFilenamePattern = options?.viewOptions?.filenamePattern\n\t\t\t.map(pattern => typeConverters.NotebookExclusiveDocumentPattern.from(pattern))\n\t\t\t.filter(pattern => pattern !== undefined) as (string | IRelativePattern | INotebookExclusiveDocumentFilter)[];\n\n\t\tif (options?.viewOptions?.filenamePattern && !viewOptionsFilenamePattern) {\n\t\t\tconsole.warn(`Notebook content provider view options file name pattern is invalid ${options?.viewOptions?.filenamePattern}`);\n\t\t}\n\n\t\tconst internalOptions = typeConverters.NotebookDocumentContentOptions.from(options);\n\t\tthis._notebookProxy.$registerNotebookProvider({ id: extension.identifier, location: extension.extensionLocation, description: extension.description }, viewType, {\n\t\t\ttransientOutputs: internalOptions.transientOutputs,\n\t\t\ttransientCellMetadata: internalOptions.transientCellMetadata,\n\t\t\ttransientDocumentMetadata: internalOptions.transientDocumentMetadata,\n\t\t\tviewOptions: options?.viewOptions && viewOptionsFilenamePattern ? { displayName: options.viewOptions.displayName, filenamePattern: viewOptionsFilenamePattern, exclusive: options.viewOptions.exclusive || false } : undefined\n\t\t});\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tlistener?.dispose();\n\t\t\tthis._notebookContentProviders.delete(viewType);\n\t\t\tthis._notebookProxy.$unregisterNotebookProvider(viewType);\n\t\t});\n\t}\n\n\tregisterNotebookCellStatusBarItemProvider(extension: IExtensionDescription, selector: vscode.NotebookSelector, provider: vscode.NotebookCellStatusBarItemProvider) {\n\n\t\tconst handle = ExtHostNotebookController._notebookStatusBarItemProviderHandlePool++;\n\t\tconst eventHandle = typeof provider.onDidChangeCellStatusBarItems === 'function' ? ExtHostNotebookController._notebookStatusBarItemProviderHandlePool++ : undefined;\n\n\t\tthis._notebookStatusBarItemProviders.set(handle, provider);\n\t\tthis._notebookProxy.$registerNotebookCellStatusBarItemProvider(handle, eventHandle, selector);\n\n\t\tlet subscription: vscode.Disposable | undefined;\n\t\tif (eventHandle !== undefined) {\n\t\t\tsubscription = provider.onDidChangeCellStatusBarItems!(_ => this._notebookProxy.$emitCellStatusBarEvent(eventHandle));\n\t\t}\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._notebookStatusBarItemProviders.delete(handle);\n\t\t\tthis._notebookProxy.$unregisterNotebookCellStatusBarItemProvider(handle, eventHandle);\n\t\t\tif (subscription) {\n\t\t\t\tsubscription.dispose();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateNotebookEditorDecorationType(options: vscode.NotebookDecorationRenderOptions): vscode.NotebookEditorDecorationType {\n\t\treturn new NotebookEditorDecorationType(this._notebookEditorsProxy, options).value;\n\t}\n\n\tasync openNotebookDocument(uri: URI): Promise<vscode.NotebookDocument> {\n\t\tconst cached = this._documents.get(uri);\n\t\tif (cached) {\n\t\t\treturn cached.apiNotebook;\n\t\t}\n\t\tconst canonicalUri = await this._notebookDocumentsProxy.$tryOpenDocument(uri);\n\t\tconst document = this._documents.get(URI.revive(canonicalUri));\n\t\treturn assertIsDefined(document?.apiNotebook);\n\t}\n\n\n\tasync showNotebookDocument(notebookOrUri: vscode.NotebookDocument | URI, options?: vscode.NotebookDocumentShowOptions): Promise<vscode.NotebookEditor> {\n\n\t\tif (URI.isUri(notebookOrUri)) {\n\t\t\tnotebookOrUri = await this.openNotebookDocument(notebookOrUri);\n\t\t}\n\n\t\tlet resolvedOptions: INotebookDocumentShowOptions;\n\t\tif (typeof options === 'object') {\n\t\t\tresolvedOptions = {\n\t\t\t\tposition: typeConverters.ViewColumn.from(options.viewColumn),\n\t\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\t\tselections: options.selections && options.selections.map(typeConverters.NotebookRange.from),\n\t\t\t\tpinned: typeof options.preview === 'boolean' ? !options.preview : undefined\n\t\t\t};\n\t\t} else {\n\t\t\tresolvedOptions = {\n\t\t\t\tpreserveFocus: false\n\t\t\t};\n\t\t}\n\n\t\tconst editorId = await this._notebookEditorsProxy.$tryShowNotebookDocument(notebookOrUri.uri, notebookOrUri.viewType, resolvedOptions);\n\t\tconst editor = editorId && this._editors.get(editorId)?.apiEditor;\n\n\t\tif (editor) {\n\t\t\treturn editor;\n\t\t}\n\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebookOrUri.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebookOrUri.toString()}\".`);\n\t\t}\n\t}\n\n\tasync $provideNotebookCellStatusBarItems(handle: number, uri: UriComponents, index: number, token: CancellationToken): Promise<INotebookCellStatusBarListDto | undefined> {\n\t\tconst provider = this._notebookStatusBarItemProviders.get(handle);\n\t\tconst revivedUri = URI.revive(uri);\n\t\tconst document = this._documents.get(revivedUri);\n\t\tif (!document || !provider) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = document.getCellFromIndex(index);\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst result = await provider.provideCellStatusBarItems(cell.apiCell, token);\n\t\tif (!result) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst cacheId = this._statusBarCache.add([disposables]);\n\t\tconst items = (result && result.map(item => typeConverters.NotebookStatusBarItem.from(item, this._commandsConverter, disposables))) ?? undefined;\n\t\treturn {\n\t\t\tcacheId,\n\t\t\titems\n\t\t};\n\t}\n\n\t$releaseNotebookCellStatusBarItems(cacheId: number): void {\n\t\tthis._statusBarCache.delete(cacheId);\n\t}\n\n\t// --- serialize/deserialize\n\n\tprivate _handlePool = 0;\n\tprivate readonly _notebookSerializer = new Map<number, vscode.NotebookSerializer>();\n\n\tregisterNotebookSerializer(extension: IExtensionDescription, viewType: string, serializer: vscode.NotebookSerializer, options?: vscode.NotebookDocumentContentOptions): vscode.Disposable {\n\t\tif (isFalsyOrWhitespace(viewType)) {\n\t\t\tthrow new Error(`viewType cannot be empty or just whitespace`);\n\t\t}\n\t\tconst handle = this._handlePool++;\n\t\tthis._notebookSerializer.set(handle, serializer);\n\t\tconst internalOptions = typeConverters.NotebookDocumentContentOptions.from(options);\n\t\tthis._notebookProxy.$registerNotebookSerializer(\n\t\t\thandle,\n\t\t\t{ id: extension.identifier, location: extension.extensionLocation, description: extension.description },\n\t\t\tviewType,\n\t\t\tinternalOptions\n\t\t);\n\t\treturn toDisposable(() => {\n\t\t\tthis._notebookProxy.$unregisterNotebookSerializer(handle);\n\t\t});\n\t}\n\n\tasync $dataToNotebook(handle: number, bytes: VSBuffer, token: CancellationToken): Promise<NotebookDataDto> {\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\t\tconst data = await serializer.deserializeNotebook(bytes.buffer, token);\n\t\treturn {\n\t\t\tmetadata: typeConverters.NotebookDocumentMetadata.from(data.metadata),\n\t\t\tcells: data.cells.map(typeConverters.NotebookCellData.from),\n\t\t};\n\t}\n\n\tasync $notebookToData(handle: number, data: NotebookDataDto, token: CancellationToken): Promise<VSBuffer> {\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\t\tconst bytes = await serializer.serializeNotebook({\n\t\t\tmetadata: typeConverters.NotebookDocumentMetadata.to(data.metadata),\n\t\t\tcells: data.cells.map(typeConverters.NotebookCellData.to)\n\t\t}, token);\n\t\treturn VSBuffer.wrap(bytes);\n\t}\n\n\tcancelOneNotebookCellExecution(cell: ExtHostCell): void {\n\t\tconst execution = this._activeExecutions.get(cell.uri);\n\t\texecution?.cancel();\n\t}\n\n\t// --- open, save, saveAs, backup\n\n\tasync $openNotebook(viewType: string, uri: UriComponents, backupId: string | undefined, untitledDocumentData: VSBuffer | undefined, token: CancellationToken): Promise<NotebookDataDto> {\n\t\tconst { provider } = this._getProviderData(viewType);\n\t\tconst data = await provider.openNotebook(URI.revive(uri), { backupId, untitledDocumentData: untitledDocumentData?.buffer }, token);\n\t\treturn {\n\t\t\tmetadata: typeConverters.NotebookDocumentMetadata.from(data.metadata),\n\t\t\tcells: data.cells.map(typeConverters.NotebookCellData.from),\n\t\t};\n\t}\n\n\tasync $saveNotebook(viewType: string, uri: UriComponents, token: CancellationToken): Promise<boolean> {\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tconst { provider } = this._getProviderData(viewType);\n\t\tawait provider.saveNotebook(document.apiNotebook, token);\n\t\treturn true;\n\t}\n\n\tasync $saveNotebookAs(viewType: string, uri: UriComponents, target: UriComponents, token: CancellationToken): Promise<boolean> {\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tconst { provider } = this._getProviderData(viewType);\n\t\tawait provider.saveNotebookAs(URI.revive(target), document.apiNotebook, token);\n\t\treturn true;\n\t}\n\n\tprivate _backupIdPool: number = 0;\n\n\tasync $backupNotebook(viewType: string, uri: UriComponents, cancellation: CancellationToken): Promise<string> {\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tconst provider = this._getProviderData(viewType);\n\n\t\tconst storagePath = this._extensionStoragePaths.workspaceValue(provider.extension) ?? this._extensionStoragePaths.globalValue(provider.extension);\n\t\tconst fileName = String(hash([document.uri.toString(), this._backupIdPool++]));\n\t\tconst backupUri = URI.joinPath(storagePath, fileName);\n\n\t\tconst backup = await provider.provider.backupNotebook(document.apiNotebook, { destination: backupUri }, cancellation);\n\t\tdocument.updateBackup(backup);\n\t\treturn backup.id;\n\t}\n\n\t$acceptModelChanged(uri: UriComponents, event: NotebookCellsChangedEventDto, isDirty: boolean): void {\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tdocument.acceptModelChanged(event, isDirty);\n\t}\n\n\t$acceptDirtyStateChanged(uri: UriComponents, isDirty: boolean): void {\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tdocument.acceptModelChanged({ rawEvents: [], versionId: document.apiNotebook.version }, isDirty);\n\t}\n\n\t$acceptModelSaved(uri: UriComponents): void {\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tthis._onDidSaveNotebookDocument.fire(document.apiNotebook);\n\t}\n\n\t$acceptEditorPropertiesChanged(id: string, data: INotebookEditorPropertiesChangeData): void {\n\t\tthis.logService.debug('ExtHostNotebook#$acceptEditorPropertiesChanged', id, data);\n\n\t\tconst editor = this._editors.get(id);\n\t\tif (!editor) {\n\t\t\tthrow new Error(`unknown text editor: ${id}. known editors: ${[...this._editors.keys()]} `);\n\t\t}\n\n\t\t// ONE: make all state updates\n\t\tif (data.visibleRanges) {\n\t\t\teditor._acceptVisibleRanges(data.visibleRanges.ranges.map(typeConverters.NotebookRange.to));\n\t\t}\n\t\tif (data.selections) {\n\t\t\teditor._acceptSelections(data.selections.selections.map(typeConverters.NotebookRange.to));\n\t\t}\n\n\t\t// TWO: send all events after states have been updated\n\t\tif (data.visibleRanges) {\n\t\t\tthis._onDidChangeNotebookEditorVisibleRanges.fire({\n\t\t\t\tnotebookEditor: editor.apiEditor,\n\t\t\t\tvisibleRanges: editor.apiEditor.visibleRanges\n\t\t\t});\n\t\t}\n\t\tif (data.selections) {\n\t\t\tthis._onDidChangeNotebookEditorSelection.fire(Object.freeze({\n\t\t\t\tnotebookEditor: editor.apiEditor,\n\t\t\t\tselections: editor.apiEditor.selections\n\t\t\t}));\n\t\t}\n\t}\n\n\t$acceptEditorViewColumns(data: INotebookEditorViewColumnInfo): void {\n\t\tfor (const id in data) {\n\t\t\tconst editor = this._editors.get(id);\n\t\t\tif (!editor) {\n\t\t\t\tthrow new Error(`unknown text editor: ${id}. known editors: ${[...this._editors.keys()]} `);\n\t\t\t}\n\t\t\teditor._acceptViewColumn(typeConverters.ViewColumn.to(data[id]));\n\t\t}\n\t}\n\n\t$acceptDocumentPropertiesChanged(uri: UriComponents, data: INotebookDocumentPropertiesChangeData): void {\n\t\tthis.logService.debug('ExtHostNotebook#$acceptDocumentPropertiesChanged', uri.path, data);\n\t\tconst document = this._getNotebookDocument(URI.revive(uri));\n\t\tdocument.acceptDocumentPropertiesChanged(data);\n\t\tif (data.metadata) {\n\t\t\tthis._onDidChangeNotebookDocumentMetadata.fire({ document: document.apiNotebook });\n\t\t}\n\t}\n\n\tprivate _createExtHostEditor(document: ExtHostNotebookDocument, editorId: string, data: INotebookEditorAddData) {\n\n\t\tif (this._editors.has(editorId)) {\n\t\t\tthrow new Error(`editor with id ALREADY EXSIST: ${editorId}`);\n\t\t}\n\n\t\tconst editor = new ExtHostNotebookEditor(\n\t\t\teditorId,\n\t\t\tthis._notebookEditorsProxy,\n\t\t\tdocument,\n\t\t\tdata.visibleRanges.map(typeConverters.NotebookRange.to),\n\t\t\tdata.selections.map(typeConverters.NotebookRange.to),\n\t\t\ttypeof data.viewColumn === 'number' ? typeConverters.ViewColumn.to(data.viewColumn) : undefined\n\t\t);\n\n\t\tthis._editors.set(editorId, editor);\n\t}\n\n\t$acceptDocumentAndEditorsDelta(delta: INotebookDocumentsAndEditorsDelta): void {\n\n\t\tif (delta.removedDocuments) {\n\t\t\tfor (const uri of delta.removedDocuments) {\n\t\t\t\tconst revivedUri = URI.revive(uri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tdocument.dispose();\n\t\t\t\t\tthis._documents.delete(revivedUri);\n\t\t\t\t\tthis._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ removedDocuments: document.apiNotebook.getCells().map(cell => cell.document.uri) });\n\t\t\t\t\tthis._onDidCloseNotebookDocument.fire(document.apiNotebook);\n\t\t\t\t}\n\n\t\t\t\tfor (const editor of this._editors.values()) {\n\t\t\t\t\tif (editor.notebookData.uri.toString() === revivedUri.toString()) {\n\t\t\t\t\t\tthis._editors.delete(editor.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.addedDocuments) {\n\n\t\t\tconst addedCellDocuments: IModelAddedData[] = [];\n\n\t\t\tfor (const modelData of delta.addedDocuments) {\n\t\t\t\tconst uri = URI.revive(modelData.uri);\n\t\t\t\tconst viewType = modelData.viewType;\n\n\t\t\t\tif (this._documents.has(uri)) {\n\t\t\t\t\tthrow new Error(`adding EXISTING notebook ${uri} `);\n\t\t\t\t}\n\t\t\t\tconst that = this;\n\n\t\t\t\tconst document = new ExtHostNotebookDocument(\n\t\t\t\t\tthis._notebookDocumentsProxy,\n\t\t\t\t\tthis._textDocumentsAndEditors,\n\t\t\t\t\tthis._textDocuments,\n\t\t\t\t\t{\n\t\t\t\t\t\temitModelChange(event: vscode.NotebookCellsChangeEvent): void {\n\t\t\t\t\t\t\tthat._onDidChangeNotebookCells.fire(event);\n\t\t\t\t\t\t},\n\t\t\t\t\t\temitCellOutputsChange(event: vscode.NotebookCellOutputsChangeEvent): void {\n\t\t\t\t\t\t\tthat._onDidChangeCellOutputs.fire(event);\n\t\t\t\t\t\t},\n\t\t\t\t\t\temitCellMetadataChange(event: vscode.NotebookCellMetadataChangeEvent): void {\n\t\t\t\t\t\t\tthat._onDidChangeCellMetadata.fire(event);\n\t\t\t\t\t\t},\n\t\t\t\t\t\temitCellExecutionStateChange(event: vscode.NotebookCellExecutionStateChangeEvent): void {\n\t\t\t\t\t\t\tthat._onDidChangeCellExecutionState.fire(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tviewType,\n\t\t\t\t\tmodelData.metadata ? typeConverters.NotebookDocumentMetadata.to(modelData.metadata) : new extHostTypes.NotebookDocumentMetadata(),\n\t\t\t\t\turi,\n\t\t\t\t);\n\n\t\t\t\tdocument.acceptModelChanged({\n\t\t\t\t\tversionId: modelData.versionId,\n\t\t\t\t\trawEvents: [{\n\t\t\t\t\t\tkind: NotebookCellsChangeType.Initialize,\n\t\t\t\t\t\tchanges: [[0, 0, modelData.cells]]\n\t\t\t\t\t}]\n\t\t\t\t}, false);\n\n\t\t\t\t// add cell document as vscode.TextDocument\n\t\t\t\taddedCellDocuments.push(...modelData.cells.map(cell => ExtHostCell.asModelAddData(document.apiNotebook, cell)));\n\n\t\t\t\tthis._documents.get(uri)?.dispose();\n\t\t\t\tthis._documents.set(uri, document);\n\t\t\t\tthis._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ addedDocuments: addedCellDocuments });\n\n\t\t\t\tthis._onDidOpenNotebookDocument.fire(document.apiNotebook);\n\t\t\t}\n\t\t}\n\n\t\tif (delta.addedEditors) {\n\t\t\tfor (const editorModelData of delta.addedEditors) {\n\t\t\t\tif (this._editors.has(editorModelData.id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst revivedUri = URI.revive(editorModelData.documentUri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tthis._createExtHostEditor(document, editorModelData.id, editorModelData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst removedEditors: ExtHostNotebookEditor[] = [];\n\n\t\tif (delta.removedEditors) {\n\t\t\tfor (const editorid of delta.removedEditors) {\n\t\t\t\tconst editor = this._editors.get(editorid);\n\n\t\t\t\tif (editor) {\n\t\t\t\t\tthis._editors.delete(editorid);\n\n\t\t\t\t\tif (this._activeNotebookEditor?.id === editor.id) {\n\t\t\t\t\t\tthis._activeNotebookEditor = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tremovedEditors.push(editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.visibleEditors) {\n\t\t\tthis._visibleNotebookEditors = delta.visibleEditors.map(id => this._editors.get(id)!).filter(editor => !!editor) as ExtHostNotebookEditor[];\n\t\t\tconst visibleEditorsSet = new Set<string>();\n\t\t\tthis._visibleNotebookEditors.forEach(editor => visibleEditorsSet.add(editor.id));\n\n\t\t\tfor (const editor of this._editors.values()) {\n\t\t\t\tconst newValue = visibleEditorsSet.has(editor.id);\n\t\t\t\teditor._acceptVisibility(newValue);\n\t\t\t}\n\n\t\t\tthis._visibleNotebookEditors = [...this._editors.values()].map(e => e).filter(e => e.visible);\n\t\t\tthis._onDidChangeVisibleNotebookEditors.fire(this.visibleNotebookEditors);\n\t\t}\n\n\t\tif (delta.newActiveEditor === null) {\n\t\t\t// clear active notebook as current active editor is non-notebook editor\n\t\t\tthis._activeNotebookEditor = undefined;\n\t\t} else if (delta.newActiveEditor) {\n\t\t\tthis._activeNotebookEditor = this._editors.get(delta.newActiveEditor);\n\t\t}\n\t\tif (delta.newActiveEditor !== undefined) {\n\t\t\tthis._onDidChangeActiveNotebookEditor.fire(this._activeNotebookEditor?.apiEditor);\n\t\t}\n\t}\n\tcreateNotebookCellExecution(docUri: vscode.Uri, index: number, kernelId: string): vscode.NotebookCellExecutionTask | undefined {\n\t\tconst document = this.lookupNotebookDocument(docUri);\n\t\tif (!document) {\n\t\t\tthrow new Error(`Invalid uri: ${docUri} `);\n\t\t}\n\n\t\tconst cell = document.getCellFromIndex(index);\n\t\tif (!cell) {\n\t\t\tthrow new Error(`Invalid cell index: ${docUri}, ${index} `);\n\t\t}\n\n\t\t// TODO@roblou also validate kernelId, once kernel has moved from editor to document\n\t\tif (this._activeExecutions.has(cell.uri)) {\n\t\t\tthrow new Error(`duplicate execution for ${cell.uri}`);\n\t\t}\n\n\t\tconst execution = new NotebookCellExecutionTask(docUri, document, cell, this._notebookDocumentsProxy);\n\t\tthis._activeExecutions.set(cell.uri, execution);\n\t\tconst listener = execution.onDidChangeState(() => {\n\t\t\tif (execution.state === NotebookCellExecutionTaskState.Resolved) {\n\t\t\t\texecution.dispose();\n\t\t\t\tlistener.dispose();\n\t\t\t\tthis._activeExecutions.delete(cell.uri);\n\t\t\t}\n\t\t});\n\n\t\treturn execution.asApiObject();\n\t}\n}\n\nenum NotebookCellExecutionTaskState {\n\tInit,\n\tStarted,\n\tResolved\n}\n\nclass NotebookCellExecutionTask extends Disposable {\n\tprivate _onDidChangeState = new Emitter<void>();\n\treadonly onDidChangeState = this._onDidChangeState.event;\n\n\tprivate _state = NotebookCellExecutionTaskState.Init;\n\tget state(): NotebookCellExecutionTaskState { return this._state; }\n\n\tprivate readonly _tokenSource = this._register(new CancellationTokenSource());\n\n\tprivate readonly _collector: TimeoutBasedCollector<IImmediateCellEditOperation>;\n\n\tprivate _executionOrder: number | undefined;\n\n\tconstructor(\n\t\tprivate readonly _uri: vscode.Uri,\n\t\tprivate readonly _document: ExtHostNotebookDocument,\n\t\tprivate readonly _cell: ExtHostCell,\n\t\tprivate readonly _proxy: MainThreadNotebookDocumentsShape) {\n\t\tsuper();\n\n\t\tthis._collector = new TimeoutBasedCollector(10, edits => this.applyEdits(edits));\n\n\t\tthis._executionOrder = _cell.internalMetadata.executionOrder;\n\t\tthis.mixinMetadata({\n\t\t\trunState: extHostTypes.NotebookCellExecutionState.Pending,\n\t\t\texecutionOrder: null\n\t\t});\n\t}\n\n\tcancel(): void {\n\t\tthis._tokenSource.cancel();\n\t}\n\n\tprivate async applyEditSoon(edit: IImmediateCellEditOperation): Promise<void> {\n\t\tawait this._collector.addItem(edit);\n\t}\n\n\tprivate async applyEdits(edits: IImmediateCellEditOperation[]): Promise<void> {\n\t\treturn this._proxy.$applyEdits(this._uri, edits, false);\n\t}\n\n\tprivate verifyStateForOutput() {\n\t\tif (this._state === NotebookCellExecutionTaskState.Init) {\n\t\t\tthrow new Error('Must call start before modifying cell output');\n\t\t}\n\n\t\tif (this._state === NotebookCellExecutionTaskState.Resolved) {\n\t\t\tthrow new Error('Cannot modify cell output after calling resolve');\n\t\t}\n\t}\n\n\tprivate mixinMetadata(mixinMetadata: NullablePartialNotebookCellMetadata) {\n\t\tconst edit: IImmediateCellEditOperation = { editType: CellEditType.PartialMetadata, handle: this._cell.handle, metadata: mixinMetadata };\n\t\tthis.applyEdits([edit]);\n\t}\n\n\tprivate cellIndexToHandle(cellIndex: number | undefined): number | undefined {\n\t\tconst cell = typeof cellIndex === 'number' ? this._document.getCellFromIndex(cellIndex) : this._cell;\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn cell.handle;\n\t}\n\n\tasApiObject(): vscode.NotebookCellExecutionTask {\n\t\tconst that = this;\n\t\treturn Object.freeze(<vscode.NotebookCellExecutionTask>{\n\t\t\tget document() { return that._document.apiNotebook; },\n\t\t\tget cell() { return that._cell.apiCell; },\n\n\t\t\tget executionOrder() { return that._executionOrder; },\n\t\t\tset executionOrder(v: number | undefined) {\n\t\t\t\tthat._executionOrder = v;\n\t\t\t\tthat.mixinMetadata({\n\t\t\t\t\texecutionOrder: v\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tstart(context?: vscode.NotebookCellExecuteStartContext): void {\n\t\t\t\tif (that._state === NotebookCellExecutionTaskState.Resolved || that._state === NotebookCellExecutionTaskState.Started) {\n\t\t\t\t\tthrow new Error('Cannot call start again');\n\t\t\t\t}\n\n\t\t\t\tthat._state = NotebookCellExecutionTaskState.Started;\n\t\t\t\tthat._onDidChangeState.fire();\n\n\t\t\t\tthat.mixinMetadata({\n\t\t\t\t\trunState: extHostTypes.NotebookCellExecutionState.Executing,\n\t\t\t\t\trunStartTime: context?.startTime ?? null\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tend(result?: vscode.NotebookCellExecuteEndContext): void {\n\t\t\t\tif (that._state === NotebookCellExecutionTaskState.Resolved) {\n\t\t\t\t\tthrow new Error('Cannot call resolve twice');\n\t\t\t\t}\n\n\t\t\t\tthat._state = NotebookCellExecutionTaskState.Resolved;\n\t\t\t\tthat._onDidChangeState.fire();\n\n\t\t\t\tthat.mixinMetadata({\n\t\t\t\t\trunState: extHostTypes.NotebookCellExecutionState.Idle,\n\t\t\t\t\tlastRunSuccess: result?.success ?? null,\n\t\t\t\t\trunEndTime: result?.endTime ?? null,\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tclearOutput(cellIndex?: number): Thenable<void> {\n\t\t\t\tthat.verifyStateForOutput();\n\t\t\t\treturn this.replaceOutput([], cellIndex);\n\t\t\t},\n\n\t\t\tasync appendOutput(outputs: vscode.NotebookCellOutput | vscode.NotebookCellOutput[], cellIndex?: number): Promise<void> {\n\t\t\t\tthat.verifyStateForOutput();\n\t\t\t\tconst handle = that.cellIndexToHandle(cellIndex);\n\t\t\t\tif (typeof handle !== 'number') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\toutputs = Array.isArray(outputs) ? outputs : [outputs];\n\t\t\t\treturn that.applyEditSoon({ editType: CellEditType.Output, handle, append: true, outputs: outputs.map(typeConverters.NotebookCellOutput.from) });\n\t\t\t},\n\n\t\t\tasync replaceOutput(outputs: vscode.NotebookCellOutput | vscode.NotebookCellOutput[], cellIndex?: number): Promise<void> {\n\t\t\t\tthat.verifyStateForOutput();\n\t\t\t\tconst handle = that.cellIndexToHandle(cellIndex);\n\t\t\t\tif (typeof handle !== 'number') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\toutputs = Array.isArray(outputs) ? outputs : [outputs];\n\t\t\t\treturn that.applyEditSoon({ editType: CellEditType.Output, handle, outputs: outputs.map(typeConverters.NotebookCellOutput.from) });\n\t\t\t},\n\n\t\t\tasync appendOutputItems(items: vscode.NotebookCellOutputItem | vscode.NotebookCellOutputItem[], outputId: string): Promise<void> {\n\t\t\t\tthat.verifyStateForOutput();\n\t\t\t\titems = Array.isArray(items) ? items : [items];\n\t\t\t\treturn that.applyEditSoon({ editType: CellEditType.OutputItems, append: true, items: items.map(typeConverters.NotebookCellOutputItem.from), outputId });\n\t\t\t},\n\n\t\t\tasync replaceOutputItems(items: vscode.NotebookCellOutputItem | vscode.NotebookCellOutputItem[], outputId: string): Promise<void> {\n\t\t\t\tthat.verifyStateForOutput();\n\t\t\t\titems = Array.isArray(items) ? items : [items];\n\t\t\t\treturn that.applyEditSoon({ editType: CellEditType.OutputItems, items: items.map(typeConverters.NotebookCellOutputItem.from), outputId });\n\t\t\t},\n\n\t\t\ttoken: that._tokenSource.token\n\t\t});\n\t}\n}\n\nclass TimeoutBasedCollector<T> {\n\tprivate batch: T[] = [];\n\tprivate waitPromise: Promise<void> | undefined;\n\n\tconstructor(\n\t\tprivate readonly delay: number,\n\t\tprivate readonly callback: (items: T[]) => Promise<void>) { }\n\n\taddItem(item: T): Promise<void> {\n\t\tthis.batch.push(item);\n\t\tif (!this.waitPromise) {\n\t\t\tthis.waitPromise = timeout(this.delay).then(() => {\n\t\t\t\tthis.waitPromise = undefined;\n\t\t\t\tconst batch = this.batch;\n\t\t\t\tthis.batch = [];\n\t\t\t\treturn this.callback(batch);\n\t\t\t});\n\t\t}\n\n\t\treturn this.waitPromise;\n\t}\n}\n"]}