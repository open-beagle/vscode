{"version":3,"sources":["vs/workbench/api/browser/mainThreadCLICommands.ts"],"names":[],"mappings":"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","file":"mainThreadCLICommands.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from 'vs/base/common/network';\nimport { isString } from 'vs/base/common/types';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { CommandsRegistry, ICommandService } from 'vs/platform/commands/common/commands';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { CLIOutput, IExtensionGalleryService, IExtensionManagementService } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { ExtensionManagementCLIService } from 'vs/platform/extensionManagement/common/extensionManagementCLIService';\nimport { getExtensionId } from 'vs/platform/extensionManagement/common/extensionManagementUtil';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { IOpenWindowOptions, IWindowOpenable } from 'vs/platform/windows/common/windows';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\nimport { IExtensionManagementServerService } from 'vs/workbench/services/extensionManagement/common/extensionManagement';\nimport { IExtensionManifestPropertiesService } from 'vs/workbench/services/extensions/common/extensionManifestPropertiesService';\nimport { IExtensionManifest } from 'vs/workbench/workbench.web.api';\n\n\n// this class contains the commands that the CLI server is reying on\n\nCommandsRegistry.registerCommand('_remoteCLI.openExternal', function (accessor: ServicesAccessor, uri: UriComponents | string) {\n\tconst openerService = accessor.get(IOpenerService);\n\treturn openerService.open(isString(uri) ? uri : URI.revive(uri), { openExternal: true, allowTunneling: true });\n});\n\nCommandsRegistry.registerCommand('_remoteCLI.windowOpen', function (accessor: ServicesAccessor, toOpen: IWindowOpenable[], options?: IOpenWindowOptions) {\n\tconst commandService = accessor.get(ICommandService);\n\treturn commandService.executeCommand('_files.windowOpen', toOpen, options);\n});\n\nCommandsRegistry.registerCommand('_remoteCLI.getSystemStatus', function (accessor: ServicesAccessor) {\n\tconst commandService = accessor.get(ICommandService);\n\treturn commandService.executeCommand('_issues.getSystemStatus');\n});\n\ninterface ManageExtensionsArgs {\n\tlist?: { showVersions?: boolean, category?: string; };\n\tinstall?: (string | URI)[];\n\tuninstall?: string[];\n\tforce?: boolean;\n}\n\nCommandsRegistry.registerCommand('_remoteCLI.manageExtensions', async function (accessor: ServicesAccessor, args: ManageExtensionsArgs) {\n\n\tconst instantiationService = accessor.get(IInstantiationService);\n\tconst extensionManagementServerService = accessor.get(IExtensionManagementServerService);\n\tconst remoteExtensionManagementService = extensionManagementServerService.remoteExtensionManagementServer?.extensionManagementService;\n\tif (!remoteExtensionManagementService) {\n\t\treturn;\n\t}\n\n\tconst cliService = instantiationService.createChild(new ServiceCollection([IExtensionManagementService, remoteExtensionManagementService])).createInstance(RemoteExtensionCLIManagementService);\n\n\tconst lines: string[] = [];\n\tconst output = { log: lines.push.bind(lines), error: lines.push.bind(lines) };\n\n\tif (args.list) {\n\t\tawait cliService.listExtensions(!!args.list.showVersions, args.list.category, output);\n\t} else {\n\t\tconst revive = (inputs: (string | UriComponents)[]) => inputs.map(input => isString(input) ? input : URI.revive(input));\n\t\tif (Array.isArray(args.install) && args.install.length) {\n\t\t\ttry {\n\t\t\t\tawait cliService.installExtensions(revive(args.install), [], true, !!args.force, output);\n\t\t\t} catch (e) {\n\t\t\t\tlines.push(e.message);\n\t\t\t}\n\t\t}\n\t\tif (Array.isArray(args.uninstall) && args.uninstall.length) {\n\t\t\ttry {\n\t\t\t\tawait cliService.uninstallExtensions(revive(args.uninstall), !!args.force, output);\n\t\t\t} catch (e) {\n\t\t\t\tlines.push(e.message);\n\t\t\t}\n\t\t}\n\t}\n\treturn lines.join('\\n');\n});\n\nclass RemoteExtensionCLIManagementService extends ExtensionManagementCLIService {\n\n\tprivate _location: string | undefined;\n\n\tconstructor(\n\t\t@IExtensionManagementService extensionManagementService: IExtensionManagementService,\n\t\t@IProductService productService: IProductService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IExtensionGalleryService extensionGalleryService: IExtensionGalleryService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IWorkbenchEnvironmentService envService: IWorkbenchEnvironmentService,\n\t\t@IExtensionManifestPropertiesService private readonly _extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t) {\n\t\tsuper(extensionManagementService, extensionGalleryService);\n\n\t\tconst remoteAuthority = envService.remoteAuthority;\n\t\tthis._location = remoteAuthority ? labelService.getHostLabel(Schemas.vscodeRemote, remoteAuthority) : undefined;\n\t}\n\n\tprotected override get location(): string | undefined {\n\t\treturn this._location;\n\t}\n\n\tprotected override validateExtensionKind(manifest: IExtensionManifest, output: CLIOutput): boolean {\n\t\tif (!this._extensionManifestPropertiesService.canExecuteOnWorkspace(manifest)) {\n\t\t\toutput.log(localize('cannot be installed', \"Cannot install the '{0}' extension because it is declared to not run in this setup.\", getExtensionId(manifest.publisher, manifest.name)));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n}\n"]}