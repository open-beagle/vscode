{"version":3,"sources":["vs/workbench/api/browser/mainThreadWorkspace.ts"],"names":[],"mappings":"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","file":"mainThreadWorkspace.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { isPromiseCanceledError } from 'vs/base/common/errors';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { isNative } from 'vs/base/common/platform';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IRequestService } from 'vs/platform/request/common/request';\nimport { WorkspaceTrustRequestOptions, IWorkspaceTrustManagementService, IWorkspaceTrustRequestService } from 'vs/platform/workspace/common/workspaceTrust';\nimport { IWorkspace, IWorkspaceContextService, WorkbenchState } from 'vs/platform/workspace/common/workspace';\nimport { isUntitledWorkspace } from 'vs/platform/workspaces/common/workspaces';\nimport { extHostNamedCustomer } from 'vs/workbench/api/common/extHostCustomers';\nimport { checkGlobFileExists } from 'vs/workbench/api/common/shared/workspaceContains';\nimport { ITextQueryBuilderOptions, QueryBuilder } from 'vs/workbench/contrib/search/common/queryBuilder';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IFileMatch, IPatternInfo, ISearchProgressItem, ISearchService } from 'vs/workbench/services/search/common/search';\nimport { IWorkspaceEditingService } from 'vs/workbench/services/workspaces/common/workspaceEditing';\nimport { ExtHostContext, ExtHostWorkspaceShape, IExtHostContext, ITextSearchComplete, IWorkspaceData, MainContext, MainThreadWorkspaceShape } from '../common/extHost.protocol';\n\n@extHostNamedCustomer(MainContext.MainThreadWorkspace)\nexport class MainThreadWorkspace implements MainThreadWorkspaceShape {\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate readonly _activeCancelTokens: { [id: number]: CancellationTokenSource } = Object.create(null);\n\tprivate readonly _proxy: ExtHostWorkspaceShape;\n\tprivate readonly _queryBuilder = this._instantiationService.createInstance(QueryBuilder);\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ISearchService private readonly _searchService: ISearchService,\n\t\t@IWorkspaceContextService private readonly _contextService: IWorkspaceContextService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IWorkspaceEditingService private readonly _workspaceEditingService: IWorkspaceEditingService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IRequestService private readonly _requestService: IRequestService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IEnvironmentService private readonly _environmentService: IEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkspaceTrustManagementService private readonly _workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@IWorkspaceTrustRequestService private readonly _workspaceTrustRequestService: IWorkspaceTrustRequestService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostWorkspace);\n\t\tconst workspace = this._contextService.getWorkspace();\n\t\t// The workspace file is provided be a unknown file system provider. It might come\n\t\t// from the extension host. So initialize now knowing that `rootPath` is undefined.\n\t\tif (workspace.configuration && !isNative && !fileService.canHandleResource(workspace.configuration)) {\n\t\t\tthis._proxy.$initializeWorkspace(this.getWorkspaceData(workspace), this.isWorkspaceTrusted());\n\t\t} else {\n\t\t\tthis._contextService.getCompleteWorkspace().then(workspace => this._proxy.$initializeWorkspace(this.getWorkspaceData(workspace), this.isWorkspaceTrusted()));\n\t\t}\n\t\tthis._contextService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspace, this, this._toDispose);\n\t\tthis._contextService.onDidChangeWorkbenchState(this._onDidChangeWorkspace, this, this._toDispose);\n\t\tthis._workspaceTrustManagementService.onDidChangeTrust(this._onDidGrantWorkspaceTrust, this, this._toDispose);\n\t}\n\n\tdispose(): void {\n\t\tthis._toDispose.dispose();\n\n\t\tfor (let requestId in this._activeCancelTokens) {\n\t\t\tconst tokenSource = this._activeCancelTokens[requestId];\n\t\t\ttokenSource.cancel();\n\t\t}\n\t}\n\n\t// --- workspace ---\n\n\t$updateWorkspaceFolders(extensionName: string, index: number, deleteCount: number, foldersToAdd: { uri: UriComponents, name?: string }[]): Promise<void> {\n\t\tconst workspaceFoldersToAdd = foldersToAdd.map(f => ({ uri: URI.revive(f.uri), name: f.name }));\n\n\t\t// Indicate in status message\n\t\tthis._notificationService.status(this.getStatusMessage(extensionName, workspaceFoldersToAdd.length, deleteCount), { hideAfter: 10 * 1000 /* 10s */ });\n\n\t\treturn this._workspaceEditingService.updateFolders(index, deleteCount, workspaceFoldersToAdd, true);\n\t}\n\n\tprivate getStatusMessage(extensionName: string, addCount: number, removeCount: number): string {\n\t\tlet message: string;\n\n\t\tconst wantsToAdd = addCount > 0;\n\t\tconst wantsToDelete = removeCount > 0;\n\n\t\t// Add Folders\n\t\tif (wantsToAdd && !wantsToDelete) {\n\t\t\tif (addCount === 1) {\n\t\t\t\tmessage = localize('folderStatusMessageAddSingleFolder', \"Extension '{0}' added 1 folder to the workspace\", extensionName);\n\t\t\t} else {\n\t\t\t\tmessage = localize('folderStatusMessageAddMultipleFolders', \"Extension '{0}' added {1} folders to the workspace\", extensionName, addCount);\n\t\t\t}\n\t\t}\n\n\t\t// Delete Folders\n\t\telse if (wantsToDelete && !wantsToAdd) {\n\t\t\tif (removeCount === 1) {\n\t\t\t\tmessage = localize('folderStatusMessageRemoveSingleFolder', \"Extension '{0}' removed 1 folder from the workspace\", extensionName);\n\t\t\t} else {\n\t\t\t\tmessage = localize('folderStatusMessageRemoveMultipleFolders', \"Extension '{0}' removed {1} folders from the workspace\", extensionName, removeCount);\n\t\t\t}\n\t\t}\n\n\t\t// Change Folders\n\t\telse {\n\t\t\tmessage = localize('folderStatusChangeFolder', \"Extension '{0}' changed folders of the workspace\", extensionName);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tprivate _onDidChangeWorkspace(): void {\n\t\tthis._proxy.$acceptWorkspaceData(this.getWorkspaceData(this._contextService.getWorkspace()));\n\t}\n\n\tprivate getWorkspaceData(workspace: IWorkspace): IWorkspaceData | null {\n\t\tif (this._contextService.getWorkbenchState() === WorkbenchState.EMPTY) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\tconfiguration: workspace.configuration || undefined,\n\t\t\tisUntitled: workspace.configuration ? isUntitledWorkspace(workspace.configuration, this._environmentService) : false,\n\t\t\tfolders: workspace.folders,\n\t\t\tid: workspace.id,\n\t\t\tname: this._labelService.getWorkspaceLabel(workspace)\n\t\t};\n\t}\n\n\t// --- search ---\n\n\t$startFileSearch(includePattern: string | null, _includeFolder: UriComponents | null, excludePatternOrDisregardExcludes: string | false | null, maxResults: number | null, token: CancellationToken): Promise<UriComponents[] | null> {\n\t\tconst includeFolder = URI.revive(_includeFolder);\n\t\tconst workspace = this._contextService.getWorkspace();\n\t\tif (!workspace.folders.length) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\tconst query = this._queryBuilder.file(\n\t\t\tincludeFolder ? [includeFolder] : workspace.folders,\n\t\t\t{\n\t\t\t\tmaxResults: withNullAsUndefined(maxResults),\n\t\t\t\tdisregardExcludeSettings: (excludePatternOrDisregardExcludes === false) || undefined,\n\t\t\t\tdisregardSearchExcludeSettings: true,\n\t\t\t\tdisregardIgnoreFiles: true,\n\t\t\t\tincludePattern: withNullAsUndefined(includePattern),\n\t\t\t\texcludePattern: typeof excludePatternOrDisregardExcludes === 'string' ? excludePatternOrDisregardExcludes : undefined,\n\t\t\t\t_reason: 'startFileSearch'\n\t\t\t});\n\n\t\treturn this._searchService.fileSearch(query, token).then(result => {\n\t\t\treturn result.results.map(m => m.resource);\n\t\t}, err => {\n\t\t\tif (!isPromiseCanceledError(err)) {\n\t\t\t\treturn Promise.reject(err);\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\t}\n\n\t$startTextSearch(pattern: IPatternInfo, _folder: UriComponents | null, options: ITextQueryBuilderOptions, requestId: number, token: CancellationToken): Promise<ITextSearchComplete | null> {\n\t\tconst folder = URI.revive(_folder);\n\t\tconst workspace = this._contextService.getWorkspace();\n\t\tconst folders = folder ? [folder] : workspace.folders.map(folder => folder.uri);\n\n\t\tconst query = this._queryBuilder.text(pattern, folders, options);\n\t\tquery._reason = 'startTextSearch';\n\n\t\tconst onProgress = (p: ISearchProgressItem) => {\n\t\t\tif ((<IFileMatch>p).results) {\n\t\t\t\tthis._proxy.$handleTextSearchResult(<IFileMatch>p, requestId);\n\t\t\t}\n\t\t};\n\n\t\tconst search = this._searchService.textSearch(query, token, onProgress).then(\n\t\t\tresult => {\n\t\t\t\treturn { limitHit: result.limitHit };\n\t\t\t},\n\t\t\terr => {\n\t\t\t\tif (!isPromiseCanceledError(err)) {\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\treturn search;\n\t}\n\n\t$checkExists(folders: readonly UriComponents[], includes: string[], token: CancellationToken): Promise<boolean> {\n\t\treturn this._instantiationService.invokeFunction((accessor) => checkGlobFileExists(accessor, folders, includes, token));\n\t}\n\n\t// --- save & edit resources ---\n\n\t$saveAll(includeUntitled?: boolean): Promise<boolean> {\n\t\treturn this._editorService.saveAll({ includeUntitled });\n\t}\n\n\t$resolveProxy(url: string): Promise<string | undefined> {\n\t\treturn this._requestService.resolveProxy(url);\n\t}\n\n\t// --- trust ---\n\n\t$requestWorkspaceTrust(options?: WorkspaceTrustRequestOptions): Promise<boolean | undefined> {\n\t\treturn this._workspaceTrustRequestService.requestWorkspaceTrust(options);\n\t}\n\n\tprivate isWorkspaceTrusted(): boolean {\n\t\treturn this._workspaceTrustManagementService.isWorkpaceTrusted();\n\t}\n\n\tprivate _onDidGrantWorkspaceTrust(): void {\n\t\tthis._proxy.$onDidGrantWorkspaceTrust();\n\t}\n}\n"]}