{"version":3,"file":"mainThreadConfiguration.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/api/browser/mainThreadConfiguration.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAahG,IAAa,uBAAuB,GAApC,MAAa,uBAAuB;QAInC,YACC,cAA+B,EACY,wBAAkD,EACrD,oBAA2C,EAC7C,mBAAwC;YAFnC,6BAAwB,GAAxB,wBAAwB,CAA0B;YACrD,yBAAoB,GAApB,oBAAoB,CAAuB;YAC7C,wBAAmB,GAAnB,mBAAmB,CAAqB;YAE9E,MAAM,KAAK,GAAG,cAAc,CAAC,QAAQ,CAAC,iCAAc,CAAC,oBAAoB,CAAC,CAAC;YAE3E,KAAK,CAAC,wBAAwB,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAC;YAC7D,IAAI,CAAC,sBAAsB,GAAG,oBAAoB,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE;gBAC/E,KAAK,CAAC,2BAA2B,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;YAC3E,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,qBAAqB;YAC5B,MAAM,iBAAiB,mCAAgC,CAAC,IAAI,CAAC,oBAAoB,CAAC,oBAAoB,EAAG,CAAC,KAAE,mBAAmB,EAAE,EAAE,GAAE,CAAC;YACtI,uDAAuD;YACvD,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,IAAI,IAAI,CAAC,mBAAmB,CAAC,sBAAsB,EAAE;gBACzF,iBAAiB,CAAC,mBAAmB,GAAG,CAAA,GAAA,iCAAS,CAAA,EAAE,CAAC;aACpD;YACD,OAAO,iBAAiB,CAAC;QAC1B,CAAC;QAEM,OAAO;YACb,IAAI,CAAC,sBAAsB,CAAC,OAAO,EAAE,CAAC;QACvC,CAAC;QAED,0BAA0B,CAAC,MAAkC,EAAE,GAAW,EAAE,KAAU,EAAE,SAA8C,EAAE,eAAoC;YAC3K,SAAS,GAAG,EAAE,QAAQ,EAAE,CAAA,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,QAAQ,EAAC,CAAC,CAAC,SAAG,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,kBAAkB,EAAE,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,kBAAkB,EAAE,CAAC;YAC9I,OAAO,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;QAChF,CAAC;QAED,0BAA0B,CAAC,MAAkC,EAAE,GAAW,EAAE,SAA8C,EAAE,eAAoC;YAC/J,SAAS,GAAG,EAAE,QAAQ,EAAE,CAAA,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,QAAQ,EAAC,CAAC,CAAC,SAAG,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,kBAAkB,EAAE,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,kBAAkB,EAAE,CAAC;YAC9I,OAAO,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,GAAG,EAAE,SAAS,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;QACpF,CAAC;QAEO,kBAAkB,CAAC,MAAkC,EAAE,GAAW,EAAE,KAAU,EAAE,SAAkC,EAAE,eAAoC;;YAC/J,MAAM,GAAG,MAAM,KAAK,IAAI,IAAI,MAAM,KAAK,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,yBAAyB,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;YAC3G,MAAM,kBAAkB,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;YAC7E,QAAQ,MAAM,EAAE;gBACf;oBACC,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,MAAA,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,MAAM,0CAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;gBAChH;oBACC,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,MAAA,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,eAAe,0CAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;gBACzH;oBACC,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,MAAA,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,SAAS,0CAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;gBACnH;oBACC,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,MAAA,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,UAAU,0CAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;gBACpH;oBACC,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,MAAA,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,SAAS,0CAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC;aACnH;QACF,CAAC;QAEO,YAAY,CAAC,GAAW,EAAE,KAAU,EAAE,mBAAwC,EAAE,eAAgC,EAAE,SAAkC,EAAE,eAAoC;YACjM,SAAS,GAAG,eAAe,KAAK,IAAI,CAAC,CAAC,CAAC,SAAS;gBAC/C,CAAC,CAAC,eAAe,KAAK,KAAK,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,SAAS,CAAC,QAAQ,EAAE;oBAC7D,CAAC,CAAC,SAAS,CAAC,kBAAkB,IAAI,eAAe,KAAK,SAAS,CAAC,CAAC,CAAC,SAAS;wBAC1E,CAAC,CAAC,EAAE,QAAQ,EAAE,SAAS,CAAC,QAAQ,EAAE,CAAC;YACtC,OAAO,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE,mBAAmB,EAAE,IAAI,CAAC,CAAC;QAChG,CAAC;QAEO,yBAAyB,CAAC,GAAW,EAAE,SAAkC;YAChF,IAAI,SAAS,CAAC,QAAQ,IAAI,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,EAAE,sBAA6B,EAAE;gBACzG,MAAM,uBAAuB,GAAG,mBAAQ,CAAC,EAAE,CAAyB,kCAAuB,CAAC,aAAa,CAAC,CAAC,0BAA0B,EAAE,CAAC;gBACxI,IAAI,uBAAuB,CAAC,GAAG,CAAC,IAAI,CAAC,uBAAuB,CAAC,GAAG,CAAC,CAAC,KAAK,qBAAgC,IAAI,uBAAuB,CAAC,GAAG,CAAC,CAAC,KAAK,iCAA4C,CAAC,EAAE;oBAC3L,gCAA4C;iBAC5C;aACD;YACD,yBAAqC;QACtC,CAAC;KACD,CAAA;IA3EY,uBAAuB;QADnC,CAAA,GAAA,uCAAoB,CAAA,CAAC,8BAAW,CAAC,uBAAuB,CAAC;QAOvD,WAAA,oCAAwB,CAAA;QACxB,WAAA,qCAAqB,CAAA;QACrB,WAAA,iCAAmB,CAAA;OART,uBAAuB,CA2EnC;IA3EY,0DAAuB","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IConfigurationRegistry, Extensions as ConfigurationExtensions, ConfigurationScope, getScopes } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IWorkspaceContextService, WorkbenchState } from 'vs/platform/workspace/common/workspace';\nimport { MainThreadConfigurationShape, MainContext, ExtHostContext, IExtHostContext, IConfigurationInitData } from '../common/extHost.protocol';\nimport { extHostNamedCustomer } from 'vs/workbench/api/common/extHostCustomers';\nimport { ConfigurationTarget, IConfigurationService, IConfigurationOverrides } from 'vs/platform/configuration/common/configuration';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\n\n@extHostNamedCustomer(MainContext.MainThreadConfiguration)\nexport class MainThreadConfiguration implements MainThreadConfigurationShape {\n\n\tprivate readonly _configurationListener: IDisposable;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IEnvironmentService private readonly _environmentService: IEnvironmentService,\n\t) {\n\t\tconst proxy = extHostContext.getProxy(ExtHostContext.ExtHostConfiguration);\n\n\t\tproxy.$initializeConfiguration(this._getConfigurationData());\n\t\tthis._configurationListener = configurationService.onDidChangeConfiguration(e => {\n\t\t\tproxy.$acceptConfigurationChanged(this._getConfigurationData(), e.change);\n\t\t});\n\t}\n\n\tprivate _getConfigurationData(): IConfigurationInitData {\n\t\tconst configurationData: IConfigurationInitData = { ...(this.configurationService.getConfigurationData()!), configurationScopes: [] };\n\t\t// Send configurations scopes only in development mode.\n\t\tif (!this._environmentService.isBuilt || this._environmentService.isExtensionDevelopment) {\n\t\t\tconfigurationData.configurationScopes = getScopes();\n\t\t}\n\t\treturn configurationData;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._configurationListener.dispose();\n\t}\n\n\t$updateConfigurationOption(target: ConfigurationTarget | null, key: string, value: any, overrides: IConfigurationOverrides | undefined, scopeToLanguage: boolean | undefined): Promise<void> {\n\t\toverrides = { resource: overrides?.resource ? URI.revive(overrides.resource) : undefined, overrideIdentifier: overrides?.overrideIdentifier };\n\t\treturn this.writeConfiguration(target, key, value, overrides, scopeToLanguage);\n\t}\n\n\t$removeConfigurationOption(target: ConfigurationTarget | null, key: string, overrides: IConfigurationOverrides | undefined, scopeToLanguage: boolean | undefined): Promise<void> {\n\t\toverrides = { resource: overrides?.resource ? URI.revive(overrides.resource) : undefined, overrideIdentifier: overrides?.overrideIdentifier };\n\t\treturn this.writeConfiguration(target, key, undefined, overrides, scopeToLanguage);\n\t}\n\n\tprivate writeConfiguration(target: ConfigurationTarget | null, key: string, value: any, overrides: IConfigurationOverrides, scopeToLanguage: boolean | undefined): Promise<void> {\n\t\ttarget = target !== null && target !== undefined ? target : this.deriveConfigurationTarget(key, overrides);\n\t\tconst configurationValue = this.configurationService.inspect(key, overrides);\n\t\tswitch (target) {\n\t\t\tcase ConfigurationTarget.MEMORY:\n\t\t\t\treturn this._updateValue(key, value, target, configurationValue?.memory?.override, overrides, scopeToLanguage);\n\t\t\tcase ConfigurationTarget.WORKSPACE_FOLDER:\n\t\t\t\treturn this._updateValue(key, value, target, configurationValue?.workspaceFolder?.override, overrides, scopeToLanguage);\n\t\t\tcase ConfigurationTarget.WORKSPACE:\n\t\t\t\treturn this._updateValue(key, value, target, configurationValue?.workspace?.override, overrides, scopeToLanguage);\n\t\t\tcase ConfigurationTarget.USER_REMOTE:\n\t\t\t\treturn this._updateValue(key, value, target, configurationValue?.userRemote?.override, overrides, scopeToLanguage);\n\t\t\tdefault:\n\t\t\t\treturn this._updateValue(key, value, target, configurationValue?.userLocal?.override, overrides, scopeToLanguage);\n\t\t}\n\t}\n\n\tprivate _updateValue(key: string, value: any, configurationTarget: ConfigurationTarget, overriddenValue: any | undefined, overrides: IConfigurationOverrides, scopeToLanguage: boolean | undefined): Promise<void> {\n\t\toverrides = scopeToLanguage === true ? overrides\n\t\t\t: scopeToLanguage === false ? { resource: overrides.resource }\n\t\t\t\t: overrides.overrideIdentifier && overriddenValue !== undefined ? overrides\n\t\t\t\t\t: { resource: overrides.resource };\n\t\treturn this.configurationService.updateValue(key, value, overrides, configurationTarget, true);\n\t}\n\n\tprivate deriveConfigurationTarget(key: string, overrides: IConfigurationOverrides): ConfigurationTarget {\n\t\tif (overrides.resource && this._workspaceContextService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tconst configurationProperties = Registry.as<IConfigurationRegistry>(ConfigurationExtensions.Configuration).getConfigurationProperties();\n\t\t\tif (configurationProperties[key] && (configurationProperties[key].scope === ConfigurationScope.RESOURCE || configurationProperties[key].scope === ConfigurationScope.LANGUAGE_OVERRIDABLE)) {\n\t\t\t\treturn ConfigurationTarget.WORKSPACE_FOLDER;\n\t\t\t}\n\t\t}\n\t\treturn ConfigurationTarget.WORKSPACE;\n\t}\n}\n"]}