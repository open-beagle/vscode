{"version":3,"sources":["vs/workbench/api/browser/mainThreadCustomEditors.ts"],"names":[],"mappings":"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","file":"mainThreadCustomEditors.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { multibyteAwareBtoa } from 'vs/base/browser/dom';\nimport { CancelablePromise, createCancelablePromise, timeout } from 'vs/base/common/async';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { isPromiseCanceledError, onUnexpectedError } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable, DisposableStore, dispose, IDisposable, IReference } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { basename } from 'vs/base/common/path';\nimport { isEqual, isEqualOrParent, toLocalResource } from 'vs/base/common/resources';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { IFileDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { FileChangesEvent, FileChangeType, FileSystemProviderCapabilities, IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IUndoRedoService, UndoRedoElementType } from 'vs/platform/undoRedo/common/undoRedo';\nimport { MainThreadWebviewPanels } from 'vs/workbench/api/browser/mainThreadWebviewPanels';\nimport { MainThreadWebviews, reviveWebviewExtension } from 'vs/workbench/api/browser/mainThreadWebviews';\nimport * as extHostProtocol from 'vs/workbench/api/common/extHost.protocol';\nimport { editorGroupToViewColumn, IRevertOptions, ISaveOptions } from 'vs/workbench/common/editor';\nimport { CustomEditorInput } from 'vs/workbench/contrib/customEditor/browser/customEditorInput';\nimport { CustomDocumentBackupData } from 'vs/workbench/contrib/customEditor/browser/customEditorInputFactory';\nimport { ICustomEditorModel, ICustomEditorService } from 'vs/workbench/contrib/customEditor/common/customEditor';\nimport { CustomTextEditorModel } from 'vs/workbench/contrib/customEditor/common/customTextEditorModel';\nimport { WebviewExtensionDescription } from 'vs/workbench/contrib/webview/browser/webview';\nimport { WebviewInput } from 'vs/workbench/contrib/webviewPanel/browser/webviewEditorInput';\nimport { IWebviewWorkbenchService } from 'vs/workbench/contrib/webviewPanel/browser/webviewWorkbenchService';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\nimport { IPathService } from 'vs/workbench/services/path/common/pathService';\nimport { IWorkingCopyFileService } from 'vs/workbench/services/workingCopy/common/workingCopyFileService';\nimport { IWorkingCopyService } from 'vs/workbench/services/workingCopy/common/workingCopyService';\nimport { IWorkingCopy, IWorkingCopyBackup, NO_TYPE_ID, WorkingCopyCapabilities } from 'vs/workbench/services/workingCopy/common/workingCopy';\n\nconst enum CustomEditorModelType {\n\tCustom,\n\tText,\n}\n\nexport class MainThreadCustomEditors extends Disposable implements extHostProtocol.MainThreadCustomEditorsShape {\n\n\tprivate readonly _proxyCustomEditors: extHostProtocol.ExtHostCustomEditorsShape;\n\n\tprivate readonly _editorProviders = new Map<string, IDisposable>();\n\n\tconstructor(\n\t\tcontext: extHostProtocol.IExtHostContext,\n\t\tprivate readonly mainThreadWebview: MainThreadWebviews,\n\t\tprivate readonly mainThreadWebviewPanels: MainThreadWebviewPanels,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@ICustomEditorService private readonly _customEditorService: ICustomEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tthis._proxyCustomEditors = context.getProxy(extHostProtocol.ExtHostContext.ExtHostCustomEditors);\n\n\t\tthis._register(workingCopyFileService.registerWorkingCopyProvider((editorResource) => {\n\t\t\tconst matchedWorkingCopies: IWorkingCopy[] = [];\n\n\t\t\tfor (const workingCopy of workingCopyService.workingCopies) {\n\t\t\t\tif (workingCopy instanceof MainThreadCustomEditorModel) {\n\t\t\t\t\tif (isEqualOrParent(editorResource, workingCopy.editorResource)) {\n\t\t\t\t\t\tmatchedWorkingCopies.push(workingCopy);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn matchedWorkingCopies;\n\t\t}));\n\n\t\t// This reviver's only job is to activate custom editor extensions.\n\t\tthis._register(_webviewWorkbenchService.registerResolver({\n\t\t\tcanResolve: (webview: WebviewInput) => {\n\t\t\t\tif (webview instanceof CustomEditorInput) {\n\t\t\t\t\textensionService.activateByEvent(`onCustomEditor:${webview.viewType}`);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tresolveWebview: () => { throw new Error('not implemented'); }\n\t\t}));\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tdispose(this._editorProviders.values());\n\t\tthis._editorProviders.clear();\n\t}\n\n\tpublic $registerTextEditorProvider(extensionData: extHostProtocol.WebviewExtensionDescription, viewType: string, options: extHostProtocol.IWebviewPanelOptions, capabilities: extHostProtocol.CustomTextEditorCapabilities, serializeBuffersForPostMessage: boolean): void {\n\t\tthis.registerEditorProvider(CustomEditorModelType.Text, reviveWebviewExtension(extensionData), viewType, options, capabilities, true, serializeBuffersForPostMessage);\n\t}\n\n\tpublic $registerCustomEditorProvider(extensionData: extHostProtocol.WebviewExtensionDescription, viewType: string, options: extHostProtocol.IWebviewPanelOptions, supportsMultipleEditorsPerDocument: boolean, serializeBuffersForPostMessage: boolean): void {\n\t\tthis.registerEditorProvider(CustomEditorModelType.Custom, reviveWebviewExtension(extensionData), viewType, options, {}, supportsMultipleEditorsPerDocument, serializeBuffersForPostMessage);\n\t}\n\n\tprivate registerEditorProvider(\n\t\tmodelType: CustomEditorModelType,\n\t\textension: WebviewExtensionDescription,\n\t\tviewType: string,\n\t\toptions: extHostProtocol.IWebviewPanelOptions,\n\t\tcapabilities: extHostProtocol.CustomTextEditorCapabilities,\n\t\tsupportsMultipleEditorsPerDocument: boolean,\n\t\tserializeBuffersForPostMessage: boolean,\n\t): void {\n\t\tif (this._editorProviders.has(viewType)) {\n\t\t\tthrow new Error(`Provider for ${viewType} already registered`);\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\n\t\tdisposables.add(this._customEditorService.registerCustomEditorCapabilities(viewType, {\n\t\t\tsupportsMultipleEditorsPerDocument\n\t\t}));\n\n\t\tdisposables.add(this._webviewWorkbenchService.registerResolver({\n\t\t\tcanResolve: (webviewInput) => {\n\t\t\t\treturn webviewInput instanceof CustomEditorInput && webviewInput.viewType === viewType;\n\t\t\t},\n\t\t\tresolveWebview: async (webviewInput: CustomEditorInput, cancellation: CancellationToken) => {\n\t\t\t\tconst handle = webviewInput.id;\n\t\t\t\tconst resource = webviewInput.resource;\n\n\t\t\t\tthis.mainThreadWebviewPanels.addWebviewInput(handle, webviewInput, { serializeBuffersForPostMessage });\n\t\t\t\twebviewInput.webview.options = options;\n\t\t\t\twebviewInput.webview.extension = extension;\n\n\t\t\t\tlet modelRef: IReference<ICustomEditorModel>;\n\t\t\t\ttry {\n\t\t\t\t\tmodelRef = await this.getOrCreateCustomEditorModel(modelType, resource, viewType, { backupId: webviewInput.backupId }, cancellation);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tonUnexpectedError(error);\n\t\t\t\t\twebviewInput.webview.html = this.mainThreadWebview.getWebviewResolvedFailedContent(viewType);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (cancellation.isCancellationRequested) {\n\t\t\t\t\tmodelRef.dispose();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twebviewInput.webview.onDidDispose(() => {\n\t\t\t\t\t// If the model is still dirty, make sure we have time to save it\n\t\t\t\t\tif (modelRef.object.isDirty()) {\n\t\t\t\t\t\tconst sub = modelRef.object.onDidChangeDirty(() => {\n\t\t\t\t\t\t\tif (!modelRef.object.isDirty()) {\n\t\t\t\t\t\t\t\tsub.dispose();\n\t\t\t\t\t\t\t\tmodelRef.dispose();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmodelRef.dispose();\n\t\t\t\t});\n\n\t\t\t\tif (capabilities.supportsMove) {\n\t\t\t\t\twebviewInput.onMove(async (newResource: URI) => {\n\t\t\t\t\t\tconst oldModel = modelRef;\n\t\t\t\t\t\tmodelRef = await this.getOrCreateCustomEditorModel(modelType, newResource, viewType, {}, CancellationToken.None);\n\t\t\t\t\t\tthis._proxyCustomEditors.$onMoveCustomEditor(handle, newResource, viewType);\n\t\t\t\t\t\toldModel.dispose();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this._proxyCustomEditors.$resolveWebviewEditor(resource, handle, viewType, {\n\t\t\t\t\t\ttitle: webviewInput.getTitle(),\n\t\t\t\t\t\twebviewOptions: webviewInput.webview.contentOptions,\n\t\t\t\t\t\tpanelOptions: webviewInput.webview.options,\n\t\t\t\t\t}, editorGroupToViewColumn(this._editorGroupService, webviewInput.group || 0), cancellation);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tonUnexpectedError(error);\n\t\t\t\t\twebviewInput.webview.html = this.mainThreadWebview.getWebviewResolvedFailedContent(viewType);\n\t\t\t\t\tmodelRef.dispose();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._editorProviders.set(viewType, disposables);\n\t}\n\n\tpublic $unregisterEditorProvider(viewType: string): void {\n\t\tconst provider = this._editorProviders.get(viewType);\n\t\tif (!provider) {\n\t\t\tthrow new Error(`No provider for ${viewType} registered`);\n\t\t}\n\n\t\tprovider.dispose();\n\t\tthis._editorProviders.delete(viewType);\n\n\t\tthis._customEditorService.models.disposeAllModelsForView(viewType);\n\t}\n\n\tprivate async getOrCreateCustomEditorModel(\n\t\tmodelType: CustomEditorModelType,\n\t\tresource: URI,\n\t\tviewType: string,\n\t\toptions: { backupId?: string },\n\t\tcancellation: CancellationToken,\n\t): Promise<IReference<ICustomEditorModel>> {\n\t\tconst existingModel = this._customEditorService.models.tryRetain(resource, viewType);\n\t\tif (existingModel) {\n\t\t\treturn existingModel;\n\t\t}\n\n\t\tswitch (modelType) {\n\t\t\tcase CustomEditorModelType.Text:\n\t\t\t\t{\n\t\t\t\t\tconst model = CustomTextEditorModel.create(this._instantiationService, viewType, resource);\n\t\t\t\t\treturn this._customEditorService.models.add(resource, viewType, model);\n\t\t\t\t}\n\t\t\tcase CustomEditorModelType.Custom:\n\t\t\t\t{\n\t\t\t\t\tconst model = MainThreadCustomEditorModel.create(this._instantiationService, this._proxyCustomEditors, viewType, resource, options, () => {\n\t\t\t\t\t\treturn Array.from(this.mainThreadWebviewPanels.webviewInputs)\n\t\t\t\t\t\t\t.filter(editor => editor instanceof CustomEditorInput && isEqual(editor.resource, resource)) as CustomEditorInput[];\n\t\t\t\t\t}, cancellation);\n\t\t\t\t\treturn this._customEditorService.models.add(resource, viewType, model);\n\t\t\t\t}\n\t\t}\n\t}\n\n\tpublic async $onDidEdit(resourceComponents: UriComponents, viewType: string, editId: number, label: string | undefined): Promise<void> {\n\t\tconst model = await this.getCustomEditorModel(resourceComponents, viewType);\n\t\tmodel.pushEdit(editId, label);\n\t}\n\n\tpublic async $onContentChange(resourceComponents: UriComponents, viewType: string): Promise<void> {\n\t\tconst model = await this.getCustomEditorModel(resourceComponents, viewType);\n\t\tmodel.changeContent();\n\t}\n\n\tprivate async getCustomEditorModel(resourceComponents: UriComponents, viewType: string) {\n\t\tconst resource = URI.revive(resourceComponents);\n\t\tconst model = await this._customEditorService.models.get(resource, viewType);\n\t\tif (!model || !(model instanceof MainThreadCustomEditorModel)) {\n\t\t\tthrow new Error('Could not find model for webview editor');\n\t\t}\n\t\treturn model;\n\t}\n}\n\nnamespace HotExitState {\n\texport const enum Type {\n\t\tAllowed,\n\t\tNotAllowed,\n\t\tPending,\n\t}\n\n\texport const Allowed = Object.freeze({ type: Type.Allowed } as const);\n\texport const NotAllowed = Object.freeze({ type: Type.NotAllowed } as const);\n\n\texport class Pending {\n\t\treadonly type = Type.Pending;\n\n\t\tconstructor(\n\t\t\tpublic readonly operation: CancelablePromise<string>,\n\t\t) { }\n\t}\n\n\texport type State = typeof Allowed | typeof NotAllowed | Pending;\n}\n\n\nclass MainThreadCustomEditorModel extends Disposable implements ICustomEditorModel, IWorkingCopy {\n\n\t#isDisposed = false;\n\n\tprivate _fromBackup: boolean = false;\n\tprivate _hotExitState: HotExitState.State = HotExitState.Allowed;\n\tprivate _backupId: string | undefined;\n\n\tprivate _currentEditIndex: number = -1;\n\tprivate _savePoint: number = -1;\n\tprivate readonly _edits: Array<number> = [];\n\tprivate _isDirtyFromContentChange = false;\n\tprivate _inOrphaned = false;\n\n\tprivate _ongoingSave?: CancelablePromise<void>;\n\n\tprivate readonly _onDidChangeOrphaned = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeOrphaned = this._onDidChangeOrphaned.event;\n\n\t// TODO@mjbvz consider to enable a `typeId` that is specific for custom\n\t// editors. Using a distinct `typeId` allows the working copy to have\n\t// any resource (including file based resources) even if other working\n\t// copies exist with the same resource.\n\t//\n\t// IMPORTANT: changing the `typeId` has an impact on backups for this\n\t// working copy. Any value that is not the empty string will be used\n\t// as seed to the backup. Only change the `typeId` if you have implemented\n\t// a fallback solution to resolve any existing backups that do not have\n\t// this seed.\n\treadonly typeId = NO_TYPE_ID;\n\n\tpublic static async create(\n\t\tinstantiationService: IInstantiationService,\n\t\tproxy: extHostProtocol.ExtHostCustomEditorsShape,\n\t\tviewType: string,\n\t\tresource: URI,\n\t\toptions: { backupId?: string },\n\t\tgetEditors: () => CustomEditorInput[],\n\t\tcancellation: CancellationToken,\n\t): Promise<MainThreadCustomEditorModel> {\n\t\tconst editors = getEditors();\n\t\tlet untitledDocumentData: VSBuffer | undefined;\n\t\tif (editors.length !== 0) {\n\t\t\tuntitledDocumentData = editors[0].untitledDocumentData;\n\t\t}\n\t\tconst { editable } = await proxy.$createCustomDocument(resource, viewType, options.backupId, untitledDocumentData, cancellation);\n\t\treturn instantiationService.createInstance(MainThreadCustomEditorModel, proxy, viewType, resource, !!options.backupId, editable, getEditors);\n\t}\n\n\tconstructor(\n\t\tprivate readonly _proxy: extHostProtocol.ExtHostCustomEditorsShape,\n\t\tprivate readonly _viewType: string,\n\t\tprivate readonly _editorResource: URI,\n\t\tfromBackup: boolean,\n\t\tprivate readonly _editable: boolean,\n\t\tprivate readonly _getEditors: () => CustomEditorInput[],\n\t\t@IFileDialogService private readonly _fileDialogService: IFileDialogService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IUndoRedoService private readonly _undoService: IUndoRedoService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t@IPathService private readonly _pathService: IPathService\n\t) {\n\t\tsuper();\n\n\t\tthis._fromBackup = fromBackup;\n\n\t\tif (_editable) {\n\t\t\tthis._register(workingCopyService.registerWorkingCopy(this));\n\t\t}\n\n\t\tthis._register(_fileService.onDidFilesChange(e => this.onDidFilesChange(e)));\n\t}\n\n\tget editorResource() {\n\t\treturn this._editorResource;\n\t}\n\n\toverride dispose() {\n\t\tthis.#isDisposed = true;\n\n\t\tif (this._editable) {\n\t\t\tthis._undoService.removeElements(this._editorResource);\n\t\t}\n\n\t\tthis._proxy.$disposeCustomDocument(this._editorResource, this._viewType);\n\n\t\tsuper.dispose();\n\t}\n\n\t//#region IWorkingCopy\n\n\tpublic get resource() {\n\t\t// Make sure each custom editor has a unique resource for backup and edits\n\t\treturn MainThreadCustomEditorModel.toWorkingCopyResource(this._viewType, this._editorResource);\n\t}\n\n\tprivate static toWorkingCopyResource(viewType: string, resource: URI) {\n\t\tconst authority = viewType.replace(/[^a-z0-9\\-_]/gi, '-');\n\t\tconst path = `/${multibyteAwareBtoa(resource.with({ query: null, fragment: null }).toString(true))}`;\n\t\treturn URI.from({\n\t\t\tscheme: Schemas.vscodeCustomEditor,\n\t\t\tauthority: authority,\n\t\t\tpath: path,\n\t\t\tquery: JSON.stringify(resource.toJSON()),\n\t\t});\n\t}\n\n\tpublic get name() {\n\t\treturn basename(this._labelService.getUriLabel(this._editorResource));\n\t}\n\n\tpublic get capabilities(): WorkingCopyCapabilities {\n\t\treturn this.isUntitled() ? WorkingCopyCapabilities.Untitled : WorkingCopyCapabilities.None;\n\t}\n\n\tpublic isDirty(): boolean {\n\t\tif (this._isDirtyFromContentChange) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this._edits.length > 0) {\n\t\t\treturn this._savePoint !== this._currentEditIndex;\n\t\t}\n\t\treturn this._fromBackup;\n\t}\n\n\tpublic isOrphaned(): boolean {\n\t\treturn this._inOrphaned;\n\t}\n\n\tprivate isUntitled() {\n\t\treturn this._editorResource.scheme === Schemas.untitled;\n\t}\n\n\tprivate readonly _onDidChangeDirty: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeDirty: Event<void> = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeContent: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeContent: Event<void> = this._onDidChangeContent.event;\n\n\t//#endregion\n\n\tprivate async onDidFilesChange(e: FileChangesEvent): Promise<void> {\n\t\tlet fileEventImpactsModel = false;\n\t\tlet newInOrphanModeGuess: boolean | undefined;\n\n\t\t// If we are currently orphaned, we check if the model file was added back\n\t\tif (this._inOrphaned) {\n\t\t\tconst modelFileAdded = e.contains(this.editorResource, FileChangeType.ADDED);\n\t\t\tif (modelFileAdded) {\n\t\t\t\tnewInOrphanModeGuess = false;\n\t\t\t\tfileEventImpactsModel = true;\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise we check if the model file was deleted\n\t\telse {\n\t\t\tconst modelFileDeleted = e.contains(this.editorResource, FileChangeType.DELETED);\n\t\t\tif (modelFileDeleted) {\n\t\t\t\tnewInOrphanModeGuess = true;\n\t\t\t\tfileEventImpactsModel = true;\n\t\t\t}\n\t\t}\n\n\t\tif (fileEventImpactsModel && this._inOrphaned !== newInOrphanModeGuess) {\n\t\t\tlet newInOrphanModeValidated: boolean = false;\n\t\t\tif (newInOrphanModeGuess) {\n\t\t\t\t// We have received reports of users seeing delete events even though the file still\n\t\t\t\t// exists (network shares issue: https://github.com/microsoft/vscode/issues/13665).\n\t\t\t\t// Since we do not want to mark the model as orphaned, we have to check if the\n\t\t\t\t// file is really gone and not just a faulty file event.\n\t\t\t\tawait timeout(100);\n\n\t\t\t\tif (this.#isDisposed) {\n\t\t\t\t\tnewInOrphanModeValidated = true;\n\t\t\t\t} else {\n\t\t\t\t\tconst exists = await this._fileService.exists(this.editorResource);\n\t\t\t\t\tnewInOrphanModeValidated = !exists;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._inOrphaned !== newInOrphanModeValidated && !this.#isDisposed) {\n\t\t\t\tthis.setOrphaned(newInOrphanModeValidated);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate setOrphaned(orphaned: boolean): void {\n\t\tif (this._inOrphaned !== orphaned) {\n\t\t\tthis._inOrphaned = orphaned;\n\t\t\tthis._onDidChangeOrphaned.fire();\n\t\t}\n\t}\n\n\tpublic isEditable(): boolean {\n\t\treturn this._editable;\n\t}\n\n\tpublic isOnReadonlyFileSystem(): boolean {\n\t\treturn this._fileService.hasCapability(this.editorResource, FileSystemProviderCapabilities.Readonly);\n\t}\n\n\tpublic get viewType() {\n\t\treturn this._viewType;\n\t}\n\n\tpublic get backupId() {\n\t\treturn this._backupId;\n\t}\n\n\tpublic pushEdit(editId: number, label: string | undefined) {\n\t\tif (!this._editable) {\n\t\t\tthrow new Error('Document is not editable');\n\t\t}\n\n\t\tthis.change(() => {\n\t\t\tthis.spliceEdits(editId);\n\t\t\tthis._currentEditIndex = this._edits.length - 1;\n\t\t});\n\n\t\tthis._undoService.pushElement({\n\t\t\ttype: UndoRedoElementType.Resource,\n\t\t\tresource: this._editorResource,\n\t\t\tlabel: label ?? localize('defaultEditLabel', \"Edit\"),\n\t\t\tundo: () => this.undo(),\n\t\t\tredo: () => this.redo(),\n\t\t});\n\t}\n\n\tpublic changeContent() {\n\t\tthis.change(() => {\n\t\t\tthis._isDirtyFromContentChange = true;\n\t\t});\n\t}\n\n\tprivate async undo(): Promise<void> {\n\t\tif (!this._editable) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._currentEditIndex < 0) {\n\t\t\t// nothing to undo\n\t\t\treturn;\n\t\t}\n\n\t\tconst undoneEdit = this._edits[this._currentEditIndex];\n\t\tthis.change(() => {\n\t\t\t--this._currentEditIndex;\n\t\t});\n\t\tawait this._proxy.$undo(this._editorResource, this.viewType, undoneEdit, this.isDirty());\n\t}\n\n\tprivate async redo(): Promise<void> {\n\t\tif (!this._editable) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._currentEditIndex >= this._edits.length - 1) {\n\t\t\t// nothing to redo\n\t\t\treturn;\n\t\t}\n\n\t\tconst redoneEdit = this._edits[this._currentEditIndex + 1];\n\t\tthis.change(() => {\n\t\t\t++this._currentEditIndex;\n\t\t});\n\t\tawait this._proxy.$redo(this._editorResource, this.viewType, redoneEdit, this.isDirty());\n\t}\n\n\tprivate spliceEdits(editToInsert?: number) {\n\t\tconst start = this._currentEditIndex + 1;\n\t\tconst toRemove = this._edits.length - this._currentEditIndex;\n\n\t\tconst removedEdits = typeof editToInsert === 'number'\n\t\t\t? this._edits.splice(start, toRemove, editToInsert)\n\t\t\t: this._edits.splice(start, toRemove);\n\n\t\tif (removedEdits.length) {\n\t\t\tthis._proxy.$disposeEdits(this._editorResource, this._viewType, removedEdits);\n\t\t}\n\t}\n\n\tprivate change(makeEdit: () => void): void {\n\t\tconst wasDirty = this.isDirty();\n\t\tmakeEdit();\n\t\tthis._onDidChangeContent.fire();\n\n\t\tif (this.isDirty() !== wasDirty) {\n\t\t\tthis._onDidChangeDirty.fire();\n\t\t}\n\t}\n\n\tpublic async revert(_options?: IRevertOptions) {\n\t\tif (!this._editable) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._currentEditIndex === this._savePoint && !this._isDirtyFromContentChange && !this._fromBackup) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._proxy.$revert(this._editorResource, this.viewType, CancellationToken.None);\n\t\tthis.change(() => {\n\t\t\tthis._isDirtyFromContentChange = false;\n\t\t\tthis._fromBackup = false;\n\t\t\tthis._currentEditIndex = this._savePoint;\n\t\t\tthis.spliceEdits();\n\t\t});\n\t}\n\n\tpublic async save(options?: ISaveOptions): Promise<boolean> {\n\t\treturn !!await this.saveCustomEditor(options);\n\t}\n\n\tpublic async saveCustomEditor(options?: ISaveOptions): Promise<URI | undefined> {\n\t\tif (!this._editable) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (this.isUntitled()) {\n\t\t\tconst targetUri = await this.suggestUntitledSavePath(options);\n\t\t\tif (!targetUri) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tawait this.saveCustomEditorAs(this._editorResource, targetUri, options);\n\t\t\treturn targetUri;\n\t\t}\n\n\t\tconst savePromise = createCancelablePromise(token => this._proxy.$onSave(this._editorResource, this.viewType, token));\n\t\tthis._ongoingSave?.cancel();\n\t\tthis._ongoingSave = savePromise;\n\n\t\ttry {\n\t\t\tawait savePromise;\n\n\t\t\tif (this._ongoingSave === savePromise) { // Make sure we are still doing the same save\n\t\t\t\tthis.change(() => {\n\t\t\t\t\tthis._isDirtyFromContentChange = false;\n\t\t\t\t\tthis._savePoint = this._currentEditIndex;\n\t\t\t\t\tthis._fromBackup = false;\n\t\t\t\t});\n\t\t\t}\n\t\t} finally {\n\t\t\tif (this._ongoingSave === savePromise) { // Make sure we are still doing the same save\n\t\t\t\tthis._ongoingSave = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn this._editorResource;\n\t}\n\n\tprivate suggestUntitledSavePath(options: ISaveOptions | undefined): Promise<URI | undefined> {\n\t\tif (!this.isUntitled()) {\n\t\t\tthrow new Error('Resource is not untitled');\n\t\t}\n\n\t\tconst remoteAuthority = this._environmentService.remoteAuthority;\n\t\tconst localResource = toLocalResource(this._editorResource, remoteAuthority, this._pathService.defaultUriScheme);\n\n\t\treturn this._fileDialogService.pickFileToSave(localResource, options?.availableFileSystems);\n\t}\n\n\tpublic async saveCustomEditorAs(resource: URI, targetResource: URI, _options?: ISaveOptions): Promise<boolean> {\n\t\tif (this._editable) {\n\t\t\t// TODO: handle cancellation\n\t\t\tawait createCancelablePromise(token => this._proxy.$onSaveAs(this._editorResource, this.viewType, targetResource, token));\n\t\t\tthis.change(() => {\n\t\t\t\tthis._savePoint = this._currentEditIndex;\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\t// Since the editor is readonly, just copy the file over\n\t\t\tawait this._fileService.copy(resource, targetResource, false /* overwrite */);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tpublic async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\tconst editors = this._getEditors();\n\t\tif (!editors.length) {\n\t\t\tthrow new Error('No editors found for resource, cannot back up');\n\t\t}\n\t\tconst primaryEditor = editors[0];\n\n\t\tconst backupMeta: CustomDocumentBackupData = {\n\t\t\tviewType: this.viewType,\n\t\t\teditorResource: this._editorResource,\n\t\t\tbackupId: '',\n\t\t\textension: primaryEditor.extension ? {\n\t\t\t\tid: primaryEditor.extension.id.value,\n\t\t\t\tlocation: primaryEditor.extension.location,\n\t\t\t} : undefined,\n\t\t\twebview: {\n\t\t\t\tid: primaryEditor.id,\n\t\t\t\toptions: primaryEditor.webview.options,\n\t\t\t\tstate: primaryEditor.webview.state,\n\t\t\t}\n\t\t};\n\n\t\tconst backupData: IWorkingCopyBackup = {\n\t\t\tmeta: backupMeta\n\t\t};\n\n\t\tif (!this._editable) {\n\t\t\treturn backupData;\n\t\t}\n\n\t\tif (this._hotExitState.type === HotExitState.Type.Pending) {\n\t\t\tthis._hotExitState.operation.cancel();\n\t\t}\n\n\t\tconst pendingState = new HotExitState.Pending(\n\t\t\tcreateCancelablePromise(token =>\n\t\t\t\tthis._proxy.$backup(this._editorResource.toJSON(), this.viewType, token)));\n\t\tthis._hotExitState = pendingState;\n\n\t\ttoken.onCancellationRequested(() => {\n\t\t\tpendingState.operation.cancel();\n\t\t});\n\n\t\ttry {\n\t\t\tconst backupId = await pendingState.operation;\n\t\t\t// Make sure state has not changed in the meantime\n\t\t\tif (this._hotExitState === pendingState) {\n\t\t\t\tthis._hotExitState = HotExitState.Allowed;\n\t\t\t\tbackupData.meta!.backupId = backupId;\n\t\t\t\tthis._backupId = backupId;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (isPromiseCanceledError(e)) {\n\t\t\t\t// This is expected\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\t// Otherwise it could be a real error. Make sure state has not changed in the meantime.\n\t\t\tif (this._hotExitState === pendingState) {\n\t\t\t\tthis._hotExitState = HotExitState.NotAllowed;\n\t\t\t}\n\t\t}\n\n\t\tif (this._hotExitState === HotExitState.Allowed) {\n\t\t\treturn backupData;\n\t\t}\n\n\t\tthrow new Error('Cannot back up in this state');\n\t}\n}\n"]}