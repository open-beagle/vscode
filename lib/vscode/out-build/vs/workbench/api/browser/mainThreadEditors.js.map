{"version":3,"file":"mainThreadEditors.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/api/browser/mainThreadEditors.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { disposed } from 'vs/base/common/errors';\nimport { IDisposable, dispose, DisposableStore } from 'vs/base/common/lifecycle';\nimport { equals as objectEquals } from 'vs/base/common/objects';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IBulkEditService, ResourceEdit, ResourceFileEdit, ResourceTextEdit } from 'vs/editor/browser/services/bulkEditService';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { ISelection } from 'vs/editor/common/core/selection';\nimport { IDecorationOptions, IDecorationRenderOptions, ILineChange } from 'vs/editor/common/editorCommon';\nimport { ISingleEditOperation } from 'vs/editor/common/model';\nimport { CommandsRegistry } from 'vs/platform/commands/common/commands';\nimport { ITextEditorOptions, IResourceEditorInput, EditorActivation, EditorOverride } from 'vs/platform/editor/common/editor';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { MainThreadDocumentsAndEditors } from 'vs/workbench/api/browser/mainThreadDocumentsAndEditors';\nimport { MainThreadTextEditor } from 'vs/workbench/api/browser/mainThreadEditor';\nimport { ExtHostContext, ExtHostEditorsShape, IApplyEditsOptions, IExtHostContext, ITextDocumentShowOptions, ITextEditorConfigurationUpdate, ITextEditorPositionData, IUndoStopOptions, MainThreadTextEditorsShape, TextEditorRevealType, IWorkspaceEditDto, WorkspaceEditType } from 'vs/workbench/api/common/extHost.protocol';\nimport { editorGroupToViewColumn, EditorGroupColumn, viewColumnToEditorGroup } from 'vs/workbench/common/editor';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IWorkingCopyService } from 'vs/workbench/services/workingCopy/common/workingCopyService';\nimport { revive } from 'vs/base/common/marshalling';\nimport { ResourceNotebookCellEdit } from 'vs/workbench/contrib/bulkEdit/browser/bulkCellEdits';\n\nexport function reviveWorkspaceEditDto2(data: IWorkspaceEditDto | undefined): ResourceEdit[] {\n\tif (!data?.edits) {\n\t\treturn [];\n\t}\n\n\tconst result: ResourceEdit[] = [];\n\tfor (let edit of revive<IWorkspaceEditDto>(data).edits) {\n\t\tif (edit._type === WorkspaceEditType.File) {\n\t\t\tresult.push(new ResourceFileEdit(edit.oldUri, edit.newUri, edit.options, edit.metadata));\n\t\t} else if (edit._type === WorkspaceEditType.Text) {\n\t\t\tresult.push(new ResourceTextEdit(edit.resource, edit.edit, edit.modelVersionId, edit.metadata));\n\t\t} else if (edit._type === WorkspaceEditType.Cell) {\n\t\t\tresult.push(new ResourceNotebookCellEdit(edit.resource, edit.edit, edit.notebookVersionId, edit.metadata));\n\t\t}\n\t}\n\treturn result;\n}\n\nexport class MainThreadTextEditors implements MainThreadTextEditorsShape {\n\n\tprivate static INSTANCE_COUNT: number = 0;\n\n\tprivate readonly _instanceId: string;\n\tprivate readonly _proxy: ExtHostEditorsShape;\n\tprivate readonly _documentsAndEditors: MainThreadDocumentsAndEditors;\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate _textEditorsListenersMap: { [editorId: string]: IDisposable[]; };\n\tprivate _editorPositionData: ITextEditorPositionData | null;\n\tprivate _registeredDecorationTypes: { [decorationType: string]: boolean; };\n\n\tconstructor(\n\t\tdocumentsAndEditors: MainThreadDocumentsAndEditors,\n\t\textHostContext: IExtHostContext,\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IBulkEditService private readonly _bulkEditService: IBulkEditService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService\n\t) {\n\t\tthis._instanceId = String(++MainThreadTextEditors.INSTANCE_COUNT);\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostEditors);\n\t\tthis._documentsAndEditors = documentsAndEditors;\n\n\t\tthis._textEditorsListenersMap = Object.create(null);\n\t\tthis._editorPositionData = null;\n\n\t\tthis._toDispose.add(documentsAndEditors.onTextEditorAdd(editors => editors.forEach(this._onTextEditorAdd, this)));\n\t\tthis._toDispose.add(documentsAndEditors.onTextEditorRemove(editors => editors.forEach(this._onTextEditorRemove, this)));\n\n\t\tthis._toDispose.add(this._editorService.onDidVisibleEditorsChange(() => this._updateActiveAndVisibleTextEditors()));\n\t\tthis._toDispose.add(this._editorGroupService.onDidRemoveGroup(() => this._updateActiveAndVisibleTextEditors()));\n\t\tthis._toDispose.add(this._editorGroupService.onDidMoveGroup(() => this._updateActiveAndVisibleTextEditors()));\n\n\t\tthis._registeredDecorationTypes = Object.create(null);\n\t}\n\n\tpublic dispose(): void {\n\t\tObject.keys(this._textEditorsListenersMap).forEach((editorId) => {\n\t\t\tdispose(this._textEditorsListenersMap[editorId]);\n\t\t});\n\t\tthis._textEditorsListenersMap = Object.create(null);\n\t\tthis._toDispose.dispose();\n\t\tfor (let decorationType in this._registeredDecorationTypes) {\n\t\t\tthis._codeEditorService.removeDecorationType(decorationType);\n\t\t}\n\t\tthis._registeredDecorationTypes = Object.create(null);\n\t}\n\n\tprivate _onTextEditorAdd(textEditor: MainThreadTextEditor): void {\n\t\tconst id = textEditor.getId();\n\t\tconst toDispose: IDisposable[] = [];\n\t\ttoDispose.push(textEditor.onPropertiesChanged((data) => {\n\t\t\tthis._proxy.$acceptEditorPropertiesChanged(id, data);\n\t\t}));\n\n\t\tthis._textEditorsListenersMap[id] = toDispose;\n\t}\n\n\tprivate _onTextEditorRemove(id: string): void {\n\t\tdispose(this._textEditorsListenersMap[id]);\n\t\tdelete this._textEditorsListenersMap[id];\n\t}\n\n\tprivate _updateActiveAndVisibleTextEditors(): void {\n\n\t\t// editor columns\n\t\tconst editorPositionData = this._getTextEditorPositionData();\n\t\tif (!objectEquals(this._editorPositionData, editorPositionData)) {\n\t\t\tthis._editorPositionData = editorPositionData;\n\t\t\tthis._proxy.$acceptEditorPositionData(this._editorPositionData);\n\t\t}\n\t}\n\n\tprivate _getTextEditorPositionData(): ITextEditorPositionData {\n\t\tconst result: ITextEditorPositionData = Object.create(null);\n\t\tfor (let editorPane of this._editorService.visibleEditorPanes) {\n\t\t\tconst id = this._documentsAndEditors.findTextEditorIdFor(editorPane);\n\t\t\tif (id) {\n\t\t\t\tresult[id] = editorGroupToViewColumn(this._editorGroupService, editorPane.group);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t// --- from extension host process\n\n\tasync $tryShowTextDocument(resource: UriComponents, options: ITextDocumentShowOptions): Promise<string | undefined> {\n\t\tconst uri = URI.revive(resource);\n\n\t\tconst editorOptions: ITextEditorOptions = {\n\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\tpinned: options.pinned,\n\t\t\tselection: options.selection,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: options.preserveFocus ? EditorActivation.RESTORE : undefined,\n\t\t\toverride: EditorOverride.DISABLED\n\t\t};\n\n\t\tconst input: IResourceEditorInput = {\n\t\t\tresource: uri,\n\t\t\toptions: editorOptions\n\t\t};\n\n\t\tconst editor = await this._editorService.openEditor(input, viewColumnToEditorGroup(this._editorGroupService, options.position));\n\t\tif (!editor) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._documentsAndEditors.findTextEditorIdFor(editor);\n\t}\n\n\tasync $tryShowEditor(id: string, position?: EditorGroupColumn): Promise<void> {\n\t\tconst mainThreadEditor = this._documentsAndEditors.getEditor(id);\n\t\tif (mainThreadEditor) {\n\t\t\tconst model = mainThreadEditor.getModel();\n\t\t\tawait this._editorService.openEditor({\n\t\t\t\tresource: model.uri,\n\t\t\t\toptions: { preserveFocus: false }\n\t\t\t}, viewColumnToEditorGroup(this._editorGroupService, position));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tasync $tryHideEditor(id: string): Promise<void> {\n\t\tconst mainThreadEditor = this._documentsAndEditors.getEditor(id);\n\t\tif (mainThreadEditor) {\n\t\t\tconst editorPanes = this._editorService.visibleEditorPanes;\n\t\t\tfor (let editorPane of editorPanes) {\n\t\t\t\tif (mainThreadEditor.matches(editorPane)) {\n\t\t\t\t\treturn editorPane.group.closeEditor(editorPane.input);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t$trySetSelections(id: string, selections: ISelection[]): Promise<void> {\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\teditor.setSelections(selections);\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$trySetDecorations(id: string, key: string, ranges: IDecorationOptions[]): Promise<void> {\n\t\tkey = `${this._instanceId}-${key}`;\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\teditor.setDecorations(key, ranges);\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$trySetDecorationsFast(id: string, key: string, ranges: number[]): Promise<void> {\n\t\tkey = `${this._instanceId}-${key}`;\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\teditor.setDecorationsFast(key, ranges);\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$tryRevealRange(id: string, range: IRange, revealType: TextEditorRevealType): Promise<void> {\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\teditor.revealRange(range, revealType);\n\t\treturn Promise.resolve();\n\t}\n\n\t$trySetOptions(id: string, options: ITextEditorConfigurationUpdate): Promise<void> {\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\teditor.setConfiguration(options);\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$tryApplyEdits(id: string, modelVersionId: number, edits: ISingleEditOperation[], opts: IApplyEditsOptions): Promise<boolean> {\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\treturn Promise.resolve(editor.applyEdits(modelVersionId, edits, opts));\n\t}\n\n\t$tryApplyWorkspaceEdit(dto: IWorkspaceEditDto): Promise<boolean> {\n\t\tconst edits = reviveWorkspaceEditDto2(dto);\n\t\treturn this._bulkEditService.apply(edits).then(() => true, _err => false);\n\t}\n\n\t$tryInsertSnippet(id: string, template: string, ranges: readonly IRange[], opts: IUndoStopOptions): Promise<boolean> {\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(disposed(`TextEditor(${id})`));\n\t\t}\n\t\treturn Promise.resolve(editor.insertSnippet(template, ranges, opts));\n\t}\n\n\t$registerTextEditorDecorationType(key: string, options: IDecorationRenderOptions): void {\n\t\tkey = `${this._instanceId}-${key}`;\n\t\tthis._registeredDecorationTypes[key] = true;\n\t\tthis._codeEditorService.registerDecorationType(key, options);\n\t}\n\n\t$removeTextEditorDecorationType(key: string): void {\n\t\tkey = `${this._instanceId}-${key}`;\n\t\tdelete this._registeredDecorationTypes[key];\n\t\tthis._codeEditorService.removeDecorationType(key);\n\t}\n\n\t$getDiffInformation(id: string): Promise<ILineChange[]> {\n\t\tconst editor = this._documentsAndEditors.getEditor(id);\n\n\t\tif (!editor) {\n\t\t\treturn Promise.reject(new Error('No such TextEditor'));\n\t\t}\n\n\t\tconst codeEditor = editor.getCodeEditor();\n\t\tif (!codeEditor) {\n\t\t\treturn Promise.reject(new Error('No such CodeEditor'));\n\t\t}\n\n\t\tconst codeEditorId = codeEditor.getId();\n\t\tconst diffEditors = this._codeEditorService.listDiffEditors();\n\t\tconst [diffEditor] = diffEditors.filter(d => d.getOriginalEditor().getId() === codeEditorId || d.getModifiedEditor().getId() === codeEditorId);\n\n\t\tif (diffEditor) {\n\t\t\treturn Promise.resolve(diffEditor.getLineChanges() || []);\n\t\t}\n\n\t\tconst dirtyDiffContribution = codeEditor.getContribution('editor.contrib.dirtydiff');\n\n\t\tif (dirtyDiffContribution) {\n\t\t\treturn Promise.resolve((dirtyDiffContribution as any).getChanges());\n\t\t}\n\n\t\treturn Promise.resolve([]);\n\t}\n}\n\n// --- commands\n\nCommandsRegistry.registerCommand('_workbench.revertAllDirty', async function (accessor: ServicesAccessor) {\n\tconst environmentService = accessor.get(IEnvironmentService);\n\tif (!environmentService.extensionTestsLocationURI) {\n\t\tthrow new Error('Command is only available when running extension tests.');\n\t}\n\n\tconst workingCopyService = accessor.get(IWorkingCopyService);\n\tfor (const workingCopy of workingCopyService.dirtyWorkingCopies) {\n\t\tawait workingCopy.revert({ soft: true });\n\t}\n});\n"]}