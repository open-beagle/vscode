{"version":3,"file":"mainThreadTreeViews.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/test/browser/api/mainThreadTreeViews.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { ExtHostTreeViewsShape, IExtHostContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { mock } from 'vs/base/test/common/mock';\nimport { ITreeItem, IViewsRegistry, Extensions, ViewContainerLocation, IViewContainersRegistry, ITreeViewDescriptor, ITreeView, ViewContainer, IViewDescriptorService, TreeItemCollapsibleState } from 'vs/workbench/common/views';\nimport { NullLogService } from 'vs/platform/log/common/log';\nimport { MainThreadTreeViews } from 'vs/workbench/api/browser/mainThreadTreeViews';\nimport { TestViewsService, workbenchInstantiationService } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { TestExtensionService } from 'vs/workbench/test/common/workbenchTestServices';\nimport { TestNotificationService } from 'vs/platform/notification/test/common/testNotificationService';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { SyncDescriptor } from 'vs/platform/instantiation/common/descriptors';\nimport { TestInstantiationService } from 'vs/platform/instantiation/test/common/instantiationServiceMock';\nimport { ViewDescriptorService } from 'vs/workbench/services/views/browser/viewDescriptorService';\nimport { CustomTreeView } from 'vs/workbench/browser/parts/views/treeView';\nimport { ExtensionHostKind } from 'vs/workbench/services/extensions/common/extensions';\n\nsuite('MainThreadHostTreeView', function () {\n\tconst testTreeViewId = 'testTreeView';\n\tconst customValue = 'customValue';\n\tconst ViewsRegistry = Registry.as<IViewsRegistry>(Extensions.ViewsRegistry);\n\n\tinterface CustomTreeItem extends ITreeItem {\n\t\tcustomProp: string;\n\t}\n\n\tclass MockExtHostTreeViewsShape extends mock<ExtHostTreeViewsShape>() {\n\t\toverride async $getChildren(treeViewId: string, treeItemHandle?: string): Promise<ITreeItem[]> {\n\t\t\treturn [<CustomTreeItem>{ handle: 'testItem1', collapsibleState: TreeItemCollapsibleState.Expanded, customProp: customValue }];\n\t\t}\n\n\t\toverride async $hasResolve(): Promise<boolean> {\n\t\t\treturn false;\n\t\t}\n\n\t\toverride $setVisible(): void { }\n\t}\n\n\tlet container: ViewContainer;\n\tlet mainThreadTreeViews: MainThreadTreeViews;\n\tlet extHostTreeViewsShape: MockExtHostTreeViewsShape;\n\n\tsetup(async () => {\n\t\tconst instantiationService: TestInstantiationService = <TestInstantiationService>workbenchInstantiationService();\n\t\tconst viewDescriptorService = instantiationService.createInstance(ViewDescriptorService);\n\t\tinstantiationService.stub(IViewDescriptorService, viewDescriptorService);\n\t\tcontainer = Registry.as<IViewContainersRegistry>(Extensions.ViewContainersRegistry).registerViewContainer({ id: 'testContainer', title: 'test', ctorDescriptor: new SyncDescriptor(<any>{}) }, ViewContainerLocation.Sidebar);\n\t\tconst viewDescriptor: ITreeViewDescriptor = {\n\t\t\tid: testTreeViewId,\n\t\t\tctorDescriptor: null!,\n\t\t\tname: 'Test View 1',\n\t\t\ttreeView: instantiationService.createInstance(CustomTreeView, 'testTree', 'Test Title'),\n\t\t};\n\t\tViewsRegistry.registerViews([viewDescriptor], container);\n\n\t\tconst testExtensionService = new TestExtensionService();\n\t\textHostTreeViewsShape = new MockExtHostTreeViewsShape();\n\t\tmainThreadTreeViews = new MainThreadTreeViews(\n\t\t\tnew class implements IExtHostContext {\n\t\t\t\tremoteAuthority = '';\n\t\t\t\textensionHostKind = ExtensionHostKind.LocalProcess;\n\t\t\t\tassertRegistered() { }\n\t\t\t\tset(v: any): any { return null; }\n\t\t\t\tgetProxy(): any {\n\t\t\t\t\treturn extHostTreeViewsShape;\n\t\t\t\t}\n\t\t\t\tdrain(): any { return null; }\n\t\t\t}, new TestViewsService(), new TestNotificationService(), testExtensionService, new NullLogService());\n\t\tmainThreadTreeViews.$registerTreeViewDataProvider(testTreeViewId, { showCollapseAll: false, canSelectMany: false });\n\t\tawait testExtensionService.whenInstalledExtensionsRegistered();\n\t});\n\n\tteardown(() => {\n\t\tViewsRegistry.deregisterViews(ViewsRegistry.getViews(container), container);\n\t});\n\n\ttest('getChildren keeps custom properties', async () => {\n\t\tconst treeView: ITreeView = (<ITreeViewDescriptor>ViewsRegistry.getView(testTreeViewId)).treeView;\n\t\tconst children = await treeView.dataProvider?.getChildren({ handle: 'root', collapsibleState: TreeItemCollapsibleState.Expanded });\n\t\tassert(children!.length === 1, 'Exactly one child should be returned');\n\t\tassert((<CustomTreeItem>children![0]).customProp === customValue, 'Tree Items should keep custom properties');\n\t});\n\n\n});\n"]}