{"version":3,"sources":["vs/workbench/contrib/extensions/common/extensionsUtils.ts"],"names":[],"mappings":"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","file":"extensionsUtils.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { Event } from 'vs/base/common/event';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IExtensionManagementService, ILocalExtension, IExtensionIdentifier, InstallOperation } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { IWorkbenchExtensionEnablementService, EnablementState } from 'vs/workbench/services/extensionManagement/common/extensionManagement';\nimport { IExtensionRecommendationsService } from 'vs/workbench/services/extensionRecommendations/common/extensionRecommendations';\nimport { ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { IWorkbenchContribution } from 'vs/workbench/common/contributions';\nimport { ServicesAccessor, IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { areSameExtensions } from 'vs/platform/extensionManagement/common/extensionManagementUtil';\nimport { Severity, INotificationService } from 'vs/platform/notification/common/notification';\n\nexport interface IExtensionStatus {\n\tidentifier: IExtensionIdentifier;\n\tlocal: ILocalExtension;\n\tgloballyEnabled: boolean;\n}\n\nexport class KeymapExtensions extends Disposable implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IWorkbenchExtensionEnablementService private readonly extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@IExtensionRecommendationsService private readonly tipsService: IExtensionRecommendationsService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t) {\n\t\tsuper();\n\t\tthis._register(lifecycleService.onDidShutdown(() => this.dispose()));\n\t\tthis._register(instantiationService.invokeFunction(onExtensionChanged)((identifiers => {\n\t\t\tPromise.all(identifiers.map(identifier => this.checkForOtherKeymaps(identifier)))\n\t\t\t\t.then(undefined, onUnexpectedError);\n\t\t})));\n\t}\n\n\tprivate checkForOtherKeymaps(extensionIdentifier: IExtensionIdentifier): Promise<void> {\n\t\treturn this.instantiationService.invokeFunction(getInstalledExtensions).then(extensions => {\n\t\t\tconst keymaps = extensions.filter(extension => isKeymapExtension(this.tipsService, extension));\n\t\t\tconst extension = keymaps.find(extension => areSameExtensions(extension.identifier, extensionIdentifier));\n\t\t\tif (extension && extension.globallyEnabled) {\n\t\t\t\tconst otherKeymaps = keymaps.filter(extension => !areSameExtensions(extension.identifier, extensionIdentifier) && extension.globallyEnabled);\n\t\t\t\tif (otherKeymaps.length) {\n\t\t\t\t\treturn this.promptForDisablingOtherKeymaps(extension, otherKeymaps);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n\n\tprivate promptForDisablingOtherKeymaps(newKeymap: IExtensionStatus, oldKeymaps: IExtensionStatus[]): void {\n\t\tconst onPrompt = (confirmed: boolean) => {\n\t\t\tconst telemetryData: { [key: string]: any; } = {\n\t\t\t\tnewKeymap: newKeymap.identifier,\n\t\t\t\toldKeymaps: oldKeymaps.map(k => k.identifier),\n\t\t\t\tconfirmed\n\t\t\t};\n\t\t\t/* __GDPR__\n\t\t\t\t\"disableOtherKeymaps\" : {\n\t\t\t\t\t\"newKeymap\": { \"${inline}\": [ \"${ExtensionIdentifier}\" ] },\n\t\t\t\t\t\"oldKeymaps\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\t\t\t\"confirmed\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tthis.telemetryService.publicLog('disableOtherKeymaps', telemetryData);\n\t\t\tif (confirmed) {\n\t\t\t\tthis.extensionEnablementService.setEnablement(oldKeymaps.map(keymap => keymap.local), EnablementState.DisabledGlobally);\n\t\t\t}\n\t\t};\n\n\t\tthis.notificationService.prompt(Severity.Info, localize('disableOtherKeymapsConfirmation', \"Disable other keymaps ({0}) to avoid conflicts between keybindings?\", oldKeymaps.map(k => `'${k.local.manifest.displayName}'`).join(', ')),\n\t\t\t[{\n\t\t\t\tlabel: localize('yes', \"Yes\"),\n\t\t\t\trun: () => onPrompt(true)\n\t\t\t}, {\n\t\t\t\tlabel: localize('no', \"No\"),\n\t\t\t\trun: () => onPrompt(false)\n\t\t\t}]\n\t\t);\n\t}\n}\n\nexport function onExtensionChanged(accessor: ServicesAccessor): Event<IExtensionIdentifier[]> {\n\tconst extensionService = accessor.get(IExtensionManagementService);\n\tconst extensionEnablementService = accessor.get(IWorkbenchExtensionEnablementService);\n\tconst onDidInstallExtension = Event.chain(extensionService.onDidInstallExtension)\n\t\t.filter(e => e.operation === InstallOperation.Install)\n\t\t.event;\n\treturn Event.debounce<IExtensionIdentifier[], IExtensionIdentifier[]>(Event.any(\n\t\tEvent.chain(Event.any(onDidInstallExtension, extensionService.onDidUninstallExtension))\n\t\t\t.map(e => [e.identifier])\n\t\t\t.event,\n\t\tEvent.map(extensionEnablementService.onEnablementChanged, extensions => extensions.map(e => e.identifier))\n\t), (result: IExtensionIdentifier[] | undefined, identifiers: IExtensionIdentifier[]) => {\n\t\tresult = result || [];\n\t\tfor (const identifier of identifiers) {\n\t\t\tif (result.some(l => !areSameExtensions(l, identifier))) {\n\t\t\t\tresult.push(identifier);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t});\n}\n\nexport async function getInstalledExtensions(accessor: ServicesAccessor): Promise<IExtensionStatus[]> {\n\tconst extensionService = accessor.get(IExtensionManagementService);\n\tconst extensionEnablementService = accessor.get(IWorkbenchExtensionEnablementService);\n\tconst extensions = await extensionService.getInstalled();\n\treturn extensions.map(extension => {\n\t\treturn {\n\t\t\tidentifier: extension.identifier,\n\t\t\tlocal: extension,\n\t\t\tgloballyEnabled: extensionEnablementService.isEnabled(extension)\n\t\t};\n\t});\n}\n\nexport function isKeymapExtension(tipsService: IExtensionRecommendationsService, extension: IExtensionStatus): boolean {\n\tconst cats = extension.local.manifest.categories;\n\treturn cats && cats.indexOf('Keymaps') !== -1 || tipsService.getKeymapRecommendations().some(extensionId => areSameExtensions({ id: extensionId }, extension.local.identifier));\n}\n"]}