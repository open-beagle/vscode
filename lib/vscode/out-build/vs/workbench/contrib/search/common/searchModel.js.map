{"version":3,"file":"searchModel.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/search/common/searchModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport * as errors from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { getBaseLabel } from 'vs/base/common/labels';\nimport { Disposable, IDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { ResourceMap, TernarySearchTree } from 'vs/base/common/map';\nimport { lcut } from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { Range } from 'vs/editor/common/core/range';\nimport { FindMatch, IModelDeltaDecoration, ITextModel, OverviewRulerLane, TrackedRangeStickiness, MinimapPosition } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { IModelService } from 'vs/editor/common/services/modelService';\nimport { createDecorator, IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IProgress, IProgressStep } from 'vs/platform/progress/common/progress';\nimport { ReplacePattern } from 'vs/workbench/services/search/common/replace';\nimport { IFileMatch, IPatternInfo, ISearchComplete, ISearchProgressItem, ISearchConfigurationProperties, ISearchService, ITextQuery, ITextSearchPreviewOptions, ITextSearchMatch, ITextSearchStats, resultIsMatch, ISearchRange, OneLineRange, ITextSearchContext, ITextSearchResult, SearchSortOrder, SearchCompletionExitCode } from 'vs/workbench/services/search/common/search';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { overviewRulerFindMatchForeground, minimapFindMatch } from 'vs/platform/theme/common/colorRegistry';\nimport { themeColorFromId } from 'vs/platform/theme/common/themeService';\nimport { IReplaceService } from 'vs/workbench/contrib/search/common/replace';\nimport { editorMatchesToTextSearchResults, addContextToEditorMatches } from 'vs/workbench/services/search/common/searchHelpers';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { memoize } from 'vs/base/common/decorators';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { compareFileNames, compareFileExtensions, comparePaths } from 'vs/base/common/comparers';\nimport { IFileService, IFileStatWithMetadata } from 'vs/platform/files/common/files';\nimport { Schemas } from 'vs/base/common/network';\nimport { IUriIdentityService } from 'vs/workbench/services/uriIdentity/common/uriIdentity';\n\nexport class Match {\n\n\tprivate static readonly MAX_PREVIEW_CHARS = 250;\n\n\tprivate _id: string;\n\tprivate _range: Range;\n\tprivate _oneLinePreviewText: string;\n\tprivate _rangeInPreviewText: ISearchRange;\n\n\t// For replace\n\tprivate _fullPreviewRange: ISearchRange;\n\n\tconstructor(private _parent: FileMatch, private _fullPreviewLines: string[], _fullPreviewRange: ISearchRange, _documentRange: ISearchRange) {\n\t\tthis._oneLinePreviewText = _fullPreviewLines[_fullPreviewRange.startLineNumber];\n\t\tconst adjustedEndCol = _fullPreviewRange.startLineNumber === _fullPreviewRange.endLineNumber ?\n\t\t\t_fullPreviewRange.endColumn :\n\t\t\tthis._oneLinePreviewText.length;\n\t\tthis._rangeInPreviewText = new OneLineRange(1, _fullPreviewRange.startColumn + 1, adjustedEndCol + 1);\n\n\t\tthis._range = new Range(\n\t\t\t_documentRange.startLineNumber + 1,\n\t\t\t_documentRange.startColumn + 1,\n\t\t\t_documentRange.endLineNumber + 1,\n\t\t\t_documentRange.endColumn + 1);\n\n\t\tthis._fullPreviewRange = _fullPreviewRange;\n\n\t\tthis._id = this._parent.id() + '>' + this._range + this.getMatchString();\n\t}\n\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tparent(): FileMatch {\n\t\treturn this._parent;\n\t}\n\n\ttext(): string {\n\t\treturn this._oneLinePreviewText;\n\t}\n\n\trange(): Range {\n\t\treturn this._range;\n\t}\n\n\t@memoize\n\tpreview(): { before: string; inside: string; after: string; } {\n\t\tlet before = this._oneLinePreviewText.substring(0, this._rangeInPreviewText.startColumn - 1),\n\t\t\tinside = this.getMatchString(),\n\t\t\tafter = this._oneLinePreviewText.substring(this._rangeInPreviewText.endColumn - 1);\n\n\t\tbefore = lcut(before, 26);\n\t\tbefore = before.trimLeft();\n\n\t\tlet charsRemaining = Match.MAX_PREVIEW_CHARS - before.length;\n\t\tinside = inside.substr(0, charsRemaining);\n\t\tcharsRemaining -= inside.length;\n\t\tafter = after.substr(0, charsRemaining);\n\n\t\treturn {\n\t\t\tbefore,\n\t\t\tinside,\n\t\t\tafter,\n\t\t};\n\t}\n\n\tget replaceString(): string {\n\t\tconst searchModel = this.parent().parent().searchModel;\n\t\tif (!searchModel.replacePattern) {\n\t\t\tthrow new Error('searchModel.replacePattern must be set before accessing replaceString');\n\t\t}\n\n\t\tconst fullMatchText = this.fullMatchText();\n\t\tlet replaceString = searchModel.replacePattern.getReplaceString(fullMatchText, searchModel.preserveCase);\n\n\t\t// If match string is not matching then regex pattern has a lookahead expression\n\t\tif (replaceString === null) {\n\t\t\tconst fullMatchTextWithSurroundingContent = this.fullMatchText(true);\n\t\t\treplaceString = searchModel.replacePattern.getReplaceString(fullMatchTextWithSurroundingContent, searchModel.preserveCase);\n\n\t\t\t// Search/find normalize line endings - check whether \\r prevents regex from matching\n\t\t\tif (replaceString === null) {\n\t\t\t\tconst fullMatchTextWithoutCR = fullMatchTextWithSurroundingContent.replace(/\\r\\n/g, '\\n');\n\t\t\t\treplaceString = searchModel.replacePattern.getReplaceString(fullMatchTextWithoutCR, searchModel.preserveCase);\n\t\t\t}\n\t\t}\n\n\t\t// Match string is still not matching. Could be unsupported matches (multi-line).\n\t\tif (replaceString === null) {\n\t\t\treplaceString = searchModel.replacePattern.pattern;\n\t\t}\n\n\t\treturn replaceString;\n\t}\n\n\tfullMatchText(includeSurrounding = false): string {\n\t\tlet thisMatchPreviewLines: string[];\n\t\tif (includeSurrounding) {\n\t\t\tthisMatchPreviewLines = this._fullPreviewLines;\n\t\t} else {\n\t\t\tthisMatchPreviewLines = this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber, this._fullPreviewRange.endLineNumber + 1);\n\t\t\tthisMatchPreviewLines[thisMatchPreviewLines.length - 1] = thisMatchPreviewLines[thisMatchPreviewLines.length - 1].slice(0, this._fullPreviewRange.endColumn);\n\t\t\tthisMatchPreviewLines[0] = thisMatchPreviewLines[0].slice(this._fullPreviewRange.startColumn);\n\t\t}\n\n\t\treturn thisMatchPreviewLines.join('\\n');\n\t}\n\n\trangeInPreview() {\n\t\t// convert to editor's base 1 positions.\n\t\treturn {\n\t\t\t...this._fullPreviewRange,\n\t\t\tstartColumn: this._fullPreviewRange.startColumn + 1,\n\t\t\tendColumn: this._fullPreviewRange.endColumn + 1\n\t\t};\n\t}\n\n\tfullPreviewLines(): string[] {\n\t\treturn this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber, this._fullPreviewRange.endLineNumber + 1);\n\t}\n\n\tgetMatchString(): string {\n\t\treturn this._oneLinePreviewText.substring(this._rangeInPreviewText.startColumn - 1, this._rangeInPreviewText.endColumn - 1);\n\t}\n}\n\nexport class FileMatch extends Disposable implements IFileMatch {\n\n\tprivate static readonly _CURRENT_FIND_MATCH = ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tzIndex: 13,\n\t\tclassName: 'currentFindMatch',\n\t\toverviewRuler: {\n\t\t\tcolor: themeColorFromId(overviewRulerFindMatchForeground),\n\t\t\tposition: OverviewRulerLane.Center\n\t\t},\n\t\tminimap: {\n\t\t\tcolor: themeColorFromId(minimapFindMatch),\n\t\t\tposition: MinimapPosition.Inline\n\t\t}\n\t});\n\n\tprivate static readonly _FIND_MATCH = ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tclassName: 'findMatch',\n\t\toverviewRuler: {\n\t\t\tcolor: themeColorFromId(overviewRulerFindMatchForeground),\n\t\t\tposition: OverviewRulerLane.Center\n\t\t},\n\t\tminimap: {\n\t\t\tcolor: themeColorFromId(minimapFindMatch),\n\t\t\tposition: MinimapPosition.Inline\n\t\t}\n\t});\n\n\tprivate static getDecorationOption(selected: boolean): ModelDecorationOptions {\n\t\treturn (selected ? FileMatch._CURRENT_FIND_MATCH : FileMatch._FIND_MATCH);\n\t}\n\n\tprivate _onChange = this._register(new Emitter<{ didRemove?: boolean; forceUpdateModel?: boolean }>());\n\treadonly onChange: Event<{ didRemove?: boolean; forceUpdateModel?: boolean }> = this._onChange.event;\n\n\tprivate _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose: Event<void> = this._onDispose.event;\n\n\tprivate _resource: URI;\n\tprivate _fileStat?: IFileStatWithMetadata;\n\tprivate _model: ITextModel | null = null;\n\tprivate _modelListener: IDisposable | null = null;\n\tprivate _matches: Map<string, Match>;\n\tprivate _removedMatches: Set<string>;\n\tprivate _selectedMatch: Match | null = null;\n\n\tprivate _updateScheduler: RunOnceScheduler;\n\tprivate _modelDecorations: string[] = [];\n\n\tprivate _context: Map<number, string> = new Map();\n\tpublic get context(): Map<number, string> {\n\t\treturn new Map(this._context);\n\t}\n\n\tconstructor(private _query: IPatternInfo, private _previewOptions: ITextSearchPreviewOptions | undefined, private _maxResults: number | undefined, private _parent: FolderMatch, private rawMatch: IFileMatch,\n\t\t@IModelService private readonly modelService: IModelService, @IReplaceService private readonly replaceService: IReplaceService\n\t) {\n\t\tsuper();\n\t\tthis._resource = this.rawMatch.resource;\n\t\tthis._matches = new Map<string, Match>();\n\t\tthis._removedMatches = new Set<string>();\n\t\tthis._updateScheduler = new RunOnceScheduler(this.updateMatchesForModel.bind(this), 250);\n\n\t\tthis.createMatches();\n\t}\n\n\tprivate createMatches(): void {\n\t\tconst model = this.modelService.getModel(this._resource);\n\t\tif (model) {\n\t\t\tthis.bindModel(model);\n\t\t\tthis.updateMatchesForModel();\n\t\t} else {\n\t\t\tthis.rawMatch.results!\n\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t.forEach(rawMatch => {\n\t\t\t\t\ttextSearchResultToMatches(rawMatch, this)\n\t\t\t\t\t\t.forEach(m => this.add(m));\n\t\t\t\t});\n\n\t\t\tthis.addContext(this.rawMatch.results);\n\t\t}\n\t}\n\n\tbindModel(model: ITextModel): void {\n\t\tthis._model = model;\n\t\tthis._modelListener = this._model.onDidChangeContent(() => {\n\t\t\tthis._updateScheduler.schedule();\n\t\t});\n\t\tthis._model.onWillDispose(() => this.onModelWillDispose());\n\t\tthis.updateHighlights();\n\t}\n\n\tprivate onModelWillDispose(): void {\n\t\t// Update matches because model might have some dirty changes\n\t\tthis.updateMatchesForModel();\n\t\tthis.unbindModel();\n\t}\n\n\tprivate unbindModel(): void {\n\t\tif (this._model) {\n\t\t\tthis._updateScheduler.cancel();\n\t\t\tthis._model.deltaDecorations(this._modelDecorations, []);\n\t\t\tthis._model = null;\n\t\t\tthis._modelListener!.dispose();\n\t\t}\n\t}\n\n\tprivate updateMatchesForModel(): void {\n\t\t// this is called from a timeout and might fire\n\t\t// after the model has been disposed\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\t\tthis._matches = new Map<string, Match>();\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst matches = this._model\n\t\t\t.findMatches(this._query.pattern, this._model.getFullModelRange(), !!this._query.isRegExp, !!this._query.isCaseSensitive, wordSeparators, false, this._maxResults);\n\n\t\tthis.updateMatches(matches, true);\n\t}\n\n\tprivate updatesMatchesForLineAfterReplace(lineNumber: number, modelChange: boolean): void {\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst range = {\n\t\t\tstartLineNumber: lineNumber,\n\t\t\tstartColumn: this._model.getLineMinColumn(lineNumber),\n\t\t\tendLineNumber: lineNumber,\n\t\t\tendColumn: this._model.getLineMaxColumn(lineNumber)\n\t\t};\n\t\tconst oldMatches = Array.from(this._matches.values()).filter(match => match.range().startLineNumber === lineNumber);\n\t\toldMatches.forEach(match => this._matches.delete(match.id()));\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst matches = this._model.findMatches(this._query.pattern, range, !!this._query.isRegExp, !!this._query.isCaseSensitive, wordSeparators, false, this._maxResults);\n\t\tthis.updateMatches(matches, modelChange);\n\t}\n\n\tprivate updateMatches(matches: FindMatch[], modelChange: boolean): void {\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst textSearchResults = editorMatchesToTextSearchResults(matches, this._model, this._previewOptions);\n\t\ttextSearchResults.forEach(textSearchResult => {\n\t\t\ttextSearchResultToMatches(textSearchResult, this).forEach(match => {\n\t\t\t\tif (!this._removedMatches.has(match.id())) {\n\t\t\t\t\tthis.add(match);\n\t\t\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\t\t\tthis._selectedMatch = match;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.addContext(\n\t\t\taddContextToEditorMatches(textSearchResults, this._model, this.parent().parent().query!)\n\t\t\t\t.filter((result => !resultIsMatch(result)) as ((a: any) => a is ITextSearchContext))\n\t\t\t\t.map(context => ({ ...context, lineNumber: context.lineNumber + 1 })));\n\n\t\tthis._onChange.fire({ forceUpdateModel: modelChange });\n\t\tthis.updateHighlights();\n\t}\n\n\tupdateHighlights(): void {\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.parent().showHighlights) {\n\t\t\tthis._modelDecorations = this._model.deltaDecorations(this._modelDecorations, this.matches().map(match => <IModelDeltaDecoration>{\n\t\t\t\trange: match.range(),\n\t\t\t\toptions: FileMatch.getDecorationOption(this.isMatchSelected(match))\n\t\t\t}));\n\t\t} else {\n\t\t\tthis._modelDecorations = this._model.deltaDecorations(this._modelDecorations, []);\n\t\t}\n\t}\n\n\tid(): string {\n\t\treturn this.resource.toString();\n\t}\n\n\tparent(): FolderMatch {\n\t\treturn this._parent;\n\t}\n\n\tmatches(): Match[] {\n\t\treturn Array.from(this._matches.values());\n\t}\n\n\tremove(match: Match): void {\n\t\tthis.removeMatch(match);\n\t\tthis._removedMatches.add(match.id());\n\t\tthis._onChange.fire({ didRemove: true });\n\t}\n\n\tprivate replaceQ = Promise.resolve();\n\tasync replace(toReplace: Match): Promise<void> {\n\t\treturn this.replaceQ = this.replaceQ.finally(async () => {\n\t\t\tawait this.replaceService.replace(toReplace);\n\t\t\tthis.updatesMatchesForLineAfterReplace(toReplace.range().startLineNumber, false);\n\t\t});\n\t}\n\n\tsetSelectedMatch(match: Match | null): void {\n\t\tif (match) {\n\t\t\tif (!this._matches.has(match.id())) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._selectedMatch = match;\n\t\tthis.updateHighlights();\n\t}\n\n\tgetSelectedMatch(): Match | null {\n\t\treturn this._selectedMatch;\n\t}\n\n\tisMatchSelected(match: Match): boolean {\n\t\treturn !!this._selectedMatch && this._selectedMatch.id() === match.id();\n\t}\n\n\tcount(): number {\n\t\treturn this.matches().length;\n\t}\n\n\tget resource(): URI {\n\t\treturn this._resource;\n\t}\n\n\tname(): string {\n\t\treturn getBaseLabel(this.resource);\n\t}\n\n\taddContext(results: ITextSearchResult[] | undefined) {\n\t\tif (!results) { return; }\n\n\t\tresults\n\t\t\t.filter((result => !resultIsMatch(result)) as ((a: any) => a is ITextSearchContext))\n\t\t\t.forEach(context => this._context.set(context.lineNumber, context.text));\n\t}\n\n\tadd(match: Match, trigger?: boolean) {\n\t\tthis._matches.set(match.id(), match);\n\t\tif (trigger) {\n\t\t\tthis._onChange.fire({ forceUpdateModel: true });\n\t\t}\n\t}\n\n\tprivate removeMatch(match: Match) {\n\t\tthis._matches.delete(match.id());\n\t\tif (this.isMatchSelected(match)) {\n\t\t\tthis.setSelectedMatch(null);\n\t\t} else {\n\t\t\tthis.updateHighlights();\n\t\t}\n\t}\n\n\tasync resolveFileStat(fileService: IFileService): Promise<void> {\n\t\tthis._fileStat = await fileService.resolve(this.resource, { resolveMetadata: true }).catch(() => undefined);\n\t}\n\n\tpublic get fileStat(): IFileStatWithMetadata | undefined {\n\t\treturn this._fileStat;\n\t}\n\n\tpublic set fileStat(stat: IFileStatWithMetadata | undefined) {\n\t\tthis._fileStat = stat;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.setSelectedMatch(null);\n\t\tthis.unbindModel();\n\t\tthis._onDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n\nexport interface IChangeEvent {\n\telements: FileMatch[];\n\tadded?: boolean;\n\tremoved?: boolean;\n}\n\nexport class FolderMatch extends Disposable {\n\n\tprivate _onChange = this._register(new Emitter<IChangeEvent>());\n\treadonly onChange: Event<IChangeEvent> = this._onChange.event;\n\n\tprivate _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose: Event<void> = this._onDispose.event;\n\n\tprivate _fileMatches: ResourceMap<FileMatch>;\n\tprivate _unDisposedFileMatches: ResourceMap<FileMatch>;\n\tprivate _replacingAll: boolean = false;\n\n\tconstructor(protected _resource: URI | null, private _id: string, private _index: number, private _query: ITextQuery, private _parent: SearchResult, private _searchModel: SearchModel,\n\t\t@IReplaceService private readonly replaceService: IReplaceService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\t\tthis._fileMatches = new ResourceMap<FileMatch>();\n\t\tthis._unDisposedFileMatches = new ResourceMap<FileMatch>();\n\t}\n\n\tget searchModel(): SearchModel {\n\t\treturn this._searchModel;\n\t}\n\n\tget showHighlights(): boolean {\n\t\treturn this._parent.showHighlights;\n\t}\n\n\tset replacingAll(b: boolean) {\n\t\tthis._replacingAll = b;\n\t}\n\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tget resource(): URI | null {\n\t\treturn this._resource;\n\t}\n\n\tindex(): number {\n\t\treturn this._index;\n\t}\n\n\tname(): string {\n\t\treturn getBaseLabel(withNullAsUndefined(this.resource)) || '';\n\t}\n\n\tparent(): SearchResult {\n\t\treturn this._parent;\n\t}\n\n\tbindModel(model: ITextModel): void {\n\t\tconst fileMatch = this._fileMatches.get(model.uri);\n\t\tif (fileMatch) {\n\t\t\tfileMatch.bindModel(model);\n\t\t}\n\t}\n\n\tadd(raw: IFileMatch[], silent: boolean): void {\n\t\tconst added: FileMatch[] = [];\n\t\tconst updated: FileMatch[] = [];\n\t\traw.forEach(rawFileMatch => {\n\t\t\tconst existingFileMatch = this._fileMatches.get(rawFileMatch.resource);\n\t\t\tif (existingFileMatch) {\n\t\t\t\trawFileMatch\n\t\t\t\t\t.results!\n\t\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t\t.forEach(m => {\n\t\t\t\t\t\ttextSearchResultToMatches(m, existingFileMatch)\n\t\t\t\t\t\t\t.forEach(m => existingFileMatch.add(m));\n\t\t\t\t\t});\n\t\t\t\tupdated.push(existingFileMatch);\n\n\t\t\t\texistingFileMatch.addContext(rawFileMatch.results);\n\t\t\t} else {\n\t\t\t\tconst fileMatch = this.instantiationService.createInstance(FileMatch, this._query.contentPattern, this._query.previewOptions, this._query.maxResults, this, rawFileMatch);\n\t\t\t\tthis.doAdd(fileMatch);\n\t\t\t\tadded.push(fileMatch);\n\t\t\t\tconst disposable = fileMatch.onChange(({ didRemove }) => this.onFileChange(fileMatch, didRemove));\n\t\t\t\tfileMatch.onDispose(() => disposable.dispose());\n\t\t\t}\n\t\t});\n\n\t\tconst elements = [...added, ...updated];\n\t\tif (!silent && elements.length) {\n\t\t\tthis._onChange.fire({ elements, added: !!added.length });\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tconst changed: FileMatch[] = this.matches();\n\t\tthis.disposeMatches();\n\t\tthis._onChange.fire({ elements: changed, removed: true });\n\t}\n\n\tremove(matches: FileMatch | FileMatch[]): void {\n\t\tthis.doRemove(matches);\n\t}\n\n\treplace(match: FileMatch): Promise<any> {\n\t\treturn this.replaceService.replace([match]).then(() => {\n\t\t\tthis.doRemove(match);\n\t\t});\n\t}\n\n\treplaceAll(): Promise<any> {\n\t\tconst matches = this.matches();\n\t\treturn this.replaceService.replace(matches).then(() => this.doRemove(matches));\n\t}\n\n\tmatches(): FileMatch[] {\n\t\treturn [...this._fileMatches.values()];\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.fileCount() === 0;\n\t}\n\n\tfileCount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tcount(): number {\n\t\treturn this.matches().reduce<number>((prev, match) => prev + match.count(), 0);\n\t}\n\n\tprivate onFileChange(fileMatch: FileMatch, removed = false): void {\n\t\tlet added = false;\n\t\tif (!this._fileMatches.has(fileMatch.resource)) {\n\t\t\tthis.doAdd(fileMatch);\n\t\t\tadded = true;\n\t\t}\n\t\tif (fileMatch.count() === 0) {\n\t\t\tthis.doRemove(fileMatch, false, false);\n\t\t\tadded = false;\n\t\t\tremoved = true;\n\t\t}\n\t\tif (!this._replacingAll) {\n\t\t\tthis._onChange.fire({ elements: [fileMatch], added: added, removed: removed });\n\t\t}\n\t}\n\n\tprivate doAdd(fileMatch: FileMatch): void {\n\t\tthis._fileMatches.set(fileMatch.resource, fileMatch);\n\t\tif (this._unDisposedFileMatches.has(fileMatch.resource)) {\n\t\t\tthis._unDisposedFileMatches.delete(fileMatch.resource);\n\t\t}\n\t}\n\n\tprivate doRemove(fileMatches: FileMatch | FileMatch[], dispose: boolean = true, trigger: boolean = true): void {\n\t\tif (!Array.isArray(fileMatches)) {\n\t\t\tfileMatches = [fileMatches];\n\t\t}\n\n\t\tfor (const match of fileMatches as FileMatch[]) {\n\t\t\tthis._fileMatches.delete(match.resource);\n\t\t\tif (dispose) {\n\t\t\t\tmatch.dispose();\n\t\t\t} else {\n\t\t\t\tthis._unDisposedFileMatches.set(match.resource, match);\n\t\t\t}\n\t\t}\n\n\t\tif (trigger) {\n\t\t\tthis._onChange.fire({ elements: fileMatches, removed: true });\n\t\t}\n\t}\n\n\tprivate disposeMatches(): void {\n\t\t[...this._fileMatches.values()].forEach((fileMatch: FileMatch) => fileMatch.dispose());\n\t\t[...this._unDisposedFileMatches.values()].forEach((fileMatch: FileMatch) => fileMatch.dispose());\n\t\tthis._fileMatches.clear();\n\t\tthis._unDisposedFileMatches.clear();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.disposeMatches();\n\t\tthis._onDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n\n/**\n * BaseFolderMatch => optional resource (\"other files\" node)\n * FolderMatch => required resource (normal folder node)\n */\nexport class FolderMatchWithResource extends FolderMatch {\n\tconstructor(_resource: URI, _id: string, _index: number, _query: ITextQuery, _parent: SearchResult, _searchModel: SearchModel,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@IInstantiationService instantiationService: IInstantiationService\n\t) {\n\t\tsuper(_resource, _id, _index, _query, _parent, _searchModel, replaceService, instantiationService);\n\t}\n\n\toverride get resource(): URI {\n\t\treturn this._resource!;\n\t}\n}\n\n/**\n * Compares instances of the same match type. Different match types should not be siblings\n * and their sort order is undefined.\n */\nexport function searchMatchComparer(elementA: RenderableMatch, elementB: RenderableMatch, sortOrder: SearchSortOrder = SearchSortOrder.Default): number {\n\tif (elementA instanceof FolderMatch && elementB instanceof FolderMatch) {\n\t\treturn elementA.index() - elementB.index();\n\t}\n\n\tif (elementA instanceof FileMatch && elementB instanceof FileMatch) {\n\t\tswitch (sortOrder) {\n\t\t\tcase SearchSortOrder.CountDescending:\n\t\t\t\treturn elementB.count() - elementA.count();\n\t\t\tcase SearchSortOrder.CountAscending:\n\t\t\t\treturn elementA.count() - elementB.count();\n\t\t\tcase SearchSortOrder.Type:\n\t\t\t\treturn compareFileExtensions(elementA.name(), elementB.name());\n\t\t\tcase SearchSortOrder.FileNames:\n\t\t\t\treturn compareFileNames(elementA.name(), elementB.name());\n\t\t\tcase SearchSortOrder.Modified:\n\t\t\t\tconst fileStatA = elementA.fileStat;\n\t\t\t\tconst fileStatB = elementB.fileStat;\n\t\t\t\tif (fileStatA && fileStatB) {\n\t\t\t\t\treturn fileStatB.mtime - fileStatA.mtime;\n\t\t\t\t}\n\t\t\t// Fall through otherwise\n\t\t\tdefault:\n\t\t\t\treturn comparePaths(elementA.resource.fsPath, elementB.resource.fsPath) || compareFileNames(elementA.name(), elementB.name());\n\t\t}\n\t}\n\n\tif (elementA instanceof Match && elementB instanceof Match) {\n\t\treturn Range.compareRangesUsingStarts(elementA.range(), elementB.range());\n\t}\n\n\treturn 0;\n}\n\nexport class SearchResult extends Disposable {\n\n\tprivate _onChange = this._register(new Emitter<IChangeEvent>());\n\treadonly onChange: Event<IChangeEvent> = this._onChange.event;\n\n\tprivate _folderMatches: FolderMatchWithResource[] = [];\n\tprivate _otherFilesMatch: FolderMatch | null = null;\n\tprivate _folderMatchesMap: TernarySearchTree<URI, FolderMatchWithResource> = TernarySearchTree.forUris<FolderMatchWithResource>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\tprivate _showHighlights: boolean = false;\n\tprivate _query: ITextQuery | null = null;\n\n\tprivate _rangeHighlightDecorations: RangeHighlightDecorations;\n\tprivate disposePastResults: () => void = () => { };\n\n\tprivate _isDirty = false;\n\n\tconstructor(\n\t\tprivate _searchModel: SearchModel,\n\t\t@IReplaceService private readonly replaceService: IReplaceService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\t\tthis._rangeHighlightDecorations = this.instantiationService.createInstance(RangeHighlightDecorations);\n\n\t\tthis._register(this.modelService.onModelAdded(model => this.onModelAdded(model)));\n\n\t\tthis._register(this.onChange(e => {\n\t\t\tif (e.removed) {\n\t\t\t\tthis._isDirty = !this.isEmpty();\n\t\t\t}\n\t\t}));\n\t}\n\n\tget isDirty(): boolean {\n\t\treturn this._isDirty;\n\t}\n\n\tget query(): ITextQuery | null {\n\t\treturn this._query;\n\t}\n\n\tset query(query: ITextQuery | null) {\n\t\t// When updating the query we could change the roots, so keep a reference to them to clean up when we trigger `disposePastResults`\n\t\tconst oldFolderMatches = this.folderMatches();\n\t\tnew Promise<void>(resolve => this.disposePastResults = resolve)\n\t\t\t.then(() => oldFolderMatches.forEach(match => match.clear()))\n\t\t\t.then(() => oldFolderMatches.forEach(match => match.dispose()))\n\t\t\t.then(() => this._isDirty = false);\n\n\t\tthis._rangeHighlightDecorations.removeHighlightRange();\n\t\tthis._folderMatchesMap = TernarySearchTree.forUris<FolderMatchWithResource>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\n\t\tif (!query) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._folderMatches = (query && query.folderQueries || [])\n\t\t\t.map(fq => fq.folder)\n\t\t\t.map((resource, index) => this.createFolderMatchWithResource(resource, resource.toString(), index, query));\n\n\t\tthis._folderMatches.forEach(fm => this._folderMatchesMap.set(fm.resource, fm));\n\t\tthis._otherFilesMatch = this.createOtherFilesFolderMatch('otherFiles', this._folderMatches.length + 1, query);\n\n\t\tthis._query = query;\n\t}\n\n\tprivate onModelAdded(model: ITextModel): void {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(model.uri);\n\t\tif (folderMatch) {\n\t\t\tfolderMatch.bindModel(model);\n\t\t}\n\t}\n\n\tprivate createFolderMatchWithResource(resource: URI, id: string, index: number, query: ITextQuery): FolderMatchWithResource {\n\t\treturn <FolderMatchWithResource>this._createBaseFolderMatch(FolderMatchWithResource, resource, id, index, query);\n\t}\n\n\tprivate createOtherFilesFolderMatch(id: string, index: number, query: ITextQuery): FolderMatch {\n\t\treturn this._createBaseFolderMatch(FolderMatch, null, id, index, query);\n\t}\n\n\tprivate _createBaseFolderMatch(folderMatchClass: typeof FolderMatch | typeof FolderMatchWithResource, resource: URI | null, id: string, index: number, query: ITextQuery): FolderMatch {\n\t\tconst folderMatch = this.instantiationService.createInstance(folderMatchClass, resource, id, index, query, this, this._searchModel);\n\t\tconst disposable = folderMatch.onChange((event) => this._onChange.fire(event));\n\t\tfolderMatch.onDispose(() => disposable.dispose());\n\t\treturn folderMatch;\n\t}\n\n\tget searchModel(): SearchModel {\n\t\treturn this._searchModel;\n\t}\n\n\tadd(allRaw: IFileMatch[], silent: boolean = false): void {\n\t\t// Split up raw into a list per folder so we can do a batch add per folder.\n\n\t\tconst { byFolder, other } = this.groupFilesByFolder(allRaw);\n\t\tbyFolder.forEach(raw => {\n\t\t\tif (!raw.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst folderMatch = this.getFolderMatch(raw[0].resource);\n\t\t\tif (folderMatch) {\n\t\t\t\tfolderMatch.add(raw, silent);\n\t\t\t}\n\t\t});\n\n\t\tthis._otherFilesMatch?.add(other, silent);\n\t\tthis.disposePastResults();\n\t}\n\n\tclear(): void {\n\t\tthis.folderMatches().forEach((folderMatch) => folderMatch.clear());\n\t\tthis.disposeMatches();\n\t\tthis._folderMatches = [];\n\t\tthis._otherFilesMatch = null;\n\t}\n\n\tremove(matches: FileMatch | FolderMatch | (FileMatch | FolderMatch)[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\n\t\tmatches.forEach(m => {\n\t\t\tif (m instanceof FolderMatch) {\n\t\t\t\tm.clear();\n\t\t\t}\n\t\t});\n\n\t\tconst fileMatches: FileMatch[] = matches.filter(m => m instanceof FileMatch) as FileMatch[];\n\n\t\tconst { byFolder, other } = this.groupFilesByFolder(fileMatches);\n\t\tbyFolder.forEach(matches => {\n\t\t\tif (!matches.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getFolderMatch(matches[0].resource).remove(<FileMatch[]>matches);\n\t\t});\n\n\t\tif (other.length) {\n\t\t\tthis.getFolderMatch(other[0].resource).remove(<FileMatch[]>other);\n\t\t}\n\t}\n\n\treplace(match: FileMatch): Promise<any> {\n\t\treturn this.getFolderMatch(match.resource).replace(match);\n\t}\n\n\treplaceAll(progress: IProgress<IProgressStep>): Promise<any> {\n\t\tthis.replacingAll = true;\n\n\t\tconst promise = this.replaceService.replace(this.matches(), progress);\n\t\tconst onDone = Event.stopwatch(Event.fromPromise(promise));\n\t\t/* __GDPR__\n\t\t\t\"replaceAll.started\" : {\n\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t}\n\t\t*/\n\t\tonDone(duration => this.telemetryService.publicLog('replaceAll.started', { duration }));\n\n\t\treturn promise.then(() => {\n\t\t\tthis.replacingAll = false;\n\t\t\tthis.clear();\n\t\t}, () => {\n\t\t\tthis.replacingAll = false;\n\t\t});\n\t}\n\n\tfolderMatches(): FolderMatch[] {\n\t\treturn this._otherFilesMatch ?\n\t\t\t[\n\t\t\t\t...this._folderMatches,\n\t\t\t\tthis._otherFilesMatch\n\t\t\t] :\n\t\t\t[\n\t\t\t\t...this._folderMatches\n\t\t\t];\n\t}\n\n\tmatches(): FileMatch[] {\n\t\tconst matches: FileMatch[][] = [];\n\t\tthis.folderMatches().forEach(folderMatch => {\n\t\t\tmatches.push(folderMatch.matches());\n\t\t});\n\n\t\treturn (<FileMatch[]>[]).concat(...matches);\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.folderMatches().every((folderMatch) => folderMatch.isEmpty());\n\t}\n\n\tfileCount(): number {\n\t\treturn this.folderMatches().reduce<number>((prev, match) => prev + match.fileCount(), 0);\n\t}\n\n\tcount(): number {\n\t\treturn this.matches().reduce<number>((prev, match) => prev + match.count(), 0);\n\t}\n\n\tget showHighlights(): boolean {\n\t\treturn this._showHighlights;\n\t}\n\n\ttoggleHighlights(value: boolean): void {\n\t\tif (this._showHighlights === value) {\n\t\t\treturn;\n\t\t}\n\t\tthis._showHighlights = value;\n\t\tlet selectedMatch: Match | null = null;\n\t\tthis.matches().forEach((fileMatch: FileMatch) => {\n\t\t\tfileMatch.updateHighlights();\n\t\t\tif (!selectedMatch) {\n\t\t\t\tselectedMatch = fileMatch.getSelectedMatch();\n\t\t\t}\n\t\t});\n\t\tif (this._showHighlights && selectedMatch) {\n\t\t\t// TS?\n\t\t\tthis._rangeHighlightDecorations.highlightRange(\n\t\t\t\t(<Match>selectedMatch).parent().resource,\n\t\t\t\t(<Match>selectedMatch).range()\n\t\t\t);\n\t\t} else {\n\t\t\tthis._rangeHighlightDecorations.removeHighlightRange();\n\t\t}\n\t}\n\n\tget rangeHighlightDecorations(): RangeHighlightDecorations {\n\t\treturn this._rangeHighlightDecorations;\n\t}\n\n\tprivate getFolderMatch(resource: URI): FolderMatch {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(resource);\n\t\treturn folderMatch ? folderMatch : this._otherFilesMatch!;\n\t}\n\n\tprivate set replacingAll(running: boolean) {\n\t\tthis.folderMatches().forEach((folderMatch) => {\n\t\t\tfolderMatch.replacingAll = running;\n\t\t});\n\t}\n\n\tprivate groupFilesByFolder(fileMatches: IFileMatch[]): { byFolder: ResourceMap<IFileMatch[]>, other: IFileMatch[] } {\n\t\tconst rawPerFolder = new ResourceMap<IFileMatch[]>();\n\t\tconst otherFileMatches: IFileMatch[] = [];\n\t\tthis._folderMatches.forEach(fm => rawPerFolder.set(fm.resource, []));\n\n\t\tfileMatches.forEach(rawFileMatch => {\n\t\t\tconst folderMatch = this.getFolderMatch(rawFileMatch.resource);\n\t\t\tif (!folderMatch) {\n\t\t\t\t// foldermatch was previously removed by user or disposed for some reason\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst resource = folderMatch.resource;\n\t\t\tif (resource) {\n\t\t\t\trawPerFolder.get(resource)!.push(rawFileMatch);\n\t\t\t} else {\n\t\t\t\totherFileMatches.push(rawFileMatch);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tbyFolder: rawPerFolder,\n\t\t\tother: otherFileMatches\n\t\t};\n\t}\n\n\tprivate disposeMatches(): void {\n\t\tthis.folderMatches().forEach(folderMatch => folderMatch.dispose());\n\t\tthis._folderMatches = [];\n\t\tthis._folderMatchesMap = TernarySearchTree.forUris<FolderMatchWithResource>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\t\tthis._rangeHighlightDecorations.removeHighlightRange();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.disposePastResults();\n\t\tthis.disposeMatches();\n\t\tthis._rangeHighlightDecorations.dispose();\n\t\tsuper.dispose();\n\t}\n}\n\nexport class SearchModel extends Disposable {\n\n\tprivate _searchResult: SearchResult;\n\tprivate _searchQuery: ITextQuery | null = null;\n\tprivate _replaceActive: boolean = false;\n\tprivate _replaceString: string | null = null;\n\tprivate _replacePattern: ReplacePattern | null = null;\n\tprivate _preserveCase: boolean = false;\n\tprivate _startStreamDelay: Promise<void> = Promise.resolve();\n\tprivate _resultQueue: IFileMatch[] = [];\n\n\tprivate readonly _onReplaceTermChanged: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onReplaceTermChanged: Event<void> = this._onReplaceTermChanged.event;\n\n\tprivate currentCancelTokenSource: CancellationTokenSource | null = null;\n\tprivate searchCancelledForNewSearch: boolean = false;\n\n\tconstructor(\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\t\tthis._searchResult = this.instantiationService.createInstance(SearchResult, this);\n\t}\n\n\tisReplaceActive(): boolean {\n\t\treturn this._replaceActive;\n\t}\n\n\tset replaceActive(replaceActive: boolean) {\n\t\tthis._replaceActive = replaceActive;\n\t}\n\n\tget replacePattern(): ReplacePattern | null {\n\t\treturn this._replacePattern;\n\t}\n\n\tget replaceString(): string {\n\t\treturn this._replaceString || '';\n\t}\n\n\tset preserveCase(value: boolean) {\n\t\tthis._preserveCase = value;\n\t}\n\n\tget preserveCase(): boolean {\n\t\treturn this._preserveCase;\n\t}\n\n\tset replaceString(replaceString: string) {\n\t\tthis._replaceString = replaceString;\n\t\tif (this._searchQuery) {\n\t\t\tthis._replacePattern = new ReplacePattern(replaceString, this._searchQuery.contentPattern);\n\t\t}\n\t\tthis._onReplaceTermChanged.fire();\n\t}\n\n\tget searchResult(): SearchResult {\n\t\treturn this._searchResult;\n\t}\n\n\tsearch(query: ITextQuery, onProgress?: (result: ISearchProgressItem) => void): Promise<ISearchComplete> {\n\t\tthis.cancelSearch(true);\n\n\t\tthis._searchQuery = query;\n\t\tif (!this.searchConfig.searchOnType) {\n\t\t\tthis.searchResult.clear();\n\t\t}\n\n\t\tthis._searchResult.query = this._searchQuery;\n\n\t\tconst progressEmitter = new Emitter<void>();\n\t\tthis._replacePattern = new ReplacePattern(this.replaceString, this._searchQuery.contentPattern);\n\n\t\t// In search on type case, delay the streaming of results just a bit, so that we don't flash the only \"local results\" fast path\n\t\tthis._startStreamDelay = new Promise(resolve => setTimeout(resolve, this.searchConfig.searchOnType ? 150 : 0));\n\n\t\tconst tokenSource = this.currentCancelTokenSource = new CancellationTokenSource();\n\t\tconst currentRequest = this.searchService.textSearch(this._searchQuery, this.currentCancelTokenSource.token, p => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p);\n\n\t\t\tif (onProgress) {\n\t\t\t\tonProgress(p);\n\t\t\t}\n\t\t});\n\n\t\tconst dispose = () => tokenSource.dispose();\n\t\tcurrentRequest.then(dispose, dispose);\n\n\t\tconst onDone = Event.fromPromise(currentRequest);\n\t\tconst onFirstRender = Event.any<any>(onDone, progressEmitter.event);\n\t\tconst onFirstRenderStopwatch = Event.stopwatch(onFirstRender);\n\t\t/* __GDPR__\n\t\t\t\"searchResultsFirstRender\" : {\n\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t}\n\t\t*/\n\t\tonFirstRenderStopwatch(duration => this.telemetryService.publicLog('searchResultsFirstRender', { duration }));\n\n\t\tconst start = Date.now();\n\t\tcurrentRequest.then(\n\t\t\tvalue => this.onSearchCompleted(value, Date.now() - start),\n\t\t\te => this.onSearchError(e, Date.now() - start));\n\n\t\treturn currentRequest.finally(() => {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFinished\" : {\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tthis.telemetryService.publicLog('searchResultsFinished', { duration: Date.now() - start });\n\t\t});\n\t}\n\n\tprivate onSearchCompleted(completed: ISearchComplete | null, duration: number): ISearchComplete | null {\n\t\tif (!this._searchQuery) {\n\t\t\tthrow new Error('onSearchCompleted must be called after a search is started');\n\t\t}\n\n\t\tthis._searchResult.add(this._resultQueue);\n\t\tthis._resultQueue = [];\n\n\t\tconst options: IPatternInfo = Object.assign({}, this._searchQuery.contentPattern);\n\t\tdelete (options as any).pattern;\n\n\t\tconst stats = completed && completed.stats as ITextSearchStats;\n\n\t\tconst fileSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme === Schemas.file);\n\t\tconst otherSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme !== Schemas.file);\n\t\tconst scheme = fileSchemeOnly ? Schemas.file :\n\t\t\totherSchemeOnly ? 'other' :\n\t\t\t\t'mixed';\n\n\t\t/* __GDPR__\n\t\t\t\"searchResultsShown\" : {\n\t\t\t\t\"count\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"fileCount\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"options\": { \"${inline}\": [ \"${IPatternInfo}\" ] },\n\t\t\t\t\"duration\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\t\"type\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"scheme\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"searchOnTypeEnabled\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t\t}\n\t\t*/\n\t\tthis.telemetryService.publicLog('searchResultsShown', {\n\t\t\tcount: this._searchResult.count(),\n\t\t\tfileCount: this._searchResult.fileCount(),\n\t\t\toptions,\n\t\t\tduration,\n\t\t\ttype: stats && stats.type,\n\t\t\tscheme,\n\t\t\tsearchOnTypeEnabled: this.searchConfig.searchOnType\n\t\t});\n\t\treturn completed;\n\t}\n\n\tprivate onSearchError(e: any, duration: number): void {\n\t\tif (errors.isPromiseCanceledError(e)) {\n\t\t\tthis.onSearchCompleted(\n\t\t\t\tthis.searchCancelledForNewSearch\n\t\t\t\t\t? { exit: SearchCompletionExitCode.NewSearchStarted, results: [], messages: [] }\n\t\t\t\t\t: null,\n\t\t\t\tduration);\n\t\t\tthis.searchCancelledForNewSearch = false;\n\t\t}\n\t}\n\n\tprivate async onSearchProgress(p: ISearchProgressItem) {\n\t\tif ((<IFileMatch>p).resource) {\n\t\t\tthis._resultQueue.push(<IFileMatch>p);\n\t\t\tawait this._startStreamDelay;\n\t\t\tif (this._resultQueue.length) {\n\t\t\t\tthis._searchResult.add(this._resultQueue, true);\n\t\t\t\tthis._resultQueue = [];\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate get searchConfig() {\n\t\treturn this.configurationService.getValue<ISearchConfigurationProperties>('search');\n\t}\n\n\tcancelSearch(cancelledForNewSearch = false): boolean {\n\t\tif (this.currentCancelTokenSource) {\n\t\t\tthis.searchCancelledForNewSearch = cancelledForNewSearch;\n\t\t\tthis.currentCancelTokenSource.cancel();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.cancelSearch();\n\t\tthis.searchResult.dispose();\n\t\tsuper.dispose();\n\t}\n}\n\nexport type FileMatchOrMatch = FileMatch | Match;\n\nexport type RenderableMatch = FolderMatch | FolderMatchWithResource | FileMatch | Match;\n\nexport class SearchWorkbenchService implements ISearchWorkbenchService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _searchModel: SearchModel | null = null;\n\n\tconstructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n\t}\n\n\tget searchModel(): SearchModel {\n\t\tif (!this._searchModel) {\n\t\t\tthis._searchModel = this.instantiationService.createInstance(SearchModel);\n\t\t}\n\t\treturn this._searchModel;\n\t}\n}\n\nexport const ISearchWorkbenchService = createDecorator<ISearchWorkbenchService>('searchWorkbenchService');\n\nexport interface ISearchWorkbenchService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly searchModel: SearchModel;\n}\n\n/**\n * Can add a range highlight decoration to a model.\n * It will automatically remove it when the model has its decorations changed.\n */\nexport class RangeHighlightDecorations implements IDisposable {\n\n\tprivate _decorationId: string | null = null;\n\tprivate _model: ITextModel | null = null;\n\tprivate readonly _modelDisposables = new DisposableStore();\n\n\tconstructor(\n\t\t@IModelService private readonly _modelService: IModelService\n\t) {\n\t}\n\n\tremoveHighlightRange() {\n\t\tif (this._model && this._decorationId) {\n\t\t\tthis._model.deltaDecorations([this._decorationId], []);\n\t\t}\n\t\tthis._decorationId = null;\n\t}\n\n\thighlightRange(resource: URI | ITextModel, range: Range, ownerId: number = 0): void {\n\t\tlet model: ITextModel | null;\n\t\tif (URI.isUri(resource)) {\n\t\t\tmodel = this._modelService.getModel(resource);\n\t\t} else {\n\t\t\tmodel = resource;\n\t\t}\n\n\t\tif (model) {\n\t\t\tthis.doHighlightRange(model, range);\n\t\t}\n\t}\n\n\tprivate doHighlightRange(model: ITextModel, range: Range) {\n\t\tthis.removeHighlightRange();\n\t\tthis._decorationId = model.deltaDecorations([], [{ range: range, options: RangeHighlightDecorations._RANGE_HIGHLIGHT_DECORATION }])[0];\n\t\tthis.setModel(model);\n\t}\n\n\tprivate setModel(model: ITextModel) {\n\t\tif (this._model !== model) {\n\t\t\tthis.clearModelListeners();\n\t\t\tthis._model = model;\n\t\t\tthis._modelDisposables.add(this._model.onDidChangeDecorations((e) => {\n\t\t\t\tthis.clearModelListeners();\n\t\t\t\tthis.removeHighlightRange();\n\t\t\t\tthis._model = null;\n\t\t\t}));\n\t\t\tthis._modelDisposables.add(this._model.onWillDispose(() => {\n\t\t\t\tthis.clearModelListeners();\n\t\t\t\tthis.removeHighlightRange();\n\t\t\t\tthis._model = null;\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate clearModelListeners() {\n\t\tthis._modelDisposables.clear();\n\t}\n\n\tdispose() {\n\t\tif (this._model) {\n\t\t\tthis.removeHighlightRange();\n\t\t\tthis._modelDisposables.dispose();\n\t\t\tthis._model = null;\n\t\t}\n\t}\n\n\tprivate static readonly _RANGE_HIGHLIGHT_DECORATION = ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tclassName: 'rangeHighlight',\n\t\tisWholeLine: true\n\t});\n}\n\nfunction textSearchResultToMatches(rawMatch: ITextSearchMatch, fileMatch: FileMatch): Match[] {\n\tconst previewLines = rawMatch.preview.text.split('\\n');\n\tif (Array.isArray(rawMatch.ranges)) {\n\t\treturn rawMatch.ranges.map((r, i) => {\n\t\t\tconst previewRange: ISearchRange = (<ISearchRange[]>rawMatch.preview.matches)[i];\n\t\t\treturn new Match(fileMatch, previewLines, previewRange, r);\n\t\t});\n\t} else {\n\t\tconst previewRange = <ISearchRange>rawMatch.preview.matches;\n\t\tconst match = new Match(fileMatch, previewLines, previewRange, rawMatch.ranges);\n\t\treturn [match];\n\t}\n}\n"]}