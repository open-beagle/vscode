{"version":3,"file":"search.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/search/common/search.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IA8BhG,IAAiB,+BAA+B,CA0B/C;IA1BD,WAAiB,+BAA+B;QAE/C,MAAM,SAAS,GAA+B,EAAE,CAAC;QAEjD,SAAgB,QAAQ,CAAC,QAAkC;YAC1D,IAAI,OAAO,GAAyC,QAAQ,CAAC;YAC7D,IAAI,OAAO,EAAE;gBACZ,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aACxB;YAED,OAAO;gBACN,OAAO;oBACN,IAAI,OAAO,EAAE;wBACZ,MAAM,GAAG,GAAG,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;wBACvC,IAAI,GAAG,IAAI,CAAC,EAAE;4BACb,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;4BACzB,OAAO,GAAG,SAAS,CAAC;yBACpB;qBACD;gBACF,CAAC;aACD,CAAC;QACH,CAAC;QAjBe,wCAAQ,WAiBvB,CAAA;QAED,SAAgB,GAAG;YAClB,OAAO,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC3B,CAAC;QAFe,mCAAG,MAElB,CAAA;IACF,CAAC,EA1BgB,+BAA+B,GAA/B,uCAA+B,KAA/B,uCAA+B,QA0B/C;IAED,SAAgB,mBAAmB,CAAC,KAAa,EAAE,QAA2B,gCAAiB,CAAC,IAAI;QAEnG,MAAM,MAAM,GAAqD,EAAE,CAAC;QAEpE,MAAM,QAAQ,GAAG,+BAA+B,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE;YACpE,OAAO,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,uBAAuB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;gBAClF,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;oBACzB,MAAM,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;iBAC9B;YACF,CAAC,EAAE,0BAAiB,CAAC,CAAC;QACvB,CAAC,CAAC,CAAC;QAEH,OAAO,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;IAChD,CAAC;IAbD,kDAaC;IAgBD;;OAEG;IACH,SAAgB,gCAAgC,CAAC,QAA0B;QAC1E,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,8BAAc,CAAC,CAAC;QACnD,MAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,oCAAwB,CAAC,CAAC;QAC9D,MAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,oBAAY,CAAC,CAAC;QAE/C,MAAM,SAAS,GAAG,aAAa,CAAC,OAAO;aACrC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,+BAAsB,CAAC,cAAc,CAAC,MAAM,EAAE,EAAE,iBAAiB,EAAE,yBAAgB,CAAC,OAAO,EAAE,CAAC,CAAC;aAC7G,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,QAAQ,CAAC,IAAI,WAAW,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,CAAC;QAE3H,OAAO,SAAkB,CAAC;IAC3B,CAAC;IAVD,4EAUC;IAED,wDAAwD;IACxD,MAAM,kBAAkB,GAAG,gDAAgD,CAAC;IAO5E,SAAgB,sBAAsB,CAAC,MAAc,EAAE,MAAiB;;QACvE,IAAI,CAAC,MAAM,KAAI,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA,EAAE;YACnE,OAAO,SAAS,CAAC;SACjB;QAED,IAAI,KAAK,GAAuB,SAAS,CAAC;QAE1C,yDAAyD;QACzD,MAAM,YAAY,GAAG,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAErD,IAAI,YAAY,EAAE;YACjB,MAAM,eAAe,GAAG,QAAQ,CAAC,MAAA,YAAY,CAAC,CAAC,CAAC,mCAAI,EAAE,EAAE,EAAE,CAAC,CAAC;YAE5D,cAAc;YACd,IAAI,CAAA,GAAA,gBAAQ,CAAA,CAAC,eAAe,CAAC,EAAE;gBAC9B,KAAK,GAAG;oBACP,eAAe,EAAE,eAAe;oBAChC,WAAW,EAAE,CAAC;oBACd,aAAa,EAAE,eAAe;oBAC9B,SAAS,EAAE,CAAC;iBACZ,CAAC;gBAEF,gBAAgB;gBAChB,MAAM,WAAW,GAAG,QAAQ,CAAC,MAAA,YAAY,CAAC,CAAC,CAAC,mCAAI,EAAE,EAAE,EAAE,CAAC,CAAC;gBACxD,IAAI,CAAA,GAAA,gBAAQ,CAAA,CAAC,WAAW,CAAC,EAAE;oBAC1B,KAAK,GAAG;wBACP,eAAe,EAAE,KAAK,CAAC,eAAe;wBACtC,WAAW,EAAE,WAAW;wBACxB,aAAa,EAAE,KAAK,CAAC,aAAa;wBAClC,SAAS,EAAE,WAAW;qBACtB,CAAC;iBACF;aACD;YAED,yGAAyG;iBACpG,IAAI,YAAY,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE;gBAChC,KAAK,GAAG;oBACP,eAAe,EAAE,CAAC;oBAClB,WAAW,EAAE,CAAC;oBACd,aAAa,EAAE,CAAC;oBAChB,SAAS,EAAE,CAAC;iBACZ,CAAC;aACF;SACD;QAED,IAAI,YAAY,IAAI,KAAK,EAAE;YAC1B,OAAO;gBACN,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,YAAY,CAAC,KAAK,CAAC;gBAC5C,KAAK;aACL,CAAC;SACF;QAED,OAAO,SAAS,CAAC;IAClB,CAAC;IArDD,wDAqDC;IAED,IAAY,aAIX;IAJD,WAAY,aAAa;QACxB,iDAAI,CAAA;QACJ,2DAAS,CAAA;QACT,6DAAU,CAAA;IACX,CAAC,EAJW,aAAa,GAAb,qBAAa,KAAb,qBAAa,QAIxB;IAEY,QAAA,cAAc,GAAG,IAAI,0BAAa,CAAgB,aAAa,EAAE,aAAa,CAAC,IAAI,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { ISearchConfiguration, ISearchConfigurationProperties } from 'vs/workbench/services/search/common/search';\nimport { SymbolKind, Location, ProviderResult, SymbolTag } from 'vs/editor/common/modes';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { URI } from 'vs/base/common/uri';\nimport { EditorResourceAccessor, SideBySideEditor } from 'vs/workbench/common/editor';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { isNumber } from 'vs/base/common/types';\nimport { RawContextKey } from 'vs/platform/contextkey/common/contextkey';\n\nexport interface IWorkspaceSymbol {\n\tname: string;\n\tcontainerName?: string;\n\tkind: SymbolKind;\n\ttags?: SymbolTag[];\n\tlocation: Location;\n}\n\nexport interface IWorkspaceSymbolProvider {\n\tprovideWorkspaceSymbols(search: string, token: CancellationToken): ProviderResult<IWorkspaceSymbol[]>;\n\tresolveWorkspaceSymbol?(item: IWorkspaceSymbol, token: CancellationToken): ProviderResult<IWorkspaceSymbol>;\n}\n\nexport namespace WorkspaceSymbolProviderRegistry {\n\n\tconst _supports: IWorkspaceSymbolProvider[] = [];\n\n\texport function register(provider: IWorkspaceSymbolProvider): IDisposable {\n\t\tlet support: IWorkspaceSymbolProvider | undefined = provider;\n\t\tif (support) {\n\t\t\t_supports.push(support);\n\t\t}\n\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tif (support) {\n\t\t\t\t\tconst idx = _supports.indexOf(support);\n\t\t\t\t\tif (idx >= 0) {\n\t\t\t\t\t\t_supports.splice(idx, 1);\n\t\t\t\t\t\tsupport = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\texport function all(): IWorkspaceSymbolProvider[] {\n\t\treturn _supports.slice(0);\n\t}\n}\n\nexport function getWorkspaceSymbols(query: string, token: CancellationToken = CancellationToken.None): Promise<[IWorkspaceSymbolProvider, IWorkspaceSymbol[]][]> {\n\n\tconst result: [IWorkspaceSymbolProvider, IWorkspaceSymbol[]][] = [];\n\n\tconst promises = WorkspaceSymbolProviderRegistry.all().map(support => {\n\t\treturn Promise.resolve(support.provideWorkspaceSymbols(query, token)).then(value => {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tresult.push([support, value]);\n\t\t\t}\n\t\t}, onUnexpectedError);\n\t});\n\n\treturn Promise.all(promises).then(_ => result);\n}\n\nexport interface IWorkbenchSearchConfigurationProperties extends ISearchConfigurationProperties {\n\tquickOpen: {\n\t\tincludeSymbols: boolean;\n\t\tincludeHistory: boolean;\n\t\thistory: {\n\t\t\tfilterSortOrder: 'default' | 'recency'\n\t\t}\n\t};\n}\n\nexport interface IWorkbenchSearchConfiguration extends ISearchConfiguration {\n\tsearch: IWorkbenchSearchConfigurationProperties;\n}\n\n/**\n * Helper to return all opened editors with resources not belonging to the currently opened workspace.\n */\nexport function getOutOfWorkspaceEditorResources(accessor: ServicesAccessor): URI[] {\n\tconst editorService = accessor.get(IEditorService);\n\tconst contextService = accessor.get(IWorkspaceContextService);\n\tconst fileService = accessor.get(IFileService);\n\n\tconst resources = editorService.editors\n\t\t.map(editor => EditorResourceAccessor.getOriginalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY }))\n\t\t.filter(resource => !!resource && !contextService.isInsideWorkspace(resource) && fileService.canHandleResource(resource));\n\n\treturn resources as URI[];\n}\n\n// Supports patterns of <path><#|:|(><line><#|:|,><col?>\nconst LINE_COLON_PATTERN = /\\s?[#:\\(](?:line )?(\\d*)(?:[#:,](\\d*))?\\)?\\s*$/;\n\nexport interface IFilterAndRange {\n\tfilter: string;\n\trange: IRange;\n}\n\nexport function extractRangeFromFilter(filter: string, unless?: string[]): IFilterAndRange | undefined {\n\tif (!filter || unless?.some(value => filter.indexOf(value) !== -1)) {\n\t\treturn undefined;\n\t}\n\n\tlet range: IRange | undefined = undefined;\n\n\t// Find Line/Column number from search value using RegExp\n\tconst patternMatch = LINE_COLON_PATTERN.exec(filter);\n\n\tif (patternMatch) {\n\t\tconst startLineNumber = parseInt(patternMatch[1] ?? '', 10);\n\n\t\t// Line Number\n\t\tif (isNumber(startLineNumber)) {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: startLineNumber,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: startLineNumber,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\n\t\t\t// Column Number\n\t\t\tconst startColumn = parseInt(patternMatch[2] ?? '', 10);\n\t\t\tif (isNumber(startColumn)) {\n\t\t\t\trange = {\n\t\t\t\t\tstartLineNumber: range.startLineNumber,\n\t\t\t\t\tstartColumn: startColumn,\n\t\t\t\t\tendLineNumber: range.endLineNumber,\n\t\t\t\t\tendColumn: startColumn\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// User has typed \"something:\" or \"something#\" without a line number, in this case treat as start of file\n\t\telse if (patternMatch[1] === '') {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: 1,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: 1,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\t\t}\n\t}\n\n\tif (patternMatch && range) {\n\t\treturn {\n\t\t\tfilter: filter.substr(0, patternMatch.index), // clear range suffix from search value\n\t\t\trange\n\t\t};\n\t}\n\n\treturn undefined;\n}\n\nexport enum SearchUIState {\n\tIdle,\n\tSearching,\n\tSlowSearch\n}\n\nexport const SearchStateKey = new RawContextKey<SearchUIState>('searchState', SearchUIState.Idle);\n"]}