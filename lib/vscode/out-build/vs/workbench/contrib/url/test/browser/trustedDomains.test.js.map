{"version":3,"file":"trustedDomains.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/url/test/browser/trustedDomains.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\n\nimport { isURLDomainTrusted } from 'vs/workbench/contrib/url/browser/trustedDomainsValidator';\nimport { URI } from 'vs/base/common/uri';\nimport { extractGitHubRemotesFromGitConfig } from 'vs/workbench/contrib/url/browser/trustedDomains';\n\nfunction linkAllowedByRules(link: string, rules: string[]) {\n\tassert.ok(isURLDomainTrusted(URI.parse(link), rules), `Link\\n${link}\\n should be allowed by rules\\n${JSON.stringify(rules)}`);\n}\nfunction linkNotAllowedByRules(link: string, rules: string[]) {\n\tassert.ok(!isURLDomainTrusted(URI.parse(link), rules), `Link\\n${link}\\n should NOT be allowed by rules\\n${JSON.stringify(rules)}`);\n}\n\nsuite('GitHub remote extraction', () => {\n\ttest('All known formats', () => {\n\t\tassert.deepStrictEqual(\n\t\t\textractGitHubRemotesFromGitConfig(\n\t\t\t\t`\n[remote \"1\"]\n\t\t\turl = git@github.com:sshgit/vscode.git\n[remote \"2\"]\n\t\t\turl = git@github.com:ssh/vscode\n[remote \"3\"]\n\t\t\turl = https://github.com/httpsgit/vscode.git\n[remote \"4\"]\n\t\t\turl = https://github.com/https/vscode`),\n\t\t\t[\n\t\t\t\t'https://github.com/sshgit/vscode/',\n\t\t\t\t'https://github.com/ssh/vscode/',\n\t\t\t\t'https://github.com/httpsgit/vscode/',\n\t\t\t\t'https://github.com/https/vscode/'\n\t\t\t]);\n\t});\n});\n\nsuite('Link protection domain matching', () => {\n\ttest('simple', () => {\n\t\tlinkNotAllowedByRules('https://x.org', []);\n\n\t\tlinkAllowedByRules('https://x.org', ['https://x.org']);\n\t\tlinkAllowedByRules('https://x.org/foo', ['https://x.org']);\n\n\t\tlinkNotAllowedByRules('https://x.org', ['http://x.org']);\n\t\tlinkNotAllowedByRules('http://x.org', ['https://x.org']);\n\n\t\tlinkNotAllowedByRules('https://www.x.org', ['https://x.org']);\n\n\t\tlinkAllowedByRules('https://www.x.org', ['https://www.x.org', 'https://y.org']);\n\t});\n\n\ttest('localhost', () => {\n\t\tlinkAllowedByRules('https://127.0.0.1', []);\n\t\tlinkAllowedByRules('https://127.0.0.1:3000', []);\n\t\tlinkAllowedByRules('https://localhost', []);\n\t\tlinkAllowedByRules('https://localhost:3000', []);\n\t});\n\n\ttest('* star', () => {\n\t\tlinkAllowedByRules('https://a.x.org', ['https://*.x.org']);\n\t\tlinkAllowedByRules('https://a.b.x.org', ['https://*.x.org']);\n\t});\n\n\ttest('no scheme', () => {\n\t\tlinkAllowedByRules('https://a.x.org', ['a.x.org']);\n\t\tlinkAllowedByRules('https://a.x.org', ['*.x.org']);\n\t\tlinkAllowedByRules('https://a.b.x.org', ['*.x.org']);\n\t\tlinkAllowedByRules('https://x.org', ['*.x.org']);\n\t});\n\n\ttest('sub paths', () => {\n\t\tlinkAllowedByRules('https://x.org/foo', ['https://x.org/foo']);\n\t\tlinkAllowedByRules('https://x.org/foo/bar', ['https://x.org/foo']);\n\n\t\tlinkAllowedByRules('https://x.org/foo', ['https://x.org/foo/']);\n\t\tlinkAllowedByRules('https://x.org/foo/bar', ['https://x.org/foo/']);\n\n\t\tlinkAllowedByRules('https://x.org/foo', ['x.org/foo']);\n\t\tlinkAllowedByRules('https://x.org/foo', ['*.org/foo']);\n\n\t\tlinkNotAllowedByRules('https://x.org/bar', ['https://x.org/foo']);\n\t\tlinkNotAllowedByRules('https://x.org/bar', ['x.org/foo']);\n\t\tlinkNotAllowedByRules('https://x.org/bar', ['*.org/foo']);\n\n\t\tlinkAllowedByRules('https://x.org/foo/bar', ['https://x.org/foo']);\n\t\tlinkNotAllowedByRules('https://x.org/foo2', ['https://x.org/foo']);\n\n\t\tlinkNotAllowedByRules('https://www.x.org/foo', ['https://x.org/foo']);\n\n\t\tlinkNotAllowedByRules('https://a.x.org/bar', ['https://*.x.org/foo']);\n\t\tlinkNotAllowedByRules('https://a.b.x.org/bar', ['https://*.x.org/foo']);\n\n\t\tlinkAllowedByRules('https://github.com', ['https://github.com/foo/bar', 'https://github.com']);\n\t});\n\n\ttest('ports', () => {\n\t\tlinkNotAllowedByRules('https://x.org:8080/foo/bar', ['https://x.org:8081/foo']);\n\t\tlinkAllowedByRules('https://x.org:8080/foo/bar', ['https://x.org:*/foo']);\n\t\tlinkAllowedByRules('https://x.org/foo/bar', ['https://x.org:*/foo']);\n\t\tlinkAllowedByRules('https://x.org:8080/foo/bar', ['https://x.org:8080/foo']);\n\t});\n\n\ttest('ip addresses', () => {\n\t\tlinkAllowedByRules('http://192.168.1.7/', ['http://192.168.1.7/']);\n\t\tlinkAllowedByRules('http://192.168.1.7/', ['http://192.168.1.7']);\n\t\tlinkAllowedByRules('http://192.168.1.7/', ['http://192.168.1.*']);\n\n\t\tlinkNotAllowedByRules('http://192.168.1.7:3000/', ['http://192.168.*.6:*']);\n\t\tlinkAllowedByRules('http://192.168.1.7:3000/', ['http://192.168.1.7:3000/']);\n\t\tlinkAllowedByRules('http://192.168.1.7:3000/', ['http://192.168.1.7:*']);\n\t\tlinkAllowedByRules('http://192.168.1.7:3000/', ['http://192.168.1.*:*']);\n\t\tlinkNotAllowedByRules('http://192.168.1.7:3000/', ['http://192.168.*.6:*']);\n\t});\n\n\ttest('scheme match', () => {\n\t\tlinkAllowedByRules('http://192.168.1.7/', ['http://*']);\n\t\tlinkAllowedByRules('http://twitter.com', ['http://*']);\n\t\tlinkAllowedByRules('http://twitter.com/hello', ['http://*']);\n\t\tlinkNotAllowedByRules('https://192.168.1.7/', ['http://*']);\n\t\tlinkNotAllowedByRules('https://twitter.com/', ['http://*']);\n\t});\n\n\ttest('case normalization', () => {\n\t\t// https://github.com/microsoft/vscode/issues/99294\n\t\tlinkAllowedByRules('https://github.com/microsoft/vscode/issues/new', ['https://github.com/microsoft']);\n\t\tlinkAllowedByRules('https://github.com/microsoft/vscode/issues/new', ['https://github.com/microsoft']);\n\t});\n});\n"]}