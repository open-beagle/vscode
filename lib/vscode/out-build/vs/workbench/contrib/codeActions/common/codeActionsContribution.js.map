{"version":3,"sources":["vs/workbench/contrib/codeActions/common/codeActionsContribution.ts"],"names":[],"mappings":"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","file":"codeActionsContribution.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { flatten } from 'vs/base/common/arrays';\nimport { Emitter } from 'vs/base/common/event';\nimport { IJSONSchema, IJSONSchemaMap } from 'vs/base/common/jsonSchema';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { codeActionCommandId, refactorCommandId, sourceActionCommandId } from 'vs/editor/contrib/codeAction/codeAction';\nimport { CodeActionKind } from 'vs/editor/contrib/codeAction/types';\nimport * as nls from 'vs/nls';\nimport { Extensions, IConfigurationNode, IConfigurationRegistry, ConfigurationScope, IConfigurationPropertySchema } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IWorkbenchContribution } from 'vs/workbench/common/contributions';\nimport { CodeActionsExtensionPoint, ContributedCodeAction } from 'vs/workbench/contrib/codeActions/common/codeActionsExtensionPoint';\nimport { IExtensionPoint } from 'vs/workbench/services/extensions/common/extensionsRegistry';\nimport { editorConfigurationBaseNode } from 'vs/editor/common/config/commonEditorConfig';\n\nconst codeActionsOnSaveDefaultProperties = Object.freeze<IJSONSchemaMap>({\n\t'source.fixAll': {\n\t\ttype: 'boolean',\n\t\tdescription: nls.localize('codeActionsOnSave.fixAll', \"Controls whether auto fix action should be run on file save.\")\n\t}\n});\n\nconst codeActionsOnSaveSchema: IConfigurationPropertySchema = {\n\toneOf: [\n\t\t{\n\t\t\ttype: 'object',\n\t\t\tproperties: codeActionsOnSaveDefaultProperties,\n\t\t\tadditionalProperties: {\n\t\t\t\ttype: 'boolean'\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'array',\n\t\t\titems: { type: 'string' }\n\t\t}\n\t],\n\tdefault: {},\n\tdescription: nls.localize('codeActionsOnSave', \"Code action kinds to be run on save.\"),\n\tscope: ConfigurationScope.LANGUAGE_OVERRIDABLE,\n};\n\nexport const editorConfiguration = Object.freeze<IConfigurationNode>({\n\t...editorConfigurationBaseNode,\n\tproperties: {\n\t\t'editor.codeActionsOnSave': codeActionsOnSaveSchema\n\t}\n});\n\nexport class CodeActionsContribution extends Disposable implements IWorkbenchContribution {\n\n\tprivate _contributedCodeActions: CodeActionsExtensionPoint[] = [];\n\n\tprivate readonly _onDidChangeContributions = this._register(new Emitter<void>());\n\n\tconstructor(\n\t\tcodeActionsExtensionPoint: IExtensionPoint<CodeActionsExtensionPoint[]>,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t) {\n\t\tsuper();\n\n\t\tcodeActionsExtensionPoint.setHandler(extensionPoints => {\n\t\t\tthis._contributedCodeActions = flatten(extensionPoints.map(x => x.value));\n\t\t\tthis.updateConfigurationSchema(this._contributedCodeActions);\n\t\t\tthis._onDidChangeContributions.fire();\n\t\t});\n\n\t\tkeybindingService.registerSchemaContribution({\n\t\t\tgetSchemaAdditions: () => this.getSchemaAdditions(),\n\t\t\tonDidChange: this._onDidChangeContributions.event,\n\t\t});\n\t}\n\n\tprivate updateConfigurationSchema(codeActionContributions: readonly CodeActionsExtensionPoint[]) {\n\t\tconst newProperties: IJSONSchemaMap = { ...codeActionsOnSaveDefaultProperties };\n\t\tfor (const [sourceAction, props] of this.getSourceActions(codeActionContributions)) {\n\t\t\tnewProperties[sourceAction] = {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdescription: nls.localize('codeActionsOnSave.generic', \"Controls whether '{0}' actions should be run on file save.\", props.title)\n\t\t\t};\n\t\t}\n\t\tcodeActionsOnSaveSchema.properties = newProperties;\n\t\tRegistry.as<IConfigurationRegistry>(Extensions.Configuration)\n\t\t\t.notifyConfigurationSchemaUpdated(editorConfiguration);\n\t}\n\n\tprivate getSourceActions(contributions: readonly CodeActionsExtensionPoint[]) {\n\t\tconst defaultKinds = Object.keys(codeActionsOnSaveDefaultProperties).map(value => new CodeActionKind(value));\n\t\tconst sourceActions = new Map<string, { readonly title: string }>();\n\t\tfor (const contribution of contributions) {\n\t\t\tfor (const action of contribution.actions) {\n\t\t\t\tconst kind = new CodeActionKind(action.kind);\n\t\t\t\tif (CodeActionKind.Source.contains(kind)\n\t\t\t\t\t// Exclude any we already included by default\n\t\t\t\t\t&& !defaultKinds.some(defaultKind => defaultKind.contains(kind))\n\t\t\t\t) {\n\t\t\t\t\tsourceActions.set(kind.value, action);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn sourceActions;\n\t}\n\n\tprivate getSchemaAdditions(): IJSONSchema[] {\n\t\tconst conditionalSchema = (command: string, actions: readonly ContributedCodeAction[]): IJSONSchema => {\n\t\t\treturn {\n\t\t\t\tif: {\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\t'command': { const: command }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tthen: {\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\t'args': {\n\t\t\t\t\t\t\trequired: ['kind'],\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t'kind': {\n\t\t\t\t\t\t\t\t\tanyOf: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tenum: actions.map(action => action.kind),\n\t\t\t\t\t\t\t\t\t\t\tenumDescriptions: actions.map(action => action.description ?? action.title),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{ type: 'string' },\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\tconst getActions = (ofKind: CodeActionKind): ContributedCodeAction[] => {\n\t\t\tconst allActions = flatten(this._contributedCodeActions.map(desc => desc.actions.slice()));\n\n\t\t\tconst out = new Map<string, ContributedCodeAction>();\n\t\t\tfor (const action of allActions) {\n\t\t\t\tif (!out.has(action.kind) && ofKind.contains(new CodeActionKind(action.kind))) {\n\t\t\t\t\tout.set(action.kind, action);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Array.from(out.values());\n\t\t};\n\n\t\treturn [\n\t\t\tconditionalSchema(codeActionCommandId, getActions(CodeActionKind.Empty)),\n\t\t\tconditionalSchema(refactorCommandId, getActions(CodeActionKind.Refactor)),\n\t\t\tconditionalSchema(sourceActionCommandId, getActions(CodeActionKind.Source)),\n\t\t];\n\t}\n}\n"]}