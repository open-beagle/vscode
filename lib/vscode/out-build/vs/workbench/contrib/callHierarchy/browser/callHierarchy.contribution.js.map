{"version":3,"sources":["vs/workbench/contrib/callHierarchy/browser/callHierarchy.contribution.ts"],"names":[],"mappings":"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","file":"callHierarchy.contribution.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { CallHierarchyProviderRegistry, CallHierarchyDirection, CallHierarchyModel } from 'vs/workbench/contrib/callHierarchy/common/callHierarchy';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { CallHierarchyTreePeekWidget } from 'vs/workbench/contrib/callHierarchy/browser/callHierarchyPeek';\nimport { Event } from 'vs/base/common/event';\nimport { registerEditorContribution, EditorAction2 } from 'vs/editor/browser/editorExtensions';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IContextKeyService, RawContextKey, IContextKey, ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { PeekContext } from 'vs/editor/contrib/peekView/peekView';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { registerIcon } from 'vs/platform/theme/common/iconRegistry';\n\nconst _ctxHasCallHierarchyProvider = new RawContextKey<boolean>('editorHasCallHierarchyProvider', false, localize('editorHasCallHierarchyProvider', 'Whether a call hierarchy provider is available'));\nconst _ctxCallHierarchyVisible = new RawContextKey<boolean>('callHierarchyVisible', false, localize('callHierarchyVisible', 'Whether call hierarchy peek is currently showing'));\nconst _ctxCallHierarchyDirection = new RawContextKey<string>('callHierarchyDirection', undefined, { type: 'string', description: localize('callHierarchyDirection', 'Whether call hierarchy shows incoming or outgoing calls') });\n\nfunction sanitizedDirection(candidate: string): CallHierarchyDirection {\n\treturn candidate === CallHierarchyDirection.CallsFrom || candidate === CallHierarchyDirection.CallsTo\n\t\t? candidate\n\t\t: CallHierarchyDirection.CallsTo;\n}\n\nclass CallHierarchyController implements IEditorContribution {\n\n\tstatic readonly Id = 'callHierarchy';\n\n\tstatic get(editor: ICodeEditor): CallHierarchyController {\n\t\treturn editor.getContribution<CallHierarchyController>(CallHierarchyController.Id);\n\t}\n\n\tprivate static readonly _StorageDirection = 'callHierarchy/defaultDirection';\n\n\tprivate readonly _ctxHasProvider: IContextKey<boolean>;\n\tprivate readonly _ctxIsVisible: IContextKey<boolean>;\n\tprivate readonly _ctxDirection: IContextKey<string>;\n\tprivate readonly _dispoables = new DisposableStore();\n\tprivate readonly _sessionDisposables = new DisposableStore();\n\n\tprivate _widget?: CallHierarchyTreePeekWidget;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@ICodeEditorService private readonly _editorService: ICodeEditorService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tthis._ctxIsVisible = _ctxCallHierarchyVisible.bindTo(this._contextKeyService);\n\t\tthis._ctxHasProvider = _ctxHasCallHierarchyProvider.bindTo(this._contextKeyService);\n\t\tthis._ctxDirection = _ctxCallHierarchyDirection.bindTo(this._contextKeyService);\n\t\tthis._dispoables.add(Event.any<any>(_editor.onDidChangeModel, _editor.onDidChangeModelLanguage, CallHierarchyProviderRegistry.onDidChange)(() => {\n\t\t\tthis._ctxHasProvider.set(_editor.hasModel() && CallHierarchyProviderRegistry.has(_editor.getModel()));\n\t\t}));\n\t\tthis._dispoables.add(this._sessionDisposables);\n\t}\n\n\tdispose(): void {\n\t\tthis._ctxHasProvider.reset();\n\t\tthis._ctxIsVisible.reset();\n\t\tthis._dispoables.dispose();\n\t}\n\n\tasync startCallHierarchyFromEditor(): Promise<void> {\n\t\tthis._sessionDisposables.clear();\n\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst document = this._editor.getModel();\n\t\tconst position = this._editor.getPosition();\n\t\tif (!CallHierarchyProviderRegistry.has(document)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tconst model = CallHierarchyModel.create(document, position, cts.token);\n\t\tconst direction = sanitizedDirection(this._storageService.get(CallHierarchyController._StorageDirection, StorageScope.GLOBAL, CallHierarchyDirection.CallsTo));\n\n\t\tthis._showCallHierarchyWidget(position, direction, model, cts);\n\t}\n\n\tasync startCallHierarchyFromCallHierarchy(): Promise<void> {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._widget.getModel();\n\t\tconst call = this._widget.getFocused();\n\t\tif (!call || !model) {\n\t\t\treturn;\n\t\t}\n\t\tconst newEditor = await this._editorService.openCodeEditor({ resource: call.item.uri }, this._editor);\n\t\tif (!newEditor) {\n\t\t\treturn;\n\t\t}\n\t\tconst newModel = model.fork(call.item);\n\t\tthis._sessionDisposables.clear();\n\n\t\tCallHierarchyController.get(newEditor)._showCallHierarchyWidget(\n\t\t\tRange.lift(newModel.root.selectionRange).getStartPosition(),\n\t\t\tthis._widget.direction,\n\t\t\tPromise.resolve(newModel),\n\t\t\tnew CancellationTokenSource()\n\t\t);\n\t}\n\n\tprivate _showCallHierarchyWidget(position: IPosition, direction: CallHierarchyDirection, model: Promise<CallHierarchyModel | undefined>, cts: CancellationTokenSource) {\n\n\t\tthis._ctxIsVisible.set(true);\n\t\tthis._ctxDirection.set(direction);\n\t\tEvent.any<any>(this._editor.onDidChangeModel, this._editor.onDidChangeModelLanguage)(this.endCallHierarchy, this, this._sessionDisposables);\n\t\tthis._widget = this._instantiationService.createInstance(CallHierarchyTreePeekWidget, this._editor, position, direction);\n\t\tthis._widget.showLoading();\n\t\tthis._sessionDisposables.add(this._widget.onDidClose(() => {\n\t\t\tthis.endCallHierarchy();\n\t\t\tthis._storageService.store(CallHierarchyController._StorageDirection, this._widget!.direction, StorageScope.GLOBAL, StorageTarget.USER);\n\t\t}));\n\t\tthis._sessionDisposables.add({ dispose() { cts.dispose(true); } });\n\t\tthis._sessionDisposables.add(this._widget);\n\n\t\tmodel.then(model => {\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn; // nothing\n\t\t\t}\n\t\t\tif (model) {\n\t\t\t\tthis._sessionDisposables.add(model);\n\t\t\t\tthis._widget!.showModel(model);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._widget!.showMessage(localize('no.item', \"No results\"));\n\t\t\t}\n\t\t}).catch(e => {\n\t\t\tthis._widget!.showMessage(localize('error', \"Failed to show call hierarchy\"));\n\t\t\tconsole.error(e);\n\t\t});\n\t}\n\n\tshowOutgoingCalls(): void {\n\t\tthis._widget?.updateDirection(CallHierarchyDirection.CallsFrom);\n\t\tthis._ctxDirection.set(CallHierarchyDirection.CallsFrom);\n\t}\n\n\tshowIncomingCalls(): void {\n\t\tthis._widget?.updateDirection(CallHierarchyDirection.CallsTo);\n\t\tthis._ctxDirection.set(CallHierarchyDirection.CallsTo);\n\t}\n\n\tendCallHierarchy(): void {\n\t\tthis._sessionDisposables.clear();\n\t\tthis._ctxIsVisible.set(false);\n\t\tthis._editor.focus();\n\t}\n}\n\nregisterEditorContribution(CallHierarchyController.Id, CallHierarchyController);\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showCallHierarchy',\n\t\t\ttitle: { value: localize('title', \"Peek Call Hierarchy\"), original: 'Peek Call Hierarchy' },\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.EditorContextPeek,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 1000,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t_ctxHasCallHierarchyProvider,\n\t\t\t\t\tPeekContext.notInPeekEditor\n\t\t\t\t),\n\t\t\t},\n\t\t\tkeybinding: {\n\t\t\t\twhen: EditorContextKeys.editorTextFocus,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KEY_H\n\t\t\t},\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t_ctxHasCallHierarchyProvider,\n\t\t\t\tPeekContext.notInPeekEditor\n\t\t\t)\n\t\t});\n\t}\n\n\tasync runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\treturn CallHierarchyController.get(editor).startCallHierarchyFromEditor();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showIncomingCalls',\n\t\t\ttitle: { value: localize('title.incoming', \"Show Incoming Calls\"), original: 'Show Incoming Calls' },\n\t\t\ticon: registerIcon('callhierarchy-incoming', Codicon.callIncoming, localize('showIncomingCallsIcons', 'Icon for incoming calls in the call hierarchy view.')),\n\t\t\tprecondition: ContextKeyExpr.and(_ctxCallHierarchyVisible, _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsFrom)),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KEY_H,\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: CallHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\twhen: _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsFrom),\n\t\t\t\torder: 1,\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\treturn CallHierarchyController.get(editor).showIncomingCalls();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showOutgoingCalls',\n\t\t\ttitle: { value: localize('title.outgoing', \"Show Outgoing Calls\"), original: 'Show Outgoing Calls' },\n\t\t\ticon: registerIcon('callhierarchy-outgoing', Codicon.callOutgoing, localize('showOutgoingCallsIcon', 'Icon for outgoing calls in the call hierarchy view.')),\n\t\t\tprecondition: ContextKeyExpr.and(_ctxCallHierarchyVisible, _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsTo)),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KEY_H,\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: CallHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\twhen: _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsTo),\n\t\t\t\torder: 1\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\treturn CallHierarchyController.get(editor).showOutgoingCalls();\n\t}\n});\n\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.refocusCallHierarchy',\n\t\t\ttitle: { value: localize('title.refocus', \"Refocus Call Hierarchy\"), original: 'Refocus Call Hierarchy' },\n\t\t\tprecondition: _ctxCallHierarchyVisible,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyCode.Enter\n\t\t\t}\n\t\t});\n\t}\n\n\tasync runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\treturn CallHierarchyController.get(editor).startCallHierarchyFromCallHierarchy();\n\t}\n});\n\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.closeCallHierarchy',\n\t\t\ttitle: localize('close', 'Close'),\n\t\t\ticon: Codicon.close,\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t_ctxCallHierarchyVisible,\n\t\t\t\tContextKeyExpr.not('config.editor.stablePeek')\n\t\t\t),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 10,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: CallHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\torder: 1000\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\treturn CallHierarchyController.get(editor).endCallHierarchy();\n\t}\n});\n"]}