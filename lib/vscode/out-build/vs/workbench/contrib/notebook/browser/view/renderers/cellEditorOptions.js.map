{"version":3,"sources":["vs/workbench/contrib/notebook/browser/view/renderers/cellEditorOptions.ts"],"names":[],"mappings":"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","file":"cellEditorOptions.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { deepClone } from 'vs/base/common/objects';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IConfigurationRegistry, Extensions as ConfigurationExtensions } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IEditorOptions, LineNumbersType } from 'vs/editor/common/config/editorOptions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { EDITOR_BOTTOM_PADDING, EDITOR_BOTTOM_PADDING_WITHOUT_STATUSBAR } from 'vs/workbench/contrib/notebook/browser/constants';\nimport { EditorTopPaddingChangeEvent, getEditorTopPadding, getNotebookEditorFromEditorPane, ICellViewModel, NOTEBOOK_CELL_LINE_NUMBERS, NOTEBOOK_EDITOR_FOCUSED, NOTEBOOK_IS_ACTIVE_EDITOR } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { ShowCellStatusBarKey } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { localize } from 'vs/nls';\nimport { Action2, MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { NOTEBOOK_ACTIONS_CATEGORY } from 'vs/workbench/contrib/notebook/browser/contrib/coreActions';\n\nexport class CellEditorOptions {\n\n\tprivate static fixedEditorOptions: IEditorOptions = {\n\t\tscrollBeyondLastLine: false,\n\t\tscrollbar: {\n\t\t\tverticalScrollbarSize: 14,\n\t\t\thorizontal: 'auto',\n\t\t\tuseShadows: true,\n\t\t\tverticalHasArrows: false,\n\t\t\thorizontalHasArrows: false,\n\t\t\talwaysConsumeMouseWheel: false\n\t\t},\n\t\trenderLineHighlightOnlyWhenFocus: true,\n\t\toverviewRulerLanes: 0,\n\t\tselectOnLineNumbers: false,\n\t\tlineNumbers: 'off',\n\t\tlineDecorationsWidth: 0,\n\t\tglyphMargin: false,\n\t\tfixedOverflowWidgets: true,\n\t\tminimap: { enabled: false },\n\t\trenderValidationDecorations: 'on'\n\t};\n\n\tprivate _value: IEditorOptions;\n\tprivate _lineNumbers: 'on' | 'off' | 'inherit' = 'inherit';\n\tprivate disposable: IDisposable;\n\n\tprivate readonly _onDidChange = new Emitter<IEditorOptions>();\n\treadonly onDidChange: Event<IEditorOptions> = this._onDidChange.event;\n\n\tconstructor(readonly configurationService: IConfigurationService, language: string) {\n\n\t\tthis.disposable = configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('editor') || e.affectsConfiguration('notebook') || e.affectsConfiguration(ShowCellStatusBarKey)) {\n\t\t\t\tthis._value = computeEditorOptions();\n\t\t\t\tthis._onDidChange.fire(this.value);\n\t\t\t}\n\t\t});\n\n\t\tEditorTopPaddingChangeEvent(() => {\n\t\t\tthis._value = computeEditorOptions();\n\t\t\tthis._onDidChange.fire(this.value);\n\n\t\t});\n\n\t\tconst computeEditorOptions = () => {\n\t\t\tconst showCellStatusBar = configurationService.getValue<boolean>(ShowCellStatusBarKey);\n\t\t\tconst editorPadding = {\n\t\t\t\ttop: getEditorTopPadding(),\n\t\t\t\tbottom: showCellStatusBar ? EDITOR_BOTTOM_PADDING : EDITOR_BOTTOM_PADDING_WITHOUT_STATUSBAR\n\t\t\t};\n\n\t\t\tconst renderLiNumbers = configurationService.getValue<'on' | 'off'>('notebook.lineNumbers') === 'on';\n\t\t\tconst lineNumbers: LineNumbersType = renderLiNumbers ? 'on' : 'off';\n\t\t\tconst editorOptions = deepClone(configurationService.getValue<IEditorOptions>('editor', { overrideIdentifier: language }));\n\t\t\tconst computed = {\n\t\t\t\t...editorOptions,\n\t\t\t\t...CellEditorOptions.fixedEditorOptions,\n\t\t\t\t...{ padding: editorPadding, lineNumbers },\n\t\t\t};\n\n\t\t\tif (!computed.folding) {\n\t\t\t\tcomputed.lineDecorationsWidth = 16;\n\t\t\t}\n\n\t\t\treturn computed;\n\t\t};\n\n\t\tthis._value = computeEditorOptions();\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t\tthis.disposable.dispose();\n\t}\n\n\tget value(): IEditorOptions {\n\t\treturn this._value;\n\t}\n\n\tsetGlyphMargin(gm: boolean): void {\n\t\tif (gm !== this._value.glyphMargin) {\n\t\t\tthis._value.glyphMargin = gm;\n\t\t\tthis._onDidChange.fire(this.value);\n\t\t}\n\t}\n\n\tsetLineNumbers(lineNumbers: 'on' | 'off' | 'inherit'): void {\n\t\tthis._lineNumbers = lineNumbers;\n\t\tif (this._lineNumbers === 'inherit') {\n\t\t\tconst renderLiNumbers = this.configurationService.getValue<'on' | 'off'>('notebook.lineNumbers') === 'on';\n\t\t\tconst lineNumbers: LineNumbersType = renderLiNumbers ? 'on' : 'off';\n\t\t\tthis._value.lineNumbers = lineNumbers;\n\t\t} else {\n\t\t\tthis._value.lineNumbers = lineNumbers as LineNumbersType;\n\t\t}\n\t\tthis._onDidChange.fire(this.value);\n\t}\n}\n\nRegistry.as<IConfigurationRegistry>(ConfigurationExtensions.Configuration).registerConfiguration({\n\tid: 'notebook',\n\torder: 100,\n\ttype: 'object',\n\t'properties': {\n\t\t'notebook.lineNumbers': {\n\t\t\ttype: 'string',\n\t\t\tenum: ['off', 'on'],\n\t\t\tdefault: 'off',\n\t\t\tmarkdownDescription: localize('notebook.lineNumbers', \"Controls the display of line numbers in the cell editor.\")\n\t\t}\n\t}\n});\n\nregisterAction2(class ToggleLineNumberAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.toggleLineNumbers',\n\t\t\ttitle: { value: localize('notebook.toggleLineNumbers', \"Toggle Notebook Line Numbers\"), original: 'Toggle Notebook Line Numbers' },\n\t\t\tprecondition: NOTEBOOK_EDITOR_FOCUSED,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.EditorTitle,\n\t\t\t\tgroup: 'LineNumber',\n\t\t\t\torder: 0,\n\t\t\t\twhen: NOTEBOOK_IS_ACTIVE_EDITOR\n\t\t\t}],\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tf1: true,\n\t\t\ttoggled: {\n\t\t\t\tcondition: ContextKeyExpr.notEquals('config.notebook.lineNumbers', 'off'),\n\t\t\t\ttitle: { value: localize('notebook.showLineNumbers', \"Show Notebook Line Numbers\"), original: 'Show Notebook Line Numbers' },\n\t\t\t}\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\tconst renderLiNumbers = configurationService.getValue<'on' | 'off'>('notebook.lineNumbers') === 'on';\n\n\t\tif (renderLiNumbers) {\n\t\t\tconfigurationService.updateValue('notebook.lineNumbers', 'off');\n\t\t} else {\n\t\t\tconfigurationService.updateValue('notebook.lineNumbers', 'on');\n\t\t}\n\t}\n});\n\nregisterAction2(class ToggleActiveLineNumberAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.cell.toggleLineNumbers',\n\t\t\ttitle: 'Show Cell Line Numbers',\n\t\t\tprecondition: NOTEBOOK_EDITOR_FOCUSED,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.NotebookCellTitle,\n\t\t\t\tgroup: 'View',\n\t\t\t\torder: 1\n\t\t\t}],\n\t\t\ttoggled: ContextKeyExpr.or(\n\t\t\t\tNOTEBOOK_CELL_LINE_NUMBERS.isEqualTo('on'),\n\t\t\t\tContextKeyExpr.and(NOTEBOOK_CELL_LINE_NUMBERS.isEqualTo('inherit'), ContextKeyExpr.equals('config.notebook.lineNumbers', 'on'))\n\t\t\t)\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, context?: { cell: ICellViewModel; }): Promise<void> {\n\t\tlet cell = context?.cell;\n\t\tif (!cell) {\n\t\t\tconst editor = getNotebookEditorFromEditorPane(accessor.get(IEditorService).activeEditorPane);\n\t\t\tif (!editor || !editor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcell = editor.getActiveCell();\n\t\t}\n\n\t\tif (cell) {\n\t\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\t\tconst renderLineNumbers = configurationService.getValue<'on' | 'off'>('notebook.lineNumbers') === 'on';\n\t\t\tconst cellLineNumbers = cell.lineNumbers;\n\t\t\t// 'on', 'inherit' \t-> 'on'\n\t\t\t// 'on', 'off'\t\t-> 'off'\n\t\t\t// 'on', 'on'\t\t-> 'on'\n\t\t\t// 'off', 'inherit'\t-> 'off'\n\t\t\t// 'off', 'off'\t\t-> 'off'\n\t\t\t// 'off', 'on'\t\t-> 'on'\n\t\t\tconst currentLineNumberIsOn = cellLineNumbers === 'on' || (cellLineNumbers === 'inherit' && renderLineNumbers);\n\n\t\t\tif (currentLineNumberIsOn) {\n\t\t\t\tcell.lineNumbers = 'off';\n\t\t\t} else {\n\t\t\t\tcell.lineNumbers = 'on';\n\t\t\t}\n\t\t}\n\t}\n});\n"]}