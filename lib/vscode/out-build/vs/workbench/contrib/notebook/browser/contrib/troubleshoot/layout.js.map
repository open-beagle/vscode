{"version":3,"file":"layout.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/browser/contrib/troubleshoot/layout.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore, dispose, IDisposable } from 'vs/base/common/lifecycle';\nimport { Action2, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { CATEGORIES } from 'vs/workbench/common/actions';\nimport { getNotebookEditorFromEditorPane, ICellViewModel, INotebookEditor, INotebookEditorContribution } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { registerNotebookContribution } from 'vs/workbench/contrib/notebook/browser/notebookEditorExtensions';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\n\nexport class TroubleshootController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.troubleshoot';\n\n\tprivate readonly _localStore = this._register(new DisposableStore());\n\tprivate _cellStateListeners: IDisposable[] = [];\n\tprivate _logging: boolean = false;\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(() => {\n\t\t\tthis._localStore.clear();\n\t\t\tthis._cellStateListeners.forEach(listener => listener.dispose());\n\n\t\t\tif (!this._notebookEditor.viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._updateListener();\n\t\t}));\n\n\t\tthis._updateListener();\n\t}\n\n\ttoggleLogging(): void {\n\t\tthis._logging = !this._logging;\n\t}\n\n\tprivate _log(cell: ICellViewModel, e: any) {\n\t\tif (this._logging) {\n\t\t\tconst oldHeight = this._notebookEditor.getViewHeight(cell);\n\t\t\tconsole.log(`cell#${cell.handle}`, e, `${oldHeight} -> ${cell.layoutInfo.totalHeight}`);\n\t\t}\n\t}\n\n\tprivate _updateListener() {\n\t\tif (!this._notebookEditor.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewModel = this._notebookEditor.viewModel;\n\n\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\tconst cell = viewModel.viewCells[i];\n\n\t\t\tthis._cellStateListeners.push(cell.onDidChangeLayout(e => {\n\t\t\t\tthis._log(cell, e);\n\t\t\t}));\n\t\t}\n\n\t\tthis._localStore.add(viewModel.onDidChangeViewCells(e => {\n\t\t\te.splices.reverse().forEach(splice => {\n\t\t\t\tconst [start, deleted, newCells] = splice;\n\t\t\t\tconst deletedCells = this._cellStateListeners.splice(start, deleted, ...newCells.map(cell => {\n\t\t\t\t\treturn cell.onDidChangeLayout(e => {\n\t\t\t\t\t\tthis._log(cell, e);\n\t\t\t\t\t});\n\t\t\t\t}));\n\n\t\t\t\tdispose(deletedCells);\n\t\t\t});\n\t\t}));\n\t}\n\n\toverride dispose() {\n\t\tdispose(this._cellStateListeners);\n\t\tsuper.dispose();\n\t}\n}\n\nregisterNotebookContribution(TroubleshootController.id, TroubleshootController);\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.toggleLayoutTroubleshoot',\n\t\t\ttitle: 'Toggle Notebook Layout Troubleshoot',\n\t\t\tcategory: CATEGORIES.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst controller = editor.getContribution<TroubleshootController>(TroubleshootController.id);\n\t\tcontroller?.toggleLogging();\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.inspectLayout',\n\t\t\ttitle: 'Inspect Notebook Layout',\n\t\t\tcategory: CATEGORIES.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor || !editor.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\teditor.viewModel.viewCells.forEach(cell => {\n\t\t\tconsole.log(`cell#${cell.handle}`, cell.layoutInfo);\n\t\t});\n\t}\n});\n"]}