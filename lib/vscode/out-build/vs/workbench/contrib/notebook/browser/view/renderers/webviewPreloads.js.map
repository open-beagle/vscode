{"version":3,"file":"webviewPreloads.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Event } from 'vs/base/common/event';\nimport type { IDisposable } from 'vs/base/common/lifecycle';\nimport { RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { FromWebviewMessage, IBlurOutputMessage, ICellDropMessage, ICellDragMessage, ICellDragStartMessage, IClickedDataUrlMessage, ICustomRendererMessage, IDimensionMessage, IClickMarkdownPreviewMessage, IMouseEnterMarkdownPreviewMessage, IMouseEnterMessage, IMouseLeaveMarkdownPreviewMessage, IMouseLeaveMessage, IToggleMarkdownPreviewMessage, IWheelMessage, ToWebviewMessage, ICellDragEndMessage, IOutputFocusMessage, IOutputBlurMessage, DimensionUpdate, IContextMenuMarkdownPreviewMessage, ITelemetryFoundRenderedMarkdownMath, ITelemetryFoundUnrenderedMarkdownMath } from 'vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView';\n\n// !! IMPORTANT !! everything must be in-line within the webviewPreloads\n// function. Imports are not allowed. This is stringifies and injected into\n// the webview.\n\ndeclare module globalThis {\n\tconst acquireVsCodeApi: () => ({\n\t\tgetState(): { [key: string]: unknown; };\n\t\tsetState(data: { [key: string]: unknown; }): void;\n\t\tpostMessage: (msg: unknown) => void;\n\t});\n}\n\ndeclare class ResizeObserver {\n\tconstructor(onChange: (entries: { target: HTMLElement, contentRect?: ClientRect; }[]) => void);\n\tobserve(element: Element): void;\n\tdisconnect(): void;\n}\n\ndeclare const __outputNodePadding__: number;\ndeclare const __outputNodeLeftPadding__: number;\n\ntype Listener<T> = { fn: (evt: T) => void; thisArg: unknown; };\n\ninterface EmitterLike<T> {\n\tfire(data: T): void;\n\tevent: Event<T>;\n}\n\nasync function webviewPreloads(markdownRendererModule: any, markdownDeps: any) {\n\tconst acquireVsCodeApi = globalThis.acquireVsCodeApi;\n\tconst vscode = acquireVsCodeApi();\n\tdelete (globalThis as any).acquireVsCodeApi;\n\n\tconst handleInnerClick = (event: MouseEvent) => {\n\t\tif (!event || !event.view || !event.view.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (node instanceof HTMLAnchorElement && node.href) {\n\t\t\t\tif (node.href.startsWith('blob:')) {\n\t\t\t\t\thandleBlobUrlClick(node.href, node.download);\n\t\t\t\t} else if (node.href.startsWith('data:')) {\n\t\t\t\t\thandleDataUrl(node.href, node.download);\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst handleDataUrl = async (data: string | ArrayBuffer | null, downloadName: string) => {\n\t\tpostNotebookMessage<IClickedDataUrlMessage>('clicked-data-url', {\n\t\t\tdata,\n\t\t\tdownloadName\n\t\t});\n\t};\n\n\tconst handleBlobUrlClick = async (url: string, downloadName: string) => {\n\t\ttry {\n\t\t\tconst response = await fetch(url);\n\t\t\tconst blob = await response.blob();\n\t\t\tconst reader = new FileReader();\n\t\t\treader.addEventListener('load', () => {\n\t\t\t\thandleDataUrl(reader.result, downloadName);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob);\n\t\t} catch (e) {\n\t\t\tconsole.error(e.message);\n\t\t}\n\t};\n\n\tdocument.body.addEventListener('click', handleInnerClick);\n\n\tconst preservedScriptAttributes: (keyof HTMLScriptElement)[] = [\n\t\t'type', 'src', 'nonce', 'noModule', 'async',\n\t];\n\n\t// derived from https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/core/DOMEval.js\n\tconst domEval = (container: Element) => {\n\t\tconst arr = Array.from(container.getElementsByTagName('script'));\n\t\tfor (let n = 0; n < arr.length; n++) {\n\t\t\tconst node = arr[n];\n\t\t\tconst scriptTag = document.createElement('script');\n\t\t\tconst trustedScript = ttPolicy?.createScript(node.innerText) ?? node.innerText;\n\t\t\tscriptTag.text = trustedScript as string;\n\t\t\tfor (const key of preservedScriptAttributes) {\n\t\t\t\tconst val = node[key] || node.getAttribute && node.getAttribute(key);\n\t\t\t\tif (val) {\n\t\t\t\t\tscriptTag.setAttribute(key, val as any);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TODO@connor4312: should script with src not be removed?\n\t\t\tcontainer.appendChild(scriptTag).parentNode!.removeChild(scriptTag);\n\t\t}\n\t};\n\n\tconst runScript = async (url: string, originalUri: string, globals: { [name: string]: unknown } = {}): Promise<() => (PreloadResult)> => {\n\t\tlet text: string;\n\t\ttry {\n\t\t\tconst res = await fetch(url);\n\t\t\ttext = await res.text();\n\t\t\tif (!res.ok) {\n\t\t\t\tthrow new Error(`Unexpected ${res.status} requesting ${originalUri}: ${text || res.statusText}`);\n\t\t\t}\n\n\t\t\tglobals.scriptUrl = url;\n\t\t} catch (e) {\n\t\t\treturn () => ({ state: PreloadState.Error, error: e.message });\n\t\t}\n\n\t\tconst args = Object.entries(globals);\n\t\treturn () => {\n\t\t\ttry {\n\t\t\t\tnew Function(...args.map(([k]) => k), text)(...args.map(([, v]) => v));\n\t\t\t\treturn { state: PreloadState.Ok };\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\treturn { state: PreloadState.Error, error: e.message };\n\t\t\t}\n\t\t};\n\t};\n\n\tconst dimensionUpdater = new class {\n\t\tprivate readonly pending = new Map<string, DimensionUpdate>();\n\n\t\tupdate(id: string, height: number, options: { init?: boolean; isOutput?: boolean }) {\n\t\t\tif (!this.pending.size) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.updateImmediately();\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tthis.pending.set(id, {\n\t\t\t\tid,\n\t\t\t\theight,\n\t\t\t\t...options,\n\t\t\t});\n\t\t}\n\n\t\tupdateImmediately() {\n\t\t\tif (!this.pending.size) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpostNotebookMessage<IDimensionMessage>('dimension', {\n\t\t\t\tupdates: Array.from(this.pending.values())\n\t\t\t});\n\t\t\tthis.pending.clear();\n\t\t}\n\t};\n\n\tconst resizeObserver = new class {\n\n\t\tprivate readonly _observer: ResizeObserver;\n\n\t\tprivate readonly _observedElements = new WeakMap<Element, { id: string, output: boolean }>();\n\n\t\tconstructor() {\n\t\t\tthis._observer = new ResizeObserver(entries => {\n\t\t\t\tfor (const entry of entries) {\n\t\t\t\t\tif (!document.body.contains(entry.target)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst observedElementInfo = this._observedElements.get(entry.target);\n\t\t\t\t\tif (!observedElementInfo) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (entry.target.id === observedElementInfo.id && entry.contentRect) {\n\t\t\t\t\t\tif (observedElementInfo.output) {\n\t\t\t\t\t\t\tlet height = 0;\n\t\t\t\t\t\t\tif (entry.contentRect.height !== 0) {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `${__outputNodePadding__}px ${__outputNodePadding__}px ${__outputNodePadding__}px ${__outputNodeLeftPadding__}px`;\n\t\t\t\t\t\t\t\theight = entry.contentRect.height + __outputNodePadding__ * 2;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `0px`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdimensionUpdater.update(observedElementInfo.id, height, {\n\t\t\t\t\t\t\t\tisOutput: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdimensionUpdater.update(observedElementInfo.id, entry.target.clientHeight, {\n\t\t\t\t\t\t\t\tisOutput: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tpublic observe(container: Element, id: string, output: boolean) {\n\t\t\tif (this._observedElements.has(container)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._observedElements.set(container, { id, output });\n\t\t\tthis._observer.observe(container);\n\t\t}\n\t};\n\n\tfunction scrollWillGoToParent(event: WheelEvent) {\n\t\tfor (let node = event.target as Node | null; node; node = node.parentNode) {\n\t\t\tif (!(node instanceof Element) || node.id === 'container' || node.classList.contains('cell_container') || node.classList.contains('output_container')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.deltaY < 0 && node.scrollTop > 0) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (event.deltaY > 0 && node.scrollTop + node.clientHeight < node.scrollHeight) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst handleWheel = (event: WheelEvent) => {\n\t\tif (event.defaultPrevented || scrollWillGoToParent(event)) {\n\t\t\treturn;\n\t\t}\n\t\tpostNotebookMessage<IWheelMessage>('did-scroll-wheel', {\n\t\t\tpayload: {\n\t\t\t\tdeltaMode: event.deltaMode,\n\t\t\t\tdeltaX: event.deltaX,\n\t\t\t\tdeltaY: event.deltaY,\n\t\t\t\tdeltaZ: event.deltaZ,\n\t\t\t\tdetail: event.detail,\n\t\t\t\ttype: event.type\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction focusFirstFocusableInCell(cellId: string) {\n\t\tconst cellOutputContainer = document.getElementById(cellId);\n\t\tif (cellOutputContainer) {\n\t\t\tconst focusableElement = cellOutputContainer.querySelector('[tabindex=\"0\"], [href], button, input, option, select, textarea') as HTMLElement | null;\n\t\t\tfocusableElement?.focus();\n\t\t}\n\t}\n\n\tfunction createFocusSink(cellId: string, outputId: string, focusNext?: boolean) {\n\t\tconst element = document.createElement('div');\n\t\telement.tabIndex = 0;\n\t\telement.addEventListener('focus', () => {\n\t\t\tpostNotebookMessage<IBlurOutputMessage>('focus-editor', {\n\t\t\t\tid: outputId,\n\t\t\t\tfocusNext\n\t\t\t});\n\t\t});\n\n\t\treturn element;\n\t}\n\n\tfunction addMouseoverListeners(element: HTMLElement, outputId: string): void {\n\t\telement.addEventListener('mouseenter', () => {\n\t\t\tpostNotebookMessage<IMouseEnterMessage>('mouseenter', {\n\t\t\t\tid: outputId,\n\t\t\t});\n\t\t});\n\t\telement.addEventListener('mouseleave', () => {\n\t\t\tpostNotebookMessage<IMouseLeaveMessage>('mouseleave', {\n\t\t\t\tid: outputId,\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction isAncestor(testChild: Node | null, testAncestor: Node | null): boolean {\n\t\twhile (testChild) {\n\t\t\tif (testChild === testAncestor) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\ttestChild = testChild.parentNode;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tclass FocusTracker {\n\t\tprivate _outputId: string;\n\t\tprivate _hasFocus: boolean = false;\n\t\tprivate _loosingFocus: boolean = false;\n\t\tprivate _element: HTMLElement | Window;\n\t\tconstructor(element: HTMLElement | Window, outputId: string) {\n\t\t\tthis._element = element;\n\t\t\tthis._outputId = outputId;\n\t\t\tthis._hasFocus = isAncestor(document.activeElement, <HTMLElement>element);\n\t\t\tthis._loosingFocus = false;\n\n\t\t\telement.addEventListener('focus', this._onFocus.bind(this), true);\n\t\t\telement.addEventListener('blur', this._onBlur.bind(this), true);\n\t\t}\n\n\t\tprivate _onFocus() {\n\t\t\tthis._loosingFocus = false;\n\t\t\tif (!this._hasFocus) {\n\t\t\t\tthis._hasFocus = true;\n\t\t\t\tpostNotebookMessage<IOutputFocusMessage>('outputFocus', {\n\t\t\t\t\tid: this._outputId,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tprivate _onBlur() {\n\t\t\tif (this._hasFocus) {\n\t\t\t\tthis._loosingFocus = true;\n\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\tif (this._loosingFocus) {\n\t\t\t\t\t\tthis._loosingFocus = false;\n\t\t\t\t\t\tthis._hasFocus = false;\n\t\t\t\t\t\tpostNotebookMessage<IOutputBlurMessage>('outputBlur', {\n\t\t\t\t\t\t\tid: this._outputId,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\tif (this._element) {\n\t\t\t\tthis._element.removeEventListener('focus', this._onFocus, true);\n\t\t\t\tthis._element.removeEventListener('blur', this._onBlur, true);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst focusTrackers = new Map<string, FocusTracker>();\n\n\tfunction addFocusTracker(element: HTMLElement, outputId: string): void {\n\t\tif (focusTrackers.has(outputId)) {\n\t\t\tfocusTrackers.get(outputId)?.dispose();\n\t\t}\n\n\t\tfocusTrackers.set(outputId, new FocusTracker(element, outputId));\n\t}\n\n\tconst dontEmit = Symbol('dontEmit');\n\n\tfunction createEmitter<T>(listenerChange: (listeners: Set<Listener<T>>) => void = () => undefined): EmitterLike<T> {\n\t\tconst listeners = new Set<Listener<T>>();\n\t\treturn {\n\t\t\tfire(data) {\n\t\t\t\tfor (const listener of [...listeners]) {\n\t\t\t\t\tlistener.fn.call(listener.thisArg, data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tevent(fn, thisArg, disposables) {\n\t\t\t\tconst listenerObj = { fn, thisArg };\n\t\t\t\tconst disposable: IDisposable = {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tlisteners.delete(listenerObj);\n\t\t\t\t\t\tlistenerChange(listeners);\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tlisteners.add(listenerObj);\n\t\t\t\tlistenerChange(listeners);\n\n\t\t\t\tif (disposables instanceof Array) {\n\t\t\t\t\tdisposables.push(disposable);\n\t\t\t\t} else if (disposables) {\n\t\t\t\t\tdisposables.add(disposable);\n\t\t\t\t}\n\n\t\t\t\treturn disposable;\n\t\t\t},\n\t\t};\n\t}\n\n\t// Maps the events in the given emitter, invoking mapFn on each one. mapFn can return\n\t// the dontEmit symbol to skip emission.\n\tfunction mapEmitter<T, R>(emitter: EmitterLike<T>, mapFn: (data: T) => R | typeof dontEmit) {\n\t\tlet listener: IDisposable;\n\t\tconst mapped = createEmitter(listeners => {\n\t\t\tif (listeners.size && !listener) {\n\t\t\t\tlistener = emitter.event(data => {\n\t\t\t\t\tconst v = mapFn(data);\n\t\t\t\t\tif (v !== dontEmit) {\n\t\t\t\t\t\tmapped.fire(v);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (listener && !listeners.size) {\n\t\t\t\tlistener.dispose();\n\t\t\t}\n\t\t});\n\n\t\treturn mapped.event;\n\t}\n\n\tinterface ICreateCellInfo {\n\t\telement: HTMLElement;\n\t\toutputId: string;\n\n\t\tmime: string;\n\t\tvalue: unknown;\n\t\tmetadata: unknown;\n\t}\n\n\tinterface IDestroyCellInfo {\n\t\toutputId: string;\n\t}\n\n\tconst onWillDestroyOutput = createEmitter<[string | undefined /* namespace */, IDestroyCellInfo | undefined /* cell uri */]>();\n\tconst onDidCreateOutput = createEmitter<[string | undefined /* namespace */, ICreateCellInfo]>();\n\tconst onDidReceiveMessage = createEmitter<[string, unknown]>();\n\n\tconst matchesNs = (namespace: string, query: string | undefined) => namespace === '*' || query === namespace || query === 'undefined';\n\n\t(window as any).acquireNotebookRendererApi = <T>(namespace: string) => {\n\t\tif (!namespace || typeof namespace !== 'string') {\n\t\t\tthrow new Error(`acquireNotebookRendererApi should be called your renderer type as a string, got: ${namespace}.`);\n\t\t}\n\n\t\treturn {\n\t\t\tpostMessage(message: unknown) {\n\t\t\t\tpostNotebookMessage<ICustomRendererMessage>('customRendererMessage', {\n\t\t\t\t\trendererId: namespace,\n\t\t\t\t\tmessage,\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetState(newState: T) {\n\t\t\t\tvscode.setState({ ...vscode.getState(), [namespace]: newState });\n\t\t\t},\n\t\t\tgetState(): T | undefined {\n\t\t\t\tconst state = vscode.getState();\n\t\t\t\treturn typeof state === 'object' && state ? state[namespace] as T : undefined;\n\t\t\t},\n\t\t\tonDidReceiveMessage: mapEmitter(onDidReceiveMessage, ([ns, data]) => ns === namespace ? data : dontEmit),\n\t\t\tonWillDestroyOutput: mapEmitter(onWillDestroyOutput, ([ns, data]) => matchesNs(namespace, ns) ? data : dontEmit),\n\t\t\tonDidCreateOutput: mapEmitter(onDidCreateOutput, ([ns, data]) => matchesNs(namespace, ns) ? data : dontEmit),\n\t\t};\n\t};\n\n\tconst enum PreloadState {\n\t\tOk,\n\t\tError\n\t}\n\n\ttype PreloadResult = { state: PreloadState.Ok } | { state: PreloadState.Error, error: string };\n\n\t/**\n\t * Map of preload resource URIs to promises that resolve one the resource\n\t * loads or errors.\n\t */\n\tconst preloadPromises = new Map<string, Promise<PreloadResult>>();\n\tconst queuedOuputActions = new Map<string, Promise<void>>();\n\n\t/**\n\t * Enqueues an action that affects a output. This blocks behind renderer load\n\t * requests that affect the same output. This should be called whenever you\n\t * do something that affects output to ensure it runs in\n\t * the correct order.\n\t */\n\tconst enqueueOutputAction = <T extends { outputId: string; }>(event: T, fn: (event: T) => Promise<void> | void) => {\n\t\tconst queued = queuedOuputActions.get(event.outputId);\n\t\tconst maybePromise = queued ? queued.then(() => fn(event)) : fn(event);\n\t\tif (typeof maybePromise === 'undefined') {\n\t\t\treturn; // a synchonrously-called function, we're done\n\t\t}\n\n\t\tconst promise = maybePromise.then(() => {\n\t\t\tif (queuedOuputActions.get(event.outputId) === promise) {\n\t\t\t\tqueuedOuputActions.delete(event.outputId);\n\t\t\t}\n\t\t});\n\n\t\tqueuedOuputActions.set(event.outputId, promise);\n\t};\n\n\tconst ttPolicy = window.trustedTypes?.createPolicy('notebookOutputRenderer', {\n\t\tcreateHTML: value => value,\n\t\tcreateScript: value => value,\n\t});\n\n\twindow.addEventListener('wheel', handleWheel);\n\n\twindow.addEventListener('message', rawEvent => {\n\t\tconst event = rawEvent as ({ data: ToWebviewMessage; });\n\n\t\tswitch (event.data.type) {\n\t\t\tcase 'initializeMarkdownPreview':\n\t\t\t\tfor (const cell of event.data.cells) {\n\t\t\t\t\tcreateMarkdownPreview(cell.cellId, cell.content, cell.offset);\n\n\t\t\t\t\tconst cellContainer = document.getElementById(cell.cellId);\n\t\t\t\t\tif (cellContainer) {\n\t\t\t\t\t\tcellContainer.style.visibility = 'hidden';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdimensionUpdater.updateImmediately();\n\t\t\t\tpostNotebookMessage('initializedMarkdownPreview', {});\n\t\t\t\tbreak;\n\t\t\tcase 'createMarkdownPreview':\n\t\t\t\tcreateMarkdownPreview(event.data.id, event.data.content, event.data.top);\n\t\t\t\tbreak;\n\t\t\tcase 'showMarkdownPreview':\n\t\t\t\t{\n\t\t\t\t\tconst data = event.data;\n\n\t\t\t\t\tconst cellContainer = document.getElementById(data.id);\n\t\t\t\t\tif (cellContainer) {\n\t\t\t\t\t\tcellContainer.style.visibility = 'visible';\n\t\t\t\t\t\tcellContainer.style.top = `${data.top}px`;\n\t\t\t\t\t}\n\n\t\t\t\t\tupdateMarkdownPreview(data.id, data.content);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'hideMarkdownPreviews':\n\t\t\t\t{\n\t\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\t\tconst cellContainer = document.getElementById(id);\n\t\t\t\t\t\tif (cellContainer) {\n\t\t\t\t\t\t\tcellContainer.style.visibility = 'hidden';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'unhideMarkdownPreviews':\n\t\t\t\t{\n\t\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\t\tconst cellContainer = document.getElementById(id);\n\t\t\t\t\t\tif (cellContainer) {\n\t\t\t\t\t\t\tcellContainer.style.visibility = 'visible';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tupdateMarkdownPreview(id, undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'deleteMarkdownPreview':\n\t\t\t\t{\n\t\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\t\tconst cellContainer = document.getElementById(id);\n\t\t\t\t\t\tcellContainer?.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'updateSelectedMarkdownPreviews':\n\t\t\t\t{\n\t\t\t\t\tconst selectedCellIds = new Set<string>(event.data.selectedCellIds);\n\n\t\t\t\t\tfor (const oldSelected of document.querySelectorAll('.preview.selected')) {\n\t\t\t\t\t\tconst id = oldSelected.id;\n\t\t\t\t\t\tif (!selectedCellIds.has(id)) {\n\t\t\t\t\t\t\toldSelected.classList.remove('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const newSelected of selectedCellIds) {\n\t\t\t\t\t\tconst previewContainer = document.getElementById(newSelected);\n\t\t\t\t\t\tif (previewContainer) {\n\t\t\t\t\t\t\tpreviewContainer.classList.add('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'html':\n\t\t\t\tenqueueOutputAction(event.data, async data => {\n\t\t\t\t\tconst preloadResults = await Promise.all(data.requiredPreloads.map(p => preloadPromises.get(p.uri)));\n\t\t\t\t\tif (!queuedOuputActions.has(data.outputId)) { // output was cleared while loading\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet cellOutputContainer = document.getElementById(data.cellId);\n\t\t\t\t\tconst outputId = data.outputId;\n\t\t\t\t\tif (!cellOutputContainer) {\n\t\t\t\t\t\tconst container = document.getElementById('container')!;\n\n\t\t\t\t\t\tconst upperWrapperElement = createFocusSink(data.cellId, outputId);\n\t\t\t\t\t\tcontainer.appendChild(upperWrapperElement);\n\n\t\t\t\t\t\tconst newElement = document.createElement('div');\n\n\t\t\t\t\t\tnewElement.id = data.cellId;\n\t\t\t\t\t\tnewElement.classList.add('cell_container');\n\n\t\t\t\t\t\tcontainer.appendChild(newElement);\n\t\t\t\t\t\tcellOutputContainer = newElement;\n\n\t\t\t\t\t\tconst lowerWrapperElement = createFocusSink(data.cellId, outputId, true);\n\t\t\t\t\t\tcontainer.appendChild(lowerWrapperElement);\n\t\t\t\t\t}\n\n\t\t\t\t\tcellOutputContainer.style.position = 'absolute';\n\t\t\t\t\tcellOutputContainer.style.top = data.cellTop + 'px';\n\n\t\t\t\t\tconst outputContainer = document.createElement('div');\n\t\t\t\t\toutputContainer.classList.add('output_container');\n\t\t\t\t\toutputContainer.style.position = 'absolute';\n\t\t\t\t\toutputContainer.style.overflow = 'hidden';\n\t\t\t\t\toutputContainer.style.maxHeight = '0px';\n\t\t\t\t\toutputContainer.style.top = `${data.outputOffset}px`;\n\n\t\t\t\t\tconst outputNode = document.createElement('div');\n\t\t\t\t\toutputNode.classList.add('output');\n\t\t\t\t\toutputNode.style.position = 'absolute';\n\t\t\t\t\toutputNode.style.top = `0px`;\n\t\t\t\t\toutputNode.style.left = data.left + 'px';\n\t\t\t\t\t// outputNode.style.width = 'calc(100% - ' + data.left + 'px)';\n\t\t\t\t\t// outputNode.style.minHeight = '32px';\n\t\t\t\t\toutputNode.style.padding = '0px';\n\t\t\t\t\toutputNode.id = outputId;\n\n\t\t\t\t\taddMouseoverListeners(outputNode, outputId);\n\t\t\t\t\taddFocusTracker(outputNode, outputId);\n\t\t\t\t\tconst content = data.content;\n\t\t\t\t\tif (content.type === RenderOutputType.Html) {\n\t\t\t\t\t\tconst trustedHtml = ttPolicy?.createHTML(content.htmlContent) ?? content.htmlContent;\n\t\t\t\t\t\toutputNode.innerHTML = trustedHtml as string;\n\t\t\t\t\t\tcellOutputContainer.appendChild(outputContainer);\n\t\t\t\t\t\toutputContainer.appendChild(outputNode);\n\t\t\t\t\t\tdomEval(outputNode);\n\t\t\t\t\t} else if (preloadResults.some(e => e?.state === PreloadState.Error)) {\n\t\t\t\t\t\toutputNode.innerText = `Error loading preloads:`;\n\t\t\t\t\t\tconst errList = document.createElement('ul');\n\t\t\t\t\t\tfor (const result of preloadResults) {\n\t\t\t\t\t\t\tif (result?.state === PreloadState.Error) {\n\t\t\t\t\t\t\t\tconst item = document.createElement('li');\n\t\t\t\t\t\t\t\titem.innerText = result.error;\n\t\t\t\t\t\t\t\terrList.appendChild(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\toutputNode.appendChild(errList);\n\t\t\t\t\t\tcellOutputContainer.appendChild(outputContainer);\n\t\t\t\t\t\toutputContainer.appendChild(outputNode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst { metadata, mimeType, value } = content;\n\t\t\t\t\t\tonDidCreateOutput.fire([data.apiNamespace, {\n\t\t\t\t\t\t\telement: outputNode,\n\t\t\t\t\t\t\toutputId,\n\t\t\t\t\t\t\tmime: content.mimeType,\n\t\t\t\t\t\t\tvalue: content.value,\n\t\t\t\t\t\t\tmetadata: content.metadata,\n\n\t\t\t\t\t\t\tget mimeType() {\n\t\t\t\t\t\t\t\tconsole.warn(`event.mimeType is deprecated, use 'mime' instead`);\n\t\t\t\t\t\t\t\treturn mimeType;\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\tget output() {\n\t\t\t\t\t\t\t\tconsole.warn(`event.output is deprecated, use properties directly instead`);\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tmetadata: { [mimeType]: metadata },\n\t\t\t\t\t\t\t\t\tdata: { [mimeType]: value },\n\t\t\t\t\t\t\t\t\toutputId,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} as ICreateCellInfo]);\n\t\t\t\t\t\tcellOutputContainer.appendChild(outputContainer);\n\t\t\t\t\t\toutputContainer.appendChild(outputNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tresizeObserver.observe(outputNode, outputId, true);\n\n\t\t\t\t\tconst clientHeight = outputNode.clientHeight;\n\t\t\t\t\tconst cps = document.defaultView!.getComputedStyle(outputNode);\n\t\t\t\t\tif (clientHeight !== 0 && cps.padding === '0px') {\n\t\t\t\t\t\t// we set padding to zero if the output height is zero (then we can have a zero-height output DOM node)\n\t\t\t\t\t\t// thus we need to ensure the padding is accounted when updating the init height of the output\n\t\t\t\t\t\tdimensionUpdater.update(outputId, clientHeight + __outputNodePadding__ * 2, {\n\t\t\t\t\t\t\tisOutput: true,\n\t\t\t\t\t\t\tinit: true,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\toutputNode.style.padding = `${__outputNodePadding__}px ${__outputNodePadding__}px ${__outputNodePadding__}px ${__outputNodeLeftPadding__}px`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdimensionUpdater.update(outputId, outputNode.clientHeight, {\n\t\t\t\t\t\t\tisOutput: true,\n\t\t\t\t\t\t\tinit: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// don't hide until after this step so that the height is right\n\t\t\t\t\tcellOutputContainer.style.visibility = data.initiallyHidden ? 'hidden' : 'visible';\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'view-scroll':\n\t\t\t\t{\n\t\t\t\t\t// const date = new Date();\n\t\t\t\t\t// console.log('----- will scroll ----  ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\n\t\t\t\t\tfor (const request of event.data.widgets) {\n\t\t\t\t\t\tconst widget = document.getElementById(request.outputId);\n\t\t\t\t\t\tif (widget) {\n\t\t\t\t\t\t\twidget.parentElement!.parentElement!.style.top = `${request.cellTop}px`;\n\t\t\t\t\t\t\twidget.parentElement!.style.top = `${request.outputOffset}px`;\n\t\t\t\t\t\t\tif (request.forceDisplay) {\n\t\t\t\t\t\t\t\twidget.parentElement!.parentElement!.style.visibility = 'visible';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const cell of event.data.markdownPreviews) {\n\t\t\t\t\t\tconst container = document.getElementById(cell.id);\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\tcontainer.style.top = `${cell.top}px`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase 'clear':\n\t\t\t\tqueuedOuputActions.clear(); // stop all loading outputs\n\t\t\t\tonWillDestroyOutput.fire([undefined, undefined]);\n\t\t\t\tdocument.getElementById('container')!.innerText = '';\n\n\t\t\t\tfocusTrackers.forEach(ft => {\n\t\t\t\t\tft.dispose();\n\t\t\t\t});\n\t\t\t\tfocusTrackers.clear();\n\t\t\t\tbreak;\n\t\t\tcase 'clearOutput':\n\t\t\t\tconst output = document.getElementById(event.data.outputId);\n\t\t\t\tqueuedOuputActions.delete(event.data.outputId); // stop any in-progress rendering\n\t\t\t\tif (output && output.parentNode) {\n\t\t\t\t\tonWillDestroyOutput.fire([event.data.apiNamespace, { outputId: event.data.outputId }]);\n\t\t\t\t\toutput.parentNode.removeChild(output);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'hideOutput':\n\t\t\t\tenqueueOutputAction(event.data, ({ outputId }) => {\n\t\t\t\t\tconst container = document.getElementById(outputId)?.parentElement?.parentElement;\n\t\t\t\t\tif (container) {\n\t\t\t\t\t\tcontainer.style.visibility = 'hidden';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'showOutput':\n\t\t\t\tenqueueOutputAction(event.data, ({ outputId, cellTop: top, }) => {\n\t\t\t\t\tconst output = document.getElementById(outputId);\n\t\t\t\t\tif (output) {\n\t\t\t\t\t\toutput.parentElement!.parentElement!.style.visibility = 'visible';\n\t\t\t\t\t\toutput.parentElement!.parentElement!.style.top = top + 'px';\n\n\t\t\t\t\t\tdimensionUpdater.update(outputId, output.clientHeight, {\n\t\t\t\t\t\t\tisOutput: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'ack-dimension':\n\t\t\t\t{\n\t\t\t\t\tconst { outputId, height } = event.data;\n\t\t\t\t\tconst output = document.getElementById(outputId);\n\t\t\t\t\tif (output) {\n\t\t\t\t\t\toutput.parentElement!.style.maxHeight = `${height}px`;\n\t\t\t\t\t\toutput.parentElement!.style.height = `${height}px`;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase 'preload':\n\t\t\t\tconst resources = event.data.resources;\n\t\t\t\tconst globals = event.data.type === 'preload' ? { acquireVsCodeApi } : {};\n\t\t\t\tlet queue: Promise<PreloadResult> = Promise.resolve({ state: PreloadState.Ok });\n\t\t\t\tfor (const { uri, originalUri } of resources) {\n\t\t\t\t\t// create the promise so that the scripts download in parallel, but\n\t\t\t\t\t// only invoke them in series within the queue\n\t\t\t\t\tconst promise = runScript(uri, originalUri, globals);\n\t\t\t\t\tqueue = queue.then(() => promise.then(fn => {\n\t\t\t\t\t\tconst result = fn();\n\t\t\t\t\t\tif (result.state === PreloadState.Error) {\n\t\t\t\t\t\t\tconsole.error(result.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}));\n\t\t\t\t\tpreloadPromises.set(uri, queue);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'focus-output':\n\t\t\t\tfocusFirstFocusableInCell(event.data.cellId);\n\t\t\t\tbreak;\n\t\t\tcase 'decorations':\n\t\t\t\t{\n\t\t\t\t\tconst outputContainer = document.getElementById(event.data.cellId);\n\t\t\t\t\toutputContainer?.classList.add(...event.data.addedClassNames);\n\t\t\t\t\toutputContainer?.classList.remove(...event.data.removedClassNames);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'customRendererMessage':\n\t\t\t\tonDidReceiveMessage.fire([event.data.rendererId, event.data.message]);\n\t\t\t\tbreak;\n\t\t}\n\t});\n\n\tconst markdownRenderer: {\n\t\trenderMarkup: (context: { element: HTMLElement, content: string }) => void,\n\t} = await markdownRendererModule.activate(markdownDeps);\n\n\tvscode.postMessage({\n\t\t__vscode_notebook_message: true,\n\t\ttype: 'initialized'\n\t});\n\n\tfunction createMarkdownPreview(cellId: string, content: string, top: number) {\n\t\tconst container = document.getElementById('container')!;\n\t\tconst cellContainer = document.createElement('div');\n\t\tcellContainer.id = cellId;\n\t\tcellContainer.classList.add('preview');\n\n\t\tcellContainer.style.position = 'absolute';\n\t\tcellContainer.style.top = top + 'px';\n\t\tcontainer.appendChild(cellContainer);\n\n\t\tcellContainer.addEventListener('dblclick', () => {\n\t\t\tpostNotebookMessage<IToggleMarkdownPreviewMessage>('toggleMarkdownPreview', { cellId });\n\t\t});\n\n\t\tcellContainer.addEventListener('click', e => {\n\t\t\tpostNotebookMessage<IClickMarkdownPreviewMessage>('clickMarkdownPreview', {\n\t\t\t\tcellId,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t});\n\t\t});\n\n\t\tcellContainer.addEventListener('contextmenu', e => {\n\t\t\tpostNotebookMessage<IContextMenuMarkdownPreviewMessage>('contextMenuMarkdownPreview', {\n\t\t\t\tcellId,\n\t\t\t\tclientX: e.clientX,\n\t\t\t\tclientY: e.clientY,\n\t\t\t});\n\t\t});\n\n\t\tcellContainer.addEventListener('mouseenter', () => {\n\t\t\tpostNotebookMessage<IMouseEnterMarkdownPreviewMessage>('mouseEnterMarkdownPreview', { cellId });\n\t\t});\n\n\t\tcellContainer.addEventListener('mouseleave', () => {\n\t\t\tpostNotebookMessage<IMouseLeaveMarkdownPreviewMessage>('mouseLeaveMarkdownPreview', { cellId });\n\t\t});\n\n\t\tcellContainer.setAttribute('draggable', 'true');\n\n\t\tcellContainer.addEventListener('dragstart', e => {\n\t\t\tmarkdownPreviewDragManager.startDrag(e, cellId);\n\t\t});\n\n\t\tcellContainer.addEventListener('drag', e => {\n\t\t\tmarkdownPreviewDragManager.updateDrag(e, cellId);\n\t\t});\n\n\t\tcellContainer.addEventListener('dragend', e => {\n\t\t\tmarkdownPreviewDragManager.endDrag(e, cellId);\n\t\t});\n\n\t\tconst previewRoot = cellContainer.attachShadow({ mode: 'open' });\n\n\t\t// Add default webview style\n\t\tconst defaultStyles = document.getElementById('_defaultStyles') as HTMLStyleElement;\n\t\tpreviewRoot.appendChild(defaultStyles.cloneNode(true));\n\n\t\t// Add default preview style\n\t\tconst previewStyles = document.getElementById('preview-styles') as HTMLTemplateElement;\n\t\tpreviewRoot.appendChild(previewStyles.content.cloneNode(true));\n\n\t\tconst previewNode = document.createElement('div');\n\t\tpreviewNode.id = 'preview';\n\t\tpreviewRoot.appendChild(previewNode);\n\n\t\tupdateMarkdownPreview(cellId, content);\n\n\t\tresizeObserver.observe(cellContainer, cellId, false);\n\t}\n\n\tfunction postNotebookMessage<T extends FromWebviewMessage>(\n\t\ttype: T['type'],\n\t\tproperties: Omit<T, '__vscode_notebook_message' | 'type'>\n\t) {\n\t\tvscode.postMessage({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype,\n\t\t\t...properties\n\t\t});\n\t}\n\n\tlet hasPostedRenderedMathTelemetry = false;\n\tconst unsupportedKatexTermsRegex = /(\\\\(?:abovewithdelims|array|Arrowvert|arrowvert|atopwithdelims|bbox|bracevert|buildrel|cancelto|cases|class|cssId|ddddot|dddot|DeclareMathOperator|definecolor|displaylines|enclose|eqalign|eqalignno|eqref|hfil|hfill|idotsint|iiiint|label|leftarrowtail|leftroot|leqalignno|lower|mathtip|matrix|mbox|mit|mmlToken|moveleft|moveright|mspace|newenvironment|Newextarrow|notag|oldstyle|overparen|overwithdelims|pmatrix|raise|ref|renewenvironment|require|root|Rule|scr|shoveleft|shoveright|sideset|skew|Space|strut|style|texttip|Tiny|toggle|underparen|unicode|uproot)\\b)/g;\n\n\tfunction updateMarkdownPreview(cellId: string, content: string | undefined) {\n\t\tconst previewContainerNode = document.getElementById(cellId);\n\t\tif (!previewContainerNode) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst previewRoot = previewContainerNode.shadowRoot;\n\t\tconst previewNode = previewRoot?.getElementById('preview') as HTMLElement;\n\n\t\t// TODO: handle namespace\n\t\tif (typeof content === 'string') {\n\t\t\tif (content.trim().length === 0) {\n\t\t\t\tpreviewContainerNode.classList.add('emptyMarkdownCell');\n\t\t\t\tpreviewNode.innerText = '';\n\t\t\t} else {\n\t\t\t\tpreviewContainerNode.classList.remove('emptyMarkdownCell');\n\t\t\t\tmarkdownRenderer.renderMarkup({\n\t\t\t\t\telement: previewNode,\n\t\t\t\t\tcontent: content\n\t\t\t\t});\n\n\t\t\t\tif (!hasPostedRenderedMathTelemetry) {\n\t\t\t\t\tconst hasRenderedMath = previewNode.querySelector('.katex');\n\t\t\t\t\tif (hasRenderedMath) {\n\t\t\t\t\t\thasPostedRenderedMathTelemetry = true;\n\t\t\t\t\t\tpostNotebookMessage<ITelemetryFoundRenderedMarkdownMath>('telemetryFoundRenderedMarkdownMath', {});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst matches = previewNode.innerText.match(unsupportedKatexTermsRegex);\n\t\t\t\tif (matches) {\n\t\t\t\t\tpostNotebookMessage<ITelemetryFoundUnrenderedMarkdownMath>('telemetryFoundUnrenderedMarkdownMath', {\n\t\t\t\t\t\tlatexDirective: matches[0],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdimensionUpdater.update(cellId, previewContainerNode.clientHeight, {\n\t\t\tisOutput: false\n\t\t});\n\t}\n\n\tconst markdownPreviewDragManager = new class MarkdownPreviewDragManager {\n\n\t\tprivate currentDrag: { cellId: string, clientY: number } | undefined;\n\n\t\tconstructor() {\n\t\t\tdocument.addEventListener('dragover', e => {\n\t\t\t\t// Allow dropping dragged markdown cells\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tdocument.addEventListener('drop', e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tconst drag = this.currentDrag;\n\t\t\t\tif (!drag) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t\tpostNotebookMessage<ICellDropMessage>('cell-drop', {\n\t\t\t\t\tcellId: drag.cellId,\n\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\tposition: { clientY: e.clientY },\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tstartDrag(e: DragEvent, cellId: string) {\n\t\t\tif (!e.dataTransfer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\n\t\t\t(e.target as HTMLElement).classList.add('dragging');\n\n\t\t\tpostNotebookMessage<ICellDragStartMessage>('cell-drag-start', {\n\t\t\t\tcellId: cellId,\n\t\t\t\tposition: { clientY: e.clientY },\n\t\t\t});\n\n\t\t\t// Continuously send updates while dragging instead of relying on `updateDrag`.\n\t\t\t// This lets us scroll the list based on drag position.\n\t\t\tconst trySendDragUpdate = () => {\n\t\t\t\tif (this.currentDrag?.cellId !== cellId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tpostNotebookMessage<ICellDragMessage>('cell-drag', {\n\t\t\t\t\tcellId: cellId,\n\t\t\t\t\tposition: { clientY: this.currentDrag.clientY },\n\t\t\t\t});\n\t\t\t\trequestAnimationFrame(trySendDragUpdate);\n\t\t\t};\n\t\t\trequestAnimationFrame(trySendDragUpdate);\n\t\t}\n\n\t\tupdateDrag(e: DragEvent, cellId: string) {\n\t\t\tif (cellId !== this.currentDrag?.cellId) {\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t}\n\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\t\t}\n\n\t\tendDrag(e: DragEvent, cellId: string) {\n\t\t\tthis.currentDrag = undefined;\n\t\t\t(e.target as HTMLElement).classList.remove('dragging');\n\t\t\tpostNotebookMessage<ICellDragEndMessage>('cell-drag-end', {\n\t\t\t\tcellId: cellId\n\t\t\t});\n\t\t}\n\t}();\n}\n\nexport function preloadsScriptStr(styleValues: {\n\toutputNodePadding: number;\n\toutputNodeLeftPadding: number;\n}, markdownRenderer: {\n\tentrypoint: string,\n\tdependencies: Array<{ entrypoint: string }>,\n}) {\n\tconst markdownCtx = {\n\t\tdependencies: markdownRenderer.dependencies,\n\t};\n\n\treturn `\n\timport * as markdownRendererModule from \"${markdownRenderer.entrypoint}\";\n\t(${webviewPreloads})(markdownRendererModule, JSON.parse(decodeURIComponent(\"${encodeURIComponent(JSON.stringify(markdownCtx))}\")))`\n\t\t.replace(/__outputNodePadding__/g, `${styleValues.outputNodePadding}`)\n\t\t.replace(/__outputNodeLeftPadding__/g, `${styleValues.outputNodeLeftPadding}`);\n}\n"]}