{"version":3,"sources":["vs/workbench/contrib/notebook/browser/notebookEditor.ts"],"names":[],"mappings":"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","file":"notebookEditor.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from 'vs/base/browser/dom';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport 'vs/css!./media/notebook';\nimport { localize } from 'vs/nls';\nimport { extname } from 'vs/base/common/resources';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { EditorOverride } from 'vs/platform/editor/common/editor';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { INotificationService, Severity } from 'vs/platform/notification/common/notification';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { EditorPane } from 'vs/workbench/browser/parts/editor/editorPane';\nimport { EditorOptions, IEditorInput, IEditorMemento, IEditorOpenContext } from 'vs/workbench/common/editor';\nimport { NotebookEditorInput } from 'vs/workbench/contrib/notebook/common/notebookEditorInput';\nimport { NotebookEditorWidget } from 'vs/workbench/contrib/notebook/browser/notebookEditorWidget';\nimport { INotebookEditorViewState, NotebookViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/notebookViewModel';\nimport { IEditorDropService } from 'vs/workbench/services/editor/browser/editorDropService';\nimport { IEditorGroup, IEditorGroupsService, GroupsOrder } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { NotebookEditorOptions, NOTEBOOK_EDITOR_ID } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { IBorrowValue, INotebookEditorService } from 'vs/workbench/contrib/notebook/browser/notebookEditorService';\nimport { clearMarks, getAndClearMarks, mark } from 'vs/workbench/contrib/notebook/common/notebookPerformance';\nimport { IFileService } from 'vs/platform/files/common/files';\n\nconst NOTEBOOK_EDITOR_VIEW_STATE_PREFERENCE_KEY = 'NotebookEditorViewState';\n\nexport class NotebookEditor extends EditorPane {\n\tstatic readonly ID: string = NOTEBOOK_EDITOR_ID;\n\n\tprivate readonly _editorMemento: IEditorMemento<INotebookEditorViewState>;\n\tprivate readonly _groupListener = this._register(new DisposableStore());\n\tprivate readonly _widgetDisposableStore: DisposableStore = new DisposableStore();\n\tprivate _widget: IBorrowValue<NotebookEditorWidget> = { value: undefined };\n\tprivate _rootElement!: HTMLElement;\n\tprivate _dimension?: DOM.Dimension;\n\n\t// todo@rebornix is there a reason that `super.fireOnDidFocus` isn't used?\n\tprivate readonly _onDidFocusWidget = this._register(new Emitter<void>());\n\toverride get onDidFocus(): Event<void> { return this._onDidFocusWidget.event; }\n\n\tprivate readonly _onDidChangeModel = this._register(new Emitter<void>());\n\treadonly onDidChangeModel: Event<void> = this._onDidChangeModel.event;\n\n\tconstructor(\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IEditorDropService private readonly _editorDropService: IEditorDropService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@INotebookEditorService private readonly _notebookWidgetService: INotebookEditorService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t) {\n\t\tsuper(NotebookEditor.ID, telemetryService, themeService, storageService);\n\t\tthis._editorMemento = this.getEditorMemento<INotebookEditorViewState>(_editorGroupService, NOTEBOOK_EDITOR_VIEW_STATE_PREFERENCE_KEY);\n\n\t\tthis._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e => this.onDidFileSystemProviderChange(e.scheme)));\n\t\tthis._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e => this.onDidFileSystemProviderChange(e.scheme)));\n\t}\n\n\tprivate onDidFileSystemProviderChange(scheme: string): void {\n\t\tif (this.input?.resource?.scheme === scheme && this._widget.value) {\n\t\t\tthis._widget.value.setOptions(new NotebookEditorOptions({ isReadOnly: this.input.isReadonly() }));\n\t\t}\n\t}\n\n\tget viewModel(): NotebookViewModel | undefined {\n\t\treturn this._widget.value?.viewModel;\n\t}\n\n\toverride get minimumWidth(): number { return 375; }\n\toverride get maximumWidth(): number { return Number.POSITIVE_INFINITY; }\n\n\t// these setters need to exist because this extends from EditorPane\n\toverride set minimumWidth(value: number) { /*noop*/ }\n\toverride set maximumWidth(value: number) { /*noop*/ }\n\n\t//#region Editor Core\n\toverride get scopedContextKeyService(): IContextKeyService | undefined {\n\t\treturn this._widget.value?.scopedContextKeyService;\n\t}\n\n\tprotected createEditor(parent: HTMLElement): void {\n\t\tthis._rootElement = DOM.append(parent, DOM.$('.notebook-editor'));\n\n\t\t// this._widget.createEditor();\n\t\tthis._register(this.onDidFocus(() => this._widget.value?.updateEditorFocus()));\n\t\tthis._register(this.onDidBlur(() => this._widget.value?.updateEditorFocus()));\n\t}\n\n\tgetDomNode() {\n\t\treturn this._rootElement;\n\t}\n\n\toverride getControl(): NotebookEditorWidget | undefined {\n\t\treturn this._widget.value;\n\t}\n\n\toverride setEditorVisible(visible: boolean, group: IEditorGroup | undefined): void {\n\t\tsuper.setEditorVisible(visible, group);\n\t\tif (group) {\n\t\t\tthis._groupListener.clear();\n\t\t\tthis._groupListener.add(group.onWillCloseEditor(e => this._saveEditorViewState(e.editor)));\n\t\t\tthis._groupListener.add(group.onDidGroupChange(() => {\n\t\t\t\tif (this._editorGroupService.activeGroup !== group) {\n\t\t\t\t\tthis._widget?.value?.updateEditorFocus();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tif (!visible) {\n\t\t\tthis._saveEditorViewState(this.input);\n\t\t\tif (this.input && this._widget.value) {\n\t\t\t\t// the widget is not transfered to other editor inputs\n\t\t\t\tthis._widget.value.onWillHide();\n\t\t\t}\n\t\t}\n\t}\n\n\toverride focus() {\n\t\tsuper.focus();\n\t\tthis._widget.value?.focus();\n\t}\n\n\toverride hasFocus(): boolean {\n\t\tconst activeElement = document.activeElement;\n\t\tconst value = this._widget.value;\n\n\t\treturn !!value && (DOM.isAncestor(activeElement, value.getDomNode() || DOM.isAncestor(activeElement, value.getOverflowContainerDomNode())));\n\t}\n\n\toverride async setInput(input: NotebookEditorInput, options: EditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken): Promise<void> {\n\t\tclearMarks(input.resource);\n\t\tmark(input.resource, 'startTime');\n\t\tconst group = this.group!;\n\n\t\tthis._saveEditorViewState(this.input);\n\n\t\tthis._widgetDisposableStore.clear();\n\n\t\t// there currently is a widget which we still own so\n\t\t// we need to hide it before getting a new widget\n\t\tif (this._widget.value) {\n\t\t\tthis._widget.value.onWillHide();\n\t\t}\n\n\t\tthis._widget = this.instantiationService.invokeFunction(this._notebookWidgetService.retrieveWidget, group, input);\n\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidChangeModel(() => this._onDidChangeModel.fire()));\n\n\t\tif (this._dimension) {\n\t\t\tthis._widget.value!.layout(this._dimension, this._rootElement);\n\t\t}\n\n\t\t// only now `setInput` and yield/await. this is AFTER the actual widget is ready. This is very important\n\t\t// so that others synchronously receive a notebook editor with the correct widget being set\n\t\tawait super.setInput(input, options, context, token);\n\t\tconst model = await input.resolve();\n\t\tmark(input.resource, 'inputLoaded');\n\n\t\t// Check for cancellation\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (model === null) {\n\t\t\tthis._notificationService.prompt(\n\t\t\t\tSeverity.Error,\n\t\t\t\tlocalize('fail.noEditor', \"Cannot open resource with notebook editor type '{0}', please check if you have the right extension installed or enabled.\", input.viewType),\n\t\t\t\t[{\n\t\t\t\t\tlabel: localize('fail.reOpen', \"Reopen file with VS Code standard text editor\"),\n\t\t\t\t\trun: async () => {\n\t\t\t\t\t\tawait this._editorService.openEditor({ resource: input.resource, forceFile: true, options: { ...options, override: EditorOverride.DISABLED } });\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\n\n\t\tconst viewState = this._loadNotebookEditorViewState(input);\n\n\t\tthis._widget.value?.setParentContextKeyService(this._contextKeyService);\n\t\tawait this._widget.value!.setModel(model.notebook, viewState);\n\t\tconst isReadonly = input.isReadonly();\n\t\tawait this._widget.value!.setOptions(options instanceof NotebookEditorOptions ? options.with({ isReadOnly: isReadonly }) : new NotebookEditorOptions({ isReadOnly: isReadonly }));\n\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidFocus(() => this._onDidFocusWidget.fire()));\n\n\t\tthis._widgetDisposableStore.add(this._editorDropService.createEditorDropTarget(this._widget.value!.getDomNode(), {\n\t\t\tcontainsGroup: (group) => this.group?.id === group.id\n\t\t}));\n\n\t\tmark(input.resource, 'editorLoaded');\n\n\t\ttype WorkbenchNotebookOpenClassification = {\n\t\t\tscheme: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\text: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\tviewType: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\textensionActivated: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\tinputLoaded: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\twebviewCommLoaded: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\tcustomMarkdownLoaded: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\teditorLoaded: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t};\n\n\t\ttype WorkbenchNotebookOpenEvent = {\n\t\t\tscheme: string;\n\t\t\text: string;\n\t\t\tviewType: string;\n\t\t\textensionActivated: number;\n\t\t\tinputLoaded: number;\n\t\t\twebviewCommLoaded: number;\n\t\t\tcustomMarkdownLoaded: number;\n\t\t\teditorLoaded: number;\n\t\t};\n\n\t\tconst perfMarks = getAndClearMarks(input.resource);\n\n\t\tif (perfMarks) {\n\t\t\tconst startTime = perfMarks['startTime'];\n\t\t\tconst extensionActivated = perfMarks['extensionActivated'];\n\t\t\tconst inputLoaded = perfMarks['inputLoaded'];\n\t\t\tconst webviewCommLoaded = perfMarks['webviewCommLoaded'];\n\t\t\tconst customMarkdownLoaded = perfMarks['customMarkdownLoaded'];\n\t\t\tconst editorLoaded = perfMarks['editorLoaded'];\n\n\t\t\tif (\n\t\t\t\tstartTime !== undefined\n\t\t\t\t&& extensionActivated !== undefined\n\t\t\t\t&& inputLoaded !== undefined\n\t\t\t\t&& webviewCommLoaded !== undefined\n\t\t\t\t&& customMarkdownLoaded !== undefined\n\t\t\t\t&& editorLoaded !== undefined\n\t\t\t) {\n\t\t\t\tthis.telemetryService.publicLog2<WorkbenchNotebookOpenEvent, WorkbenchNotebookOpenClassification>('notebook/editorOpenPerf', {\n\t\t\t\t\tscheme: model.notebook.uri.scheme,\n\t\t\t\t\text: extname(model.notebook.uri),\n\t\t\t\t\tviewType: model.notebook.viewType,\n\t\t\t\t\textensionActivated: extensionActivated - startTime,\n\t\t\t\t\tinputLoaded: inputLoaded - startTime,\n\t\t\t\t\twebviewCommLoaded: webviewCommLoaded - startTime,\n\t\t\t\t\tcustomMarkdownLoaded: customMarkdownLoaded - startTime,\n\t\t\t\t\teditorLoaded: editorLoaded - startTime\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\toverride clearInput(): void {\n\t\tif (this._widget.value) {\n\t\t\tthis._saveEditorViewState(this.input);\n\t\t\tthis._widget.value.onWillHide();\n\t\t}\n\t\tsuper.clearInput();\n\t}\n\n\toverride setOptions(options: EditorOptions | undefined): void {\n\t\tif (options instanceof NotebookEditorOptions) {\n\t\t\tthis._widget.value?.setOptions(options);\n\t\t}\n\t\tsuper.setOptions(options);\n\t}\n\n\tprotected override saveState(): void {\n\t\tthis._saveEditorViewState(this.input);\n\t\tsuper.saveState();\n\t}\n\n\tprivate _saveEditorViewState(input: IEditorInput | undefined): void {\n\t\tif (this.group && this._widget.value && input instanceof NotebookEditorInput) {\n\t\t\tif (this._widget.value.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = this._widget.value.getEditorViewState();\n\t\t\tthis._editorMemento.saveEditorState(this.group, input.resource, state);\n\t\t}\n\t}\n\n\tprivate _loadNotebookEditorViewState(input: NotebookEditorInput): INotebookEditorViewState | undefined {\n\t\tlet result: INotebookEditorViewState | undefined;\n\t\tif (this.group) {\n\t\t\tresult = this._editorMemento.loadEditorState(this.group, input.resource);\n\t\t}\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\t// when we don't have a view state for the group/input-tuple then we try to use an existing\n\t\t// editor for the same resource.\n\t\tfor (const group of this._editorGroupService.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tif (group.activeEditorPane !== this && group.activeEditorPane instanceof NotebookEditor && group.activeEditor?.matches(input)) {\n\t\t\t\treturn group.activeEditorPane._widget.value?.getEditorViewState();\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tlayout(dimension: DOM.Dimension): void {\n\t\tthis._rootElement.classList.toggle('mid-width', dimension.width < 1000 && dimension.width >= 600);\n\t\tthis._rootElement.classList.toggle('narrow-width', dimension.width < 600);\n\t\tthis._dimension = dimension;\n\n\t\tif (!this._widget.value || !(this._input instanceof NotebookEditorInput)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._input.resource.toString() !== this._widget.value.viewModel?.uri.toString() && this._widget.value?.viewModel) {\n\t\t\t// input and widget mismatch\n\t\t\t// this happens when\n\t\t\t// 1. open document A, pin the document\n\t\t\t// 2. open document B\n\t\t\t// 3. close document B\n\t\t\t// 4. a layout is triggered\n\t\t\treturn;\n\t\t}\n\n\t\tthis._widget.value.layout(this._dimension, this._rootElement);\n\t}\n\n\t//#endregion\n\n\t//#region Editor Features\n\n\t//#endregion\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t}\n\n\t// toJSON(): object {\n\t// \treturn {\n\t// \t\tnotebookHandle: this.viewModel?.handle\n\t// \t};\n\t// }\n}\n"]}