{"version":3,"file":"cellContextKeys.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/browser/view/renderers/cellContextKeys.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { NotebookCellExecutionState } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { NOTEBOOK_CELL_TYPE, NOTEBOOK_VIEW_TYPE, NOTEBOOK_CELL_EDITABLE, NOTEBOOK_CELL_MARKDOWN_EDIT_MODE, NOTEBOOK_CELL_EXECUTION_STATE, NOTEBOOK_CELL_HAS_OUTPUTS, CellViewModelStateChangeEvent, CellEditState, NOTEBOOK_CELL_INPUT_COLLAPSED, NOTEBOOK_CELL_OUTPUT_COLLAPSED, NOTEBOOK_CELL_FOCUSED, INotebookEditor, NOTEBOOK_CELL_EDITOR_FOCUSED, CellFocusMode, NotebookCellExecutionStateContext, NOTEBOOK_CELL_LINE_NUMBERS } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CodeCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel';\nimport { MarkdownCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/markdownCellViewModel';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\n\nexport class CellContextKeyManager extends Disposable {\n\n\tprivate cellType!: IContextKey<string>;\n\tprivate viewType!: IContextKey<string>;\n\tprivate cellEditable!: IContextKey<boolean>;\n\tprivate cellFocused!: IContextKey<boolean>;\n\tprivate cellEditorFocused!: IContextKey<boolean>;\n\tprivate cellRunState!: IContextKey<NotebookCellExecutionStateContext>;\n\tprivate cellHasOutputs!: IContextKey<boolean>;\n\tprivate cellContentCollapsed!: IContextKey<boolean>;\n\tprivate cellOutputCollapsed!: IContextKey<boolean>;\n\tprivate cellLineNumbers!: IContextKey<'on' | 'off' | 'inherit'>;\n\n\tprivate markdownEditMode!: IContextKey<boolean>;\n\n\tprivate readonly elementDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly contextKeyService: IContextKeyService,\n\t\tprivate readonly notebookEditor: INotebookEditor,\n\t\tprivate element: CodeCellViewModel | MarkdownCellViewModel\n\t) {\n\t\tsuper();\n\n\t\tthis.contextKeyService.bufferChangeEvents(() => {\n\t\t\tthis.cellType = NOTEBOOK_CELL_TYPE.bindTo(this.contextKeyService);\n\t\t\tthis.viewType = NOTEBOOK_VIEW_TYPE.bindTo(this.contextKeyService);\n\t\t\tthis.cellEditable = NOTEBOOK_CELL_EDITABLE.bindTo(this.contextKeyService);\n\t\t\tthis.cellFocused = NOTEBOOK_CELL_FOCUSED.bindTo(this.contextKeyService);\n\t\t\tthis.cellEditorFocused = NOTEBOOK_CELL_EDITOR_FOCUSED.bindTo(this.contextKeyService);\n\t\t\tthis.markdownEditMode = NOTEBOOK_CELL_MARKDOWN_EDIT_MODE.bindTo(this.contextKeyService);\n\t\t\tthis.cellRunState = NOTEBOOK_CELL_EXECUTION_STATE.bindTo(this.contextKeyService);\n\t\t\tthis.cellHasOutputs = NOTEBOOK_CELL_HAS_OUTPUTS.bindTo(this.contextKeyService);\n\t\t\tthis.cellContentCollapsed = NOTEBOOK_CELL_INPUT_COLLAPSED.bindTo(this.contextKeyService);\n\t\t\tthis.cellOutputCollapsed = NOTEBOOK_CELL_OUTPUT_COLLAPSED.bindTo(this.contextKeyService);\n\t\t\tthis.cellLineNumbers = NOTEBOOK_CELL_LINE_NUMBERS.bindTo(this.contextKeyService);\n\n\t\t\tthis.updateForElement(element);\n\t\t});\n\t}\n\n\tpublic updateForElement(element: MarkdownCellViewModel | CodeCellViewModel) {\n\t\tthis.elementDisposables.clear();\n\t\tthis.elementDisposables.add(element.onDidChangeState(e => this.onDidChangeState(e)));\n\n\t\tif (element instanceof CodeCellViewModel) {\n\t\t\tthis.elementDisposables.add(element.onDidChangeOutputs(() => this.updateForOutputs()));\n\t\t}\n\n\t\tthis.elementDisposables.add(element.model.onDidChangeMetadata(() => this.updateForCollapseState()));\n\t\tthis.elementDisposables.add(this.notebookEditor.onDidChangeActiveCell(() => this.updateForFocusState()));\n\n\t\tthis.element = element;\n\t\tif (this.element instanceof MarkdownCellViewModel) {\n\t\t\tthis.cellType.set('markdown');\n\t\t} else if (this.element instanceof CodeCellViewModel) {\n\t\t\tthis.cellType.set('code');\n\t\t}\n\n\t\tthis.contextKeyService.bufferChangeEvents(() => {\n\t\t\tthis.updateForFocusState();\n\t\t\tthis.updateForMetadata();\n\t\t\tthis.updateForEditState();\n\t\t\tthis.updateForCollapseState();\n\t\t\tthis.updateForOutputs();\n\n\t\t\tthis.viewType.set(this.element.viewType);\n\t\t\tthis.cellLineNumbers.set(this.element.lineNumbers);\n\t\t});\n\t}\n\n\tprivate onDidChangeState(e: CellViewModelStateChangeEvent) {\n\t\tthis.contextKeyService.bufferChangeEvents(() => {\n\t\t\tif (e.metadataChanged) {\n\t\t\t\tthis.updateForMetadata();\n\t\t\t}\n\n\t\t\tif (e.editStateChanged) {\n\t\t\t\tthis.updateForEditState();\n\t\t\t}\n\n\t\t\tif (e.focusModeChanged) {\n\t\t\t\tthis.updateForFocusState();\n\t\t\t}\n\n\t\t\tif (e.cellLineNumberChanged) {\n\t\t\t\tthis.cellLineNumbers.set(this.element.lineNumbers);\n\t\t\t}\n\n\t\t\t// if (e.collapseStateChanged) {\n\t\t\t// \tthis.updateForCollapseState();\n\t\t\t// }\n\t\t});\n\t}\n\n\tprivate updateForFocusState() {\n\t\tconst activeCell = this.notebookEditor.getActiveCell();\n\t\tthis.cellFocused.set(this.notebookEditor.getActiveCell() === this.element);\n\n\t\tif (activeCell === this.element) {\n\t\t\tthis.cellEditorFocused.set(this.element.focusMode === CellFocusMode.Editor);\n\t\t} else {\n\t\t\tthis.cellEditorFocused.set(false);\n\t\t}\n\n\t}\n\n\tprivate updateForMetadata() {\n\t\tconst metadata = this.element.metadata;\n\t\tthis.cellEditable.set(!this.notebookEditor.viewModel?.options.isReadOnly);\n\n\t\tconst runState = metadata.runState ?? NotebookCellExecutionState.Idle;\n\t\tif (runState === NotebookCellExecutionState.Idle) {\n\t\t\tif (metadata.lastRunSuccess === true) {\n\t\t\t\tthis.cellRunState.set('succeeded');\n\t\t\t} else if (metadata.lastRunSuccess === false) {\n\t\t\t\tthis.cellRunState.set('failed');\n\t\t\t} else {\n\t\t\t\tthis.cellRunState.set('idle');\n\t\t\t}\n\t\t} else if (runState === NotebookCellExecutionState.Executing) {\n\t\t\tthis.cellRunState.set('executing');\n\t\t} else if (runState === NotebookCellExecutionState.Pending) {\n\t\t\tthis.cellRunState.set('pending');\n\t\t}\n\t}\n\n\tprivate updateForEditState() {\n\t\tif (this.element instanceof MarkdownCellViewModel) {\n\t\t\tthis.markdownEditMode.set(this.element.getEditState() === CellEditState.Editing);\n\t\t} else {\n\t\t\tthis.markdownEditMode.set(false);\n\t\t}\n\t}\n\n\tprivate updateForCollapseState() {\n\t\tthis.cellContentCollapsed.set(!!this.element.metadata?.inputCollapsed);\n\t\tthis.cellOutputCollapsed.set(!!this.element.metadata?.outputCollapsed);\n\t}\n\n\tprivate updateForOutputs() {\n\t\tif (this.element instanceof CodeCellViewModel) {\n\t\t\tthis.cellHasOutputs.set(this.element.outputsViewModels.length > 0);\n\t\t} else {\n\t\t\tthis.cellHasOutputs.set(false);\n\t\t}\n\t}\n}\n"]}