{"version":3,"sources":["vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts"],"names":[],"mappings":"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","file":"cellRenderer.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as Codicons from 'vs/base/common/codicons';\nimport { getPixelRatio, getZoomLevel } from 'vs/base/browser/browser';\nimport * as DOM from 'vs/base/browser/dom';\nimport * as aria from 'vs/base/browser/ui/aria/aria';\nimport { domEvent } from 'vs/base/browser/event';\nimport { renderIcon } from 'vs/base/browser/ui/iconLabel/iconLabels';\nimport { IListRenderer, IListVirtualDelegate } from 'vs/base/browser/ui/list/list';\nimport { ProgressBar } from 'vs/base/browser/ui/progressbar/progressbar';\nimport { ToolBar } from 'vs/base/browser/ui/toolbar/toolbar';\nimport { IAction } from 'vs/base/common/actions';\nimport { Color } from 'vs/base/common/color';\nimport { combinedDisposable, Disposable, DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport * as platform from 'vs/base/common/platform';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\nimport { EditorOption, IEditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { BareFontInfo } from 'vs/editor/common/config/fontInfo';\nimport { Range } from 'vs/editor/common/core/range';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { ITextModel } from 'vs/editor/common/model';\nimport * as modes from 'vs/editor/common/modes';\nimport { tokenizeLineToHTML } from 'vs/editor/common/modes/textToHtmlTokenizer';\nimport { localize } from 'vs/nls';\nimport { createActionViewItem } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { IMenu, MenuItemAction } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { BOTTOM_CELL_TOOLBAR_GAP, CELL_BOTTOM_MARGIN, CELL_TOP_MARGIN, EDITOR_TOOLBAR_HEIGHT } from 'vs/workbench/contrib/notebook/browser/constants';\nimport { DeleteCellAction, INotebookActionContext, INotebookCellActionContext } from 'vs/workbench/contrib/notebook/browser/contrib/coreActions';\nimport { BaseCellRenderTemplate, CellEditState, CodeCellLayoutInfo, CodeCellRenderTemplate, EXPAND_CELL_INPUT_COMMAND_ID, ICellViewModel, INotebookEditor, isCodeCellRenderTemplate, MarkdownCellRenderTemplate } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CellContextKeyManager } from 'vs/workbench/contrib/notebook/browser/view/renderers/cellContextKeys';\nimport { CellDragAndDropController, DRAGGING_CLASS } from 'vs/workbench/contrib/notebook/browser/view/renderers/cellDnd';\nimport { CellMenus } from 'vs/workbench/contrib/notebook/browser/view/renderers/cellMenus';\nimport { CellEditorStatusBar } from 'vs/workbench/contrib/notebook/browser/view/renderers/cellWidgets';\nimport { CodeCell } from 'vs/workbench/contrib/notebook/browser/view/renderers/codeCell';\nimport { StatefulMarkdownCell } from 'vs/workbench/contrib/notebook/browser/view/renderers/markdownCell';\nimport { CodeCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel';\nimport { MarkdownCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/markdownCellViewModel';\nimport { CellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/notebookViewModel';\nimport { CellEditType, CellKind, NotebookCellMetadata, NotebookCellExecutionState, NotebookCellsChangeType } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { CodiconActionViewItem, createAndFillInActionBarActionsWithVerticalSeparators, VerticalSeparator, VerticalSeparatorViewItem } from './cellActionView';\nimport { ThemeIcon } from 'vs/platform/theme/common/themeService';\nimport { errorStateIcon, successStateIcon, unfoldIcon } from 'vs/workbench/contrib/notebook/browser/notebookIcons';\nimport { syncing } from 'vs/platform/theme/common/iconRegistry';\nimport { CellEditorOptions } from 'vs/workbench/contrib/notebook/browser/view/renderers/cellEditorOptions';\n\nconst $ = DOM.$;\n\nexport class NotebookCellListDelegate implements IListVirtualDelegate<CellViewModel> {\n\tprivate readonly lineHeight: number;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tconst editorOptions = this.configurationService.getValue<IEditorOptions>('editor');\n\t\tthis.lineHeight = BareFontInfo.createFromRawSettings(editorOptions, getZoomLevel(), getPixelRatio()).lineHeight;\n\t}\n\n\tgetHeight(element: CellViewModel): number {\n\t\treturn element.getHeight(this.lineHeight);\n\t}\n\n\thasDynamicHeight(element: CellViewModel): boolean {\n\t\treturn element.hasDynamicHeight();\n\t}\n\n\tgetTemplateId(element: CellViewModel): string {\n\t\tif (element.cellKind === CellKind.Markdown) {\n\t\t\treturn MarkdownCellRenderer.TEMPLATE_ID;\n\t\t} else {\n\t\t\treturn CodeCellRenderer.TEMPLATE_ID;\n\t\t}\n\t}\n}\n\nabstract class AbstractCellRenderer {\n\tprotected readonly editorOptions: CellEditorOptions;\n\tprotected readonly cellMenus: CellMenus;\n\n\tconstructor(\n\t\tprotected readonly instantiationService: IInstantiationService,\n\t\tprotected readonly notebookEditor: INotebookEditor,\n\t\tprotected readonly contextMenuService: IContextMenuService,\n\t\tconfigurationService: IConfigurationService,\n\t\tprivate readonly keybindingService: IKeybindingService,\n\t\tprivate readonly notificationService: INotificationService,\n\t\tprotected readonly contextKeyServiceProvider: (container: HTMLElement) => IContextKeyService,\n\t\tlanguage: string,\n\t\tprotected readonly dndController: CellDragAndDropController\n\t) {\n\t\tthis.editorOptions = new CellEditorOptions(configurationService, language);\n\t\tthis.cellMenus = this.instantiationService.createInstance(CellMenus);\n\t}\n\n\tdispose() {\n\t\tthis.editorOptions.dispose();\n\t}\n\n\tprotected createBetweenCellToolbar(container: HTMLElement, disposables: DisposableStore, contextKeyService: IContextKeyService): ToolBar {\n\t\tconst toolbar = new ToolBar(container, this.contextMenuService, {\n\t\t\tactionViewItemProvider: action => {\n\t\t\t\tif (action instanceof MenuItemAction) {\n\t\t\t\t\tconst item = new CodiconActionViewItem(action, this.keybindingService, this.notificationService);\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\tconst cellMenu = this.instantiationService.createInstance(CellMenus);\n\t\tconst menu = disposables.add(cellMenu.getCellInsertionMenu(contextKeyService));\n\t\tconst updateActions = () => {\n\t\t\tconst actions = this.getCellToolbarActions(menu, false);\n\t\t\ttoolbar.setActions(actions.primary, actions.secondary);\n\t\t};\n\n\t\tdisposables.add(menu.onDidChange(() => updateActions()));\n\t\tupdateActions();\n\n\t\treturn toolbar;\n\t}\n\n\tprotected setBetweenCellToolbarContext(templateData: BaseCellRenderTemplate, element: CodeCellViewModel | MarkdownCellViewModel, context: INotebookCellActionContext): void {\n\t\ttemplateData.betweenCellToolbar.context = context;\n\n\t\tconst container = templateData.bottomCellContainer;\n\t\tconst bottomToolbarOffset = element.layoutInfo.bottomToolbarOffset;\n\t\tcontainer.style.top = `${bottomToolbarOffset}px`;\n\n\t\ttemplateData.elementDisposables.add(element.onDidChangeLayout(() => {\n\t\t\tconst bottomToolbarOffset = element.layoutInfo.bottomToolbarOffset;\n\t\t\tcontainer.style.top = `${bottomToolbarOffset}px`;\n\t\t}));\n\t}\n\n\tprotected createToolbar(container: HTMLElement, elementClass?: string): ToolBar {\n\t\tconst toolbar = new ToolBar(container, this.contextMenuService, {\n\t\t\tgetKeyBinding: action => this.keybindingService.lookupKeybinding(action.id),\n\t\t\tactionViewItemProvider: action => {\n\t\t\t\tif (action.id === VerticalSeparator.ID) {\n\t\t\t\t\treturn new VerticalSeparatorViewItem(undefined, action);\n\t\t\t\t}\n\t\t\t\treturn createActionViewItem(this.instantiationService, action);\n\t\t\t},\n\t\t\trenderDropdownAsChildElement: true\n\t\t});\n\n\t\tif (elementClass) {\n\t\t\ttoolbar.getElement().classList.add(elementClass);\n\t\t}\n\n\t\treturn toolbar;\n\t}\n\n\tprotected getCellToolbarActions(menu: IMenu, alwaysFillSecondaryActions: boolean): { primary: IAction[], secondary: IAction[] } {\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\n\t\tcreateAndFillInActionBarActionsWithVerticalSeparators(menu, { shouldForwardArgs: true }, result, alwaysFillSecondaryActions, g => /^inline/.test(g));\n\n\t\treturn result;\n\t}\n\n\tprotected setupCellToolbarActions(templateData: BaseCellRenderTemplate, disposables: DisposableStore): void {\n\t\tconst updateActions = () => {\n\t\t\tconst actions = this.getCellToolbarActions(templateData.titleMenu, true);\n\n\t\t\tconst hadFocus = DOM.isAncestor(document.activeElement, templateData.toolbar.getElement());\n\t\t\ttemplateData.toolbar.setActions(actions.primary, actions.secondary);\n\t\t\tif (hadFocus) {\n\t\t\t\tthis.notebookEditor.focus();\n\t\t\t}\n\n\t\t\tif (actions.primary.length || actions.secondary.length) {\n\t\t\t\ttemplateData.container.classList.add('cell-has-toolbar-actions');\n\t\t\t\tif (isCodeCellRenderTemplate(templateData)) {\n\t\t\t\t\ttemplateData.focusIndicatorLeft.style.top = `${EDITOR_TOOLBAR_HEIGHT + CELL_TOP_MARGIN}px`;\n\t\t\t\t\ttemplateData.focusIndicatorRight.style.top = `${EDITOR_TOOLBAR_HEIGHT + CELL_TOP_MARGIN}px`;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttemplateData.container.classList.remove('cell-has-toolbar-actions');\n\t\t\t\tif (isCodeCellRenderTemplate(templateData)) {\n\t\t\t\t\ttemplateData.focusIndicatorLeft.style.top = `${CELL_TOP_MARGIN}px`;\n\t\t\t\t\ttemplateData.focusIndicatorRight.style.top = `${CELL_TOP_MARGIN}px`;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// #103926\n\t\tlet dropdownIsVisible = false;\n\t\tlet deferredUpdate: (() => void) | undefined;\n\n\t\tupdateActions();\n\t\tdisposables.add(templateData.titleMenu.onDidChange(() => {\n\t\t\tif (this.notebookEditor.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (dropdownIsVisible) {\n\t\t\t\tdeferredUpdate = () => updateActions();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateActions();\n\t\t}));\n\t\ttemplateData.container.classList.toggle('cell-toolbar-dropdown-active', false);\n\t\tdisposables.add(templateData.toolbar.onDidChangeDropdownVisibility(visible => {\n\t\t\tdropdownIsVisible = visible;\n\t\t\ttemplateData.container.classList.toggle('cell-toolbar-dropdown-active', visible);\n\n\t\t\tif (deferredUpdate && !visible) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (deferredUpdate) {\n\t\t\t\t\t\tdeferredUpdate();\n\t\t\t\t\t}\n\t\t\t\t}, 0);\n\t\t\t\tdeferredUpdate = undefined;\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected commonRenderTemplate(templateData: BaseCellRenderTemplate): void {\n\t\ttemplateData.disposables.add(DOM.addDisposableListener(templateData.container, DOM.EventType.FOCUS, () => {\n\t\t\tif (templateData.currentRenderedCell) {\n\t\t\t\tthis.notebookEditor.focusElement(templateData.currentRenderedCell);\n\t\t\t}\n\t\t}, true));\n\n\t\tthis.addExpandListener(templateData);\n\t}\n\n\tprotected commonRenderElement(element: ICellViewModel, templateData: BaseCellRenderTemplate): void {\n\t\tif (element.dragging) {\n\t\t\ttemplateData.container.classList.add(DRAGGING_CLASS);\n\t\t} else {\n\t\t\ttemplateData.container.classList.remove(DRAGGING_CLASS);\n\t\t}\n\t}\n\n\tprotected addExpandListener(templateData: BaseCellRenderTemplate): void {\n\t\ttemplateData.disposables.add(domEvent(templateData.expandButton, DOM.EventType.CLICK)(() => {\n\t\t\tif (!templateData.currentRenderedCell) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst textModel = this.notebookEditor.viewModel!.notebookDocument;\n\t\t\tconst index = textModel.cells.indexOf(templateData.currentRenderedCell.model);\n\n\t\t\tif (index < 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (templateData.currentRenderedCell.metadata?.inputCollapsed) {\n\t\t\t\ttextModel.applyEdits([\n\t\t\t\t\t{ editType: CellEditType.Metadata, index, metadata: { ...templateData.currentRenderedCell.metadata, inputCollapsed: false } }\n\t\t\t\t], true, undefined, () => undefined, undefined);\n\t\t\t} else if (templateData.currentRenderedCell.metadata?.outputCollapsed) {\n\t\t\t\ttextModel.applyEdits([\n\t\t\t\t\t{ editType: CellEditType.Metadata, index, metadata: { ...templateData.currentRenderedCell.metadata, outputCollapsed: false } }\n\t\t\t\t], true, undefined, () => undefined, undefined);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected setupCollapsedPart(container: HTMLElement): { collapsedPart: HTMLElement, expandButton: HTMLElement } {\n\t\tconst collapsedPart = DOM.append(container, $('.cell.cell-collapsed-part', undefined, $('span.expandButton' + ThemeIcon.asCSSSelector(unfoldIcon))));\n\t\tconst expandButton = collapsedPart.querySelector('.expandButton') as HTMLElement;\n\t\tconst keybinding = this.keybindingService.lookupKeybinding(EXPAND_CELL_INPUT_COMMAND_ID);\n\t\tlet title = localize('cellExpandButtonLabel', \"Expand\");\n\t\tif (keybinding) {\n\t\t\ttitle += ` (${keybinding.getLabel()})`;\n\t\t}\n\n\t\tcollapsedPart.title = title;\n\t\tDOM.hide(collapsedPart);\n\n\t\treturn { collapsedPart, expandButton };\n\t}\n}\n\nexport class MarkdownCellRenderer extends AbstractCellRenderer implements IListRenderer<MarkdownCellViewModel, MarkdownCellRenderTemplate> {\n\tstatic readonly TEMPLATE_ID = 'markdown_cell';\n\n\tprivate readonly useRenderer: boolean;\n\n\tconstructor(\n\t\tnotebookEditor: INotebookEditor,\n\t\tdndController: CellDragAndDropController,\n\t\tprivate renderedEditors: Map<ICellViewModel, ICodeEditor | undefined>,\n\t\tcontextKeyServiceProvider: (container: HTMLElement) => IContextKeyService,\n\t\toptions: { useRenderer: boolean },\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@INotificationService notificationService: INotificationService,\n\t) {\n\t\tsuper(instantiationService, notebookEditor, contextMenuService, configurationService, keybindingService, notificationService, contextKeyServiceProvider, 'markdown', dndController);\n\t\tthis.useRenderer = options.useRenderer;\n\t}\n\n\tget templateId() {\n\t\treturn MarkdownCellRenderer.TEMPLATE_ID;\n\t}\n\n\trenderTemplate(rootContainer: HTMLElement): MarkdownCellRenderTemplate {\n\t\trootContainer.classList.add('markdown-cell-row');\n\t\tconst container = DOM.append(rootContainer, DOM.$('.cell-inner-container'));\n\t\tconst disposables = new DisposableStore();\n\t\tconst contextKeyService = disposables.add(this.contextKeyServiceProvider(container));\n\t\tconst decorationContainer = DOM.append(rootContainer, $('.cell-decoration'));\n\t\tconst titleToolbarContainer = DOM.append(container, $('.cell-title-toolbar'));\n\t\tconst toolbar = disposables.add(this.createToolbar(titleToolbarContainer));\n\t\tconst deleteToolbar = disposables.add(this.createToolbar(titleToolbarContainer, 'cell-delete-toolbar'));\n\t\tdeleteToolbar.setActions([this.instantiationService.createInstance(DeleteCellAction)]);\n\n\t\tDOM.append(container, $('.cell-focus-indicator.cell-focus-indicator-top'));\n\t\tconst focusIndicatorLeft = DOM.append(container, DOM.$('.cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left'));\n\t\tconst focusIndicatorRight = DOM.append(container, DOM.$('.cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right'));\n\n\t\tconst codeInnerContent = DOM.append(container, $('.cell.code'));\n\t\tconst editorPart = DOM.append(codeInnerContent, $('.cell-editor-part'));\n\t\tconst editorContainer = DOM.append(editorPart, $('.cell-editor-container'));\n\t\teditorPart.style.display = 'none';\n\n\t\tconst innerContent = DOM.append(container, $('.cell.markdown'));\n\t\tconst foldingIndicator = DOM.append(focusIndicatorLeft, DOM.$('.notebook-folding-indicator'));\n\n\t\tconst { collapsedPart, expandButton } = this.setupCollapsedPart(container);\n\n\t\tconst bottomCellContainer = DOM.append(container, $('.cell-bottom-toolbar-container'));\n\t\tconst betweenCellToolbar = disposables.add(this.createBetweenCellToolbar(bottomCellContainer, disposables, contextKeyService));\n\t\tconst focusIndicatorBottom = DOM.append(container, $('.cell-focus-indicator.cell-focus-indicator-bottom'));\n\n\t\tconst statusBar = disposables.add(this.instantiationService.createInstance(CellEditorStatusBar, editorPart));\n\n\t\tconst titleMenu = disposables.add(this.cellMenus.getCellTitleMenu(contextKeyService));\n\n\t\tconst templateData: MarkdownCellRenderTemplate = {\n\t\t\tuseRenderer: this.useRenderer,\n\t\t\trootContainer,\n\t\t\tcollapsedPart,\n\t\t\texpandButton,\n\t\t\tcontextKeyService,\n\t\t\tcontainer,\n\t\t\tdecorationContainer,\n\t\t\tcellContainer: innerContent,\n\t\t\teditorPart,\n\t\t\teditorContainer,\n\t\t\tfocusIndicatorLeft,\n\t\t\tfocusIndicatorBottom,\n\t\t\tfocusIndicatorRight,\n\t\t\tfoldingIndicator,\n\t\t\tdisposables,\n\t\t\telementDisposables: new DisposableStore(),\n\t\t\ttoolbar,\n\t\t\tdeleteToolbar,\n\t\t\tbetweenCellToolbar,\n\t\t\tbottomCellContainer,\n\t\t\ttitleMenu,\n\t\t\tstatusBar,\n\t\t\ttoJSON: () => { return {}; }\n\t\t};\n\n\t\tif (!this.useRenderer) {\n\t\t\tthis.dndController.registerDragHandle(templateData, rootContainer, container, () => this.getDragImage(templateData));\n\t\t}\n\n\t\tthis.commonRenderTemplate(templateData);\n\n\t\treturn templateData;\n\t}\n\n\tprivate getDragImage(templateData: MarkdownCellRenderTemplate): HTMLElement {\n\t\tif (templateData.currentRenderedCell?.getEditState() === CellEditState.Editing) {\n\t\t\treturn this.getEditDragImage(templateData);\n\t\t} else {\n\t\t\treturn this.getMarkdownDragImage(templateData);\n\t\t}\n\t}\n\n\tprivate getMarkdownDragImage(templateData: MarkdownCellRenderTemplate): HTMLElement {\n\t\tconst dragImageContainer = DOM.$('.cell-drag-image.monaco-list-row.focused.markdown-cell-row');\n\t\tDOM.reset(dragImageContainer, templateData.container.cloneNode(true));\n\n\t\t// Remove all rendered content nodes after the\n\t\tconst markdownContent = dragImageContainer.querySelector('.cell.markdown');\n\t\tconst contentNodes = markdownContent?.children[0].children;\n\t\tif (contentNodes) {\n\t\t\tfor (let i = contentNodes.length - 1; i >= 1; i--) {\n\t\t\t\tcontentNodes.item(i)!.remove();\n\t\t\t}\n\t\t}\n\n\t\treturn dragImageContainer;\n\t}\n\n\tprivate getEditDragImage(templateData: MarkdownCellRenderTemplate): HTMLElement {\n\t\treturn new CodeCellDragImageRenderer().getDragImage(templateData, templateData.currentEditor!, 'markdown');\n\t}\n\n\trenderElement(element: MarkdownCellViewModel, index: number, templateData: MarkdownCellRenderTemplate, height: number | undefined): void {\n\t\tif (!this.notebookEditor.hasModel()) {\n\t\t\tthrow new Error('The notebook editor is not attached with view model yet.');\n\t\t}\n\n\t\tconst removedClassNames: string[] = [];\n\t\ttemplateData.rootContainer.classList.forEach(className => {\n\t\t\tif (/^nb\\-.*$/.test(className)) {\n\t\t\t\tremovedClassNames.push(className);\n\t\t\t}\n\t\t});\n\n\t\tremovedClassNames.forEach(className => {\n\t\t\ttemplateData.rootContainer.classList.remove(className);\n\t\t});\n\n\t\ttemplateData.decorationContainer.innerText = '';\n\n\t\tthis.commonRenderElement(element, templateData);\n\n\t\ttemplateData.currentRenderedCell = element;\n\t\ttemplateData.currentEditor = undefined;\n\t\ttemplateData.editorPart.style.display = 'none';\n\t\ttemplateData.cellContainer.innerText = '';\n\n\t\tif (height === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst elementDisposables = templateData.elementDisposables;\n\n\t\tconst generateCellTopDecorations = () => {\n\t\t\ttemplateData.decorationContainer.innerText = '';\n\n\t\t\telement.getCellDecorations().filter(options => options.topClassName !== undefined).forEach(options => {\n\t\t\t\ttemplateData.decorationContainer.append(DOM.$(`.${options.topClassName!}`));\n\t\t\t});\n\t\t};\n\n\t\telementDisposables.add(element.onCellDecorationsChanged((e) => {\n\t\t\tconst modified = e.added.find(e => e.topClassName) || e.removed.find(e => e.topClassName);\n\n\t\t\tif (modified) {\n\t\t\t\tgenerateCellTopDecorations();\n\t\t\t}\n\t\t}));\n\n\t\telementDisposables.add(new CellContextKeyManager(templateData.contextKeyService, this.notebookEditor, element));\n\n\t\tthis.updateForLayout(element, templateData);\n\t\telementDisposables.add(element.onDidChangeLayout(() => {\n\t\t\tthis.updateForLayout(element, templateData);\n\t\t}));\n\n\t\tthis.updateForHover(element, templateData);\n\t\tconst cellEditorOptions = new CellEditorOptions(this.configurationService, 'markdown');\n\t\tcellEditorOptions.setLineNumbers(element.lineNumbers);\n\t\telementDisposables.add(cellEditorOptions);\n\n\t\telementDisposables.add(element.onDidChangeState(e => {\n\t\t\tif (e.cellIsHoveredChanged) {\n\t\t\t\tthis.updateForHover(element, templateData);\n\t\t\t}\n\n\t\t\tif (e.metadataChanged) {\n\t\t\t\tthis.updateCollapsedState(element);\n\t\t\t}\n\n\t\t\tif (e.cellLineNumberChanged) {\n\t\t\t\tcellEditorOptions.setLineNumbers(element.lineNumbers);\n\t\t\t}\n\t\t}));\n\n\t\t// render toolbar first\n\t\tthis.setupCellToolbarActions(templateData, elementDisposables);\n\n\t\tconst toolbarContext = <INotebookCellActionContext>{\n\t\t\tui: true,\n\t\t\tcell: element,\n\t\t\tnotebookEditor: this.notebookEditor,\n\t\t\t$mid: 12\n\t\t};\n\t\ttemplateData.toolbar.context = toolbarContext;\n\t\ttemplateData.deleteToolbar.context = toolbarContext;\n\n\t\tthis.setBetweenCellToolbarContext(templateData, element, toolbarContext);\n\n\t\tconst scopedInstaService = this.instantiationService.createChild(new ServiceCollection([IContextKeyService, templateData.contextKeyService]));\n\t\tconst markdownCell = scopedInstaService.createInstance(StatefulMarkdownCell, this.notebookEditor, element, templateData, this.editorOptions.value, this.renderedEditors, { useRenderer: templateData.useRenderer });\n\t\telementDisposables.add(markdownCell);\n\t\telementDisposables.add(cellEditorOptions.onDidChange(newValue => markdownCell.updateEditorOptions(newValue)));\n\n\t\ttemplateData.statusBar.update(toolbarContext);\n\t}\n\n\tprivate updateForLayout(element: MarkdownCellViewModel, templateData: MarkdownCellRenderTemplate): void {\n\t\ttemplateData.focusIndicatorBottom.style.top = `${element.layoutInfo.totalHeight - BOTTOM_CELL_TOOLBAR_GAP - CELL_BOTTOM_MARGIN}px`;\n\n\t\tconst focusSideHeight = element.layoutInfo.totalHeight - BOTTOM_CELL_TOOLBAR_GAP;\n\t\ttemplateData.focusIndicatorLeft.style.height = `${focusSideHeight}px`;\n\t\ttemplateData.focusIndicatorRight.style.height = `${focusSideHeight}px`;\n\t}\n\n\tprivate updateForHover(element: MarkdownCellViewModel, templateData: MarkdownCellRenderTemplate): void {\n\t\ttemplateData.container.classList.toggle('markdown-cell-hover', element.cellIsHovered);\n\t}\n\n\tprivate updateCollapsedState(element: MarkdownCellViewModel) {\n\t\tif (element.metadata?.inputCollapsed) {\n\t\t\tthis.notebookEditor.hideMarkdownPreviews([element]);\n\t\t} else {\n\t\t\tthis.notebookEditor.unhideMarkdownPreviews([element]);\n\t\t}\n\t}\n\n\tdisposeTemplate(templateData: MarkdownCellRenderTemplate): void {\n\t\ttemplateData.disposables.clear();\n\t}\n\n\tdisposeElement(element: ICellViewModel, _index: number, templateData: MarkdownCellRenderTemplate): void {\n\t\ttemplateData.elementDisposables.clear();\n\t\telement.getCellDecorations().forEach(e => {\n\t\t\tif (e.className) {\n\t\t\t\ttemplateData.container.classList.remove(e.className);\n\t\t\t}\n\t\t});\n\t}\n}\n\nclass EditorTextRenderer {\n\n\tprivate static _ttPolicy = window.trustedTypes?.createPolicy('cellRendererEditorText', {\n\t\tcreateHTML(input) { return input; }\n\t});\n\n\tgetRichText(editor: ICodeEditor, modelRange: Range): HTMLElement | null {\n\t\tconst model = editor.getModel();\n\t\tif (!model) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst colorMap = this.getDefaultColorMap();\n\t\tconst fontInfo = editor.getOptions().get(EditorOption.fontInfo);\n\t\tconst fontFamilyVar = '--notebook-editor-font-family';\n\t\tconst fontSizeVar = '--notebook-editor-font-size';\n\t\tconst fontWeightVar = '--notebook-editor-font-weight';\n\n\t\tconst style = ``\n\t\t\t+ `color: ${colorMap[modes.ColorId.DefaultForeground]};`\n\t\t\t+ `background-color: ${colorMap[modes.ColorId.DefaultBackground]};`\n\t\t\t+ `font-family: var(${fontFamilyVar});`\n\t\t\t+ `font-weight: var(${fontWeightVar});`\n\t\t\t+ `font-size: var(${fontSizeVar});`\n\t\t\t+ `line-height: ${fontInfo.lineHeight}px;`\n\t\t\t+ `white-space: pre;`;\n\n\t\tconst element = DOM.$('div', { style });\n\n\t\tconst fontSize = fontInfo.fontSize;\n\t\tconst fontWeight = fontInfo.fontWeight;\n\t\telement.style.setProperty(fontFamilyVar, fontInfo.fontFamily);\n\t\telement.style.setProperty(fontSizeVar, `${fontSize}px`);\n\t\telement.style.setProperty(fontWeightVar, fontWeight);\n\n\t\tconst linesHtml = this.getRichTextLinesAsHtml(model, modelRange, colorMap);\n\t\telement.innerHTML = linesHtml as string;\n\t\treturn element;\n\t}\n\n\tprivate getRichTextLinesAsHtml(model: ITextModel, modelRange: Range, colorMap: string[]): string | TrustedHTML {\n\t\tconst startLineNumber = modelRange.startLineNumber;\n\t\tconst startColumn = modelRange.startColumn;\n\t\tconst endLineNumber = modelRange.endLineNumber;\n\t\tconst endColumn = modelRange.endColumn;\n\n\t\tconst tabSize = model.getOptions().tabSize;\n\n\t\tlet result = '';\n\n\t\tfor (let lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++) {\n\t\t\tconst lineTokens = model.getLineTokens(lineNumber);\n\t\t\tconst lineContent = lineTokens.getLineContent();\n\t\t\tconst startOffset = (lineNumber === startLineNumber ? startColumn - 1 : 0);\n\t\t\tconst endOffset = (lineNumber === endLineNumber ? endColumn - 1 : lineContent.length);\n\n\t\t\tif (lineContent === '') {\n\t\t\t\tresult += '<br>';\n\t\t\t} else {\n\t\t\t\tresult += tokenizeLineToHTML(lineContent, lineTokens.inflate(), colorMap, startOffset, endOffset, tabSize, platform.isWindows);\n\t\t\t}\n\t\t}\n\n\t\treturn EditorTextRenderer._ttPolicy?.createHTML(result) ?? result;\n\t}\n\n\tprivate getDefaultColorMap(): string[] {\n\t\tconst colorMap = modes.TokenizationRegistry.getColorMap();\n\t\tconst result: string[] = ['#000000'];\n\t\tif (colorMap) {\n\t\t\tfor (let i = 1, len = colorMap.length; i < len; i++) {\n\t\t\t\tresult[i] = Color.Format.CSS.formatHex(colorMap[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\nclass CodeCellDragImageRenderer {\n\tgetDragImage(templateData: BaseCellRenderTemplate, editor: ICodeEditor, type: 'code' | 'markdown'): HTMLElement {\n\t\tlet dragImage = this.getDragImageImpl(templateData, editor, type);\n\t\tif (!dragImage) {\n\t\t\t// TODO@roblourens I don't think this can happen\n\t\t\tdragImage = document.createElement('div');\n\t\t\tdragImage.textContent = '1 cell';\n\t\t}\n\n\t\treturn dragImage;\n\t}\n\n\tprivate getDragImageImpl(templateData: BaseCellRenderTemplate, editor: ICodeEditor, type: 'code' | 'markdown'): HTMLElement | null {\n\t\tconst dragImageContainer = templateData.container.cloneNode(true) as HTMLElement;\n\t\tdragImageContainer.classList.forEach(c => dragImageContainer.classList.remove(c));\n\t\tdragImageContainer.classList.add('cell-drag-image', 'monaco-list-row', 'focused', `${type}-cell-row`);\n\n\t\tconst editorContainer: HTMLElement | null = dragImageContainer.querySelector('.cell-editor-container');\n\t\tif (!editorContainer) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst richEditorText = new EditorTextRenderer().getRichText(editor, new Range(1, 1, 1, 1000));\n\t\tif (!richEditorText) {\n\t\t\treturn null;\n\t\t}\n\t\tDOM.reset(editorContainer, richEditorText);\n\n\t\treturn dragImageContainer;\n\t}\n}\n\nexport class CodeCellRenderer extends AbstractCellRenderer implements IListRenderer<CodeCellViewModel, CodeCellRenderTemplate> {\n\tstatic readonly TEMPLATE_ID = 'code_cell';\n\n\tconstructor(\n\t\tnotebookEditor: INotebookEditor,\n\t\tprivate renderedEditors: Map<ICellViewModel, ICodeEditor | undefined>,\n\t\tdndController: CellDragAndDropController,\n\t\tcontextKeyServiceProvider: (container: HTMLElement) => IContextKeyService,\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@INotificationService notificationService: INotificationService,\n\t) {\n\t\tsuper(instantiationService, notebookEditor, contextMenuService, configurationService, keybindingService, notificationService, contextKeyServiceProvider, 'plaintext', dndController);\n\t}\n\n\tget templateId() {\n\t\treturn CodeCellRenderer.TEMPLATE_ID;\n\t}\n\n\trenderTemplate(rootContainer: HTMLElement): CodeCellRenderTemplate {\n\t\trootContainer.classList.add('code-cell-row');\n\t\tconst container = DOM.append(rootContainer, DOM.$('.cell-inner-container'));\n\t\tconst disposables = new DisposableStore();\n\t\tconst contextKeyService = disposables.add(this.contextKeyServiceProvider(container));\n\t\tconst decorationContainer = DOM.append(rootContainer, $('.cell-decoration'));\n\t\tDOM.append(container, $('.cell-focus-indicator.cell-focus-indicator-top'));\n\t\tconst titleToolbarContainer = DOM.append(container, $('.cell-title-toolbar'));\n\t\tconst toolbar = disposables.add(this.createToolbar(titleToolbarContainer));\n\t\tconst deleteToolbar = disposables.add(this.createToolbar(titleToolbarContainer, 'cell-delete-toolbar'));\n\t\tdeleteToolbar.setActions([this.instantiationService.createInstance(DeleteCellAction)]);\n\n\t\tconst focusIndicator = DOM.append(container, DOM.$('.cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left'));\n\t\tconst dragHandle = DOM.append(container, DOM.$('.cell-drag-handle'));\n\n\t\tconst cellContainer = DOM.append(container, $('.cell.code'));\n\t\tconst runButtonContainer = DOM.append(cellContainer, $('.run-button-container'));\n\n\t\tconst runToolbar = disposables.add(this.setupRunToolbar(runButtonContainer, contextKeyService, disposables));\n\t\tconst executionOrderLabel = DOM.append(cellContainer, $('div.execution-count-label'));\n\n\t\tconst editorPart = DOM.append(cellContainer, $('.cell-editor-part'));\n\t\tconst editorContainer = DOM.append(editorPart, $('.cell-editor-container'));\n\n\t\t// create a special context key service that set the inCompositeEditor-contextkey\n\t\tconst editorContextKeyService = disposables.add(this.contextKeyServiceProvider(editorPart));\n\t\tconst editorInstaService = this.instantiationService.createChild(new ServiceCollection([IContextKeyService, editorContextKeyService]));\n\t\tEditorContextKeys.inCompositeEditor.bindTo(editorContextKeyService).set(true);\n\n\t\tconst editor = editorInstaService.createInstance(CodeEditorWidget, editorContainer, {\n\t\t\t...this.editorOptions.value,\n\t\t\tdimension: {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t},\n\t\t\t// overflowWidgetsDomNode: this.notebookEditor.getOverflowContainerDomNode()\n\t\t}, {});\n\n\t\tdisposables.add(editor);\n\t\tconst { collapsedPart, expandButton } = this.setupCollapsedPart(container);\n\n\t\tconst progressBar = new ProgressBar(editorPart);\n\t\tprogressBar.hide();\n\t\tdisposables.add(progressBar);\n\n\t\tconst statusBar = disposables.add(this.instantiationService.createInstance(CellEditorStatusBar, editorPart));\n\n\t\tconst outputContainer = DOM.append(container, $('.output'));\n\t\tconst outputShowMoreContainer = DOM.append(container, $('.output-show-more-container'));\n\n\t\tconst focusIndicatorRight = DOM.append(container, DOM.$('.cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right'));\n\n\t\tconst focusSinkElement = DOM.append(container, $('.cell-editor-focus-sink'));\n\t\tfocusSinkElement.setAttribute('tabindex', '0');\n\t\tconst bottomCellContainer = DOM.append(container, $('.cell-bottom-toolbar-container'));\n\t\tconst focusIndicatorBottom = DOM.append(container, $('.cell-focus-indicator.cell-focus-indicator-bottom'));\n\t\tconst betweenCellToolbar = this.createBetweenCellToolbar(bottomCellContainer, disposables, contextKeyService);\n\n\t\tconst titleMenu = disposables.add(this.cellMenus.getCellTitleMenu(contextKeyService));\n\n\t\tconst templateData: CodeCellRenderTemplate = {\n\t\t\trootContainer,\n\t\t\teditorPart,\n\t\t\tcollapsedPart,\n\t\t\texpandButton,\n\t\t\tcontextKeyService,\n\t\t\tcontainer,\n\t\t\tdecorationContainer,\n\t\t\tcellContainer,\n\t\t\tprogressBar,\n\t\t\tstatusBar,\n\t\t\tfocusIndicatorLeft: focusIndicator,\n\t\t\tfocusIndicatorRight,\n\t\t\tfocusIndicatorBottom,\n\t\t\ttoolbar,\n\t\t\tdeleteToolbar,\n\t\t\tbetweenCellToolbar,\n\t\t\tfocusSinkElement,\n\t\t\trunToolbar,\n\t\t\trunButtonContainer,\n\t\t\texecutionOrderLabel,\n\t\t\toutputContainer,\n\t\t\toutputShowMoreContainer,\n\t\t\teditor,\n\t\t\tdisposables,\n\t\t\telementDisposables: new DisposableStore(),\n\t\t\tbottomCellContainer,\n\t\t\ttitleMenu,\n\t\t\tdragHandle,\n\t\t\ttoJSON: () => { return {}; }\n\t\t};\n\n\t\tthis.dndController.registerDragHandle(templateData, rootContainer, dragHandle, () => new CodeCellDragImageRenderer().getDragImage(templateData, templateData.editor, 'code'));\n\n\t\tdisposables.add(this.addDoubleClickCollapseHandler(templateData));\n\t\tdisposables.add(DOM.addDisposableListener(focusSinkElement, DOM.EventType.FOCUS, () => {\n\t\t\tif (templateData.currentRenderedCell && (templateData.currentRenderedCell as CodeCellViewModel).outputsViewModels.length) {\n\t\t\t\tthis.notebookEditor.focusNotebookCell(templateData.currentRenderedCell, 'output');\n\t\t\t}\n\t\t}));\n\n\t\tthis.commonRenderTemplate(templateData);\n\n\t\treturn templateData;\n\t}\n\n\tprivate addDoubleClickCollapseHandler(templateData: CodeCellRenderTemplate): IDisposable {\n\t\tconst dragHandleListener = DOM.addDisposableListener(templateData.dragHandle, DOM.EventType.DBLCLICK, e => {\n\t\t\tconst cell = templateData.currentRenderedCell;\n\t\t\tif (!cell) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst clickedOnInput = e.offsetY < (cell.layoutInfo as CodeCellLayoutInfo).outputContainerOffset;\n\t\t\tconst viewModel = this.notebookEditor.viewModel!;\n\t\t\tconst metadata: Partial<NotebookCellMetadata> = clickedOnInput ?\n\t\t\t\t{ inputCollapsed: !cell.metadata?.inputCollapsed } :\n\t\t\t\t{ outputCollapsed: !cell.metadata?.outputCollapsed };\n\t\t\tviewModel.notebookDocument.applyEdits([\n\t\t\t\t{\n\t\t\t\t\teditType: CellEditType.PartialMetadata,\n\t\t\t\t\tindex: viewModel.getCellIndex(cell),\n\t\t\t\t\tmetadata\n\t\t\t\t}\n\t\t\t], true, undefined, () => undefined, undefined);\n\t\t});\n\n\t\tconst collapsedPartListener = DOM.addDisposableListener(templateData.collapsedPart, DOM.EventType.DBLCLICK, e => {\n\t\t\tconst cell = templateData.currentRenderedCell;\n\t\t\tif (!cell) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst metadata: Partial<NotebookCellMetadata> = cell.metadata?.inputCollapsed ?\n\t\t\t\t{ inputCollapsed: false } :\n\t\t\t\t{ outputCollapsed: false };\n\t\t\tconst viewModel = this.notebookEditor.viewModel!;\n\t\t\tviewModel.notebookDocument.applyEdits([\n\t\t\t\t{\n\t\t\t\t\teditType: CellEditType.PartialMetadata,\n\t\t\t\t\tindex: viewModel.getCellIndex(cell),\n\t\t\t\t\tmetadata\n\t\t\t\t}\n\t\t\t], true, undefined, () => undefined, undefined);\n\t\t});\n\n\t\treturn combinedDisposable(dragHandleListener, collapsedPartListener);\n\t}\n\n\tprivate setupRunToolbar(runButtonContainer: HTMLElement, contextKeyService: IContextKeyService, disposables: DisposableStore): ToolBar {\n\t\tconst runToolbar = this.createToolbar(runButtonContainer);\n\t\tconst runMenu = this.cellMenus.getCellExecuteMenu(contextKeyService);\n\t\tconst update = () => {\n\t\t\tconst actions = this.getCellToolbarActions(runMenu, false);\n\t\t\trunToolbar.setActions(actions.primary, actions.secondary);\n\t\t};\n\t\tdisposables.add(runMenu.onDidChange(() => {\n\t\t\tupdate();\n\t\t}));\n\t\tupdate();\n\t\treturn runToolbar;\n\t}\n\n\tprivate updateForOutputs(element: CodeCellViewModel, templateData: CodeCellRenderTemplate): void {\n\t\tif (element.outputsViewModels.length) {\n\t\t\tDOM.show(templateData.focusSinkElement);\n\t\t} else {\n\t\t\tDOM.hide(templateData.focusSinkElement);\n\t\t}\n\t}\n\n\tprivate updateForMetadata(element: CodeCellViewModel, templateData: CodeCellRenderTemplate, editorOptions: CellEditorOptions): void {\n\t\tif (!this.notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst metadata = element.metadata;\n\t\tthis.updateExecutionOrder(metadata, templateData);\n\n\t\tif (metadata.runState === NotebookCellExecutionState.Executing) {\n\t\t\ttemplateData.progressBar.infinite().show(500);\n\t\t} else {\n\t\t\ttemplateData.progressBar.hide();\n\t\t}\n\t}\n\n\tprivate updateExecutionOrder(metadata: NotebookCellMetadata, templateData: CodeCellRenderTemplate): void {\n\t\tif (this.notebookEditor.activeKernel?.implementsExecutionOrder) {\n\t\t\tconst executionOrderLabel = typeof metadata.executionOrder === 'number' ?\n\t\t\t\t`[${metadata.executionOrder}]` :\n\t\t\t\t'[ ]';\n\t\t\ttemplateData.executionOrderLabel.innerText = executionOrderLabel;\n\t\t} else {\n\t\t\ttemplateData.executionOrderLabel.innerText = '';\n\t\t}\n\t}\n\n\tprivate updateForHover(element: CodeCellViewModel, templateData: CodeCellRenderTemplate): void {\n\t\ttemplateData.container.classList.toggle('cell-output-hover', element.outputIsHovered);\n\t}\n\n\tprivate updateForFocus(element: CodeCellViewModel, templateData: CodeCellRenderTemplate): void {\n\t\ttemplateData.container.classList.toggle('cell-output-focus', element.outputIsFocused);\n\t}\n\n\tprivate updateForLayout(element: CodeCellViewModel, templateData: CodeCellRenderTemplate): void {\n\t\ttemplateData.focusIndicatorLeft.style.height = `${element.layoutInfo.indicatorHeight}px`;\n\t\ttemplateData.focusIndicatorRight.style.height = `${element.layoutInfo.indicatorHeight}px`;\n\t\ttemplateData.focusIndicatorBottom.style.top = `${element.layoutInfo.totalHeight - BOTTOM_CELL_TOOLBAR_GAP - CELL_BOTTOM_MARGIN}px`;\n\t\ttemplateData.outputContainer.style.top = `${element.layoutInfo.outputContainerOffset}px`;\n\t\ttemplateData.outputShowMoreContainer.style.top = `${element.layoutInfo.outputShowMoreContainerOffset}px`;\n\t\ttemplateData.dragHandle.style.height = `${element.layoutInfo.totalHeight - BOTTOM_CELL_TOOLBAR_GAP}px`;\n\t}\n\n\trenderElement(element: CodeCellViewModel, index: number, templateData: CodeCellRenderTemplate, height: number | undefined): void {\n\t\tif (!this.notebookEditor.hasModel()) {\n\t\t\tthrow new Error('The notebook editor is not attached with view model yet.');\n\t\t}\n\n\t\tconst removedClassNames: string[] = [];\n\t\ttemplateData.rootContainer.classList.forEach(className => {\n\t\t\tif (/^nb\\-.*$/.test(className)) {\n\t\t\t\tremovedClassNames.push(className);\n\t\t\t}\n\t\t});\n\n\t\tremovedClassNames.forEach(className => {\n\t\t\ttemplateData.rootContainer.classList.remove(className);\n\t\t});\n\n\t\ttemplateData.decorationContainer.innerText = '';\n\n\t\tthis.commonRenderElement(element, templateData);\n\n\t\ttemplateData.currentRenderedCell = element;\n\n\t\tif (height === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\ttemplateData.outputContainer.innerText = '';\n\n\t\tconst elementDisposables = templateData.elementDisposables;\n\n\t\tconst generateCellTopDecorations = () => {\n\t\t\ttemplateData.decorationContainer.innerText = '';\n\n\t\t\telement.getCellDecorations().filter(options => options.topClassName !== undefined).forEach(options => {\n\t\t\t\ttemplateData.decorationContainer.append(DOM.$(`.${options.topClassName!}`));\n\t\t\t});\n\t\t};\n\n\t\telementDisposables.add(element.onCellDecorationsChanged((e) => {\n\t\t\tconst modified = e.added.find(e => e.topClassName) || e.removed.find(e => e.topClassName);\n\n\t\t\tif (modified) {\n\t\t\t\tgenerateCellTopDecorations();\n\t\t\t}\n\t\t}));\n\n\t\tgenerateCellTopDecorations();\n\n\t\telementDisposables.add(this.instantiationService.createInstance(CodeCell, this.notebookEditor, element, templateData));\n\t\tthis.renderedEditors.set(element, templateData.editor);\n\n\t\tconst cellEditorOptions = new CellEditorOptions(this.configurationService, element.language);\n\t\telementDisposables.add(cellEditorOptions);\n\t\telementDisposables.add(cellEditorOptions.onDidChange(newValue => templateData.editor.updateOptions(newValue)));\n\t\ttemplateData.editor.updateOptions(cellEditorOptions.value);\n\n\t\telementDisposables.add(new CellContextKeyManager(templateData.contextKeyService, this.notebookEditor, element));\n\n\t\tthis.updateForLayout(element, templateData);\n\t\telementDisposables.add(element.onDidChangeLayout(() => {\n\t\t\tthis.updateForLayout(element, templateData);\n\t\t}));\n\n\t\tthis.updateForMetadata(element, templateData, cellEditorOptions);\n\t\tthis.updateForHover(element, templateData);\n\t\tthis.updateForFocus(element, templateData);\n\t\tcellEditorOptions.setLineNumbers(element.lineNumbers);\n\t\telementDisposables.add(element.onDidChangeState((e) => {\n\t\t\tif (e.metadataChanged) {\n\t\t\t\tthis.updateForMetadata(element, templateData, cellEditorOptions);\n\t\t\t}\n\n\t\t\tif (e.outputIsHoveredChanged) {\n\t\t\t\tthis.updateForHover(element, templateData);\n\t\t\t}\n\n\t\t\tif (e.outputIsFocusedChanged) {\n\t\t\t\tthis.updateForFocus(element, templateData);\n\t\t\t}\n\n\t\t\tif (e.cellLineNumberChanged) {\n\t\t\t\tcellEditorOptions.setLineNumbers(element.lineNumbers);\n\t\t\t}\n\t\t}));\n\t\telementDisposables.add(this.notebookEditor.viewModel.notebookDocument.onDidChangeContent(e => {\n\t\t\tif (e.rawEvents.find(event => event.kind === NotebookCellsChangeType.ChangeDocumentMetadata)) {\n\t\t\t\tthis.updateForMetadata(element, templateData, cellEditorOptions);\n\t\t\t}\n\t\t}));\n\n\t\tthis.updateForOutputs(element, templateData);\n\t\telementDisposables.add(element.onDidChangeOutputs(_e => this.updateForOutputs(element, templateData)));\n\n\t\tthis.setupCellToolbarActions(templateData, elementDisposables);\n\n\t\tconst toolbarContext = <INotebookCellActionContext>{\n\t\t\tui: true,\n\t\t\tcell: element,\n\t\t\tcellTemplate: templateData,\n\t\t\tnotebookEditor: this.notebookEditor,\n\t\t\t$mid: 12\n\t\t};\n\t\ttemplateData.toolbar.context = toolbarContext;\n\t\ttemplateData.runToolbar.context = toolbarContext;\n\t\ttemplateData.deleteToolbar.context = toolbarContext;\n\n\t\tthis.setBetweenCellToolbarContext(templateData, element, toolbarContext);\n\n\t\ttemplateData.statusBar.update(toolbarContext);\n\t}\n\n\tdisposeTemplate(templateData: CodeCellRenderTemplate): void {\n\t\ttemplateData.disposables.clear();\n\t}\n\n\tdisposeElement(element: ICellViewModel, index: number, templateData: CodeCellRenderTemplate, height: number | undefined): void {\n\t\ttemplateData.elementDisposables.clear();\n\t\tthis.renderedEditors.delete(element);\n\t}\n}\n\nexport class TimerRenderer {\n\tconstructor(private readonly container: HTMLElement) {\n\t\tDOM.hide(container);\n\t}\n\n\tprivate intervalTimer: number | undefined;\n\n\tstart(startTime: number, adjustment: number): IDisposable {\n\t\tthis.stop();\n\t\tDOM.show(this.container);\n\t\tconst intervalTimer = setInterval(() => {\n\t\t\tconst duration = Date.now() - startTime + adjustment;\n\t\t\tthis.container.textContent = this.formatDuration(duration);\n\t\t}, 100);\n\t\tthis.intervalTimer = intervalTimer as unknown as number | undefined;\n\n\t\treturn toDisposable(() => {\n\t\t\tclearInterval(intervalTimer);\n\t\t});\n\t}\n\n\tstop() {\n\t\tif (this.intervalTimer) {\n\t\t\tclearInterval(this.intervalTimer);\n\t\t}\n\t}\n\n\tshow(duration: number) {\n\t\tthis.stop();\n\n\t\tDOM.show(this.container);\n\t\tthis.container.textContent = this.formatDuration(duration);\n\t}\n\n\tclear() {\n\t\tDOM.hide(this.container);\n\t\tthis.stop();\n\t\tthis.container.textContent = '';\n\t}\n\n\tprivate formatDuration(duration: number) {\n\t\tconst seconds = Math.floor(duration / 1000);\n\t\tconst tenths = String(duration - seconds * 1000).charAt(0);\n\n\t\treturn `${seconds}.${tenths}s`;\n\t}\n}\n\nexport class RunStateRenderer {\n\tprivate static readonly MIN_SPINNER_TIME = 200;\n\n\tprivate spinnerTimer: any | undefined;\n\tprivate lastRunState: NotebookCellExecutionState | undefined;\n\tprivate pendingNewState: NotebookCellExecutionState | undefined;\n\tprivate pendingLastRunSuccess: boolean | undefined;\n\n\tconstructor(private readonly element: HTMLElement) {\n\t\tDOM.hide(element);\n\t}\n\n\tclear() {\n\t\tif (this.spinnerTimer) {\n\t\t\tclearTimeout(this.spinnerTimer);\n\t\t\tthis.spinnerTimer = undefined;\n\t\t}\n\t}\n\n\trenderState(runState: NotebookCellExecutionState = NotebookCellExecutionState.Idle, getCellIndex: () => number, lastRunSuccess: boolean | undefined = undefined) {\n\t\tif (this.spinnerTimer) {\n\t\t\tthis.pendingNewState = runState;\n\t\t\tthis.pendingLastRunSuccess = lastRunSuccess;\n\t\t\treturn;\n\t\t}\n\n\t\tlet runStateTooltip: string | undefined;\n\t\tif (runState === NotebookCellExecutionState.Idle && lastRunSuccess) {\n\t\t\taria.alert(`Code cell at ${getCellIndex()} finishes running successfully`);\n\t\t\tDOM.reset(this.element, renderIcon(successStateIcon));\n\t\t} else if (runState === NotebookCellExecutionState.Idle && !lastRunSuccess) {\n\t\t\taria.alert(`Code cell at ${getCellIndex()} finishes running with errors`);\n\t\t\tDOM.reset(this.element, renderIcon(errorStateIcon));\n\t\t} else if (runState === NotebookCellExecutionState.Executing) {\n\t\t\trunStateTooltip = localize('runStateExecuting', \"Executing\");\n\t\t\tif (this.lastRunState !== NotebookCellExecutionState.Executing) {\n\t\t\t\taria.alert(`Code cell at ${getCellIndex()} starts running`);\n\t\t\t}\n\t\t\tDOM.reset(this.element, renderIcon(syncing));\n\t\t\tthis.spinnerTimer = setTimeout(() => {\n\t\t\t\tthis.spinnerTimer = undefined;\n\t\t\t\tif (this.pendingNewState && this.pendingNewState !== runState) {\n\t\t\t\t\tthis.renderState(this.pendingNewState, getCellIndex, this.pendingLastRunSuccess);\n\t\t\t\t\tthis.pendingNewState = undefined;\n\t\t\t\t}\n\t\t\t}, RunStateRenderer.MIN_SPINNER_TIME);\n\t\t} else if (runState === NotebookCellExecutionState.Pending) {\n\t\t\t// Not spinning\n\t\t\trunStateTooltip = localize('runStatePending', \"Pending\");\n\t\t\tDOM.reset(this.element, renderIcon(Codicons.Codicon.clock));\n\t\t} else {\n\t\t\tthis.element.innerText = '';\n\t\t}\n\n\t\tif (runState === NotebookCellExecutionState.Idle && typeof lastRunSuccess !== 'boolean') {\n\t\t\tDOM.hide(this.element);\n\t\t} else {\n\t\t\tthis.element.style.display = 'flex';\n\t\t}\n\n\t\tif (runStateTooltip) {\n\t\t\tthis.element.setAttribute('title', runStateTooltip);\n\t\t}\n\n\t\tthis.lastRunState = runState;\n\t}\n}\n\nexport class ListTopCellToolbar extends Disposable {\n\tprivate topCellToolbar: HTMLElement;\n\tprivate menu: IMenu;\n\tprivate toolbar: ToolBar;\n\tprivate _modelDisposables = new DisposableStore();\n\tconstructor(\n\t\tprotected readonly notebookEditor: INotebookEditor,\n\n\t\tcontextKeyService: IContextKeyService,\n\t\tinsertionIndicatorContainer: HTMLElement,\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t\t@IContextMenuService protected readonly contextMenuService: IContextMenuService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.topCellToolbar = DOM.append(insertionIndicatorContainer, $('.cell-list-top-cell-toolbar-container'));\n\n\t\tthis.toolbar = this._register(new ToolBar(this.topCellToolbar, this.contextMenuService, {\n\t\t\tactionViewItemProvider: action => {\n\t\t\t\tif (action instanceof MenuItemAction) {\n\t\t\t\t\tconst item = new CodiconActionViewItem(action, this.keybindingService, this.notificationService);\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t\tthis.toolbar.context = <INotebookActionContext>{\n\t\t\tnotebookEditor\n\t\t};\n\n\t\tconst cellMenu = this.instantiationService.createInstance(CellMenus);\n\t\tthis.menu = this._register(cellMenu.getCellTopInsertionMenu(contextKeyService));\n\t\tthis._register(this.menu.onDidChange(() => {\n\t\t\tthis.updateActions();\n\t\t}));\n\t\tthis.updateActions();\n\n\t\t// update toolbar container css based on cell list length\n\t\tthis._register(this.notebookEditor.onDidChangeModel(() => {\n\t\t\tthis._modelDisposables.clear();\n\n\t\t\tif (this.notebookEditor.viewModel) {\n\t\t\t\tthis._modelDisposables.add(this.notebookEditor.viewModel.onDidChangeViewCells(() => {\n\t\t\t\t\tthis.updateClass();\n\t\t\t\t}));\n\n\t\t\t\tthis.updateClass();\n\t\t\t}\n\t\t}));\n\n\t\tthis.updateClass();\n\t}\n\n\tprivate updateActions() {\n\t\tconst actions = this.getCellToolbarActions(this.menu, false);\n\t\tthis.toolbar.setActions(actions.primary, actions.secondary);\n\t}\n\n\tprivate updateClass() {\n\t\tif (this.notebookEditor.viewModel?.length === 0) {\n\t\t\tthis.topCellToolbar.classList.add('emptyNotebook');\n\t\t} else {\n\t\t\tthis.topCellToolbar.classList.remove('emptyNotebook');\n\t\t}\n\t}\n\n\tprivate getCellToolbarActions(menu: IMenu, alwaysFillSecondaryActions: boolean): { primary: IAction[], secondary: IAction[] } {\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\n\t\tcreateAndFillInActionBarActionsWithVerticalSeparators(menu, { shouldForwardArgs: true }, result, alwaysFillSecondaryActions, g => /^inline/.test(g));\n\n\t\treturn result;\n\t}\n}\n"]}