{"version":3,"sources":["vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts"],"names":[],"mappings":"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","file":"backLayerWebView.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction } from 'vs/base/common/actions';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { getExtensionForMimeType } from 'vs/base/common/mime';\nimport { FileAccess, Schemas } from 'vs/base/common/network';\nimport { isMacintosh, isWeb } from 'vs/base/common/platform';\nimport { dirname, joinPath } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport * as UUID from 'vs/base/common/uuid';\nimport * as nls from 'vs/nls';\nimport { createAndFillInContextMenuActions } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { IMenuService, MenuId } from 'vs/platform/actions/common/actions';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IFileDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IOpenerService, matchesScheme } from 'vs/platform/opener/common/opener';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { CellEditState, ICellOutputViewModel, ICommonCellInfo, ICommonNotebookEditor, IDisplayOutputLayoutUpdateRequest, IDisplayOutputViewModel, IGenericCellViewModel, IInsetRenderOutput, RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { preloadsScriptStr } from 'vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads';\nimport { transformWebviewThemeVars } from 'vs/workbench/contrib/notebook/browser/view/renderers/webviewThemeMapping';\nimport { MarkdownCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/markdownCellViewModel';\nimport { INotebookRendererInfo } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { IWebviewService, WebviewContentPurpose, WebviewElement } from 'vs/workbench/contrib/webview/browser/webview';\nimport { asWebviewUri } from 'vs/workbench/contrib/webview/common/webviewUri';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\n\ninterface BaseToWebviewMessage {\n\treadonly __vscode_notebook_message: true;\n}\n\nexport interface WebviewIntialized extends BaseToWebviewMessage {\n\ttype: 'initialized';\n}\n\nexport interface DimensionUpdate {\n\tid: string;\n\tinit?: boolean;\n\theight: number;\n\tisOutput?: boolean;\n}\n\nexport interface IDimensionMessage extends BaseToWebviewMessage {\n\ttype: 'dimension';\n\tupdates: readonly DimensionUpdate[];\n}\n\nexport interface IMouseEnterMessage extends BaseToWebviewMessage {\n\ttype: 'mouseenter';\n\tid: string;\n}\n\nexport interface IMouseLeaveMessage extends BaseToWebviewMessage {\n\ttype: 'mouseleave';\n\tid: string;\n}\n\nexport interface IOutputFocusMessage extends BaseToWebviewMessage {\n\ttype: 'outputFocus';\n\tid: string;\n}\n\nexport interface IOutputBlurMessage extends BaseToWebviewMessage {\n\ttype: 'outputBlur';\n\tid: string;\n}\n\nexport interface IWheelMessage extends BaseToWebviewMessage {\n\ttype: 'did-scroll-wheel';\n\tpayload: any;\n}\n\nexport interface IScrollAckMessage extends BaseToWebviewMessage {\n\ttype: 'scroll-ack';\n\tdata: { top: number };\n\tversion: number;\n}\n\nexport interface IBlurOutputMessage extends BaseToWebviewMessage {\n\ttype: 'focus-editor';\n\tid: string;\n\tfocusNext?: boolean;\n}\n\nexport interface IClickedDataUrlMessage extends BaseToWebviewMessage {\n\ttype: 'clicked-data-url';\n\tdata: string | ArrayBuffer | null;\n\tdownloadName?: string;\n}\n\nexport interface IClickMarkdownPreviewMessage extends BaseToWebviewMessage {\n\treadonly type: 'clickMarkdownPreview';\n\treadonly cellId: string;\n\treadonly ctrlKey: boolean\n\treadonly altKey: boolean;\n\treadonly metaKey: boolean;\n\treadonly shiftKey: boolean;\n}\n\nexport interface IContextMenuMarkdownPreviewMessage extends BaseToWebviewMessage {\n\treadonly type: 'contextMenuMarkdownPreview';\n\treadonly cellId: string;\n\treadonly clientX: number;\n\treadonly clientY: number;\n}\n\nexport interface IMouseEnterMarkdownPreviewMessage extends BaseToWebviewMessage {\n\ttype: 'mouseEnterMarkdownPreview';\n\tcellId: string;\n}\n\nexport interface IMouseLeaveMarkdownPreviewMessage extends BaseToWebviewMessage {\n\ttype: 'mouseLeaveMarkdownPreview';\n\tcellId: string;\n}\n\nexport interface IToggleMarkdownPreviewMessage extends BaseToWebviewMessage {\n\ttype: 'toggleMarkdownPreview';\n\tcellId: string;\n}\n\nexport interface ICellDragStartMessage extends BaseToWebviewMessage {\n\ttype: 'cell-drag-start';\n\treadonly cellId: string;\n\treadonly position: {\n\t\treadonly clientY: number;\n\t};\n}\n\nexport interface ICellDragMessage extends BaseToWebviewMessage {\n\ttype: 'cell-drag';\n\treadonly cellId: string;\n\treadonly position: {\n\t\treadonly clientY: number;\n\t};\n}\n\nexport interface ICellDropMessage extends BaseToWebviewMessage {\n\treadonly type: 'cell-drop';\n\treadonly cellId: string;\n\treadonly ctrlKey: boolean\n\treadonly altKey: boolean;\n\treadonly position: {\n\t\treadonly clientY: number;\n\t};\n}\n\nexport interface ICellDragEndMessage extends BaseToWebviewMessage {\n\treadonly type: 'cell-drag-end';\n\treadonly cellId: string;\n}\n\nexport interface IInitializedMarkdownPreviewMessage extends BaseToWebviewMessage {\n\treadonly type: 'initializedMarkdownPreview';\n}\n\nexport interface ITelemetryFoundRenderedMarkdownMath extends BaseToWebviewMessage {\n\treadonly type: 'telemetryFoundRenderedMarkdownMath';\n}\n\nexport interface ITelemetryFoundUnrenderedMarkdownMath extends BaseToWebviewMessage {\n\treadonly type: 'telemetryFoundUnrenderedMarkdownMath';\n\treadonly latexDirective: string;\n}\n\nexport interface IClearMessage {\n\ttype: 'clear';\n}\n\nexport interface IOutputRequestMetadata {\n\t/**\n\t * Additional attributes of a cell metadata.\n\t */\n\tcustom?: { [key: string]: unknown };\n}\n\nexport interface IOutputRequestDto {\n\t/**\n\t * { mime_type: value }\n\t */\n\tdata: { [key: string]: unknown; }\n\n\tmetadata?: IOutputRequestMetadata;\n\toutputId: string;\n}\n\nexport interface ICreationRequestMessage {\n\ttype: 'html';\n\tcontent:\n\t| { type: RenderOutputType.Html; htmlContent: string }\n\t| { type: RenderOutputType.Extension; outputId: string; value: unknown; metadata: unknown; mimeType: string };\n\tcellId: string;\n\toutputId: string;\n\tcellTop: number;\n\toutputOffset: number;\n\tleft: number;\n\trequiredPreloads: ReadonlyArray<IPreloadResource>;\n\treadonly initiallyHidden?: boolean;\n\tapiNamespace?: string | undefined;\n}\n\nexport interface IContentWidgetTopRequest {\n\toutputId: string;\n\tcellTop: number;\n\toutputOffset: number;\n\tforceDisplay: boolean;\n}\n\nexport interface IViewScrollTopRequestMessage {\n\ttype: 'view-scroll';\n\twidgets: IContentWidgetTopRequest[];\n\tmarkdownPreviews: { id: string; top: number }[];\n}\n\nexport interface IScrollRequestMessage {\n\ttype: 'scroll';\n\tid: string;\n\ttop: number;\n\twidgetTop?: number;\n\tversion: number;\n}\n\nexport interface IClearOutputRequestMessage {\n\ttype: 'clearOutput';\n\tcellId: string;\n\toutputId: string;\n\tcellUri: string;\n\tapiNamespace: string | undefined;\n}\n\nexport interface IHideOutputMessage {\n\ttype: 'hideOutput';\n\toutputId: string;\n\tcellId: string;\n}\n\nexport interface IShowOutputMessage {\n\ttype: 'showOutput';\n\tcellId: string;\n\toutputId: string;\n\tcellTop: number;\n\toutputOffset: number;\n}\n\nexport interface IFocusOutputMessage {\n\ttype: 'focus-output';\n\tcellId: string;\n}\n\nexport interface IAckOutputHeightMessage {\n\ttype: 'ack-dimension',\n\tcellId: string;\n\toutputId: string;\n\theight: number;\n}\n\nexport interface IPreloadResource {\n\toriginalUri: string;\n\turi: string;\n}\n\nexport interface IUpdatePreloadResourceMessage {\n\ttype: 'preload';\n\tresources: IPreloadResource[];\n\tsource: 'renderer' | 'kernel';\n}\n\nexport interface IUpdateDecorationsMessage {\n\ttype: 'decorations';\n\tcellId: string;\n\taddedClassNames: string[];\n\tremovedClassNames: string[];\n}\n\nexport interface ICustomRendererMessage extends BaseToWebviewMessage {\n\ttype: 'customRendererMessage';\n\trendererId: string;\n\tmessage: unknown;\n}\n\nexport interface ICreateMarkdownMessage {\n\ttype: 'createMarkdownPreview',\n\tid: string;\n\thandle: number;\n\tcontent: string;\n\ttop: number;\n}\nexport interface IDeleteMarkdownMessage {\n\ttype: 'deleteMarkdownPreview',\n\tids: readonly string[];\n}\n\nexport interface IHideMarkdownMessage {\n\ttype: 'hideMarkdownPreviews';\n\tids: readonly string[];\n}\n\nexport interface IUnhideMarkdownMessage {\n\ttype: 'unhideMarkdownPreviews';\n\tids: readonly string[];\n}\n\nexport interface IShowMarkdownMessage {\n\ttype: 'showMarkdownPreview',\n\tid: string;\n\thandle: number;\n\tcontent: string | undefined;\n\ttop: number;\n}\n\nexport interface IUpdateSelectedMarkdownPreviews {\n\treadonly type: 'updateSelectedMarkdownPreviews',\n\treadonly selectedCellIds: readonly string[]\n}\n\nexport interface IInitializeMarkdownMessage {\n\ttype: 'initializeMarkdownPreview';\n\tcells: Array<{ cellId: string, cellHandle: number, content: string, offset: number }>;\n}\n\nexport type FromWebviewMessage =\n\t| WebviewIntialized\n\t| IDimensionMessage\n\t| IMouseEnterMessage\n\t| IMouseLeaveMessage\n\t| IOutputFocusMessage\n\t| IOutputBlurMessage\n\t| IWheelMessage\n\t| IScrollAckMessage\n\t| IBlurOutputMessage\n\t| ICustomRendererMessage\n\t| IClickedDataUrlMessage\n\t| IClickMarkdownPreviewMessage\n\t| IContextMenuMarkdownPreviewMessage\n\t| IMouseEnterMarkdownPreviewMessage\n\t| IMouseLeaveMarkdownPreviewMessage\n\t| IToggleMarkdownPreviewMessage\n\t| ICellDragStartMessage\n\t| ICellDragMessage\n\t| ICellDropMessage\n\t| ICellDragEndMessage\n\t| IInitializedMarkdownPreviewMessage\n\t| ITelemetryFoundRenderedMarkdownMath\n\t| ITelemetryFoundUnrenderedMarkdownMath\n\t;\n\nexport type ToWebviewMessage =\n\t| IClearMessage\n\t| IFocusOutputMessage\n\t| IAckOutputHeightMessage\n\t| ICreationRequestMessage\n\t| IViewScrollTopRequestMessage\n\t| IScrollRequestMessage\n\t| IClearOutputRequestMessage\n\t| IHideOutputMessage\n\t| IShowOutputMessage\n\t| IUpdatePreloadResourceMessage\n\t| IUpdateDecorationsMessage\n\t| ICustomRendererMessage\n\t| ICreateMarkdownMessage\n\t| IDeleteMarkdownMessage\n\t| IShowMarkdownMessage\n\t| IHideMarkdownMessage\n\t| IUnhideMarkdownMessage\n\t| IUpdateSelectedMarkdownPreviews\n\t| IInitializeMarkdownMessage;\n\nexport type AnyMessage = FromWebviewMessage | ToWebviewMessage;\n\nexport interface ICachedInset<K extends ICommonCellInfo> {\n\toutputId: string;\n\tcellInfo: K;\n\trenderer?: INotebookRendererInfo;\n\tcachedCreation: ICreationRequestMessage;\n}\n\nfunction html(strings: TemplateStringsArray, ...values: any[]): string {\n\tlet str = '';\n\tstrings.forEach((string, i) => {\n\t\tstr += string + (values[i] || '');\n\t});\n\treturn str;\n}\n\nexport interface INotebookWebviewMessage {\n\tmessage: unknown;\n\tforRenderer?: string;\n}\n\nexport interface IResolvedBackLayerWebview {\n\twebview: WebviewElement;\n}\n\nexport class BackLayerWebView<T extends ICommonCellInfo> extends Disposable {\n\telement: HTMLElement;\n\twebview: WebviewElement | undefined = undefined;\n\tinsetMapping: Map<IDisplayOutputViewModel, ICachedInset<T>> = new Map();\n\treadonly markdownPreviewMapping = new Map<string, { contentHash: number, visible: boolean }>();\n\thiddenInsetMapping: Set<IDisplayOutputViewModel> = new Set();\n\treversedInsetMapping: Map<string, IDisplayOutputViewModel> = new Map();\n\tlocalResourceRootsCache: URI[] | undefined = undefined;\n\trendererRootsCache: URI[] = [];\n\tkernelRootsCache: URI[] = [];\n\tprivate readonly _onMessage = this._register(new Emitter<INotebookWebviewMessage>());\n\tprivate readonly _preloadsCache = new Set<string>();\n\tpublic readonly onMessage: Event<INotebookWebviewMessage> = this._onMessage.event;\n\tprivate _loaded!: Promise<void>;\n\tprivate _initalized?: Promise<void>;\n\tprivate _disposed = false;\n\n\tconstructor(\n\t\tpublic notebookEditor: ICommonNotebookEditor,\n\t\tpublic id: string,\n\t\tpublic documentUri: URI,\n\t\tpublic options: {\n\t\t\toutputNodePadding: number,\n\t\t\toutputNodeLeftPadding: number,\n\t\t\tpreviewNodePadding: number,\n\t\t\tleftMargin: number,\n\t\t\trightMargin: number,\n\t\t\trunGutter: number,\n\t\t},\n\t\t@IWebviewService readonly webviewService: IWebviewService,\n\t\t@IOpenerService readonly openerService: IOpenerService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IMenuService private readonly menuService: IMenuService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t) {\n\t\tsuper();\n\n\t\tthis.element = document.createElement('div');\n\n\t\tthis.element.style.height = '1400px';\n\t\tthis.element.style.position = 'absolute';\n\t}\n\tprivate generateContent(coreDependencies: string, baseUrl: string) {\n\t\tconst markupRenderer = this.getMarkdownRenderer();\n\t\tconst outputWidth = `calc(100% - ${this.options.leftMargin + this.options.rightMargin + this.options.runGutter}px)`;\n\t\tconst outputMarginLeft = `${this.options.leftMargin + this.options.runGutter}px`;\n\t\treturn html`\n\t\t<html lang=\"en\">\n\t\t\t<head>\n\t\t\t\t<meta charset=\"UTF-8\">\n\t\t\t\t<base href=\"${baseUrl}/\"/>\n\n\t\t\t\t<!--\n\t\t\t\tMarkdown previews are rendered using a shadow dom and are not effected by normal css.\n\t\t\t\tInsert this style node into all preview shadow doms for styling.\n\t\t\t\t-->\n\t\t\t\t<template id=\"preview-styles\">\n\t\t\t\t\t<style>\n\t\t\t\t\t\timg {\n\t\t\t\t\t\t\tmax-width: 100%;\n\t\t\t\t\t\t\tmax-height: 100%;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ta {\n\t\t\t\t\t\t\ttext-decoration: none;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ta:hover {\n\t\t\t\t\t\t\ttext-decoration: underline;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ta:focus,\n\t\t\t\t\t\tinput:focus,\n\t\t\t\t\t\tselect:focus,\n\t\t\t\t\t\ttextarea:focus {\n\t\t\t\t\t\t\toutline: 1px solid -webkit-focus-ring-color;\n\t\t\t\t\t\t\toutline-offset: -1px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thr {\n\t\t\t\t\t\t\tborder: 0;\n\t\t\t\t\t\t\theight: 2px;\n\t\t\t\t\t\t\tborder-bottom: 2px solid;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\th1 {\n\t\t\t\t\t\t\tfont-size: 26px;\n\t\t\t\t\t\t\tline-height: 31px;\n\t\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\t\tmargin-bottom: 13px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\th2 {\n\t\t\t\t\t\t\tfont-size: 19px;\n\t\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\t\tmargin-bottom: 10px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\th1,\n\t\t\t\t\t\th2,\n\t\t\t\t\t\th3 {\n\t\t\t\t\t\t\tfont-weight: normal;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdiv {\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Adjust margin of first item in markdown cell */\n\t\t\t\t\t\t*:first-child {\n\t\t\t\t\t\t\tmargin-top: 0px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* h1 tags don't need top margin */\n\t\t\t\t\t\th1:first-child {\n\t\t\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Removes bottom margin when only one item exists in markdown cell */\n\t\t\t\t\t\t*:only-child,\n\t\t\t\t\t\t*:last-child {\n\t\t\t\t\t\t\tmargin-bottom: 0;\n\t\t\t\t\t\t\tpadding-bottom: 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* makes all markdown cells consistent */\n\t\t\t\t\t\tdiv {\n\t\t\t\t\t\t\tmin-height: ${this.options.previewNodePadding * 2}px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttable {\n\t\t\t\t\t\t\tborder-collapse: collapse;\n\t\t\t\t\t\t\tborder-spacing: 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttable th,\n\t\t\t\t\t\ttable td {\n\t\t\t\t\t\t\tborder: 1px solid;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttable > thead > tr > th {\n\t\t\t\t\t\t\ttext-align: left;\n\t\t\t\t\t\t\tborder-bottom: 1px solid;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttable > thead > tr > th,\n\t\t\t\t\t\ttable > thead > tr > td,\n\t\t\t\t\t\ttable > tbody > tr > th,\n\t\t\t\t\t\ttable > tbody > tr > td {\n\t\t\t\t\t\t\tpadding: 5px 10px;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttable > tbody > tr + tr > td {\n\t\t\t\t\t\t\tborder-top: 1px solid;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tblockquote {\n\t\t\t\t\t\t\tmargin: 0 7px 0 5px;\n\t\t\t\t\t\t\tpadding: 0 16px 0 10px;\n\t\t\t\t\t\t\tborder-left-width: 5px;\n\t\t\t\t\t\t\tborder-left-style: solid;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\t.code {\n\t\t\t\t\t\t\tfont-family: var(--monaco-monospace-font);\n\t\t\t\t\t\t\tfont-size: 1em;\n\t\t\t\t\t\t\tline-height: 1.357em;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.code {\n\t\t\t\t\t\t\twhite-space: pre-wrap;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.latex-block {\n\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.latex {\n\t\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.latex img,\n\t\t\t\t\t\t.latex-block img {\n\t\t\t\t\t\t\tfilter: brightness(0) invert(0)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdragging {\n\t\t\t\t\t\t\tbackground-color: var(--vscode-editor-background);\n\t\t\t\t\t\t}\n\t\t\t\t\t</style>\n\t\t\t\t</template>\n\t\t\t\t<style>\n\t\t\t\t\t#container .cell_container {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .output_container {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div > div > div.output {\n\t\t\t\t\t\twidth: ${outputWidth};\n\t\t\t\t\t\tmargin-left: ${outputMarginLeft};\n\t\t\t\t\t\tpadding: ${this.options.outputNodePadding}px ${this.options.outputNodePadding}px ${this.options.outputNodePadding}px ${this.options.outputNodeLeftPadding}px;\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\tbackground-color: var(--vscode-notebook-outputContainerBackgroundColor);\n\t\t\t\t\t}\n\n\t\t\t\t\t/* markdown */\n\t\t\t\t\t#container > div.preview {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tpadding-right: ${this.options.previewNodePadding}px;\n\t\t\t\t\t\tpadding-left: ${this.options.leftMargin}px;\n\t\t\t\t\t\tpadding-top: ${this.options.previewNodePadding}px;\n\t\t\t\t\t\tpadding-bottom: ${this.options.previewNodePadding}px;\n\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\tuser-select: none;\n\t\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\t\t-ms-user-select: none;\n\t\t\t\t\t\twhite-space: initial;\n\t\t\t\t\t\tcursor: grab;\n\n\t\t\t\t\t\tcolor: var(--vscode-foreground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.preview.emptyMarkdownCell::before {\n\t\t\t\t\t\tcontent: \"${nls.localize('notebook.emptyMarkdownPlaceholder', \"Empty markdown cell, double click or press enter to edit.\")}\";\n\t\t\t\t\t\tfont-style: italic;\n\t\t\t\t\t\topacity: 0.6;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.preview.selected {\n\t\t\t\t\t\tbackground: var(--vscode-notebook-selectedCellBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.preview.dragging {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t.monaco-workbench.vs-dark .notebookOverlay .cell.markdown .latex img,\n\t\t\t\t\t.monaco-workbench.vs-dark .notebookOverlay .cell.markdown .latex-block img {\n\t\t\t\t\t\tfilter: brightness(0) invert(1)\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-symbolHighlight > div {\n\t\t\t\t\t\tbackground-color: var(--vscode-notebook-symbolHighlightBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-cellDeleted > div {\n\t\t\t\t\t\tbackground-color: var(--vscode-diffEditor-removedTextBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-cellAdded > div {\n\t\t\t\t\t\tbackground-color: var(--vscode-diffEditor-insertedTextBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div > div:not(.preview) > div {\n\t\t\t\t\t\toverflow-x: scroll;\n\t\t\t\t\t}\n\n\t\t\t\t\tbody {\n\t\t\t\t\t\tpadding: 0px;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable, thead, tr, th, td, tbody {\n\t\t\t\t\t\tborder: none !important;\n\t\t\t\t\t\tborder-color: transparent;\n\t\t\t\t\t\tborder-spacing: 0;\n\t\t\t\t\t\tborder-collapse: collapse;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable, th, tr {\n\t\t\t\t\t\ttext-align: left !important;\n\t\t\t\t\t}\n\n\t\t\t\t\tthead {\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tbackground-color: rgba(130, 130, 130, 0.16);\n\t\t\t\t\t}\n\n\t\t\t\t\tth, td {\n\t\t\t\t\t\tpadding: 4px 8px;\n\t\t\t\t\t}\n\n\t\t\t\t\ttr:nth-child(even) {\n\t\t\t\t\t\tbackground-color: rgba(130, 130, 130, 0.08);\n\t\t\t\t\t}\n\n\t\t\t\t\ttbody th {\n\t\t\t\t\t\tfont-weight: normal;\n\t\t\t\t\t}\n\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body style=\"overflow: hidden;\">\n\t\t\t\t<script>\n\t\t\t\t\tself.require = {};\n\t\t\t\t</script>\n\t\t\t\t${coreDependencies}\n\t\t\t\t<div id='container' class=\"widgetarea\" style=\"position: absolute;width:100%;top: 0px\"></div>\n\t\t\t\t<script type=\"module\">${preloadsScriptStr({\n\t\t\toutputNodePadding: this.options.outputNodePadding,\n\t\t\toutputNodeLeftPadding: this.options.outputNodeLeftPadding,\n\t\t}, {\n\t\t\tentrypoint: markupRenderer[0].entrypoint,\n\t\t\tdependencies: markupRenderer[0].dependencies,\n\t\t})}</script>\n\t\t\t</body>\n\t\t</html>`;\n\t}\n\n\tprivate getMarkdownRenderer(): Array<{ entrypoint: string, dependencies: Array<{ entrypoint: string }> }> {\n\t\tconst allRenderers = this.notebookService.getMarkupRendererInfo();\n\n\t\tconst topLevelMarkdownRenderers = allRenderers\n\t\t\t.filter(renderer => !renderer.dependsOn)\n\t\t\t.filter(renderer => renderer.mimeTypes?.includes('text/markdown'));\n\n\t\tconst subRenderers = new Map<string, Array<{ entrypoint: string }>>();\n\t\tfor (const renderer of allRenderers) {\n\t\t\tif (renderer.dependsOn) {\n\t\t\t\tif (!subRenderers.has(renderer.dependsOn)) {\n\t\t\t\t\tsubRenderers.set(renderer.dependsOn, []);\n\t\t\t\t}\n\t\t\t\tconst entryPoint = asWebviewUri(this.environmentService, this.id, renderer.entrypoint);\n\t\t\t\tsubRenderers.get(renderer.dependsOn)!.push({ entrypoint: entryPoint.toString(true) });\n\t\t\t}\n\t\t}\n\n\t\treturn topLevelMarkdownRenderers.map((renderer) => {\n\t\t\tconst src = asWebviewUri(this.environmentService, this.id, renderer.entrypoint);\n\t\t\treturn {\n\t\t\t\tentrypoint: src.toString(),\n\t\t\t\tdependencies: subRenderers.get(renderer.id) || [],\n\t\t\t};\n\t\t});\n\t}\n\n\tpostRendererMessage(rendererId: string, message: any) {\n\t\tthis._sendMessageToWebview({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype: 'customRendererMessage',\n\t\t\tmessage,\n\t\t\trendererId\n\t\t});\n\t}\n\n\tprivate resolveOutputId(id: string): { cellInfo: T, output: ICellOutputViewModel } | undefined {\n\t\tconst output = this.reversedInsetMapping.get(id);\n\t\tif (!output) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellInfo = this.insetMapping.get(output)!.cellInfo;\n\t\treturn { cellInfo, output };\n\t}\n\n\tisResolved(): this is IResolvedBackLayerWebview {\n\t\treturn !!this.webview;\n\t}\n\n\tasync createWebview(): Promise<void> {\n\t\tlet coreDependencies = '';\n\t\tlet resolveFunc: () => void;\n\n\t\tthis._initalized = new Promise<void>((resolve, reject) => {\n\t\t\tresolveFunc = resolve;\n\t\t});\n\n\t\tconst baseUrl = asWebviewUri(this.environmentService, this.id, dirname(this.documentUri));\n\n\t\tif (!isWeb) {\n\t\t\tconst loaderUri = FileAccess.asFileUri('vs/loader.js', require);\n\t\t\tconst loader = asWebviewUri(this.environmentService, this.id, loaderUri);\n\n\t\t\tcoreDependencies = `<script src=\"${loader}\"></script><script>\n\t\t\tvar requirejs = (function() {\n\t\t\t\treturn require;\n\t\t\t}());\n\t\t\t</script>`;\n\t\t\tconst htmlContent = this.generateContent(coreDependencies, baseUrl.toString());\n\t\t\tthis._initialize(htmlContent);\n\t\t\tresolveFunc!();\n\t\t} else {\n\t\t\tconst loaderUri = FileAccess.asBrowserUri('vs/loader.js', require);\n\n\t\t\tfetch(loaderUri.toString(true)).then(async response => {\n\t\t\t\tif (response.status !== 200) {\n\t\t\t\t\tthrow new Error(response.statusText);\n\t\t\t\t}\n\n\t\t\t\tconst loaderJs = await response.text();\n\n\t\t\t\tcoreDependencies = `\n<script>\n${loaderJs}\n</script>\n<script>\nvar requirejs = (function() {\n\treturn require;\n}());\n</script>\n`;\n\n\t\t\t\tconst htmlContent = this.generateContent(coreDependencies, baseUrl.toString());\n\t\t\t\tthis._initialize(htmlContent);\n\t\t\t\tresolveFunc!();\n\t\t\t}, error => {\n\t\t\t\t// the fetch request is rejected\n\t\t\t\tconst htmlContent = this.generateContent(coreDependencies, baseUrl.toString());\n\t\t\t\tthis._initialize(htmlContent);\n\t\t\t\tresolveFunc!();\n\t\t\t});\n\t\t}\n\n\t\tawait this._initalized;\n\t}\n\n\tprivate async _initialize(content: string) {\n\t\tif (!document.body.contains(this.element)) {\n\t\t\tthrow new Error('Element is already detached from the DOM tree');\n\t\t}\n\n\t\tthis.webview = this._createInset(this.webviewService, content);\n\t\tthis.webview.mountTo(this.element);\n\t\tthis._register(this.webview);\n\n\t\tthis._register(this.webview.onDidClickLink(link => {\n\t\t\tif (this._disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!link) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (matchesScheme(link, Schemas.http) || matchesScheme(link, Schemas.https) || matchesScheme(link, Schemas.mailto)\n\t\t\t\t|| matchesScheme(link, Schemas.command)) {\n\t\t\t\tthis.openerService.open(link, { fromUserGesture: true, allowContributedOpeners: true, allowCommands: true });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.webview.onDidReload(() => {\n\t\t\tif (this._disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet renderers = new Set<INotebookRendererInfo>();\n\t\t\tfor (const inset of this.insetMapping.values()) {\n\t\t\t\tif (inset.renderer) {\n\t\t\t\t\trenderers.add(inset.renderer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._preloadsCache.clear();\n\t\t\tthis.updateRendererPreloads(renderers);\n\n\t\t\tfor (const [output, inset] of this.insetMapping.entries()) {\n\t\t\t\tthis._sendMessageToWebview({ ...inset.cachedCreation, initiallyHidden: this.hiddenInsetMapping.has(output) });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.webview.onMessage((message) => {\n\t\t\tconst data: FromWebviewMessage | { readonly __vscode_notebook_message: undefined } = message.message;\n\t\t\tif (this._disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!data.__vscode_notebook_message) {\n\t\t\t\tthis._onMessage.fire({ message: data });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (data.type) {\n\t\t\t\tcase 'dimension':\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (const update of data.updates) {\n\t\t\t\t\t\t\tconst height = update.height;\n\t\t\t\t\t\t\tif (update.isOutput) {\n\t\t\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(update.id);\n\t\t\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\t\t\tconst { cellInfo, output } = resolvedResult;\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.updateOutputHeight(cellInfo, output, height, !!update.init, 'webview#dimension');\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.scheduleOutputHeightAck(cellInfo, update.id, height);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.notebookEditor.updateMarkdownCellHeight(update.id, height, !!update.init);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'mouseenter':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\t\tlatestCell.outputIsHovered = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'mouseleave':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\t\tlatestCell.outputIsHovered = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'outputFocus':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\t\tlatestCell.outputIsFocused = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'outputBlur':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\t\tlatestCell.outputIsFocused = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'scroll-ack':\n\t\t\t\t\t{\n\t\t\t\t\t\t// const date = new Date();\n\t\t\t\t\t\t// const top = data.data.top;\n\t\t\t\t\t\t// console.log('ack top ', top, ' version: ', data.version, ' - ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'did-scroll-wheel':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notebookEditor.triggerScroll({\n\t\t\t\t\t\t\t...data.payload,\n\t\t\t\t\t\t\tpreventDefault: () => { },\n\t\t\t\t\t\t\tstopPropagation: () => { }\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'focus-editor':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\t\tif (!latestCell) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.focusNext) {\n\t\t\t\t\t\t\t\tthis.notebookEditor.focusNextNotebookCell(latestCell, 'editor');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.notebookEditor.focusNotebookCell(latestCell, 'editor');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'clicked-data-url':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onDidClickDataLink(data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'customRendererMessage':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onMessage.fire({ message: data.message, forRenderer: data.rendererId });\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'clickMarkdownPreview':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t\tif (data.shiftKey || (isMacintosh ? data.metaKey : data.ctrlKey)) {\n\t\t\t\t\t\t\t\t// Add to selection\n\t\t\t\t\t\t\t\tthis.notebookEditor.toggleNotebookCellSelection(cell);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Normal click\n\t\t\t\t\t\t\t\tthis.notebookEditor.focusNotebookCell(cell, 'container', { skipReveal: true });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'contextMenuMarkdownPreview':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t\t// Focus the cell first\n\t\t\t\t\t\t\tthis.notebookEditor.focusNotebookCell(cell, 'container', { skipReveal: true });\n\n\t\t\t\t\t\t\t// Then show the context menu\n\t\t\t\t\t\t\tconst webviewRect = this.element.getBoundingClientRect();\n\t\t\t\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\t\t\t\tgetActions: () => {\n\t\t\t\t\t\t\t\t\tconst result: IAction[] = [];\n\t\t\t\t\t\t\t\t\tconst menu = this.menuService.createMenu(MenuId.NotebookCellTitle, this.contextKeyService);\n\t\t\t\t\t\t\t\t\tcreateAndFillInContextMenuActions(menu, undefined, result);\n\t\t\t\t\t\t\t\t\tmenu.dispose();\n\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tgetAnchor: () => ({\n\t\t\t\t\t\t\t\t\tx: webviewRect.x + data.clientX,\n\t\t\t\t\t\t\t\t\ty: webviewRect.y + data.clientY\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'toggleMarkdownPreview':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t\tthis.notebookEditor.setMarkdownCellEditState(data.cellId, CellEditState.Editing);\n\t\t\t\t\t\t\tthis.notebookEditor.focusNotebookCell(cell, 'editor', { skipReveal: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'mouseEnterMarkdownPreview':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\t\tif (cell instanceof MarkdownCellViewModel) {\n\t\t\t\t\t\t\tcell.cellIsHovered = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'mouseLeaveMarkdownPreview':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\t\tif (cell instanceof MarkdownCellViewModel) {\n\t\t\t\t\t\t\tcell.cellIsHovered = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'cell-drag-start':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notebookEditor.markdownCellDragStart(data.cellId, data.position);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'cell-drag':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notebookEditor.markdownCellDrag(data.cellId, data.position);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'cell-drop':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notebookEditor.markdownCellDrop(data.cellId, {\n\t\t\t\t\t\t\tclientY: data.position.clientY,\n\t\t\t\t\t\t\tctrlKey: data.ctrlKey,\n\t\t\t\t\t\t\taltKey: data.altKey,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'cell-drag-end':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notebookEditor.markdownCellDragEnd(data.cellId);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\tcase 'telemetryFoundRenderedMarkdownMath':\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.telemetryService.publicLog2<{}, {}>('notebook/markdown/renderedLatex', {});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'telemetryFoundUnrenderedMarkdownMath':\n\t\t\t\t\t{\n\t\t\t\t\t\ttype Classification = {\n\t\t\t\t\t\t\tlatexDirective: { classification: 'SystemMetaData', purpose: 'FeatureInsight'; };\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\ttype TelemetryEvent = {\n\t\t\t\t\t\t\tlatexDirective: string;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.telemetryService.publicLog2<TelemetryEvent, Classification>('notebook/markdown/foundUnrenderedLatex', {\n\t\t\t\t\t\t\tlatexDirective: data.latexDirective\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async _onDidClickDataLink(event: IClickedDataUrlMessage): Promise<void> {\n\t\tif (typeof event.data !== 'string') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [splitStart, splitData] = event.data.split(';base64,');\n\t\tif (!splitData || !splitStart) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst defaultDir = dirname(this.documentUri);\n\t\tlet defaultName: string;\n\t\tif (event.downloadName) {\n\t\t\tdefaultName = event.downloadName;\n\t\t} else {\n\t\t\tconst mimeType = splitStart.replace(/^data:/, '');\n\t\t\tconst candidateExtension = mimeType && getExtensionForMimeType(mimeType);\n\t\t\tdefaultName = candidateExtension ? `download${candidateExtension}` : 'download';\n\t\t}\n\n\t\tconst defaultUri = joinPath(defaultDir, defaultName);\n\t\tconst newFileUri = await this.fileDialogService.showSaveDialog({\n\t\t\tdefaultUri\n\t\t});\n\t\tif (!newFileUri) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst decoded = atob(splitData);\n\t\tconst typedArray = new Uint8Array(decoded.length);\n\t\tfor (let i = 0; i < decoded.length; i++) {\n\t\t\ttypedArray[i] = decoded.charCodeAt(i);\n\t\t}\n\n\t\tconst buff = VSBuffer.wrap(typedArray);\n\t\tawait this.fileService.writeFile(newFileUri, buff);\n\t\tawait this.openerService.open(newFileUri);\n\t}\n\n\tprivate _createInset(webviewService: IWebviewService, content: string) {\n\t\tconst rootPath = isWeb ? FileAccess.asBrowserUri('', require) : FileAccess.asFileUri('', require);\n\n\t\tconst workspaceFolders = this.contextService.getWorkspace().folders.map(x => x.uri);\n\n\t\tthis.localResourceRootsCache = [\n\t\t\t...this.notebookService.getNotebookProviderResourceRoots(),\n\t\t\t...this.notebookService.getMarkupRendererInfo().map(x => dirname(x.entrypoint)),\n\t\t\t...workspaceFolders,\n\t\t\trootPath,\n\t\t];\n\n\t\tconst webview = webviewService.createWebviewElement(this.id, {\n\t\t\tpurpose: WebviewContentPurpose.NotebookRenderer,\n\t\t\tenableFindWidget: false,\n\t\t\ttransformCssVariables: transformWebviewThemeVars,\n\t\t\tserviceWorkerFetchIgnoreSubdomain: true\n\t\t}, {\n\t\t\tallowMultipleAPIAcquire: true,\n\t\t\tallowScripts: true,\n\t\t\tlocalResourceRoots: this.localResourceRootsCache,\n\t\t\tuseRootAuthority: true\n\t\t}, undefined);\n\n\t\tlet resolveFunc: () => void;\n\t\tthis._loaded = new Promise<void>((resolve, reject) => {\n\t\t\tresolveFunc = resolve;\n\t\t});\n\n\t\tconst dispose = webview.onMessage((message) => {\n\t\t\tconst data: FromWebviewMessage = message.message;\n\t\t\tif (data.__vscode_notebook_message && data.type === 'initialized') {\n\t\t\t\tresolveFunc();\n\t\t\t\tdispose.dispose();\n\t\t\t}\n\t\t});\n\n\t\twebview.html = content;\n\t\treturn webview;\n\t}\n\n\tprivate shouldUpdateInset(cell: IGenericCellViewModel, output: ICellOutputViewModel, cellTop: number, outputOffset: number): boolean {\n\t\tif (this._disposed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (cell.metadata?.outputCollapsed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hiddenInsetMapping.has(output)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(output);\n\t\tif (!outputCache) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (outputOffset === outputCache.cachedCreation.outputOffset && cellTop === outputCache.cachedCreation.cellTop) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tackHeight(cellId: string, id: string, height: number): void {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'ack-dimension',\n\t\t\tcellId: cellId,\n\t\t\toutputId: id,\n\t\t\theight: height\n\t\t});\n\t}\n\n\tupdateScrollTops(outputRequests: IDisplayOutputLayoutUpdateRequest[], markdownPreviews: { id: string, top: number }[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst widgets = coalesce(outputRequests.map((request): IContentWidgetTopRequest | undefined => {\n\t\t\tconst outputCache = this.insetMapping.get(request.output);\n\t\t\tif (!outputCache) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!request.forceDisplay && !this.shouldUpdateInset(request.cell, request.output, request.cellTop, request.outputOffset)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst id = outputCache.outputId;\n\t\t\toutputCache.cachedCreation.cellTop = request.cellTop;\n\t\t\toutputCache.cachedCreation.outputOffset = request.outputOffset;\n\t\t\tthis.hiddenInsetMapping.delete(request.output);\n\n\t\t\treturn {\n\t\t\t\toutputId: id,\n\t\t\t\tcellTop: request.cellTop,\n\t\t\t\toutputOffset: request.outputOffset,\n\t\t\t\tforceDisplay: request.forceDisplay,\n\t\t\t};\n\t\t}));\n\n\t\tif (!widgets.length && !markdownPreviews.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'view-scroll',\n\t\t\twidgets: widgets,\n\t\t\tmarkdownPreviews,\n\t\t});\n\t}\n\n\tprivate async createMarkdownPreview(cellId: string, cellHandle: number, content: string, cellTop: number, contentHash: number) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.markdownPreviewMapping.has(cellId)) {\n\t\t\tconsole.error('Trying to create markdown preview that already exists');\n\t\t\treturn;\n\t\t}\n\n\t\tconst initialTop = cellTop;\n\t\tthis.markdownPreviewMapping.set(cellId, { contentHash, visible: true });\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'createMarkdownPreview',\n\t\t\tid: cellId,\n\t\t\thandle: cellHandle,\n\t\t\tcontent: content,\n\t\t\ttop: initialTop,\n\t\t});\n\t}\n\n\tasync showMarkdownPreview(cellId: string, cellHandle: number, content: string, cellTop: number, contentHash: number) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.markdownPreviewMapping.has(cellId)) {\n\t\t\treturn this.createMarkdownPreview(cellId, cellHandle, content, cellTop, contentHash);\n\t\t}\n\n\t\tconst entry = this.markdownPreviewMapping.get(cellId);\n\t\tif (!entry) {\n\t\t\tconsole.error('Try to show a preview that does not exist');\n\t\t\treturn;\n\t\t}\n\n\t\tif (entry.contentHash !== contentHash || !entry.visible) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'showMarkdownPreview',\n\t\t\t\tid: cellId,\n\t\t\t\thandle: cellHandle,\n\t\t\t\t// If the content has not changed, we still want to make sure the\n\t\t\t\t// preview is visible but don't need to send anything over\n\t\t\t\tcontent: entry.contentHash === contentHash ? undefined : content,\n\t\t\t\ttop: cellTop\n\t\t\t});\n\t\t}\n\n\t\tentry.contentHash = contentHash;\n\t\tentry.visible = true;\n\t}\n\n\tasync hideMarkdownPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellsToHide: string[] = [];\n\t\tfor (const cellId of cellIds) {\n\t\t\tconst entry = this.markdownPreviewMapping.get(cellId);\n\t\t\tif (entry) {\n\t\t\t\tif (entry.visible) {\n\t\t\t\t\tcellsToHide.push(cellId);\n\t\t\t\t\tentry.visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (cellsToHide.length) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'hideMarkdownPreviews',\n\t\t\t\tids: cellsToHide\n\t\t\t});\n\t\t}\n\t}\n\n\tasync unhideMarkdownPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst toUnhide: string[] = [];\n\t\tfor (const cellId of cellIds) {\n\t\t\tconst entry = this.markdownPreviewMapping.get(cellId);\n\t\t\tif (entry) {\n\t\t\t\tif (!entry.visible) {\n\t\t\t\t\tentry.visible = true;\n\t\t\t\t\ttoUnhide.push(cellId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error(`Trying to unhide a preview that does not exist: ${cellId}`);\n\t\t\t}\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'unhideMarkdownPreviews',\n\t\t\tids: toUnhide,\n\t\t});\n\t}\n\n\tasync deleteMarkdownPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const id of cellIds) {\n\t\t\tif (!this.markdownPreviewMapping.has(id)) {\n\t\t\t\tconsole.error(`Trying to delete a preview that does not exist: ${id}`);\n\t\t\t}\n\t\t\tthis.markdownPreviewMapping.delete(id);\n\t\t}\n\n\t\tif (cellIds.length) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'deleteMarkdownPreview',\n\t\t\t\tids: cellIds\n\t\t\t});\n\t\t}\n\t}\n\n\tasync updateMarkdownPreviewSelections(selectedCellsIds: string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'updateSelectedMarkdownPreviews',\n\t\t\tselectedCellIds: selectedCellsIds.filter(id => this.markdownPreviewMapping.has(id)),\n\t\t});\n\t}\n\n\tasync initializeMarkdown(cells: Array<{ cellId: string, cellHandle: number, content: string, offset: number }>) {\n\t\tawait this._loaded;\n\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO: use proper handler\n\t\tconst p = new Promise<void>(resolve => {\n\t\t\tthis.webview?.onMessage(e => {\n\t\t\t\tif (e.message.type === 'initializedMarkdownPreview') {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tfor (const cell of cells) {\n\t\t\tthis.markdownPreviewMapping.set(cell.cellId, { contentHash: 0, visible: false });\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'initializeMarkdownPreview',\n\t\t\tcells: cells,\n\t\t});\n\n\t\tawait p;\n\t}\n\n\tasync createOutput(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.insetMapping.has(content.source)) {\n\t\t\tconst outputCache = this.insetMapping.get(content.source);\n\n\t\t\tif (outputCache) {\n\t\t\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\ttype: 'showOutput',\n\t\t\t\t\tcellId: outputCache.cellInfo.cellId,\n\t\t\t\t\toutputId: outputCache.outputId,\n\t\t\t\t\tcellTop: cellTop,\n\t\t\t\t\toutputOffset: offset\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst messageBase = {\n\t\t\ttype: 'html',\n\t\t\tcellId: cellInfo.cellId,\n\t\t\tcellTop: cellTop,\n\t\t\toutputOffset: offset,\n\t\t\tleft: 0,\n\t\t\trequiredPreloads: [],\n\t\t} as const;\n\n\t\tlet message: ICreationRequestMessage;\n\t\tlet renderer: INotebookRendererInfo | undefined;\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\tconst output = content.source.model;\n\t\t\trenderer = content.renderer;\n\t\t\tconst outputDto = output.outputs.find(op => op.mime === content.mimeType);\n\t\t\tmessage = {\n\t\t\t\t...messageBase,\n\t\t\t\toutputId: output.outputId,\n\t\t\t\tapiNamespace: content.renderer.id,\n\t\t\t\trequiredPreloads: await this.updateRendererPreloads([content.renderer]),\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: RenderOutputType.Extension,\n\t\t\t\t\toutputId: output.outputId,\n\t\t\t\t\tmimeType: content.mimeType,\n\t\t\t\t\tvalue: outputDto?.value,\n\t\t\t\t\tmetadata: outputDto?.metadata,\n\t\t\t\t},\n\t\t\t};\n\t\t} else {\n\t\t\tmessage = {\n\t\t\t\t...messageBase,\n\t\t\t\toutputId: UUID.generateUuid(),\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: content.type,\n\t\t\t\t\thtmlContent: content.htmlContent,\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tthis._sendMessageToWebview(message);\n\t\tthis.insetMapping.set(content.source, { outputId: message.outputId, cellInfo: cellInfo, renderer, cachedCreation: message });\n\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\tthis.reversedInsetMapping.set(message.outputId, content.source);\n\t}\n\n\tremoveInsets(outputs: readonly ICellOutputViewModel[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const output of outputs) {\n\t\t\tconst outputCache = this.insetMapping.get(output);\n\t\t\tif (!outputCache) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst id = outputCache.outputId;\n\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'clearOutput',\n\t\t\t\tapiNamespace: outputCache.cachedCreation.apiNamespace,\n\t\t\t\tcellUri: outputCache.cellInfo.cellUri.toString(),\n\t\t\t\toutputId: id,\n\t\t\t\tcellId: outputCache.cellInfo.cellId\n\t\t\t});\n\t\t\tthis.insetMapping.delete(output);\n\t\t\tthis.reversedInsetMapping.delete(id);\n\t\t}\n\t}\n\n\thideInset(output: ICellOutputViewModel) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(output);\n\t\tif (!outputCache) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hiddenInsetMapping.add(output);\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'hideOutput',\n\t\t\toutputId: outputCache.outputId,\n\t\t\tcellId: outputCache.cellInfo.cellId,\n\t\t});\n\t}\n\n\tclearInsets() {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'clear'\n\t\t});\n\n\t\tthis.insetMapping = new Map();\n\t\tthis.reversedInsetMapping = new Map();\n\t}\n\n\tfocusWebview() {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.focus();\n\t}\n\n\tfocusOutput(cellId: string) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.focus();\n\t\tsetTimeout(() => { // Need this, or focus decoration is not shown. No clue.\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'focus-output',\n\t\t\t\tcellId,\n\t\t\t});\n\t\t}, 50);\n\t}\n\n\tdeltaCellOutputContainerClassNames(cellId: string, added: string[], removed: string[]) {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'decorations',\n\t\t\tcellId,\n\t\t\taddedClassNames: added,\n\t\t\tremovedClassNames: removed\n\t\t});\n\n\t}\n\n\tasync updateKernelPreloads(extensionLocations: URI[], preloads: URI[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this._loaded;\n\n\t\tconst resources: IPreloadResource[] = [];\n\t\tfor (const preload of preloads) {\n\t\t\tconst uri = this.environmentService.isExtensionDevelopment && (preload.scheme === 'http' || preload.scheme === 'https')\n\t\t\t\t? preload : asWebviewUri(this.environmentService, this.id, preload);\n\n\t\t\tif (!this._preloadsCache.has(uri.toString())) {\n\t\t\t\tresources.push({ uri: uri.toString(), originalUri: preload.toString() });\n\t\t\t\tthis._preloadsCache.add(uri.toString());\n\t\t\t}\n\t\t}\n\n\t\tif (!resources.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kernelRootsCache = [...extensionLocations, ...this.kernelRootsCache];\n\t\tthis._updatePreloads(resources, 'kernel');\n\t}\n\n\tasync updateRendererPreloads(renderers: Iterable<INotebookRendererInfo>) {\n\t\tif (this._disposed) {\n\t\t\treturn [];\n\t\t}\n\n\t\tawait this._loaded;\n\n\t\tconst requiredPreloads: IPreloadResource[] = [];\n\t\tconst resources: IPreloadResource[] = [];\n\t\tconst extensionLocations: URI[] = [];\n\t\tfor (const rendererInfo of renderers) {\n\t\t\textensionLocations.push(rendererInfo.extensionLocation);\n\t\t\tfor (const preload of [rendererInfo.entrypoint, ...rendererInfo.preloads]) {\n\t\t\t\tconst uri = asWebviewUri(this.environmentService, this.id, preload);\n\t\t\t\tconst resource: IPreloadResource = { uri: uri.toString(), originalUri: preload.toString() };\n\t\t\t\trequiredPreloads.push(resource);\n\n\t\t\t\tif (!this._preloadsCache.has(uri.toString())) {\n\t\t\t\t\tresources.push(resource);\n\t\t\t\t\tthis._preloadsCache.add(uri.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!resources.length) {\n\t\t\treturn requiredPreloads;\n\t\t}\n\n\t\tthis.rendererRootsCache = extensionLocations;\n\t\tthis._updatePreloads(resources, 'renderer');\n\t\treturn requiredPreloads;\n\t}\n\n\tprivate _updatePreloads(resources: IPreloadResource[], source: 'renderer' | 'kernel') {\n\t\tif (!this.webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mixedResourceRoots = [...(this.localResourceRootsCache || []), ...this.rendererRootsCache, ...this.kernelRootsCache];\n\n\t\tthis.webview.localResourcesRoot = mixedResourceRoots;\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'preload',\n\t\t\tresources: resources,\n\t\t\tsource: source\n\t\t});\n\t}\n\n\tprivate _sendMessageToWebview(message: ToWebviewMessage) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.postMessage(message);\n\t}\n\n\tclearPreloadsCache() {\n\t\tthis._preloadsCache.clear();\n\t}\n\n\toverride dispose() {\n\t\tthis._disposed = true;\n\t\tthis.webview?.dispose();\n\t\tsuper.dispose();\n\t}\n}\n"]}