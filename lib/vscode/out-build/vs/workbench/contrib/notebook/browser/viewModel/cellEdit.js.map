{"version":3,"file":"cellEdit.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/browser/viewModel/cellEdit.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { CellKind, IOutputDto, NotebookCellMetadata, SelectionStateType } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { IResourceUndoRedoElement, UndoRedoElementType } from 'vs/platform/undoRedo/common/undoRedo';\nimport { URI } from 'vs/base/common/uri';\nimport { BaseCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel';\nimport { CellFocusMode } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { NotebookCellTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookCellTextModel';\nimport { ITextCellEditingDelegate } from 'vs/workbench/contrib/notebook/common/model/cellEdit';\n\n\nexport interface IViewCellEditingDelegate extends ITextCellEditingDelegate {\n\tcreateCellViewModel?(cell: NotebookCellTextModel): BaseCellViewModel;\n\tcreateCell?(index: number, source: string, language: string, type: CellKind, metadata: NotebookCellMetadata | undefined, outputs: IOutputDto[]): BaseCellViewModel;\n}\n\nexport class JoinCellEdit implements IResourceUndoRedoElement {\n\ttype: UndoRedoElementType.Resource = UndoRedoElementType.Resource;\n\tlabel: string = 'Join Cell';\n\tprivate _deletedRawCell: NotebookCellTextModel;\n\tconstructor(\n\t\tpublic resource: URI,\n\t\tprivate index: number,\n\t\tprivate direction: 'above' | 'below',\n\t\tprivate cell: BaseCellViewModel,\n\t\tprivate selections: Selection[],\n\t\tprivate inverseRange: Range,\n\t\tprivate insertContent: string,\n\t\tprivate removedCell: BaseCellViewModel,\n\t\tprivate editingDelegate: IViewCellEditingDelegate,\n\t) {\n\t\tthis._deletedRawCell = this.removedCell.model;\n\t}\n\n\tasync undo(): Promise<void> {\n\t\tif (!this.editingDelegate.insertCell || !this.editingDelegate.createCellViewModel) {\n\t\t\tthrow new Error('Notebook Insert Cell not implemented for Undo/Redo');\n\t\t}\n\n\t\tawait this.cell.resolveTextModel();\n\n\t\tthis.cell.textModel?.applyEdits([\n\t\t\t{ range: this.inverseRange, text: '' }\n\t\t]);\n\n\t\tthis.cell.setSelections(this.selections);\n\n\t\tconst cell = this.editingDelegate.createCellViewModel(this._deletedRawCell);\n\t\tif (this.direction === 'above') {\n\t\t\tthis.editingDelegate.insertCell(this.index, this._deletedRawCell, { kind: SelectionStateType.Handle, primary: cell.handle, selections: [cell.handle] });\n\t\t\tcell.focusMode = CellFocusMode.Editor;\n\t\t} else {\n\t\t\tthis.editingDelegate.insertCell(this.index, cell.model, { kind: SelectionStateType.Handle, primary: this.cell.handle, selections: [this.cell.handle] });\n\t\t\tthis.cell.focusMode = CellFocusMode.Editor;\n\t\t}\n\t}\n\n\tasync redo(): Promise<void> {\n\t\tif (!this.editingDelegate.deleteCell) {\n\t\t\tthrow new Error('Notebook Delete Cell not implemented for Undo/Redo');\n\t\t}\n\n\t\tawait this.cell.resolveTextModel();\n\t\tthis.cell.textModel?.applyEdits([\n\t\t\t{ range: this.inverseRange, text: this.insertContent }\n\t\t]);\n\n\t\tthis.editingDelegate.deleteCell(this.index, { kind: SelectionStateType.Handle, primary: this.cell.handle, selections: [this.cell.handle] });\n\t\tthis.cell.focusMode = CellFocusMode.Editor;\n\t}\n}\n"]}