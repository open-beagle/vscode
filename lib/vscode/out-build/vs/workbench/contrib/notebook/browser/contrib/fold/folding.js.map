{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/fold/folding.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IAmBhG,MAAa,iBAAkB,SAAQ,sBAAU;QAMhD,YAA6B,eAAgC;YAC5D,KAAK,EAAE,CAAC;YADoB,oBAAe,GAAf,eAAe,CAAiB;YAHrD,kBAAa,GAAwB,IAAI,CAAC;YACjC,gBAAW,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,2BAAe,EAAE,CAAC,CAAC;YAKpE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAE5E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,GAAG,EAAE;gBACzD,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;gBAEzB,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE;oBACpC,OAAO;iBACP;gBAED,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,eAAe,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE;;oBAC5F,IAAI,CAAC,CAAC,MAAM,CAAC,gBAAgB,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,KAAK,yBAAQ,CAAC,QAAQ,EAAE;wBACvE,MAAA,IAAI,CAAC,aAAa,0CAAE,SAAS,EAAE,CAAC;wBAChC,qCAAqC;qBACrC;gBACF,CAAC,CAAC,CAAC,CAAC;gBAEJ,IAAI,CAAC,aAAa,GAAG,IAAI,2BAAY,EAAE,CAAC;gBACxC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBACzC,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;gBAEnE,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,yBAAyB,CAAC,GAAG,EAAE;oBACtE,IAAI,CAAC,0BAA0B,EAAE,CAAC;gBACnC,CAAC,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAED,aAAa;;YACZ,OAAO,CAAA,MAAA,IAAI,CAAC,aAAa,0CAAE,UAAU,EAAE,KAAI,EAAE,CAAC;QAC/C,CAAC;QAED,gBAAgB,CAAC,KAA+B;;YAC/C,MAAA,IAAI,CAAC,aAAa,0CAAE,YAAY,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;YAC9C,IAAI,CAAC,0BAA0B,EAAE,CAAC;QACnC,CAAC;QAED,mBAAmB,CAAC,KAAa,EAAE,KAAuB,EAAE,MAAc;YACzE,MAAM,UAAU,GAAG,KAAK,KAAK,+BAAgB,CAAC,SAAS,CAAC;YACxD,IAAI,MAAM,GAAG,IAAI,CAAC,aAAc,CAAC,eAAe,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;YAC5D,IAAI,OAAO,GAAoB,EAAE,CAAC;YAClC,IAAI,MAAM,EAAE;gBACX,IAAI,MAAM,CAAC,WAAW,KAAK,UAAU,EAAE;oBACtC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;iBACrB;gBACD,IAAI,MAAM,GAAG,CAAC,EAAE;oBACf,IAAI,aAAa,GAAG,IAAI,CAAC,aAAc,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE,KAAa,EAAE,EAAE,CAAC,CAAC,CAAC,WAAW,KAAK,UAAU,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC;oBACvI,OAAO,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,CAAC;iBAC/B;aACD;YAED,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,aAAc,CAAC,YAAY,CAAC,CAAC,CAAC,WAAW,EAAE,KAAK,KAAK,+BAAgB,CAAC,SAAS,CAAC,CAAC,CAAC;YAC5G,IAAI,CAAC,0BAA0B,EAAE,CAAC;QACnC,CAAC;QAED,iBAAiB,CAAC,KAAa,EAAE,KAAuB,EAAE,MAAc;YACvE,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;gBACxB,OAAO;aACP;YAED,IAAI,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC,MAAM,CAAC,WAAW,KAAK,CAAC,KAAK,KAAK,+BAAgB,CAAC,SAAS,CAAC,IAAI,KAAK,IAAI,MAAM,CAAC,CAAC;YACrK,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,aAAc,CAAC,YAAY,CAAC,CAAC,CAAC,WAAW,EAAE,KAAK,KAAK,+BAAgB,CAAC,SAAS,CAAC,CAAC,CAAC;YAC5G,IAAI,CAAC,0BAA0B,EAAE,CAAC;QACnC,CAAC;QAEO,0BAA0B;YACjC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;gBACxB,OAAO;aACP;YAED,IAAI,CAAC,eAAe,CAAC,SAAU,CAAC,mBAAmB,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YAChF,MAAM,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,SAAU,CAAC,eAAe,EAAE,CAAC;YACvE,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC;QACnD,CAAC;QAED,SAAS,CAAC,CAA4B;YACrC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE;gBACpB,OAAO;aACP;YAED,MAAM,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC;YAEjD,IAAI,CAAC,SAAS,EAAE;gBACf,OAAO;aACP;YAED,MAAM,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,MAAqB,CAAC;YAE7C,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,4BAA4B,CAAC,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,2BAA2B,CAAC,EAAE;gBACtH,MAAM,MAAM,GAAG,MAAM,CAAC,aAA4B,CAAC;gBAEnD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,4BAA4B,CAAC,EAAE;oBAC7D,OAAO;iBACP;gBAED,eAAe;gBAEf,MAAM,aAAa,GAAG,CAAC,CAAC,MAAM,CAAC;gBAC/B,MAAM,UAAU,GAAG,SAAS,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;gBACzD,MAAM,KAAK,GAAG,SAAS,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;gBAEpD,IAAI,KAAK,KAAK,+BAAgB,CAAC,IAAI,EAAE;oBACpC,OAAO;iBACP;gBAED,IAAI,CAAC,iBAAiB,CAAC,UAAU,EAAE,KAAK,KAAK,+BAAgB,CAAC,SAAS,CAAC,CAAC,CAAC,+BAAgB,CAAC,QAAQ,CAAC,CAAC,CAAC,+BAAgB,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;gBACrI,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;aACjD;YAED,OAAO;QACR,CAAC;;IArHF,8CAsHC;IArHO,oBAAE,GAAW,mCAAmC,CAAC;IAuHzD,CAAA,GAAA,uDAA4B,CAAA,CAAC,iBAAiB,CAAC,EAAE,EAAE,iBAAiB,CAAC,CAAC;IAGtE,MAAM,2BAA2B,GAAG,CAAA,GAAA,cAAQ,CAAA,CAAC,CAAW,EAAE,IAAW,CAAC,CAAC;IACvE,MAAM,6BAA6B,GAAG,CAAA,GAAA,cAAQ,CAAA,CAAC,CAAa,EAAE,IAAa,CAAC,CAAC;IAE7E,CAAA,GAAA,yBAAe,CAAA,CAAC,KAAM,SAAQ,iBAAO;QACpC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,eAAe;gBACnB,KAAK,EAAE,EAAE,KAAK,EAAE,CAAA,GAAA,cAAQ,CAAA,CAAC,CAAW,EAAE,IAAW,CAAC,EAAE,QAAQ,EAAE,WAAW,EAAE;gBAC3E,QAAQ,EAAE,uCAAyB;gBACnC,UAAU,EAAE;oBACX,IAAI,EAAE,2BAAc,CAAC,GAAG,CAAC,yCAAuB,EAAE,2BAAc,CAAC,GAAG,CAAC,oCAAsB,CAAC,CAAC;oBAC7F,OAAO,EAAE,qCAA6B,kCAAiC;oBACvE,GAAG,EAAE;wBACJ,OAAO,EAAE,kCAA2B,kCAAiC;wBACrE,SAAS,EAAE,oBAAmB;qBAC9B;oBACD,SAAS,EAAE,oBAAmB;oBAC9B,MAAM,4BAAmC;iBACzC;gBACD,WAAW,EAAE;oBACZ,WAAW,EAAE,2BAA2B;oBACxC,IAAI,EAAE;wBACL;4BACC,UAAU,EAAE,IAAI;4BAChB,IAAI,EAAE,OAAO;4BACb,WAAW,EAAE,gBAAgB;4BAC7B,MAAM,EAAE;gCACP,MAAM,EAAE,QAAQ;gCAChB,UAAU,EAAE,CAAC,OAAO,EAAE,WAAW,CAAC;gCAClC,YAAY,EAAE;oCACb,OAAO,EAAE;wCACR,MAAM,EAAE,QAAQ;qCAChB;oCACD,WAAW,EAAE;wCACZ,MAAM,EAAE,QAAQ;wCAChB,MAAM,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC;wCACtB,SAAS,EAAE,MAAM;qCACjB;oCACD,QAAQ,EAAE;wCACT,MAAM,EAAE,QAAQ;wCAChB,SAAS,EAAE,CAAC;qCACZ;iCACD;6BACD;yBACD;qBACD;iBACD;gBACD,YAAY,EAAE,2CAAyB;gBACvC,EAAE,EAAE,IAAI;aACR,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,IAAkE;;YACvG,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,8BAAc,CAAC,CAAC;YAEnD,MAAM,MAAM,GAAG,CAAA,GAAA,iDAA+B,CAAA,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;YAC/E,IAAI,CAAC,MAAM,EAAE;gBACZ,OAAO;aACP;YAED,MAAM,MAAM,GAAG,IAAI,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC;YACxC,MAAM,SAAS,GAAG,IAAI,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;YAClE,IAAI,KAAK,GAAuB,SAAS,CAAC;YAE1C,IAAI,IAAI,EAAE;gBACT,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;aACnB;iBAAM;gBACN,MAAM,UAAU,GAAG,MAAM,CAAC,aAAa,EAAE,CAAC;gBAC1C,IAAI,CAAC,UAAU,EAAE;oBAChB,OAAO;iBACP;gBACD,KAAK,GAAG,MAAA,MAAM,CAAC,SAAS,0CAAE,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;aACxD;YAED,MAAM,UAAU,GAAG,MAAM,CAAC,eAAe,CAAoB,iBAAiB,CAAC,EAAE,CAAC,CAAC;YACnF,IAAI,KAAK,KAAK,SAAS,EAAE;gBACxB,MAAM,UAAU,GAAG,MAAA,MAAM,CAAC,SAAS,0CAAE,SAAS,CAAC,KAAK,CAAC,CAAC;gBACtD,IAAI,CAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,QAAQ,MAAK,yBAAQ,CAAC,IAAI,IAAI,SAAS,KAAK,MAAM,EAAE;oBACnE,OAAO;iBACP;gBAED,IAAI,SAAS,KAAK,IAAI,EAAE;oBACvB,UAAU,CAAC,iBAAiB,CAAC,KAAK,EAAE,+BAAgB,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;iBACxE;qBAAM;oBACN,UAAU,CAAC,mBAAmB,CAAC,KAAK,EAAE,+BAAgB,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;iBAC1E;gBAED,MAAM,SAAS,GAAG,MAAM,CAAC,SAAU,CAAC,iCAAiC,CAAC,KAAK,CAAC,CAAC;gBAC7E,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,SAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC;aAC5D;QACF,CAAC;KACD,CAAC,CAAC;IAEH,CAAA,GAAA,yBAAe,CAAA,CAAC,KAAM,SAAQ,iBAAO;QACpC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,iBAAiB;gBACrB,KAAK,EAAE,EAAE,KAAK,EAAE,6BAA6B,EAAE,QAAQ,EAAE,aAAa,EAAE;gBACxE,QAAQ,EAAE,uCAAyB;gBACnC,UAAU,EAAE;oBACX,IAAI,EAAE,2BAAc,CAAC,GAAG,CAAC,yCAAuB,EAAE,2BAAc,CAAC,GAAG,CAAC,oCAAsB,CAAC,CAAC;oBAC7F,OAAO,EAAE,qCAA6B,mCAAkC;oBACxE,GAAG,EAAE;wBACJ,OAAO,EAAE,kCAA2B,mCAAkC;wBACtE,SAAS,EAAE,qBAAoB;qBAC/B;oBACD,SAAS,EAAE,qBAAoB;oBAC/B,MAAM,4BAAmC;iBACzC;gBACD,WAAW,EAAE;oBACZ,WAAW,EAAE,6BAA6B;oBAC1C,IAAI,EAAE;wBACL;4BACC,UAAU,EAAE,IAAI;4BAChB,IAAI,EAAE,OAAO;4BACb,WAAW,EAAE,gBAAgB;4BAC7B,MAAM,EAAE;gCACP,MAAM,EAAE,QAAQ;gCAChB,UAAU,EAAE,CAAC,OAAO,EAAE,WAAW,CAAC;gCAClC,YAAY,EAAE;oCACb,OAAO,EAAE;wCACR,MAAM,EAAE,QAAQ;qCAChB;oCACD,WAAW,EAAE;wCACZ,MAAM,EAAE,QAAQ;wCAChB,MAAM,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC;wCACtB,SAAS,EAAE,MAAM;qCACjB;oCACD,QAAQ,EAAE;wCACT,MAAM,EAAE,QAAQ;wCAChB,SAAS,EAAE,CAAC;qCACZ;iCACD;6BACD;yBACD;qBACD;iBACD;gBACD,YAAY,EAAE,2CAAyB;gBACvC,EAAE,EAAE,IAAI;aACR,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,IAAkE;;YACvG,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,8BAAc,CAAC,CAAC;YAEnD,MAAM,MAAM,GAAG,CAAA,GAAA,iDAA+B,CAAA,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;YAC/E,IAAI,CAAC,MAAM,EAAE;gBACZ,OAAO;aACP;YAED,MAAM,MAAM,GAAG,IAAI,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC;YACxC,MAAM,SAAS,GAAG,IAAI,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;YAClE,IAAI,KAAK,GAAuB,SAAS,CAAC;YAE1C,IAAI,IAAI,EAAE;gBACT,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;aACnB;iBAAM;gBACN,MAAM,UAAU,GAAG,MAAM,CAAC,aAAa,EAAE,CAAC;gBAC1C,IAAI,CAAC,UAAU,EAAE;oBAChB,OAAO;iBACP;gBACD,KAAK,GAAG,MAAA,MAAM,CAAC,SAAS,0CAAE,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;aACxD;YAED,MAAM,UAAU,GAAG,MAAM,CAAC,eAAe,CAAoB,iBAAiB,CAAC,EAAE,CAAC,CAAC;YACnF,IAAI,KAAK,KAAK,SAAS,EAAE;gBACxB,IAAI,SAAS,KAAK,IAAI,EAAE;oBACvB,UAAU,CAAC,iBAAiB,CAAC,KAAK,EAAE,+BAAgB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;iBACvE;qBAAM;oBACN,UAAU,CAAC,mBAAmB,CAAC,KAAK,EAAE,+BAAgB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;iBACzE;aACD;QACF,CAAC;KACD,CAAC,CAAC","file":"folding.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { INotebookEditor, INotebookEditorMouseEvent, INotebookEditorContribution, NOTEBOOK_EDITOR_FOCUSED, NOTEBOOK_IS_ACTIVE_EDITOR, getNotebookEditorFromEditorPane } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CellFoldingState, FoldingModel } from 'vs/workbench/contrib/notebook/browser/contrib/fold/foldingModel';\nimport { CellKind } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ICellRange } from 'vs/workbench/contrib/notebook/common/notebookRange';\nimport { registerNotebookContribution } from 'vs/workbench/contrib/notebook/browser/notebookEditorExtensions';\nimport { registerAction2, Action2 } from 'vs/platform/actions/common/actions';\nimport { ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { InputFocusedContextKey } from 'vs/platform/contextkey/common/contextkeys';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { NOTEBOOK_ACTIONS_CATEGORY } from 'vs/workbench/contrib/notebook/browser/contrib/coreActions';\nimport { localize } from 'vs/nls';\nimport { FoldingRegion } from 'vs/editor/contrib/folding/foldingRanges';\n\nexport class FoldingController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.findController';\n\n\tprivate _foldingModel: FoldingModel | null = null;\n\tprivate readonly _localStore = this._register(new DisposableStore());\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(this._notebookEditor.onMouseUp(e => { this.onMouseUp(e); }));\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(() => {\n\t\t\tthis._localStore.clear();\n\n\t\t\tif (!this._notebookEditor.viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._localStore.add(this._notebookEditor.viewModel.eventDispatcher.onDidChangeCellState(e => {\n\t\t\t\tif (e.source.editStateChanged && e.cell.cellKind === CellKind.Markdown) {\n\t\t\t\t\tthis._foldingModel?.recompute();\n\t\t\t\t\t// this._updateEditorFoldingRanges();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._foldingModel = new FoldingModel();\n\t\t\tthis._localStore.add(this._foldingModel);\n\t\t\tthis._foldingModel.attachViewModel(this._notebookEditor.viewModel);\n\n\t\t\tthis._localStore.add(this._foldingModel.onDidFoldingRegionChanged(() => {\n\t\t\t\tthis._updateEditorFoldingRanges();\n\t\t\t}));\n\t\t}));\n\t}\n\n\tsaveViewState(): ICellRange[] {\n\t\treturn this._foldingModel?.getMemento() || [];\n\t}\n\n\trestoreViewState(state: ICellRange[] | undefined) {\n\t\tthis._foldingModel?.applyMemento(state || []);\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tsetFoldingStateDown(index: number, state: CellFoldingState, levels: number) {\n\t\tconst doCollapse = state === CellFoldingState.Collapsed;\n\t\tlet region = this._foldingModel!.getRegionAtLine(index + 1);\n\t\tlet regions: FoldingRegion[] = [];\n\t\tif (region) {\n\t\t\tif (region.isCollapsed !== doCollapse) {\n\t\t\t\tregions.push(region);\n\t\t\t}\n\t\t\tif (levels > 1) {\n\t\t\t\tlet regionsInside = this._foldingModel!.getRegionsInside(region, (r, level: number) => r.isCollapsed !== doCollapse && level < levels);\n\t\t\t\tregions.push(...regionsInside);\n\t\t\t}\n\t\t}\n\n\t\tregions.forEach(r => this._foldingModel!.setCollapsed(r.regionIndex, state === CellFoldingState.Collapsed));\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tsetFoldingStateUp(index: number, state: CellFoldingState, levels: number) {\n\t\tif (!this._foldingModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet regions = this._foldingModel.getAllRegionsAtLine(index + 1, (region, level) => region.isCollapsed !== (state === CellFoldingState.Collapsed) && level <= levels);\n\t\tregions.forEach(r => this._foldingModel!.setCollapsed(r.regionIndex, state === CellFoldingState.Collapsed));\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tprivate _updateEditorFoldingRanges() {\n\t\tif (!this._foldingModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookEditor.viewModel!.updateFoldingRanges(this._foldingModel.regions);\n\t\tconst hiddenRanges = this._notebookEditor.viewModel!.getHiddenRanges();\n\t\tthis._notebookEditor.setHiddenAreas(hiddenRanges);\n\t}\n\n\tonMouseUp(e: INotebookEditorMouseEvent) {\n\t\tif (!e.event.target) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewModel = this._notebookEditor.viewModel;\n\n\t\tif (!viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst target = e.event.target as HTMLElement;\n\n\t\tif (target.classList.contains('codicon-notebook-collapsed') || target.classList.contains('codicon-notebook-expanded')) {\n\t\t\tconst parent = target.parentElement as HTMLElement;\n\n\t\t\tif (!parent.classList.contains('notebook-folding-indicator')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// folding icon\n\n\t\t\tconst cellViewModel = e.target;\n\t\t\tconst modelIndex = viewModel.getCellIndex(cellViewModel);\n\t\t\tconst state = viewModel.getFoldingState(modelIndex);\n\n\t\t\tif (state === CellFoldingState.None) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setFoldingStateUp(modelIndex, state === CellFoldingState.Collapsed ? CellFoldingState.Expanded : CellFoldingState.Collapsed, 1);\n\t\t\tthis._notebookEditor.focusElement(cellViewModel);\n\t\t}\n\n\t\treturn;\n\t}\n}\n\nregisterNotebookContribution(FoldingController.id, FoldingController);\n\n\nconst NOTEBOOK_FOLD_COMMAND_LABEL = localize('fold.cell', \"Fold Cell\");\nconst NOTEBOOK_UNFOLD_COMMAND_LABEL = localize('unfold.cell', \"Unfold Cell\");\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.fold',\n\t\t\ttitle: { value: localize('fold.cell', \"Fold Cell\"), original: 'Fold Cell' },\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(NOTEBOOK_EDITOR_FOCUSED, ContextKeyExpr.not(InputFocusedContextKey)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.US_OPEN_SQUARE_BRACKET,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.US_OPEN_SQUARE_BRACKET,\n\t\t\t\t\tsecondary: [KeyCode.LeftArrow],\n\t\t\t\t},\n\t\t\t\tsecondary: [KeyCode.LeftArrow],\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tdescription: {\n\t\t\t\tdescription: NOTEBOOK_FOLD_COMMAND_LABEL,\n\t\t\t\targs: [\n\t\t\t\t\t{\n\t\t\t\t\t\tisOptional: true,\n\t\t\t\t\t\tname: 'index',\n\t\t\t\t\t\tdescription: 'The cell index',\n\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t'type': 'object',\n\t\t\t\t\t\t\t'required': ['index', 'direction'],\n\t\t\t\t\t\t\t'properties': {\n\t\t\t\t\t\t\t\t'index': {\n\t\t\t\t\t\t\t\t\t'type': 'number'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'direction': {\n\t\t\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t\t\t'enum': ['up', 'down'],\n\t\t\t\t\t\t\t\t\t'default': 'down'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'levels': {\n\t\t\t\t\t\t\t\t\t'type': 'number',\n\t\t\t\t\t\t\t\t\t'default': 1\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, args?: { index: number, levels: number, direction: 'up' | 'down' }): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst levels = args && args.levels || 1;\n\t\tconst direction = args && args.direction === 'up' ? 'up' : 'down';\n\t\tlet index: number | undefined = undefined;\n\n\t\tif (args) {\n\t\t\tindex = args.index;\n\t\t} else {\n\t\t\tconst activeCell = editor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tindex = editor.viewModel?.viewCells.indexOf(activeCell);\n\t\t}\n\n\t\tconst controller = editor.getContribution<FoldingController>(FoldingController.id);\n\t\tif (index !== undefined) {\n\t\t\tconst targetCell = editor.viewModel?.viewCells[index];\n\t\t\tif (targetCell?.cellKind === CellKind.Code && direction === 'down') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (direction === 'up') {\n\t\t\t\tcontroller.setFoldingStateUp(index, CellFoldingState.Collapsed, levels);\n\t\t\t} else {\n\t\t\t\tcontroller.setFoldingStateDown(index, CellFoldingState.Collapsed, levels);\n\t\t\t}\n\n\t\t\tconst viewIndex = editor.viewModel!.getNearestVisibleCellIndexUpwards(index);\n\t\t\teditor.focusElement(editor.viewModel!.viewCells[viewIndex]);\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.unfold',\n\t\t\ttitle: { value: NOTEBOOK_UNFOLD_COMMAND_LABEL, original: 'Unfold Cell' },\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(NOTEBOOK_EDITOR_FOCUSED, ContextKeyExpr.not(InputFocusedContextKey)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.US_CLOSE_SQUARE_BRACKET,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.US_CLOSE_SQUARE_BRACKET,\n\t\t\t\t\tsecondary: [KeyCode.RightArrow],\n\t\t\t\t},\n\t\t\t\tsecondary: [KeyCode.RightArrow],\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tdescription: {\n\t\t\t\tdescription: NOTEBOOK_UNFOLD_COMMAND_LABEL,\n\t\t\t\targs: [\n\t\t\t\t\t{\n\t\t\t\t\t\tisOptional: true,\n\t\t\t\t\t\tname: 'index',\n\t\t\t\t\t\tdescription: 'The cell index',\n\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t'type': 'object',\n\t\t\t\t\t\t\t'required': ['index', 'direction'],\n\t\t\t\t\t\t\t'properties': {\n\t\t\t\t\t\t\t\t'index': {\n\t\t\t\t\t\t\t\t\t'type': 'number'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'direction': {\n\t\t\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t\t\t'enum': ['up', 'down'],\n\t\t\t\t\t\t\t\t\t'default': 'down'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'levels': {\n\t\t\t\t\t\t\t\t\t'type': 'number',\n\t\t\t\t\t\t\t\t\t'default': 1\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, args?: { index: number, levels: number, direction: 'up' | 'down' }): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst levels = args && args.levels || 1;\n\t\tconst direction = args && args.direction === 'up' ? 'up' : 'down';\n\t\tlet index: number | undefined = undefined;\n\n\t\tif (args) {\n\t\t\tindex = args.index;\n\t\t} else {\n\t\t\tconst activeCell = editor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tindex = editor.viewModel?.viewCells.indexOf(activeCell);\n\t\t}\n\n\t\tconst controller = editor.getContribution<FoldingController>(FoldingController.id);\n\t\tif (index !== undefined) {\n\t\t\tif (direction === 'up') {\n\t\t\t\tcontroller.setFoldingStateUp(index, CellFoldingState.Expanded, levels);\n\t\t\t} else {\n\t\t\t\tcontroller.setFoldingStateDown(index, CellFoldingState.Expanded, levels);\n\t\t\t}\n\t\t}\n\t}\n});\n"]}