{"version":3,"file":"notebookEditorDecorations.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/browser/notebookEditorDecorations.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from 'vs/base/browser/dom';\nimport { URI } from 'vs/base/common/uri';\nimport * as strings from 'vs/base/common/strings';\nimport { IContentDecorationRenderOptions, isThemeColor } from 'vs/editor/common/editorCommon';\nimport { IColorTheme, IThemeService, ThemeColor } from 'vs/platform/theme/common/themeService';\nimport { INotebookDecorationRenderOptions } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { _CSS_MAP } from 'vs/editor/browser/services/codeEditorServiceImpl';\n\nexport class NotebookRefCountedStyleSheet {\n\tprivate readonly _key: string;\n\tprivate readonly _styleSheet: HTMLStyleElement;\n\tprivate _refCount: number;\n\n\tconstructor(readonly widget: { removeEditorStyleSheets: (key: string) => void; }, key: string, styleSheet: HTMLStyleElement) {\n\t\tthis._key = key;\n\t\tthis._styleSheet = styleSheet;\n\t\tthis._refCount = 0;\n\t}\n\n\tpublic ref(): void {\n\t\tthis._refCount++;\n\t}\n\n\tpublic unref(): void {\n\t\tthis._refCount--;\n\t\tif (this._refCount === 0) {\n\t\t\tthis._styleSheet.parentNode?.removeChild(this._styleSheet);\n\t\t\tthis.widget.removeEditorStyleSheets(this._key);\n\t\t}\n\t}\n\n\tpublic insertRule(rule: string, index?: number): void {\n\t\tconst sheet = <CSSStyleSheet>this._styleSheet.sheet;\n\t\tsheet.insertRule(rule, index);\n\t}\n}\n\ninterface ProviderArguments {\n\tstyleSheet: NotebookRefCountedStyleSheet;\n\tkey: string;\n\toptions: INotebookDecorationRenderOptions;\n}\n\nexport class NotebookDecorationCSSRules {\n\tprivate _theme: IColorTheme;\n\tprivate _className: string;\n\tprivate _topClassName: string;\n\n\tget className() {\n\t\treturn this._className;\n\t}\n\n\tget topClassName() {\n\t\treturn this._topClassName;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _themeService: IThemeService,\n\t\tprivate readonly _styleSheet: NotebookRefCountedStyleSheet,\n\t\tprivate readonly _providerArgs: ProviderArguments\n\t) {\n\t\tthis._styleSheet.ref();\n\t\tthis._theme = this._themeService.getColorTheme();\n\t\tthis._className = CSSNameHelper.getClassName(this._providerArgs.key, CellDecorationCSSRuleType.ClassName);\n\t\tthis._topClassName = CSSNameHelper.getClassName(this._providerArgs.key, CellDecorationCSSRuleType.TopClassName);\n\t\tthis._buildCSS();\n\t}\n\n\tprivate _buildCSS() {\n\t\tif (this._providerArgs.options.backgroundColor) {\n\t\t\tconst backgroundColor = this._resolveValue(this._providerArgs.options.backgroundColor);\n\t\t\tthis._styleSheet.insertRule(`.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.code-cell-row.${this.className} .cell-focus-indicator,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.markdown-cell-row.${this.className} {\n\t\t\t\tbackground-color: ${backgroundColor} !important;\n\t\t\t}`);\n\t\t}\n\n\t\tif (this._providerArgs.options.borderColor) {\n\t\t\tconst borderColor = this._resolveValue(this._providerArgs.options.borderColor);\n\n\t\t\tthis._styleSheet.insertRule(`.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.${this.className} .cell-focus-indicator-top:before,\n\t\t\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.${this.className} .cell-focus-indicator-bottom:before {\n\t\t\t\t\t\tborder-color: ${borderColor} !important;\n\t\t\t\t\t}`);\n\n\t\t\tthis._styleSheet.insertRule(`\n\t\t\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.${this.className} .cell-focus-indicator-bottom:before {\n\t\t\t\t\t\tcontent: \"\";\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: 1px;\n\t\t\t\t\t\tborder-bottom: 1px solid ${borderColor};\n\t\t\t\t\t\tbottom: 0px;\n\t\t\t\t\t`);\n\n\t\t\tthis._styleSheet.insertRule(`\n\t\t\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.${this.className} .cell-focus-indicator-top:before {\n\t\t\t\t\t\tcontent: \"\";\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: 1px;\n\t\t\t\t\t\tborder-top: 1px solid ${borderColor};\n\t\t\t\t\t`);\n\n\t\t\t// more specific rule for `.focused` can override existing rules\n\t\t\tthis._styleSheet.insertRule(`.monaco-workbench .notebookOverlay .monaco-list:focus-within .monaco-list-row.focused.${this.className} .cell-focus-indicator-top:before,\n\t\t\t\t.monaco-workbench .notebookOverlay .monaco-list:focus-within .monaco-list-row.focused.${this.className} .cell-focus-indicator-bottom:before {\n\t\t\t\t\tborder-color: ${borderColor} !important;\n\t\t\t\t}`);\n\t\t}\n\n\t\tif (this._providerArgs.options.top) {\n\t\t\tconst unthemedCSS = this._getCSSTextForModelDecorationContentClassName(this._providerArgs.options.top);\n\t\t\tthis._styleSheet.insertRule(`.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.${this.className} .cell-decoration .${this.topClassName} {\n\t\t\t\theight: 1rem;\n\t\t\t\tdisplay: block;\n\t\t\t}`);\n\n\t\t\tthis._styleSheet.insertRule(`.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.${this.className} .cell-decoration .${this.topClassName}::before {\n\t\t\t\tdisplay: block;\n\t\t\t\t${unthemedCSS}\n\t\t\t}`);\n\t\t}\n\t}\n\n\t/**\n * Build the CSS for decorations styled before or after content.\n */\n\tprivate _getCSSTextForModelDecorationContentClassName(opts: IContentDecorationRenderOptions | undefined): string {\n\t\tif (!opts) {\n\t\t\treturn '';\n\t\t}\n\t\tconst cssTextArr: string[] = [];\n\n\t\tif (typeof opts !== 'undefined') {\n\t\t\tthis._collectBorderSettingsCSSText(opts, cssTextArr);\n\t\t\tif (typeof opts.contentIconPath !== 'undefined') {\n\t\t\t\tcssTextArr.push(strings.format(_CSS_MAP.contentIconPath, DOM.asCSSUrl(URI.revive(opts.contentIconPath))));\n\t\t\t}\n\t\t\tif (typeof opts.contentText === 'string') {\n\t\t\t\tconst truncated = opts.contentText.match(/^.*$/m)![0]; // only take first line\n\t\t\t\tconst escaped = truncated.replace(/['\\\\]/g, '\\\\$&');\n\n\t\t\t\tcssTextArr.push(strings.format(_CSS_MAP.contentText, escaped));\n\t\t\t}\n\t\t\tthis._collectCSSText(opts, ['fontStyle', 'fontWeight', 'textDecoration', 'color', 'opacity', 'backgroundColor', 'margin'], cssTextArr);\n\t\t\tif (this._collectCSSText(opts, ['width', 'height'], cssTextArr)) {\n\t\t\t\tcssTextArr.push('display:inline-block;');\n\t\t\t}\n\t\t}\n\n\t\treturn cssTextArr.join('');\n\t}\n\n\tprivate _collectBorderSettingsCSSText(opts: any, cssTextArr: string[]): boolean {\n\t\tif (this._collectCSSText(opts, ['border', 'borderColor', 'borderRadius', 'borderSpacing', 'borderStyle', 'borderWidth'], cssTextArr)) {\n\t\t\tcssTextArr.push(strings.format('box-sizing: border-box;'));\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _collectCSSText(opts: any, properties: string[], cssTextArr: string[]): boolean {\n\t\tconst lenBefore = cssTextArr.length;\n\t\tfor (let property of properties) {\n\t\t\tconst value = this._resolveValue(opts[property]);\n\t\t\tif (typeof value === 'string') {\n\t\t\t\tcssTextArr.push(strings.format(_CSS_MAP[property], value));\n\t\t\t}\n\t\t}\n\t\treturn cssTextArr.length !== lenBefore;\n\t}\n\n\tprivate _resolveValue(value: string | ThemeColor): string {\n\t\tif (isThemeColor(value)) {\n\t\t\tconst color = this._theme.getColor(value.id);\n\t\t\tif (color) {\n\t\t\t\treturn color.toString();\n\t\t\t}\n\t\t\treturn 'transparent';\n\t\t}\n\t\treturn value;\n\t}\n\n\tdispose() {\n\t\tthis._styleSheet.unref();\n\t}\n}\n\nconst enum CellDecorationCSSRuleType {\n\tClassName = 0,\n\tTopClassName = 0,\n}\n\nclass CSSNameHelper {\n\n\tpublic static getClassName(key: string, type: CellDecorationCSSRuleType): string {\n\t\treturn 'nb-' + key + '-' + type;\n\t}\n}\n"]}