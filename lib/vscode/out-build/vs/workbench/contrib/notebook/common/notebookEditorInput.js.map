{"version":3,"file":"notebookEditorInput.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/common/notebookEditorInput.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAoBhG,IAAa,mBAAmB,GAAhC,MAAa,mBAAoB,SAAQ,oBAAW;QAanD,YACiB,QAAa,EACb,QAAgB,EAChB,OAAmC,EAChB,gBAAkC,EACf,6BAAkE,EACnF,kBAAsC,EACnC,qBAA4C,EACrE,YAA2B;YAE1C,KAAK,EAAE,CAAC;YATQ,aAAQ,GAAR,QAAQ,CAAK;YACb,aAAQ,GAAR,QAAQ,CAAQ;YAChB,YAAO,GAAP,OAAO,CAA4B;YAChB,qBAAgB,GAAhB,gBAAgB,CAAkB;YACf,kCAA6B,GAA7B,6BAA6B,CAAqC;YACnF,uBAAkB,GAAlB,kBAAkB,CAAoB;YACnC,0BAAqB,GAArB,qBAAqB,CAAuB;YAV7E,0BAAqB,GAAoD,IAAI,CAAC;YAC9E,uBAAkB,GAAY,KAAK,CAAC;YAa3C,IAAI,CAAC,kBAAkB,GAAG,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC;YAC/C,IAAI,CAAC,KAAK,GAAG,YAAY,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;QACzD,CAAC;QAxBD,MAAM,CAAC,MAAM,CAAC,oBAA2C,EAAE,QAAa,EAAE,QAAgB,EAAE,UAAsC,EAAE;YACnI,OAAO,oBAAoB,CAAC,cAAc,CAAC,mBAAmB,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;QAC9F,CAAC;QAwBQ,OAAO;;YACf,MAAA,IAAI,CAAC,qBAAqB,0CAAE,OAAO,EAAE,CAAC;YACtC,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;YAClC,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;QAED,IAAa,MAAM;YAClB,OAAO,mBAAmB,CAAC,EAAE,CAAC;QAC/B,CAAC;QAEQ,OAAO;YACf,OAAO,IAAI,CAAC,KAAK,CAAC;QACnB,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE;gBAChC,OAAO,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YACD,OAAO,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;QACpD,CAAC;QAEQ,UAAU;YAClB,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,CAAC;QAClD,CAAC;QAEQ,UAAU;YAClB,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE;gBAChC,OAAO,KAAK,CAAC,UAAU,EAAE,CAAC;aAC1B;YAED,OAAO,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC;QACvD,CAAC;QAEQ,KAAK,CAAC,IAAI,CAAC,KAAsB,EAAE,OAAsB;YACjE,IAAI,IAAI,CAAC,qBAAqB,EAAE;gBAE/B,IAAI,IAAI,CAAC,UAAU,EAAE,EAAE;oBACtB,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;iBACnC;qBAAM;oBACN,MAAM,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;iBACtD;gBAED,OAAO,IAAI,CAAC;aACZ;YAED,OAAO,SAAS,CAAC;QAClB,CAAC;QAEQ,KAAK,CAAC,MAAM,CAAC,KAAsB,EAAE,OAAsB;YACnE,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE;gBAChC,OAAO,SAAS,CAAC;aACjB;YAED,MAAM,QAAQ,GAAG,IAAI,CAAC,gBAAgB,CAAC,8BAA8B,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAErF,IAAI,CAAC,QAAQ,EAAE;gBACd,OAAO,SAAS,CAAC;aACjB;YAED,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,QAAQ,CAAC;YAExH,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,UAAU,EAAE,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,oBAAoB,CAAC,CAAC;YACvG,IAAI,CAAC,MAAM,EAAE;gBACZ,OAAO,SAAS,CAAC,CAAC,iBAAiB;aACnC;YAED,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC9B,MAAM,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE;oBACjD,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;wBAChC,OAAO,OAAO,CAAC;qBACf;oBAED,IAAI,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAE;wBACpC,OAAO,GAAG,OAAO,UAAU,OAAO,CAAC,IAAI,GAAG,CAAC;qBAC3C;oBAED,OAAO,GAAG,OAAO,CAAC,OAAO,cAAc,OAAO,CAAC,OAAO,GAAG,CAAC;gBAC3D,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACd,MAAM,IAAI,KAAK,CAAC,aAAa,MAAM,wBAAwB,QAAQ,CAAC,mBAAmB,oEAAoE,QAAQ,EAAE,CAAC,CAAC;aACvK;YAED,OAAO,MAAM,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAC/D,CAAC;QAEO,KAAK,CAAC,YAAY,CAAC,iBAAyB;YACnD,OAAO,CAAA,GAAA,oBAAQ,CAAA,CAAC,MAAM,IAAI,CAAC,kBAAkB,CAAC,eAAe,EAAE,EAAE,iBAAiB,CAAC,CAAC;QACrF,CAAC;QAED,+CAA+C;QACtC,MAAM,CAAC,KAAsB,EAAE,MAAW;YAClD,IAAI,IAAI,CAAC,qBAAqB,EAAE;gBAC/B,MAAM,4BAA4B,GAAG,IAAI,CAAC,gBAAgB,CAAC,+BAA+B,CAAC,MAAM,CAAC,CAAC;gBAEnG,IAAI,4BAA4B,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,KAAK,IAAI,CAAC,qBAAsB,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;oBAC/G,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;iBACjC;aACD;YACD,OAAO,SAAS,CAAC;QAClB,CAAC;QAEO,KAAK,CAAC,MAAuB,EAAE,WAAgB;YACtD,MAAM,WAAW,GAAG,mBAAmB,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,EAAE,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;YACvG,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC;QAChC,CAAC;QAEQ,KAAK,CAAC,MAAM,CAAC,MAAuB,EAAE,OAAwB;YACtE,IAAI,IAAI,CAAC,qBAAqB,IAAI,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE;gBAC9E,MAAM,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;aACxD;QACF,CAAC;QAEQ,KAAK,CAAC,OAAO;YACrB,IAAI,CAAC,MAAM,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;gBAC3D,OAAO,IAAI,CAAC;aACZ;YAED,CAAA,GAAA,0BAAI,CAAA,CAAC,IAAI,CAAC,QAAQ,EAAE,oBAAoB,CAAC,CAAC;YAE1C,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE;gBAChC,IAAI,CAAC,qBAAqB,GAAG,MAAM,IAAI,CAAC,6BAA6B,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAC5G,IAAI,IAAI,CAAC,UAAU,EAAE,EAAE;oBACtB,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,CAAC;oBACrC,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;oBAClC,OAAO,IAAI,CAAC;iBACZ;gBACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBACxG,IAAI,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE;oBAChD,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;iBAC9B;aACD;iBAAM;gBACN,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;aACzC;YAED,OAAO,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC;QAC1C,CAAC;QAEQ,OAAO,CAAC,UAAmB;YACnC,IAAI,IAAI,KAAK,UAAU,EAAE;gBACxB,OAAO,IAAI,CAAC;aACZ;YACD,IAAI,UAAU,YAAY,mBAAmB,EAAE;gBAC9C,OAAO,IAAI,CAAC,QAAQ,KAAK,UAAU,CAAC,QAAQ,IAAI,CAAA,GAAA,mBAAO,CAAA,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAU,CAAC,QAAQ,CAAC,CAAC;aAC5F;YACD,OAAO,KAAK,CAAC;QACd,CAAC;KACD,CAAA;IAvKgB,sBAAE,GAAW,0BAA0B,CAAC;IAN5C,mBAAmB;QAiB7B,WAAA,kCAAgB,CAAA;QAChB,WAAA,wEAAmC,CAAA;QACnC,WAAA,4BAAkB,CAAA;QAClB,WAAA,qCAAqB,CAAA;QACrB,WAAA,qBAAa,CAAA;OArBH,mBAAmB,CA6K/B;IA7KY,kDAAmB","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as glob from 'vs/base/common/glob';\nimport { EditorInput, IEditorInput, GroupIdentifier, ISaveOptions, IMoveResult, IRevertOptions } from 'vs/workbench/common/editor';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { URI } from 'vs/base/common/uri';\nimport { isEqual, joinPath } from 'vs/base/common/resources';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IFileDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { INotebookEditorModelResolverService } from 'vs/workbench/contrib/notebook/common/notebookEditorModelResolverService';\nimport { IReference } from 'vs/base/common/lifecycle';\nimport { IResolvedNotebookEditorModel } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { Schemas } from 'vs/base/common/network';\nimport { mark } from 'vs/workbench/contrib/notebook/common/notebookPerformance';\n\ninterface NotebookEditorInputOptions {\n\tstartDirty?: boolean;\n}\n\nexport class NotebookEditorInput extends EditorInput {\n\n\tstatic create(instantiationService: IInstantiationService, resource: URI, viewType: string, options: NotebookEditorInputOptions = {}) {\n\t\treturn instantiationService.createInstance(NotebookEditorInput, resource, viewType, options);\n\t}\n\n\tstatic readonly ID: string = 'workbench.input.notebook';\n\n\tprivate readonly _name: string;\n\n\tprivate _editorModelReference: IReference<IResolvedNotebookEditorModel> | null = null;\n\tprivate _defaultDirtyState: boolean = false;\n\n\tconstructor(\n\t\tpublic readonly resource: URI,\n\t\tpublic readonly viewType: string,\n\t\tpublic readonly options: NotebookEditorInputOptions,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookEditorModelResolverService private readonly _notebookModelResolverService: INotebookEditorModelResolverService,\n\t\t@IFileDialogService private readonly _fileDialogService: IFileDialogService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t) {\n\t\tsuper();\n\t\tthis._defaultDirtyState = !!options.startDirty;\n\t\tthis._name = labelService.getUriBasenameLabel(resource);\n\t}\n\n\toverride dispose() {\n\t\tthis._editorModelReference?.dispose();\n\t\tthis._editorModelReference = null;\n\t\tsuper.dispose();\n\t}\n\n\toverride get typeId(): string {\n\t\treturn NotebookEditorInput.ID;\n\t}\n\n\toverride getName(): string {\n\t\treturn this._name;\n\t}\n\n\toverride isDirty() {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn this._defaultDirtyState;\n\t\t}\n\t\treturn this._editorModelReference.object.isDirty();\n\t}\n\n\toverride isUntitled(): boolean {\n\t\treturn this.resource.scheme === Schemas.untitled;\n\t}\n\n\toverride isReadonly() {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn super.isReadonly();\n\t\t}\n\n\t\treturn this._editorModelReference.object.isReadonly();\n\t}\n\n\toverride async save(group: GroupIdentifier, options?: ISaveOptions): Promise<IEditorInput | undefined> {\n\t\tif (this._editorModelReference) {\n\n\t\t\tif (this.isUntitled()) {\n\t\t\t\treturn this.saveAs(group, options);\n\t\t\t} else {\n\t\t\t\tawait this._editorModelReference.object.save(options);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\toverride async saveAs(group: GroupIdentifier, options?: ISaveOptions): Promise<IEditorInput | undefined> {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst provider = this._notebookService.getContributedNotebookProvider(this.viewType);\n\n\t\tif (!provider) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst dialogPath = this.isUntitled() ? await this._suggestName(this._name) : this._editorModelReference.object.resource;\n\n\t\tconst target = await this._fileDialogService.pickFileToSave(dialogPath, options?.availableFileSystems);\n\t\tif (!target) {\n\t\t\treturn undefined; // save cancelled\n\t\t}\n\n\t\tif (!provider.matches(target)) {\n\t\t\tconst patterns = provider.selectors.map(pattern => {\n\t\t\t\tif (typeof pattern === 'string') {\n\t\t\t\t\treturn pattern;\n\t\t\t\t}\n\n\t\t\t\tif (glob.isRelativePattern(pattern)) {\n\t\t\t\t\treturn `${pattern} (base ${pattern.base})`;\n\t\t\t\t}\n\n\t\t\t\treturn `${pattern.include} (exclude: ${pattern.exclude})`;\n\t\t\t}).join(', ');\n\t\t\tthrow new Error(`File name ${target} is not supported by ${provider.providerDisplayName}.\\n\\nPlease make sure the file name matches following patterns:\\n${patterns}`);\n\t\t}\n\n\t\treturn await this._editorModelReference.object.saveAs(target);\n\t}\n\n\tprivate async _suggestName(suggestedFilename: string) {\n\t\treturn joinPath(await this._fileDialogService.defaultFilePath(), suggestedFilename);\n\t}\n\n\t// called when users rename a notebook document\n\toverride rename(group: GroupIdentifier, target: URI): IMoveResult | undefined {\n\t\tif (this._editorModelReference) {\n\t\t\tconst contributedNotebookProviders = this._notebookService.getContributedNotebookProviders(target);\n\n\t\t\tif (contributedNotebookProviders.find(provider => provider.id === this._editorModelReference!.object.viewType)) {\n\t\t\t\treturn this._move(group, target);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _move(_group: GroupIdentifier, newResource: URI): { editor: IEditorInput } {\n\t\tconst editorInput = NotebookEditorInput.create(this._instantiationService, newResource, this.viewType);\n\t\treturn { editor: editorInput };\n\t}\n\n\toverride async revert(_group: GroupIdentifier, options?: IRevertOptions): Promise<void> {\n\t\tif (this._editorModelReference && this._editorModelReference.object.isDirty()) {\n\t\t\tawait this._editorModelReference.object.revert(options);\n\t\t}\n\t}\n\n\toverride async resolve(): Promise<IResolvedNotebookEditorModel | null> {\n\t\tif (!await this._notebookService.canResolve(this.viewType)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tmark(this.resource, 'extensionActivated');\n\n\t\tif (!this._editorModelReference) {\n\t\t\tthis._editorModelReference = await this._notebookModelResolverService.resolve(this.resource, this.viewType);\n\t\t\tif (this.isDisposed()) {\n\t\t\t\tthis._editorModelReference.dispose();\n\t\t\t\tthis._editorModelReference = null;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tthis._register(this._editorModelReference.object.onDidChangeDirty(() => this._onDidChangeDirty.fire()));\n\t\t\tif (this._editorModelReference.object.isDirty()) {\n\t\t\t\tthis._onDidChangeDirty.fire();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._editorModelReference.object.load();\n\t\t}\n\n\t\treturn this._editorModelReference.object;\n\t}\n\n\toverride matches(otherInput: unknown): boolean {\n\t\tif (this === otherInput) {\n\t\t\treturn true;\n\t\t}\n\t\tif (otherInput instanceof NotebookEditorInput) {\n\t\t\treturn this.viewType === otherInput.viewType && isEqual(this.resource, otherInput.resource);\n\t\t}\n\t\treturn false;\n\t}\n}\n"]}