{"version":3,"file":"notebookWorkerServiceImpl.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/notebook/common/services/notebookWorkerServiceImpl.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore, dispose, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { SimpleWorkerClient } from 'vs/base/common/worker/simpleWorker';\nimport { DefaultWorkerFactory } from 'vs/base/worker/defaultWorkerFactory';\nimport { NotebookCellTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookCellTextModel';\nimport { IMainCellDto, INotebookDiffResult, NotebookCellsChangeType } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { NotebookEditorSimpleWorker } from 'vs/workbench/contrib/notebook/common/services/notebookSimpleWorker';\nimport { INotebookEditorWorkerService } from 'vs/workbench/contrib/notebook/common/services/notebookWorkerService';\n\nexport class NotebookEditorWorkerServiceImpl extends Disposable implements INotebookEditorWorkerService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _workerManager: WorkerManager;\n\n\tconstructor(\n\t\t@INotebookService notebookService: INotebookService\n\t) {\n\t\tsuper();\n\n\t\tthis._workerManager = this._register(new WorkerManager(notebookService));\n\t}\n\tcanComputeDiff(original: URI, modified: URI): boolean {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tcomputeDiff(original: URI, modified: URI): Promise<INotebookDiffResult> {\n\t\treturn this._workerManager.withWorker().then(client => {\n\t\t\treturn client.computeDiff(original, modified);\n\t\t});\n\t}\n}\n\nexport class WorkerManager extends Disposable {\n\tprivate _editorWorkerClient: NotebookWorkerClient | null;\n\t// private _lastWorkerUsedTime: number;\n\n\tconstructor(\n\t\tprivate readonly _notebookService: INotebookService\n\t) {\n\t\tsuper();\n\t\tthis._editorWorkerClient = null;\n\t\t// this._lastWorkerUsedTime = (new Date()).getTime();\n\t}\n\n\twithWorker(): Promise<NotebookWorkerClient> {\n\t\t// this._lastWorkerUsedTime = (new Date()).getTime();\n\t\tif (!this._editorWorkerClient) {\n\t\t\tthis._editorWorkerClient = new NotebookWorkerClient(this._notebookService, 'notebookEditorWorkerService');\n\t\t}\n\t\treturn Promise.resolve(this._editorWorkerClient);\n\t}\n}\n\nexport interface IWorkerClient<W> {\n\tgetProxyObject(): Promise<W>;\n\tdispose(): void;\n}\n\nexport class NotebookEditorModelManager extends Disposable {\n\tprivate _syncedModels: { [modelUrl: string]: IDisposable; } = Object.create(null);\n\tprivate _syncedModelsLastUsedTime: { [modelUrl: string]: number; } = Object.create(null);\n\n\tconstructor(\n\t\tprivate readonly _proxy: NotebookEditorSimpleWorker,\n\t\tprivate readonly _notebookService: INotebookService\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic ensureSyncedResources(resources: URI[]): void {\n\t\tfor (const resource of resources) {\n\t\t\tlet resourceStr = resource.toString();\n\n\t\t\tif (!this._syncedModels[resourceStr]) {\n\t\t\t\tthis._beginModelSync(resource);\n\t\t\t}\n\t\t\tif (this._syncedModels[resourceStr]) {\n\t\t\t\tthis._syncedModelsLastUsedTime[resourceStr] = (new Date()).getTime();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _beginModelSync(resource: URI): void {\n\t\tlet model = this._notebookService.listNotebookDocuments().find(document => document.uri.toString() === resource.toString());\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet modelUrl = resource.toString();\n\n\t\tthis._proxy.acceptNewModel(\n\t\t\tmodel.uri.toString(),\n\t\t\t{\n\t\t\t\tcells: model.cells.map(cell => ({\n\t\t\t\t\thandle: cell.handle,\n\t\t\t\t\turi: cell.uri,\n\t\t\t\t\tsource: cell.getValue(),\n\t\t\t\t\teol: cell.textBuffer.getEOL(),\n\t\t\t\t\tlanguage: cell.language,\n\t\t\t\t\tcellKind: cell.cellKind,\n\t\t\t\t\toutputs: cell.outputs.map(op => ({ outputId: op.outputId, outputs: op.outputs })),\n\t\t\t\t\tmetadata: cell.metadata\n\t\t\t\t})),\n\t\t\t\tmetadata: model.metadata\n\t\t\t}\n\t\t);\n\n\t\tconst toDispose = new DisposableStore();\n\n\t\tconst cellToDto = (cell: NotebookCellTextModel): IMainCellDto => {\n\t\t\treturn {\n\t\t\t\thandle: cell.handle,\n\t\t\t\turi: cell.uri,\n\t\t\t\tsource: cell.textBuffer.getLinesContent(),\n\t\t\t\teol: cell.textBuffer.getEOL(),\n\t\t\t\tlanguage: cell.language,\n\t\t\t\tcellKind: cell.cellKind,\n\t\t\t\toutputs: cell.outputs,\n\t\t\t\tmetadata: cell.metadata\n\t\t\t};\n\t\t};\n\n\t\ttoDispose.add(model.onDidChangeContent((event) => {\n\t\t\tconst dto = event.rawEvents.map(e => {\n\t\t\t\tconst data =\n\t\t\t\t\te.kind === NotebookCellsChangeType.ModelChange || e.kind === NotebookCellsChangeType.Initialize\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\tkind: e.kind,\n\t\t\t\t\t\t\tversionId: event.versionId,\n\t\t\t\t\t\t\tchanges: e.changes.map(diff => [diff[0], diff[1], diff[2].map(cell => cellToDto(cell as NotebookCellTextModel))] as [number, number, IMainCellDto[]])\n\t\t\t\t\t\t}\n\t\t\t\t\t\t: (\n\t\t\t\t\t\t\te.kind === NotebookCellsChangeType.Move\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tkind: e.kind,\n\t\t\t\t\t\t\t\t\tindex: e.index,\n\t\t\t\t\t\t\t\t\tlength: e.length,\n\t\t\t\t\t\t\t\t\tnewIdx: e.newIdx,\n\t\t\t\t\t\t\t\t\tversionId: event.versionId,\n\t\t\t\t\t\t\t\t\tcells: e.cells.map(cell => cellToDto(cell as NotebookCellTextModel))\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: e\n\t\t\t\t\t\t);\n\n\t\t\t\treturn data;\n\t\t\t});\n\n\t\t\tthis._proxy.acceptModelChanged(modelUrl.toString(), {\n\t\t\t\trawEvents: dto,\n\t\t\t\tversionId: event.versionId\n\t\t\t});\n\t\t}));\n\n\t\ttoDispose.add(model.onWillDispose(() => {\n\t\t\tthis._stopModelSync(modelUrl);\n\t\t}));\n\t\ttoDispose.add(toDisposable(() => {\n\t\t\tthis._proxy.acceptRemovedModel(modelUrl);\n\t\t}));\n\n\t\tthis._syncedModels[modelUrl] = toDispose;\n\t}\n\n\tprivate _stopModelSync(modelUrl: string): void {\n\t\tlet toDispose = this._syncedModels[modelUrl];\n\t\tdelete this._syncedModels[modelUrl];\n\t\tdelete this._syncedModelsLastUsedTime[modelUrl];\n\t\tdispose(toDispose);\n\t}\n}\n\nexport class EditorWorkerHost {\n\n\tprivate readonly _workerClient: NotebookWorkerClient;\n\n\tconstructor(workerClient: NotebookWorkerClient) {\n\t\tthis._workerClient = workerClient;\n\t}\n\n\t// foreign host request\n\tpublic fhr(method: string, args: any[]): Promise<any> {\n\t\treturn this._workerClient.fhr(method, args);\n\t}\n}\n\nexport class NotebookWorkerClient extends Disposable {\n\tprivate _worker: IWorkerClient<NotebookEditorSimpleWorker> | null;\n\tprivate readonly _workerFactory: DefaultWorkerFactory;\n\tprivate _modelManager: NotebookEditorModelManager | null;\n\n\n\tconstructor(private readonly _notebookService: INotebookService, label: string) {\n\t\tsuper();\n\t\tthis._workerFactory = new DefaultWorkerFactory(label);\n\t\tthis._worker = null;\n\t\tthis._modelManager = null;\n\n\t}\n\n\t// foreign host request\n\tpublic fhr(method: string, args: any[]): Promise<any> {\n\t\tthrow new Error(`Not implemented!`);\n\t}\n\n\tcomputeDiff(original: URI, modified: URI) {\n\t\treturn this._withSyncedResources([original, modified]).then(proxy => {\n\t\t\treturn proxy.computeDiff(original.toString(), modified.toString());\n\t\t});\n\t}\n\n\tprivate _getOrCreateModelManager(proxy: NotebookEditorSimpleWorker): NotebookEditorModelManager {\n\t\tif (!this._modelManager) {\n\t\t\tthis._modelManager = this._register(new NotebookEditorModelManager(proxy, this._notebookService));\n\t\t}\n\t\treturn this._modelManager;\n\t}\n\n\tprotected _withSyncedResources(resources: URI[]): Promise<NotebookEditorSimpleWorker> {\n\t\treturn this._getProxy().then((proxy) => {\n\t\t\tthis._getOrCreateModelManager(proxy).ensureSyncedResources(resources);\n\t\t\treturn proxy;\n\t\t});\n\t}\n\n\tprivate _getOrCreateWorker(): IWorkerClient<NotebookEditorSimpleWorker> {\n\t\tif (!this._worker) {\n\t\t\ttry {\n\t\t\t\tthis._worker = this._register(new SimpleWorkerClient<NotebookEditorSimpleWorker, EditorWorkerHost>(\n\t\t\t\t\tthis._workerFactory,\n\t\t\t\t\t'vs/workbench/contrib/notebook/common/services/notebookSimpleWorker',\n\t\t\t\t\tnew EditorWorkerHost(this)\n\t\t\t\t));\n\t\t\t} catch (err) {\n\t\t\t\t// logOnceWebWorkerWarning(err);\n\t\t\t\t// this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\n\t\t\t\tthrow (err);\n\t\t\t}\n\t\t}\n\t\treturn this._worker;\n\t}\n\n\tprotected _getProxy(): Promise<NotebookEditorSimpleWorker> {\n\t\treturn this._getOrCreateWorker().getProxyObject().then(undefined, (err) => {\n\t\t\t// logOnceWebWorkerWarning(err);\n\t\t\t// this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\n\t\t\t// return this._getOrCreateWorker().getProxyObject();\n\t\t\tthrow (err);\n\t\t});\n\t}\n\n\n}\n"]}