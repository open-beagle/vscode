{"version":3,"sources":["vs/workbench/contrib/comments/browser/commentsTreeViewer.ts"],"names":[],"mappings":"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","file":"commentsTreeViewer.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport * as nls from 'vs/nls';\nimport { renderMarkdown } from 'vs/base/browser/markdownRenderer';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { IDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { IResourceLabel, ResourceLabels } from 'vs/workbench/browser/labels';\nimport { CommentNode, CommentsModel, ResourceWithCommentThreads } from 'vs/workbench/contrib/comments/common/commentModel';\nimport { IAsyncDataSource, ITreeNode } from 'vs/base/browser/ui/tree/tree';\nimport { IListVirtualDelegate, IListRenderer } from 'vs/base/browser/ui/list/list';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { WorkbenchAsyncDataTree, IListService, IWorkbenchAsyncDataTreeOptions } from 'vs/platform/list/browser/listService';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IColorMapping } from 'vs/platform/theme/common/styler';\n\nexport const COMMENTS_VIEW_ID = 'workbench.panel.comments';\nexport const COMMENTS_VIEW_TITLE = 'Comments';\n\nexport class CommentsAsyncDataSource implements IAsyncDataSource<any, any> {\n\thasChildren(element: any): boolean {\n\t\treturn element instanceof CommentsModel || element instanceof ResourceWithCommentThreads || (element instanceof CommentNode && !!element.replies.length);\n\t}\n\n\tgetChildren(element: any): any[] | Promise<any[]> {\n\t\tif (element instanceof CommentsModel) {\n\t\t\treturn Promise.resolve(element.resourceCommentThreads);\n\t\t}\n\t\tif (element instanceof ResourceWithCommentThreads) {\n\t\t\treturn Promise.resolve(element.commentThreads);\n\t\t}\n\t\tif (element instanceof CommentNode) {\n\t\t\treturn Promise.resolve(element.replies);\n\t\t}\n\t\treturn Promise.resolve([]);\n\t}\n}\n\ninterface IResourceTemplateData {\n\tresourceLabel: IResourceLabel;\n}\n\ninterface ICommentThreadTemplateData {\n\ticon: HTMLImageElement;\n\tuserName: HTMLSpanElement;\n\tcommentText: HTMLElement;\n\tdisposables: IDisposable[];\n}\n\nexport class CommentsModelVirualDelegate implements IListVirtualDelegate<any> {\n\tprivate static readonly RESOURCE_ID = 'resource-with-comments';\n\tprivate static readonly COMMENT_ID = 'comment-node';\n\n\n\tgetHeight(element: any): number {\n\t\treturn 22;\n\t}\n\n\tpublic getTemplateId(element: any): string {\n\t\tif (element instanceof ResourceWithCommentThreads) {\n\t\t\treturn CommentsModelVirualDelegate.RESOURCE_ID;\n\t\t}\n\t\tif (element instanceof CommentNode) {\n\t\t\treturn CommentsModelVirualDelegate.COMMENT_ID;\n\t\t}\n\n\t\treturn '';\n\t}\n}\n\nexport class ResourceWithCommentsRenderer implements IListRenderer<ITreeNode<ResourceWithCommentThreads>, IResourceTemplateData> {\n\ttemplateId: string = 'resource-with-comments';\n\n\tconstructor(\n\t\tprivate labels: ResourceLabels\n\t) {\n\t}\n\n\trenderTemplate(container: HTMLElement) {\n\t\tconst data = <IResourceTemplateData>Object.create(null);\n\t\tconst labelContainer = dom.append(container, dom.$('.resource-container'));\n\t\tdata.resourceLabel = this.labels.create(labelContainer);\n\n\t\treturn data;\n\t}\n\n\trenderElement(node: ITreeNode<ResourceWithCommentThreads>, index: number, templateData: IResourceTemplateData, height: number | undefined): void {\n\t\ttemplateData.resourceLabel.setFile(node.element.resource);\n\t}\n\n\tdisposeTemplate(templateData: IResourceTemplateData): void {\n\t\ttemplateData.resourceLabel.dispose();\n\t}\n}\n\nexport class CommentNodeRenderer implements IListRenderer<ITreeNode<CommentNode>, ICommentThreadTemplateData> {\n\ttemplateId: string = 'comment-node';\n\n\tconstructor(\n\t\t@IOpenerService private readonly openerService: IOpenerService\n\t) { }\n\n\trenderTemplate(container: HTMLElement) {\n\t\tconst data = <ICommentThreadTemplateData>Object.create(null);\n\t\tconst labelContainer = dom.append(container, dom.$('.comment-container'));\n\t\tdata.userName = dom.append(labelContainer, dom.$('.user'));\n\t\tdata.commentText = dom.append(labelContainer, dom.$('.text'));\n\t\tdata.disposables = [];\n\n\t\treturn data;\n\t}\n\n\trenderElement(node: ITreeNode<CommentNode>, index: number, templateData: ICommentThreadTemplateData, height: number | undefined): void {\n\t\ttemplateData.userName.textContent = node.element.comment.userName;\n\t\ttemplateData.commentText.innerText = '';\n\t\tconst disposables = new DisposableStore();\n\t\ttemplateData.disposables.push(disposables);\n\t\tconst renderedComment = renderMarkdown(node.element.comment.body, {\n\t\t\tinline: true,\n\t\t\tactionHandler: {\n\t\t\t\tcallback: (content) => {\n\t\t\t\t\tthis.openerService.open(content, { allowCommands: node.element.comment.body.isTrusted }).catch(onUnexpectedError);\n\t\t\t\t},\n\t\t\t\tdisposeables: disposables\n\t\t\t}\n\t\t});\n\n\t\tconst images = renderedComment.getElementsByTagName('img');\n\t\tfor (let i = 0; i < images.length; i++) {\n\t\t\tconst image = images[i];\n\t\t\tconst textDescription = dom.$('');\n\t\t\ttextDescription.textContent = image.alt ? nls.localize('imageWithLabel', \"Image: {0}\", image.alt) : nls.localize('image', \"Image\");\n\t\t\timage.parentNode!.replaceChild(textDescription, image);\n\t\t}\n\n\t\ttemplateData.commentText.appendChild(renderedComment);\n\t\ttemplateData.commentText.title = renderedComment.textContent ?? '';\n\t}\n\n\tdisposeTemplate(templateData: ICommentThreadTemplateData): void {\n\t\ttemplateData.disposables.forEach(disposeable => disposeable.dispose());\n\t}\n}\n\nexport interface ICommentsListOptions extends IWorkbenchAsyncDataTreeOptions<any, any> {\n\toverrideStyles?: IColorMapping;\n}\n\nexport class CommentsList extends WorkbenchAsyncDataTree<any, any> {\n\tconstructor(\n\t\tlabels: ResourceLabels,\n\t\tcontainer: HTMLElement,\n\t\toptions: ICommentsListOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IListService listService: IListService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService\n\t) {\n\t\tconst delegate = new CommentsModelVirualDelegate();\n\t\tconst dataSource = new CommentsAsyncDataSource();\n\n\t\tconst renderers = [\n\t\t\tinstantiationService.createInstance(ResourceWithCommentsRenderer, labels),\n\t\t\tinstantiationService.createInstance(CommentNodeRenderer)\n\t\t];\n\n\t\tsuper(\n\t\t\t'CommentsTree',\n\t\t\tcontainer,\n\t\t\tdelegate,\n\t\t\trenderers,\n\t\t\tdataSource,\n\t\t\t{\n\t\t\t\taccessibilityProvider: options.accessibilityProvider,\n\t\t\t\tidentityProvider: {\n\t\t\t\t\tgetId: (element: any) => {\n\t\t\t\t\t\tif (element instanceof CommentsModel) {\n\t\t\t\t\t\t\treturn 'root';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (element instanceof ResourceWithCommentThreads) {\n\t\t\t\t\t\t\treturn `${element.owner}-${element.id}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (element instanceof CommentNode) {\n\t\t\t\t\t\t\treturn `${element.owner}-${element.resource.toString()}-${element.threadId}-${element.comment.uniqueIdInThread}` + (element.isRoot ? '-root' : '');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\texpandOnlyOnTwistieClick: (element: any) => {\n\t\t\t\t\tif (element instanceof CommentsModel || element instanceof ResourceWithCommentThreads) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tcollapseByDefault: () => {\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\toverrideStyles: options.overrideStyles\n\t\t\t},\n\t\t\tcontextKeyService,\n\t\t\tlistService,\n\t\t\tthemeService,\n\t\t\tconfigurationService,\n\t\t\tkeybindingService,\n\t\t\taccessibilityService\n\t\t);\n\t}\n}\n"]}