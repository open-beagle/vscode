{"version":3,"sources":["vs/workbench/contrib/comments/browser/commentsEditorContribution.ts"],"names":[],"mappings":"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","file":"commentsEditorContribution.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from 'vs/base/browser/dom';\nimport { Action, IAction } from 'vs/base/common/actions';\nimport { coalesce, findFirstInSorted } from 'vs/base/common/arrays';\nimport { CancelablePromise, createCancelablePromise, Delayer } from 'vs/base/common/async';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport 'vs/css!./media/review';\nimport { IMarginData } from 'vs/editor/browser/controller/mouseTarget';\nimport { IActiveCodeEditor, ICodeEditor, IEditorMouseEvent, isCodeEditor, isDiffEditor, IViewZone, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { IEditorContribution, IModelChangedEvent } from 'vs/editor/common/editorCommon';\nimport { IModelDecorationOptions } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport * as modes from 'vs/editor/common/modes';\nimport { peekViewResultsBackground, peekViewResultsSelectionBackground, peekViewTitleBackground } from 'vs/editor/contrib/peekView/peekView';\nimport * as nls from 'vs/nls';\nimport { CommandsRegistry } from 'vs/platform/commands/common/commands';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { KeybindingsRegistry, KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { IQuickInputService, IQuickPickItem, QuickPickInput } from 'vs/platform/quickinput/common/quickInput';\nimport { editorForeground } from 'vs/platform/theme/common/colorRegistry';\nimport { registerThemingParticipant } from 'vs/platform/theme/common/themeService';\nimport { STATUS_BAR_ITEM_ACTIVE_BACKGROUND, STATUS_BAR_ITEM_HOVER_BACKGROUND } from 'vs/workbench/common/theme';\nimport { overviewRulerCommentingRangeForeground } from 'vs/workbench/contrib/comments/browser/commentGlyphWidget';\nimport { ICommentInfo, ICommentService } from 'vs/workbench/contrib/comments/browser/commentService';\nimport { COMMENTEDITOR_DECORATION_KEY, ReviewZoneWidget } from 'vs/workbench/contrib/comments/browser/commentThreadWidget';\nimport { ctxCommentEditorFocused, SimpleCommentEditor } from 'vs/workbench/contrib/comments/browser/simpleCommentEditor';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { EmbeddedCodeEditorWidget } from 'vs/editor/browser/widget/embeddedCodeEditorWidget';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\n\nexport const ID = 'editor.contrib.review';\n\nexport class ReviewViewZone implements IViewZone {\n\tpublic readonly afterLineNumber: number;\n\tpublic readonly domNode: HTMLElement;\n\tprivate callback: (top: number) => void;\n\n\tconstructor(afterLineNumber: number, onDomNodeTop: (top: number) => void) {\n\t\tthis.afterLineNumber = afterLineNumber;\n\t\tthis.callback = onDomNodeTop;\n\n\t\tthis.domNode = $('.review-viewzone');\n\t}\n\n\tonDomNodeTop(top: number): void {\n\t\tthis.callback(top);\n\t}\n}\n\nclass CommentingRangeDecoration {\n\tprivate _decorationId: string;\n\n\tpublic get id(): string {\n\t\treturn this._decorationId;\n\t}\n\n\tconstructor(private _editor: ICodeEditor, private _ownerId: string, private _extensionId: string | undefined, private _label: string | undefined, private _range: IRange, commentingOptions: ModelDecorationOptions, private commentingRangesInfo: modes.CommentingRanges) {\n\t\tconst startLineNumber = _range.startLineNumber;\n\t\tconst endLineNumber = _range.endLineNumber;\n\t\tlet commentingRangeDecorations = [{\n\t\t\trange: {\n\t\t\t\tstartLineNumber: startLineNumber, startColumn: 1,\n\t\t\t\tendLineNumber: endLineNumber, endColumn: 1\n\t\t\t},\n\t\t\toptions: commentingOptions\n\t\t}];\n\n\t\tthis._decorationId = this._editor.deltaDecorations([], commentingRangeDecorations)[0];\n\t}\n\n\tpublic getCommentAction(): { ownerId: string, extensionId: string | undefined, label: string | undefined, commentingRangesInfo: modes.CommentingRanges } {\n\t\treturn {\n\t\t\textensionId: this._extensionId,\n\t\t\tlabel: this._label,\n\t\t\townerId: this._ownerId,\n\t\t\tcommentingRangesInfo: this.commentingRangesInfo\n\t\t};\n\t}\n\n\tpublic getOriginalRange() {\n\t\treturn this._range;\n\t}\n\n\tpublic getActiveRange() {\n\t\treturn this._editor.getModel()!.getDecorationRange(this._decorationId);\n\t}\n}\nclass CommentingRangeDecorator {\n\n\tprivate decorationOptions: ModelDecorationOptions;\n\tprivate commentingRangeDecorations: CommentingRangeDecoration[] = [];\n\n\tconstructor() {\n\t\tconst decorationOptions: IModelDecorationOptions = {\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: 'comment-range-glyph comment-diff-added'\n\t\t};\n\n\t\tthis.decorationOptions = ModelDecorationOptions.createDynamic(decorationOptions);\n\t}\n\n\tpublic update(editor: ICodeEditor, commentInfos: ICommentInfo[]) {\n\t\tlet model = editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet commentingRangeDecorations: CommentingRangeDecoration[] = [];\n\t\tfor (const info of commentInfos) {\n\t\t\tinfo.commentingRanges.ranges.forEach(range => {\n\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, range, this.decorationOptions, info.commentingRanges));\n\t\t\t});\n\t\t}\n\n\t\tlet oldDecorations = this.commentingRangeDecorations.map(decoration => decoration.id);\n\t\teditor.deltaDecorations(oldDecorations, []);\n\n\t\tthis.commentingRangeDecorations = commentingRangeDecorations;\n\t}\n\n\tpublic getMatchedCommentAction(line: number) {\n\t\tlet result = [];\n\t\tfor (const decoration of this.commentingRangeDecorations) {\n\t\t\tconst range = decoration.getActiveRange();\n\t\t\tif (range && range.startLineNumber <= line && line <= range.endLineNumber) {\n\t\t\t\tresult.push(decoration.getCommentAction());\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.commentingRangeDecorations = [];\n\t}\n}\n\nexport class CommentController implements IEditorContribution {\n\tprivate readonly globalToDispose = new DisposableStore();\n\tprivate readonly localToDispose = new DisposableStore();\n\tprivate editor!: ICodeEditor;\n\tprivate _commentWidgets: ReviewZoneWidget[];\n\tprivate _commentInfos: ICommentInfo[];\n\tprivate _commentingRangeDecorator!: CommentingRangeDecorator;\n\tprivate mouseDownInfo: { lineNumber: number } | null = null;\n\tprivate _commentingRangeSpaceReserved = false;\n\tprivate _computePromise: CancelablePromise<Array<ICommentInfo | null>> | null;\n\tprivate _addInProgress!: boolean;\n\tprivate _emptyThreadsToAddQueue: [number, IEditorMouseEvent | undefined][] = [];\n\tprivate _computeCommentingRangePromise!: CancelablePromise<ICommentInfo[]> | null;\n\tprivate _computeCommentingRangeScheduler!: Delayer<Array<ICommentInfo | null>> | null;\n\tprivate _pendingCommentCache: { [key: string]: { [key: string]: string } };\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@ICommentService private readonly commentService: ICommentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IContextMenuService readonly contextMenuService: IContextMenuService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService\n\t) {\n\t\tthis._commentInfos = [];\n\t\tthis._commentWidgets = [];\n\t\tthis._pendingCommentCache = {};\n\t\tthis._computePromise = null;\n\n\t\tif (editor instanceof EmbeddedCodeEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.editor = editor;\n\n\t\tthis._commentingRangeDecorator = new CommentingRangeDecorator();\n\n\t\tthis.globalToDispose.add(this.commentService.onDidDeleteDataProvider(ownerId => {\n\t\t\tdelete this._pendingCommentCache[ownerId];\n\t\t\tthis.beginCompute();\n\t\t}));\n\t\tthis.globalToDispose.add(this.commentService.onDidSetDataProvider(_ => this.beginCompute()));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidSetResourceCommentInfos(e => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\t\t\tif (editorURI && editorURI.toString() === e.resource.toString()) {\n\t\t\t\tthis.setComments(e.commentInfos.filter(commentInfo => commentInfo !== null));\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this.editor.onDidChangeModel(e => this.onModelChanged(e)));\n\t\tthis.codeEditorService.registerDecorationType(COMMENTEDITOR_DECORATION_KEY, {});\n\t\tthis.beginCompute();\n\t}\n\n\tprivate beginCompute(): Promise<void> {\n\t\tthis._computePromise = createCancelablePromise(token => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\n\t\t\tif (editorURI) {\n\t\t\t\treturn this.commentService.getComments(editorURI);\n\t\t\t}\n\n\t\t\treturn Promise.resolve([]);\n\t\t});\n\n\t\treturn this._computePromise.then(commentInfos => {\n\t\t\tthis.setComments(coalesce(commentInfos));\n\t\t\tthis._computePromise = null;\n\t\t}, error => console.log(error));\n\t}\n\n\tprivate beginComputeCommentingRanges() {\n\t\tif (this._computeCommentingRangeScheduler) {\n\t\t\tif (this._computeCommentingRangePromise) {\n\t\t\t\tthis._computeCommentingRangePromise.cancel();\n\t\t\t\tthis._computeCommentingRangePromise = null;\n\t\t\t}\n\n\t\t\tthis._computeCommentingRangeScheduler.trigger(() => {\n\t\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\n\t\t\t\tif (editorURI) {\n\t\t\t\t\treturn this.commentService.getComments(editorURI);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}).then(commentInfos => {\n\t\t\t\tconst meaningfulCommentInfos = coalesce(commentInfos);\n\t\t\t\tthis._commentingRangeDecorator.update(this.editor, meaningfulCommentInfos);\n\t\t\t}, (err) => {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t\treturn null;\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic static get(editor: ICodeEditor): CommentController {\n\t\treturn editor.getContribution<CommentController>(ID);\n\t}\n\n\tpublic revealCommentThread(threadId: string, commentUniqueId: number, fetchOnceIfNotExist: boolean): void {\n\t\tconst commentThreadWidget = this._commentWidgets.filter(widget => widget.commentThread.threadId === threadId);\n\t\tif (commentThreadWidget.length === 1) {\n\t\t\tcommentThreadWidget[0].reveal(commentUniqueId);\n\t\t} else if (fetchOnceIfNotExist) {\n\t\t\tif (this._computePromise) {\n\t\t\t\tthis._computePromise.then(_ => {\n\t\t\t\t\tthis.revealCommentThread(threadId, commentUniqueId, false);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.beginCompute().then(_ => {\n\t\t\t\t\tthis.revealCommentThread(threadId, commentUniqueId, false);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic nextCommentThread(): void {\n\t\tif (!this._commentWidgets.length || !this.editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst after = this.editor.getSelection().getEndPosition();\n\t\tconst sortedWidgets = this._commentWidgets.sort((a, b) => {\n\t\t\tif (a.commentThread.range.startLineNumber < b.commentThread.range.startLineNumber) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startLineNumber > b.commentThread.range.startLineNumber) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startColumn < b.commentThread.range.startColumn) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startColumn > b.commentThread.range.startColumn) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t});\n\n\t\tlet idx = findFirstInSorted(sortedWidgets, widget => {\n\t\t\tif (widget.commentThread.range.startLineNumber > after.lineNumber) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (widget.commentThread.range.startLineNumber < after.lineNumber) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (widget.commentThread.range.startColumn > after.column) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (idx === this._commentWidgets.length) {\n\t\t\tthis._commentWidgets[0].reveal();\n\t\t\tthis.editor.setSelection(this._commentWidgets[0].commentThread.range);\n\t\t} else {\n\t\t\tsortedWidgets[idx].reveal();\n\t\t\tthis.editor.setSelection(sortedWidgets[idx].commentThread.range);\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.globalToDispose.dispose();\n\t\tthis.localToDispose.dispose();\n\n\t\tthis._commentWidgets.forEach(widget => widget.dispose());\n\n\t\tthis.editor = null!; // Strict null override — nulling out in dispose\n\t}\n\n\tpublic onModelChanged(e: IModelChangedEvent): void {\n\t\tthis.localToDispose.clear();\n\n\t\tthis.removeCommentWidgetsAndStoreCache();\n\n\t\tthis.localToDispose.add(this.editor.onMouseDown(e => this.onEditorMouseDown(e)));\n\t\tthis.localToDispose.add(this.editor.onMouseUp(e => this.onEditorMouseUp(e)));\n\n\t\tthis._computeCommentingRangeScheduler = new Delayer<ICommentInfo[]>(200);\n\t\tthis.localToDispose.add({\n\t\t\tdispose: () => {\n\t\t\t\tif (this._computeCommentingRangeScheduler) {\n\t\t\t\t\tthis._computeCommentingRangeScheduler.cancel();\n\t\t\t\t}\n\t\t\t\tthis._computeCommentingRangeScheduler = null;\n\t\t\t}\n\t\t});\n\t\tthis.localToDispose.add(this.editor.onDidChangeModelContent(async () => {\n\t\t\tthis.beginComputeCommentingRanges();\n\t\t}));\n\t\tthis.localToDispose.add(this.commentService.onDidUpdateCommentThreads(async e => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\t\t\tif (!editorURI) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._computePromise) {\n\t\t\t\tawait this._computePromise;\n\t\t\t}\n\n\t\t\tlet commentInfo = this._commentInfos.filter(info => info.owner === e.owner);\n\t\t\tif (!commentInfo || !commentInfo.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet added = e.added.filter(thread => thread.resource && thread.resource.toString() === editorURI.toString());\n\t\t\tlet removed = e.removed.filter(thread => thread.resource && thread.resource.toString() === editorURI.toString());\n\t\t\tlet changed = e.changed.filter(thread => thread.resource && thread.resource.toString() === editorURI.toString());\n\n\t\t\tremoved.forEach(thread => {\n\t\t\t\tlet matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.threadId === thread.threadId && zoneWidget.commentThread.threadId !== '');\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\tlet matchedZone = matchedZones[0];\n\t\t\t\t\tlet index = this._commentWidgets.indexOf(matchedZone);\n\t\t\t\t\tthis._commentWidgets.splice(index, 1);\n\t\t\t\t\tmatchedZone.dispose();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tchanged.forEach(thread => {\n\t\t\t\tlet matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.threadId === thread.threadId);\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\tlet matchedZone = matchedZones[0];\n\t\t\t\t\tmatchedZone.update(thread);\n\t\t\t\t}\n\t\t\t});\n\t\t\tadded.forEach(thread => {\n\t\t\t\tlet matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.threadId === thread.threadId);\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet matchedNewCommentThreadZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && (zoneWidget.commentThread as any).commentThreadHandle === -1 && Range.equalsRange(zoneWidget.commentThread.range, thread.range));\n\n\t\t\t\tif (matchedNewCommentThreadZones.length) {\n\t\t\t\t\tmatchedNewCommentThreadZones[0].update(thread);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst pendingCommentText = this._pendingCommentCache[e.owner] && this._pendingCommentCache[e.owner][thread.threadId!];\n\t\t\t\tthis.displayCommentThread(e.owner, thread, pendingCommentText);\n\t\t\t\tthis._commentInfos.filter(info => info.owner === e.owner)[0].threads.push(thread);\n\t\t\t});\n\n\t\t}));\n\n\t\tthis.beginCompute();\n\t}\n\n\tprivate displayCommentThread(owner: string, thread: modes.CommentThread, pendingComment: string | null): void {\n\t\tconst zoneWidget = this.instantiationService.createInstance(ReviewZoneWidget, this.editor, owner, thread, pendingComment);\n\t\tzoneWidget.display(thread.range.startLineNumber);\n\t\tthis._commentWidgets.push(zoneWidget);\n\t}\n\n\tprivate onEditorMouseDown(e: IEditorMouseEvent): void {\n\t\tthis.mouseDownInfo = null;\n\n\t\tconst range = e.target.range;\n\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.event.leftButton) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.target.type !== MouseTargetType.GUTTER_LINE_DECORATIONS) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = e.target.detail as IMarginData;\n\t\tconst gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\n\n\t\t// don't collide with folding and git decorations\n\t\tif (gutterOffsetX > 14) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mouseDownInfo = { lineNumber: range.startLineNumber };\n\t}\n\n\tprivate onEditorMouseUp(e: IEditorMouseEvent): void {\n\t\tif (!this.mouseDownInfo) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { lineNumber } = this.mouseDownInfo;\n\t\tthis.mouseDownInfo = null;\n\n\t\tconst range = e.target.range;\n\n\t\tif (!range || range.startLineNumber !== lineNumber) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.target.type !== MouseTargetType.GUTTER_LINE_DECORATIONS) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.target.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.target.element.className.indexOf('comment-diff-added') >= 0) {\n\t\t\tconst lineNumber = e.target.position!.lineNumber;\n\t\t\tthis.addOrToggleCommentAtLine(lineNumber, e);\n\t\t}\n\t}\n\n\tpublic async addOrToggleCommentAtLine(lineNumber: number, e: IEditorMouseEvent | undefined): Promise<void> {\n\t\t// If an add is already in progress, queue the next add and process it after the current one finishes to\n\t\t// prevent empty comment threads from being added to the same line.\n\t\tif (!this._addInProgress) {\n\t\t\tthis._addInProgress = true;\n\t\t\t// The widget's position is undefined until the widget has been displayed, so rely on the glyph position instead\n\t\t\tconst existingCommentsAtLine = this._commentWidgets.filter(widget => widget.getGlyphPosition() === lineNumber);\n\t\t\tif (existingCommentsAtLine.length) {\n\t\t\t\texistingCommentsAtLine.forEach(widget => widget.toggleExpand(lineNumber));\n\t\t\t\tthis.processNextThreadToAdd();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.addCommentAtLine(lineNumber, e);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._emptyThreadsToAddQueue.push([lineNumber, e]);\n\t\t}\n\t}\n\n\tprivate processNextThreadToAdd(): void {\n\t\tthis._addInProgress = false;\n\t\tconst info = this._emptyThreadsToAddQueue.shift();\n\t\tif (info) {\n\t\t\tthis.addOrToggleCommentAtLine(info[0], info[1]);\n\t\t}\n\t}\n\n\tpublic addCommentAtLine(lineNumber: number, e: IEditorMouseEvent | undefined): Promise<void> {\n\t\tconst newCommentInfos = this._commentingRangeDecorator.getMatchedCommentAction(lineNumber);\n\t\tif (!newCommentInfos.length || !this.editor.hasModel()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (newCommentInfos.length > 1) {\n\t\t\tif (e) {\n\t\t\t\tconst anchor = { x: e.event.posx, y: e.event.posy };\n\n\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\tgetAnchor: () => anchor,\n\t\t\t\t\tgetActions: () => this.getContextMenuActions(newCommentInfos, lineNumber),\n\t\t\t\t\tgetActionsContext: () => newCommentInfos.length ? newCommentInfos[0] : undefined,\n\t\t\t\t\tonHide: () => { this._addInProgress = false; }\n\t\t\t\t});\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t} else {\n\t\t\t\tconst picks = this.getCommentProvidersQuickPicks(newCommentInfos);\n\t\t\t\treturn this.quickInputService.pick(picks, { placeHolder: nls.localize('pickCommentService', \"Select Comment Provider\"), matchOnDescription: true }).then(pick => {\n\t\t\t\t\tif (!pick) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentInfos = newCommentInfos.filter(info => info.ownerId === pick.id);\n\n\t\t\t\t\tif (commentInfos.length) {\n\t\t\t\t\t\tconst { ownerId } = commentInfos[0];\n\t\t\t\t\t\tthis.addCommentAtLine2(lineNumber, ownerId);\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis._addInProgress = false;\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tconst { ownerId } = newCommentInfos[0]!;\n\t\t\tthis.addCommentAtLine2(lineNumber, ownerId);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tprivate getCommentProvidersQuickPicks(commentInfos: { ownerId: string, extensionId: string | undefined, label: string | undefined, commentingRangesInfo: modes.CommentingRanges | undefined }[]) {\n\t\tconst picks: QuickPickInput[] = commentInfos.map((commentInfo) => {\n\t\t\tconst { ownerId, extensionId, label } = commentInfo;\n\n\t\t\treturn <IQuickPickItem>{\n\t\t\t\tlabel: label || extensionId,\n\t\t\t\tid: ownerId\n\t\t\t};\n\t\t});\n\n\t\treturn picks;\n\t}\n\n\tprivate getContextMenuActions(commentInfos: { ownerId: string, extensionId: string | undefined, label: string | undefined, commentingRangesInfo: modes.CommentingRanges }[], lineNumber: number): IAction[] {\n\t\tconst actions: IAction[] = [];\n\n\t\tcommentInfos.forEach(commentInfo => {\n\t\t\tconst { ownerId, extensionId, label } = commentInfo;\n\n\t\t\tactions.push(new Action(\n\t\t\t\t'addCommentThread',\n\t\t\t\t`${label || extensionId}`,\n\t\t\t\tundefined,\n\t\t\t\ttrue,\n\t\t\t\t() => {\n\t\t\t\t\tthis.addCommentAtLine2(lineNumber, ownerId);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t));\n\t\t});\n\t\treturn actions;\n\t}\n\n\tpublic addCommentAtLine2(lineNumber: number, ownerId: string) {\n\t\tconst range = new Range(lineNumber, 1, lineNumber, 1);\n\t\tthis.commentService.createCommentThreadTemplate(ownerId, this.editor.getModel()!.uri, range);\n\t\tthis.processNextThreadToAdd();\n\t\treturn;\n\t}\n\n\tprivate setComments(commentInfos: ICommentInfo[]): void {\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._commentInfos = commentInfos;\n\t\tlet lineDecorationsWidth: number = this.editor.getLayoutInfo().decorationsWidth;\n\n\t\tif (this._commentInfos.some(info => Boolean(info.commentingRanges && (Array.isArray(info.commentingRanges) ? info.commentingRanges : info.commentingRanges.ranges).length))) {\n\t\t\tif (!this._commentingRangeSpaceReserved) {\n\t\t\t\tthis._commentingRangeSpaceReserved = true;\n\t\t\t\tlet extraEditorClassName: string[] = [];\n\t\t\t\tconst configuredExtraClassName = this.editor.getRawOptions().extraEditorClassName;\n\t\t\t\tif (configuredExtraClassName) {\n\t\t\t\t\textraEditorClassName = configuredExtraClassName.split(' ');\n\t\t\t\t}\n\n\t\t\t\tconst options = this.editor.getOptions();\n\t\t\t\tif (options.get(EditorOption.folding)) {\n\t\t\t\t\tlineDecorationsWidth -= 16;\n\t\t\t\t}\n\t\t\t\tlineDecorationsWidth += 9;\n\t\t\t\textraEditorClassName.push('inline-comment');\n\t\t\t\tthis.editor.updateOptions({\n\t\t\t\t\textraEditorClassName: extraEditorClassName.join(' '),\n\t\t\t\t\tlineDecorationsWidth: lineDecorationsWidth\n\t\t\t\t});\n\n\t\t\t\t// we only update the lineDecorationsWidth property but keep the width of the whole editor.\n\t\t\t\tconst originalLayoutInfo = this.editor.getLayoutInfo();\n\n\t\t\t\tthis.editor.layout({\n\t\t\t\t\twidth: originalLayoutInfo.width,\n\t\t\t\t\theight: originalLayoutInfo.height\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// create viewzones\n\t\tthis.removeCommentWidgetsAndStoreCache();\n\n\t\tthis._commentInfos.forEach(info => {\n\t\t\tlet providerCacheStore = this._pendingCommentCache[info.owner];\n\t\t\tinfo.threads = info.threads.filter(thread => !thread.isDisposed);\n\t\t\tinfo.threads.forEach(thread => {\n\t\t\t\tlet pendingComment: string | null = null;\n\t\t\t\tif (providerCacheStore) {\n\t\t\t\t\tpendingComment = providerCacheStore[thread.threadId!];\n\t\t\t\t}\n\n\t\t\t\tif (pendingComment) {\n\t\t\t\t\tthread.collapsibleState = modes.CommentThreadCollapsibleState.Expanded;\n\t\t\t\t}\n\n\t\t\t\tthis.displayCommentThread(info.owner, thread, pendingComment);\n\t\t\t});\n\t\t});\n\n\t\tthis._commentingRangeDecorator.update(this.editor, this._commentInfos);\n\t}\n\n\tpublic closeWidget(): void {\n\t\tif (this._commentWidgets) {\n\t\t\tthis._commentWidgets.forEach(widget => widget.hide());\n\t\t}\n\n\t\tthis.editor.focus();\n\t\tthis.editor.revealRangeInCenter(this.editor.getSelection()!);\n\t}\n\n\tprivate removeCommentWidgetsAndStoreCache() {\n\t\tif (this._commentWidgets) {\n\t\t\tthis._commentWidgets.forEach(zone => {\n\t\t\t\tlet pendingComment = zone.getPendingComment();\n\t\t\t\tlet providerCacheStore = this._pendingCommentCache[zone.owner];\n\n\t\t\t\tif (pendingComment) {\n\t\t\t\t\tif (!providerCacheStore) {\n\t\t\t\t\t\tthis._pendingCommentCache[zone.owner] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._pendingCommentCache[zone.owner][zone.commentThread.threadId!] = pendingComment;\n\t\t\t\t} else {\n\t\t\t\t\tif (providerCacheStore) {\n\t\t\t\t\t\tdelete providerCacheStore[zone.commentThread.threadId!];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tzone.dispose();\n\t\t\t});\n\t\t}\n\n\t\tthis._commentWidgets = [];\n\t}\n}\n\nexport class NextCommentThreadAction extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.nextCommentThreadAction',\n\t\t\tlabel: nls.localize('nextCommentThreadAction', \"Go to Next Comment Thread\"),\n\t\t\talias: 'Go to Next Comment Thread',\n\t\t\tprecondition: undefined,\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tlet controller = CommentController.get(editor);\n\t\tif (controller) {\n\t\t\tcontroller.nextCommentThread();\n\t\t}\n\t}\n}\n\n\nregisterEditorContribution(ID, CommentController);\nregisterEditorAction(NextCommentThreadAction);\n\nCommandsRegistry.registerCommand({\n\tid: 'workbench.action.addComment',\n\thandler: (accessor) => {\n\t\tconst activeEditor = getActiveEditor(accessor);\n\t\tif (!activeEditor) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst controller = CommentController.get(activeEditor);\n\t\tif (!controller) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst position = activeEditor.getPosition();\n\t\treturn controller.addOrToggleCommentAtLine(position.lineNumber, undefined);\n\t}\n});\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: 'workbench.action.submitComment',\n\tweight: KeybindingWeight.EditorContrib,\n\tprimary: KeyMod.CtrlCmd | KeyCode.Enter,\n\twhen: ctxCommentEditorFocused,\n\thandler: (accessor, args) => {\n\t\tconst activeCodeEditor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\t\tif (activeCodeEditor instanceof SimpleCommentEditor) {\n\t\t\tactiveCodeEditor.getParentThread().submitComment();\n\t\t}\n\t}\n});\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: 'workbench.action.hideComment',\n\tweight: KeybindingWeight.EditorContrib,\n\tprimary: KeyCode.Escape,\n\tsecondary: [KeyMod.Shift | KeyCode.Escape],\n\twhen: ctxCommentEditorFocused,\n\thandler: (accessor, args) => {\n\t\tconst activeCodeEditor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\t\tif (activeCodeEditor instanceof SimpleCommentEditor) {\n\t\t\tactiveCodeEditor.getParentThread().collapse();\n\t\t}\n\t}\n});\n\nexport function getActiveEditor(accessor: ServicesAccessor): IActiveCodeEditor | null {\n\tlet activeTextEditorControl = accessor.get(IEditorService).activeTextEditorControl;\n\n\tif (isDiffEditor(activeTextEditorControl)) {\n\t\tif (activeTextEditorControl.getOriginalEditor().hasTextFocus()) {\n\t\t\tactiveTextEditorControl = activeTextEditorControl.getOriginalEditor();\n\t\t} else {\n\t\t\tactiveTextEditorControl = activeTextEditorControl.getModifiedEditor();\n\t\t}\n\t}\n\n\tif (!isCodeEditor(activeTextEditorControl) || !activeTextEditorControl.hasModel()) {\n\t\treturn null;\n\t}\n\n\treturn activeTextEditorControl;\n}\n\nregisterThemingParticipant((theme, collector) => {\n\tconst peekViewBackground = theme.getColor(peekViewResultsBackground);\n\tif (peekViewBackground) {\n\t\tcollector.addRule(\n\t\t\t`.monaco-editor .review-widget,` +\n\t\t\t`.monaco-editor .review-widget {` +\n\t\t\t`\tbackground-color: ${peekViewBackground};` +\n\t\t\t`}`);\n\t}\n\n\tconst monacoEditorBackground = theme.getColor(peekViewTitleBackground);\n\tif (monacoEditorBackground) {\n\t\tcollector.addRule(\n\t\t\t`.monaco-editor .review-widget .body .comment-form .review-thread-reply-button {` +\n\t\t\t`\tbackground-color: ${monacoEditorBackground}` +\n\t\t\t`}`\n\t\t);\n\t}\n\n\tconst monacoEditorForeground = theme.getColor(editorForeground);\n\tif (monacoEditorForeground) {\n\t\tcollector.addRule(\n\t\t\t`.monaco-editor .review-widget .body .monaco-editor {` +\n\t\t\t`\tcolor: ${monacoEditorForeground}` +\n\t\t\t`}` +\n\t\t\t`.monaco-editor .review-widget .body .comment-form .review-thread-reply-button {` +\n\t\t\t`\tcolor: ${monacoEditorForeground};` +\n\t\t\t`\tfont-size: inherit` +\n\t\t\t`}`\n\t\t);\n\t}\n\n\tconst selectionBackground = theme.getColor(peekViewResultsSelectionBackground);\n\n\tif (selectionBackground) {\n\t\tcollector.addRule(\n\t\t\t`@keyframes monaco-review-widget-focus {` +\n\t\t\t`\t0% { background: ${selectionBackground}; }` +\n\t\t\t`\t100% { background: transparent; }` +\n\t\t\t`}` +\n\t\t\t`.monaco-editor .review-widget .body .review-comment.focus {` +\n\t\t\t`\tanimation: monaco-review-widget-focus 3s ease 0s;` +\n\t\t\t`}`\n\t\t);\n\t}\n\n\tconst commentingRangeForeground = theme.getColor(overviewRulerCommentingRangeForeground);\n\tif (commentingRangeForeground) {\n\t\tcollector.addRule(`\n\t\t\t.monaco-editor .comment-diff-added {\n\t\t\t\tborder-left: 3px solid ${commentingRangeForeground};\n\t\t\t}\n\t\t\t.monaco-editor .comment-diff-added:before {\n\t\t\t\tbackground: ${commentingRangeForeground};\n\t\t\t}\n\t\t\t.monaco-editor .comment-thread {\n\t\t\t\tborder-left: 3px solid ${commentingRangeForeground};\n\t\t\t}\n\t\t\t.monaco-editor .comment-thread:before {\n\t\t\t\tbackground: ${commentingRangeForeground};\n\t\t\t}\n\t\t`);\n\t}\n\n\tconst statusBarItemHoverBackground = theme.getColor(STATUS_BAR_ITEM_HOVER_BACKGROUND);\n\tif (statusBarItemHoverBackground) {\n\t\tcollector.addRule(`.monaco-editor .review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label.active:hover { background-color: ${statusBarItemHoverBackground};}`);\n\t}\n\n\tconst statusBarItemActiveBackground = theme.getColor(STATUS_BAR_ITEM_ACTIVE_BACKGROUND);\n\tif (statusBarItemActiveBackground) {\n\t\tcollector.addRule(`.monaco-editor .review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label:active { background-color: ${statusBarItemActiveBackground}; border: 1px solid transparent;}`);\n\t}\n});\n"]}