{"version":3,"sources":["vs/workbench/contrib/comments/browser/commentThreadWidget.ts"],"names":[],"mappings":"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","file":"commentThreadWidget.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { ActionBar } from 'vs/base/browser/ui/actionbar/actionbar';\nimport { Action, IAction } from 'vs/base/common/actions';\nimport { Color } from 'vs/base/common/color';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport * as strings from 'vs/base/common/strings';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { IMarginData } from 'vs/editor/browser/controller/mouseTarget';\nimport { ICodeEditor, IEditorMouseEvent, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { ITextModel } from 'vs/editor/common/model';\nimport * as modes from 'vs/editor/common/modes';\nimport { IModelService } from 'vs/editor/common/services/modelService';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport { MarkdownRenderer } from 'vs/editor/browser/core/markdownRenderer';\nimport { peekViewBorder } from 'vs/editor/contrib/peekView/peekView';\nimport { ZoneWidget } from 'vs/editor/contrib/zoneWidget/zoneWidget';\nimport * as nls from 'vs/nls';\nimport { createActionViewItem } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { IMenu, MenuItemAction, SubmenuItemAction } from 'vs/platform/actions/common/actions';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { contrastBorder, editorForeground, focusBorder, inputValidationErrorBackground, inputValidationErrorBorder, inputValidationErrorForeground, textBlockQuoteBackground, textBlockQuoteBorder, textLinkActiveForeground, textLinkForeground, transparent } from 'vs/platform/theme/common/colorRegistry';\nimport { IColorTheme, IThemeService, ThemeIcon } from 'vs/platform/theme/common/themeService';\nimport { CommentFormActions } from 'vs/workbench/contrib/comments/browser/commentFormActions';\nimport { CommentGlyphWidget } from 'vs/workbench/contrib/comments/browser/commentGlyphWidget';\nimport { CommentMenus } from 'vs/workbench/contrib/comments/browser/commentMenus';\nimport { CommentNode } from 'vs/workbench/contrib/comments/browser/commentNode';\nimport { ICommentService } from 'vs/workbench/contrib/comments/browser/commentService';\nimport { CommentContextKeys } from 'vs/workbench/contrib/comments/common/commentContextKeys';\nimport { ICommentThreadWidget } from 'vs/workbench/contrib/comments/common/commentThreadWidget';\nimport { SimpleCommentEditor } from './simpleCommentEditor';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { KeyCode } from 'vs/base/common/keyCodes';\nimport { StandardKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { MOUSE_CURSOR_TEXT_CSS_CLASS_NAME } from 'vs/base/browser/ui/mouseCursor/mouseCursor';\nimport { PANEL_BORDER } from 'vs/workbench/common/theme';\nimport { registerIcon } from 'vs/platform/theme/common/iconRegistry';\nimport { Codicon } from 'vs/base/common/codicons';\n\n\nconst collapseIcon = registerIcon('review-comment-collapse', Codicon.chevronUp, nls.localize('collapseIcon', 'Icon to collapse a review comment.'));\n\nexport const COMMENTEDITOR_DECORATION_KEY = 'commenteditordecoration';\nconst COLLAPSE_ACTION_CLASS = 'expand-review-action ' + ThemeIcon.asClassName(collapseIcon);\nconst COMMENT_SCHEME = 'comment';\n\n\nlet INMEM_MODEL_ID = 0;\n\nexport class ReviewZoneWidget extends ZoneWidget implements ICommentThreadWidget {\n\tprivate _headElement!: HTMLElement;\n\tprotected _headingLabel!: HTMLElement;\n\tprotected _actionbarWidget!: ActionBar;\n\tprivate _bodyElement!: HTMLElement;\n\tprivate _parentEditor: ICodeEditor;\n\tprivate _commentsElement!: HTMLElement;\n\tprivate _commentElements: CommentNode[] = [];\n\tprivate _commentReplyComponent?: {\n\t\teditor: ICodeEditor;\n\t\tform: HTMLElement;\n\t\tcommentEditorIsEmpty: IContextKey<boolean>;\n\t};\n\tprivate _reviewThreadReplyButton!: HTMLElement;\n\tprivate _resizeObserver: any;\n\tprivate readonly _onDidClose = new Emitter<ReviewZoneWidget | undefined>();\n\tprivate readonly _onDidCreateThread = new Emitter<ReviewZoneWidget>();\n\tprivate _isExpanded?: boolean;\n\tprivate _collapseAction!: Action;\n\tprivate _commentGlyph?: CommentGlyphWidget;\n\tprivate _submitActionsDisposables: IDisposable[];\n\tprivate readonly _globalToDispose = new DisposableStore();\n\tprivate _commentThreadDisposables: IDisposable[] = [];\n\tprivate _markdownRenderer: MarkdownRenderer;\n\tprivate _styleElement: HTMLStyleElement;\n\tprivate _formActions: HTMLElement | null;\n\tprivate _error!: HTMLElement;\n\tprivate _contextKeyService: IContextKeyService;\n\tprivate _threadIsEmpty: IContextKey<boolean>;\n\tprivate _commentThreadContextValue: IContextKey<string>;\n\tprivate _commentFormActions!: CommentFormActions;\n\tprivate _scopedInstatiationService: IInstantiationService;\n\tprivate _focusedComment: number | undefined = undefined;\n\n\tpublic get owner(): string {\n\t\treturn this._owner;\n\t}\n\tpublic get commentThread(): modes.CommentThread {\n\t\treturn this._commentThread;\n\t}\n\n\tpublic get extensionId(): string | undefined {\n\t\treturn this._commentThread.extensionId;\n\t}\n\n\tprivate _commentMenus: CommentMenus;\n\n\tprivate _commentOptions: modes.CommentOptions | undefined;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tprivate _owner: string,\n\t\tprivate _commentThread: modes.CommentThread,\n\t\tprivate _pendingComment: string | null,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@IModeService private modeService: IModeService,\n\t\t@IModelService private modelService: IModelService,\n\t\t@IThemeService private themeService: IThemeService,\n\t\t@ICommentService private commentService: ICommentService,\n\t\t@IOpenerService private openerService: IOpenerService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(editor, { keepEditorSelection: true });\n\t\tthis._contextKeyService = contextKeyService.createScoped(this.domNode);\n\n\t\tthis._scopedInstatiationService = instantiationService.createChild(new ServiceCollection(\n\t\t\t[IContextKeyService, this._contextKeyService]\n\t\t));\n\n\t\tthis._threadIsEmpty = CommentContextKeys.commentThreadIsEmpty.bindTo(this._contextKeyService);\n\t\tthis._threadIsEmpty.set(!_commentThread.comments || !_commentThread.comments.length);\n\t\tthis._commentThreadContextValue = this._contextKeyService.createKey('commentThread', _commentThread.contextValue);\n\n\t\tconst commentControllerKey = this._contextKeyService.createKey<string | undefined>('commentController', undefined);\n\t\tconst controller = this.commentService.getCommentController(this._owner);\n\n\t\tif (controller) {\n\t\t\tcommentControllerKey.set(controller.contextValue);\n\t\t\tthis._commentOptions = controller.options;\n\t\t}\n\n\t\tthis._resizeObserver = null;\n\t\tthis._isExpanded = _commentThread.collapsibleState === modes.CommentThreadCollapsibleState.Expanded;\n\t\tthis._commentThreadDisposables = [];\n\t\tthis._submitActionsDisposables = [];\n\t\tthis._formActions = null;\n\t\tthis._commentMenus = this.commentService.getCommentMenus(this._owner);\n\t\tthis.create();\n\n\t\tthis._styleElement = dom.createStyleSheet(this.domNode);\n\t\tthis._globalToDispose.add(this.themeService.onDidColorThemeChange(this._applyTheme, this));\n\t\tthis._globalToDispose.add(this.editor.onDidChangeConfiguration(e => {\n\t\t\tif (e.hasChanged(EditorOption.fontInfo)) {\n\t\t\t\tthis._applyTheme(this.themeService.getColorTheme());\n\t\t\t}\n\t\t}));\n\t\tthis._applyTheme(this.themeService.getColorTheme());\n\n\t\tthis._markdownRenderer = this._globalToDispose.add(new MarkdownRenderer({ editor }, this.modeService, this.openerService));\n\t\tthis._parentEditor = editor;\n\t}\n\n\tpublic get onDidClose(): Event<ReviewZoneWidget | undefined> {\n\t\treturn this._onDidClose.event;\n\t}\n\n\tpublic get onDidCreateThread(): Event<ReviewZoneWidget> {\n\t\treturn this._onDidCreateThread.event;\n\t}\n\n\tpublic getPosition(): IPosition | undefined {\n\t\tif (this.position) {\n\t\t\treturn this.position;\n\t\t}\n\n\t\tif (this._commentGlyph) {\n\t\t\treturn withNullAsUndefined(this._commentGlyph.getPosition().position);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected override revealLine(lineNumber: number) {\n\t\t// we don't do anything here as we always do the reveal ourselves.\n\t}\n\n\tpublic reveal(commentUniqueId?: number) {\n\t\tif (!this._isExpanded) {\n\t\t\tthis.show({ lineNumber: this._commentThread.range.startLineNumber, column: 1 }, 2);\n\t\t}\n\n\t\tif (commentUniqueId !== undefined) {\n\t\t\tlet height = this.editor.getLayoutInfo().height;\n\t\t\tlet matchedNode = this._commentElements.filter(commentNode => commentNode.comment.uniqueIdInThread === commentUniqueId);\n\t\t\tif (matchedNode && matchedNode.length) {\n\t\t\t\tconst commentThreadCoords = dom.getDomNodePagePosition(this._commentElements[0].domNode);\n\t\t\t\tconst commentCoords = dom.getDomNodePagePosition(matchedNode[0].domNode);\n\n\t\t\t\tthis.editor.setScrollTop(this.editor.getTopForLineNumber(this._commentThread.range.startLineNumber) - height / 2 + commentCoords.top - commentThreadCoords.top);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.revealRangeInCenter(this._commentThread.range);\n\t}\n\n\tpublic getPendingComment(): string | null {\n\t\tif (this._commentReplyComponent) {\n\t\t\tlet model = this._commentReplyComponent.editor.getModel();\n\n\t\t\tif (model && model.getValueLength() > 0) { // checking length is cheap\n\t\t\t\treturn model.getValue();\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprotected _fillContainer(container: HTMLElement): void {\n\t\tthis.setCssClass('review-widget');\n\t\tthis._headElement = <HTMLDivElement>dom.$('.head');\n\t\tcontainer.appendChild(this._headElement);\n\t\tthis._fillHead(this._headElement);\n\n\t\tthis._bodyElement = <HTMLDivElement>dom.$('.body');\n\t\tcontainer.appendChild(this._bodyElement);\n\n\t\tdom.addDisposableListener(this._bodyElement, dom.EventType.FOCUS_IN, e => {\n\t\t\tthis.commentService.setActiveCommentThread(this._commentThread);\n\t\t});\n\t}\n\n\tprotected _fillHead(container: HTMLElement): void {\n\t\tlet titleElement = dom.append(this._headElement, dom.$('.review-title'));\n\n\t\tthis._headingLabel = dom.append(titleElement, dom.$('span.filename'));\n\t\tthis.createThreadLabel();\n\n\t\tconst actionsContainer = dom.append(this._headElement, dom.$('.review-actions'));\n\t\tthis._actionbarWidget = new ActionBar(actionsContainer, {\n\t\t\tactionViewItemProvider: createActionViewItem.bind(undefined, this.instantiationService)\n\t\t});\n\n\t\tthis._disposables.add(this._actionbarWidget);\n\n\t\tthis._collapseAction = new Action('review.expand', nls.localize('label.collapse', \"Collapse\"), COLLAPSE_ACTION_CLASS, true, () => this.collapse());\n\n\t\tconst menu = this._commentMenus.getCommentThreadTitleActions(this._commentThread, this._contextKeyService);\n\t\tthis.setActionBarActions(menu);\n\n\t\tthis._disposables.add(menu);\n\t\tthis._disposables.add(menu.onDidChange(e => {\n\t\t\tthis.setActionBarActions(menu);\n\t\t}));\n\n\t\tthis._actionbarWidget.context = this._commentThread;\n\t}\n\n\tprivate setActionBarActions(menu: IMenu): void {\n\t\tconst groups = menu.getActions({ shouldForwardArgs: true }).reduce((r, [, actions]) => [...r, ...actions], <(MenuItemAction | SubmenuItemAction)[]>[]);\n\t\tthis._actionbarWidget.clear();\n\t\tthis._actionbarWidget.push([...groups, this._collapseAction], { label: false, icon: true });\n\t}\n\n\tprivate deleteCommentThread(): void {\n\t\tthis.dispose();\n\t\tthis.commentService.disposeCommentThread(this.owner, this._commentThread.threadId);\n\t}\n\n\tpublic collapse(): Promise<void> {\n\t\tthis._commentThread.collapsibleState = modes.CommentThreadCollapsibleState.Collapsed;\n\t\tif (this._commentThread.comments && this._commentThread.comments.length === 0) {\n\t\t\tthis.deleteCommentThread();\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.hide();\n\t\treturn Promise.resolve();\n\t}\n\n\tpublic getGlyphPosition(): number {\n\t\tif (this._commentGlyph) {\n\t\t\treturn this._commentGlyph.getPosition().position!.lineNumber;\n\t\t}\n\t\treturn 0;\n\t}\n\n\ttoggleExpand(lineNumber: number) {\n\t\tif (this._isExpanded) {\n\t\t\tthis._commentThread.collapsibleState = modes.CommentThreadCollapsibleState.Collapsed;\n\t\t\tthis.hide();\n\t\t\tif (!this._commentThread.comments || !this._commentThread.comments.length) {\n\t\t\t\tthis.deleteCommentThread();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._commentThread.collapsibleState = modes.CommentThreadCollapsibleState.Expanded;\n\t\t\tthis.show({ lineNumber: lineNumber, column: 1 }, 2);\n\t\t}\n\t}\n\n\tasync update(commentThread: modes.CommentThread) {\n\t\tconst oldCommentsLen = this._commentElements.length;\n\t\tconst newCommentsLen = commentThread.comments ? commentThread.comments.length : 0;\n\t\tthis._threadIsEmpty.set(!newCommentsLen);\n\n\t\tlet commentElementsToDel: CommentNode[] = [];\n\t\tlet commentElementsToDelIndex: number[] = [];\n\t\tfor (let i = 0; i < oldCommentsLen; i++) {\n\t\t\tlet comment = this._commentElements[i].comment;\n\t\t\tlet newComment = commentThread.comments ? commentThread.comments.filter(c => c.uniqueIdInThread === comment.uniqueIdInThread) : [];\n\n\t\t\tif (newComment.length) {\n\t\t\t\tthis._commentElements[i].update(newComment[0]);\n\t\t\t} else {\n\t\t\t\tcommentElementsToDelIndex.push(i);\n\t\t\t\tcommentElementsToDel.push(this._commentElements[i]);\n\t\t\t}\n\t\t}\n\n\t\t// del removed elements\n\t\tfor (let i = commentElementsToDel.length - 1; i >= 0; i--) {\n\t\t\tthis._commentElements.splice(commentElementsToDelIndex[i], 1);\n\t\t\tthis._commentsElement.removeChild(commentElementsToDel[i].domNode);\n\t\t}\n\n\t\tlet lastCommentElement: HTMLElement | null = null;\n\t\tlet newCommentNodeList: CommentNode[] = [];\n\t\tlet newCommentsInEditMode: CommentNode[] = [];\n\t\tfor (let i = newCommentsLen - 1; i >= 0; i--) {\n\t\t\tlet currentComment = commentThread.comments![i];\n\t\t\tlet oldCommentNode = this._commentElements.filter(commentNode => commentNode.comment.uniqueIdInThread === currentComment.uniqueIdInThread);\n\t\t\tif (oldCommentNode.length) {\n\t\t\t\tlastCommentElement = oldCommentNode[0].domNode;\n\t\t\t\tnewCommentNodeList.unshift(oldCommentNode[0]);\n\t\t\t} else {\n\t\t\t\tconst newElement = this.createNewCommentNode(currentComment);\n\n\t\t\t\tnewCommentNodeList.unshift(newElement);\n\t\t\t\tif (lastCommentElement) {\n\t\t\t\t\tthis._commentsElement.insertBefore(newElement.domNode, lastCommentElement);\n\t\t\t\t\tlastCommentElement = newElement.domNode;\n\t\t\t\t} else {\n\t\t\t\t\tthis._commentsElement.appendChild(newElement.domNode);\n\t\t\t\t\tlastCommentElement = newElement.domNode;\n\t\t\t\t}\n\n\t\t\t\tif (currentComment.mode === modes.CommentMode.Editing) {\n\t\t\t\t\tnewElement.switchToEditMode();\n\t\t\t\t\tnewCommentsInEditMode.push(newElement);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._commentThread = commentThread;\n\t\tthis._commentElements = newCommentNodeList;\n\t\tthis.createThreadLabel();\n\n\t\t// Move comment glyph widget and show position if the line has changed.\n\t\tconst lineNumber = this._commentThread.range.startLineNumber;\n\t\tlet shouldMoveWidget = false;\n\t\tif (this._commentGlyph) {\n\t\t\tif (this._commentGlyph.getPosition().position!.lineNumber !== lineNumber) {\n\t\t\t\tshouldMoveWidget = true;\n\t\t\t\tthis._commentGlyph.setLineNumber(lineNumber);\n\t\t\t}\n\t\t}\n\n\t\tif (!this._reviewThreadReplyButton && this._commentReplyComponent) {\n\t\t\tthis.createReplyButton(this._commentReplyComponent.editor, this._commentReplyComponent.form);\n\t\t}\n\n\t\tif (this._commentThread.comments && this._commentThread.comments.length === 0) {\n\t\t\tthis.expandReplyArea();\n\t\t}\n\n\t\tif (shouldMoveWidget && this._isExpanded) {\n\t\t\tthis.show({ lineNumber, column: 1 }, 2);\n\t\t}\n\n\t\tif (this._commentThread.collapsibleState === modes.CommentThreadCollapsibleState.Expanded) {\n\t\t\tthis.show({ lineNumber, column: 1 }, 2);\n\t\t} else {\n\t\t\tthis.hide();\n\t\t}\n\n\t\tif (this._commentThread.contextValue) {\n\t\t\tthis._commentThreadContextValue.set(this._commentThread.contextValue);\n\t\t} else {\n\t\t\tthis._commentThreadContextValue.reset();\n\t\t}\n\n\t\tif (newCommentsInEditMode.length) {\n\t\t\tconst lastIndex = this._commentElements.indexOf(newCommentsInEditMode[newCommentsInEditMode.length - 1]);\n\t\t\tthis._focusedComment = lastIndex;\n\t\t}\n\n\t\tthis.setFocusedComment(this._focusedComment);\n\t}\n\n\tprotected override _onWidth(widthInPixel: number): void {\n\t\tthis._commentReplyComponent?.editor.layout({ height: 5 * 18, width: widthInPixel - 54 /* margin 20px * 10 + scrollbar 14px*/ });\n\t}\n\n\tprotected override _doLayout(heightInPixel: number, widthInPixel: number): void {\n\t\tthis._commentReplyComponent?.editor.layout({ height: 5 * 18, width: widthInPixel - 54 /* margin 20px * 10 + scrollbar 14px*/ });\n\t}\n\n\tdisplay(lineNumber: number) {\n\t\tthis._commentGlyph = new CommentGlyphWidget(this.editor, lineNumber);\n\n\t\tthis._disposables.add(this.editor.onMouseDown(e => this.onEditorMouseDown(e)));\n\t\tthis._disposables.add(this.editor.onMouseUp(e => this.onEditorMouseUp(e)));\n\n\t\tlet headHeight = Math.ceil(this.editor.getOption(EditorOption.lineHeight) * 1.2);\n\t\tthis._headElement.style.height = `${headHeight}px`;\n\t\tthis._headElement.style.lineHeight = this._headElement.style.height;\n\n\t\tthis._commentsElement = dom.append(this._bodyElement, dom.$('div.comments-container'));\n\t\tthis._commentsElement.setAttribute('role', 'presentation');\n\t\tthis._commentsElement.tabIndex = 0;\n\n\t\tthis._disposables.add(dom.addDisposableListener(this._commentsElement, dom.EventType.KEY_DOWN, (e) => {\n\t\t\tlet event = new StandardKeyboardEvent(e as KeyboardEvent);\n\t\t\tif (event.equals(KeyCode.UpArrow) || event.equals(KeyCode.DownArrow)) {\n\t\t\t\tconst moveFocusWithinBounds = (change: number): number => {\n\t\t\t\t\tif (this._focusedComment === undefined && change >= 0) { return 0; }\n\t\t\t\t\tif (this._focusedComment === undefined && change < 0) { return this._commentElements.length - 1; }\n\t\t\t\t\tlet newIndex = this._focusedComment! + change;\n\t\t\t\t\treturn Math.min(Math.max(0, newIndex), this._commentElements.length - 1);\n\t\t\t\t};\n\n\t\t\t\tthis.setFocusedComment(event.equals(KeyCode.UpArrow) ? moveFocusWithinBounds(-1) : moveFocusWithinBounds(1));\n\t\t\t}\n\t\t}));\n\n\t\tthis._commentElements = [];\n\t\tif (this._commentThread.comments) {\n\t\t\tfor (const comment of this._commentThread.comments) {\n\t\t\t\tconst newCommentNode = this.createNewCommentNode(comment);\n\n\t\t\t\tthis._commentElements.push(newCommentNode);\n\t\t\t\tthis._commentsElement.appendChild(newCommentNode.domNode);\n\t\t\t\tif (comment.mode === modes.CommentMode.Editing) {\n\t\t\t\t\tnewCommentNode.switchToEditMode();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// create comment thread only when it supports reply\n\t\tif (this._commentThread.canReply) {\n\t\t\tthis.createCommentForm();\n\t\t}\n\n\t\tthis._resizeObserver = new MutationObserver(this._refresh.bind(this));\n\n\t\tthis._resizeObserver.observe(this._bodyElement, {\n\t\t\tattributes: true,\n\t\t\tchildList: true,\n\t\t\tcharacterData: true,\n\t\t\tsubtree: true\n\t\t});\n\n\t\tif (this._commentThread.collapsibleState === modes.CommentThreadCollapsibleState.Expanded) {\n\t\t\tthis.show({ lineNumber: lineNumber, column: 1 }, 2);\n\t\t}\n\n\t\t// If there are no existing comments, place focus on the text area. This must be done after show, which also moves focus.\n\t\t// if this._commentThread.comments is undefined, it doesn't finish initialization yet, so we don't focus the editor immediately.\n\t\tif (this._commentThread.canReply && this._commentReplyComponent) {\n\t\t\tif (!this._commentThread.comments || !this._commentThread.comments.length) {\n\t\t\t\tthis._commentReplyComponent.editor.focus();\n\t\t\t} else if (this._commentReplyComponent.editor.getModel()!.getValueLength() > 0) {\n\t\t\t\tthis.expandReplyArea();\n\t\t\t}\n\t\t}\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeCanReply(() => {\n\t\t\tif (this._commentReplyComponent) {\n\t\t\t\tif (!this._commentThread.canReply) {\n\t\t\t\t\tthis._commentReplyComponent.form.style.display = 'none';\n\t\t\t\t} else {\n\t\t\t\t\tthis._commentReplyComponent.form.style.display = 'block';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._commentThread.canReply) {\n\t\t\t\t\tthis.createCommentForm();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate createCommentForm() {\n\t\tconst hasExistingComments = this._commentThread.comments && this._commentThread.comments.length > 0;\n\t\tconst commentForm = dom.append(this._bodyElement, dom.$('.comment-form'));\n\t\tconst commentEditor = this._scopedInstatiationService.createInstance(SimpleCommentEditor, commentForm, SimpleCommentEditor.getEditorOptions(), this._parentEditor, this);\n\t\tconst commentEditorIsEmpty = CommentContextKeys.commentIsEmpty.bindTo(this._contextKeyService);\n\t\tcommentEditorIsEmpty.set(!this._pendingComment);\n\n\t\tthis._commentReplyComponent = {\n\t\t\tform: commentForm,\n\t\t\teditor: commentEditor,\n\t\t\tcommentEditorIsEmpty\n\t\t};\n\n\t\tconst modeId = generateUuid() + '-' + (hasExistingComments ? this._commentThread.threadId : ++INMEM_MODEL_ID);\n\t\tconst params = JSON.stringify({\n\t\t\textensionId: this.extensionId,\n\t\t\tcommentThreadId: this.commentThread.threadId\n\t\t});\n\n\t\tlet resource = URI.parse(`${COMMENT_SCHEME}://${this.extensionId}/commentinput-${modeId}.md?${params}`); // TODO. Remove params once extensions adopt authority.\n\t\tlet commentController = this.commentService.getCommentController(this.owner);\n\t\tif (commentController) {\n\t\t\tresource = resource.with({ authority: commentController.id });\n\t\t}\n\n\t\tconst model = this.modelService.createModel(this._pendingComment || '', this.modeService.createByFilepathOrFirstLine(resource), resource, false);\n\t\tthis._disposables.add(model);\n\t\tcommentEditor.setModel(model);\n\t\tthis._disposables.add(commentEditor);\n\t\tthis._disposables.add(commentEditor.getModel()!.onDidChangeContent(() => {\n\t\t\tthis.setCommentEditorDecorations();\n\t\t\tcommentEditorIsEmpty?.set(!commentEditor.getValue());\n\t\t}));\n\n\t\tthis.createTextModelListener(commentEditor, commentForm);\n\n\t\tthis.setCommentEditorDecorations();\n\n\t\t// Only add the additional step of clicking a reply button to expand the textarea when there are existing comments\n\t\tif (hasExistingComments) {\n\t\t\tthis.createReplyButton(commentEditor, commentForm);\n\t\t} else {\n\t\t\tif (this._commentThread.comments && this._commentThread.comments.length === 0) {\n\t\t\t\tthis.expandReplyArea();\n\t\t\t}\n\t\t}\n\t\tthis._error = dom.append(commentForm, dom.$('.validation-error.hidden'));\n\n\t\tthis._formActions = dom.append(commentForm, dom.$('.form-actions'));\n\t\tthis.createCommentWidgetActions(this._formActions, model);\n\t\tthis.createCommentWidgetActionsListener();\n\t}\n\n\tprivate createTextModelListener(commentEditor: ICodeEditor, commentForm: HTMLElement) {\n\t\tthis._commentThreadDisposables.push(commentEditor.onDidFocusEditorWidget(() => {\n\t\t\tthis._commentThread.input = {\n\t\t\t\turi: commentEditor.getModel()!.uri,\n\t\t\t\tvalue: commentEditor.getValue()\n\t\t\t};\n\t\t\tthis.commentService.setActiveCommentThread(this._commentThread);\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(commentEditor.getModel()!.onDidChangeContent(() => {\n\t\t\tlet modelContent = commentEditor.getValue();\n\t\t\tif (this._commentThread.input && this._commentThread.input.uri === commentEditor.getModel()!.uri && this._commentThread.input.value !== modelContent) {\n\t\t\t\tlet newInput: modes.CommentInput = this._commentThread.input;\n\t\t\t\tnewInput.value = modelContent;\n\t\t\t\tthis._commentThread.input = newInput;\n\t\t\t}\n\t\t\tthis.commentService.setActiveCommentThread(this._commentThread);\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeInput(input => {\n\t\t\tlet thread = this._commentThread;\n\n\t\t\tif (thread.input && thread.input.uri !== commentEditor.getModel()!.uri) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!input) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (commentEditor.getValue() !== input.value) {\n\t\t\t\tcommentEditor.setValue(input.value);\n\n\t\t\t\tif (input.value === '') {\n\t\t\t\t\tthis._pendingComment = '';\n\t\t\t\t\tcommentForm.classList.remove('expand');\n\t\t\t\t\tcommentEditor.getDomNode()!.style.outline = '';\n\t\t\t\t\tthis._error.textContent = '';\n\t\t\t\t\tthis._error.classList.add('hidden');\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async _ => {\n\t\t\tawait this.update(this._commentThread);\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeLabel(_ => {\n\t\t\tthis.createThreadLabel();\n\t\t}));\n\t}\n\n\tprivate createCommentWidgetActionsListener() {\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeRange(range => {\n\t\t\t// Move comment glyph widget and show position if the line has changed.\n\t\t\tconst lineNumber = this._commentThread.range.startLineNumber;\n\t\t\tlet shouldMoveWidget = false;\n\t\t\tif (this._commentGlyph) {\n\t\t\t\tif (this._commentGlyph.getPosition().position!.lineNumber !== lineNumber) {\n\t\t\t\t\tshouldMoveWidget = true;\n\t\t\t\t\tthis._commentGlyph.setLineNumber(lineNumber);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (shouldMoveWidget && this._isExpanded) {\n\t\t\t\tthis.show({ lineNumber, column: 1 }, 2);\n\t\t\t}\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeCollasibleState(state => {\n\t\t\tif (state === modes.CommentThreadCollapsibleState.Expanded && !this._isExpanded) {\n\t\t\t\tconst lineNumber = this._commentThread.range.startLineNumber;\n\n\t\t\t\tthis.show({ lineNumber, column: 1 }, 2);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state === modes.CommentThreadCollapsibleState.Collapsed && this._isExpanded) {\n\t\t\t\tthis.hide();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate setFocusedComment(value: number | undefined) {\n\t\tif (this._focusedComment !== undefined) {\n\t\t\tthis._commentElements[this._focusedComment]?.setFocus(false);\n\t\t}\n\n\t\tif (this._commentElements.length === 0 || value === undefined) {\n\t\t\tthis._focusedComment = undefined;\n\t\t} else {\n\t\t\tthis._focusedComment = Math.min(value, this._commentElements.length - 1);\n\t\t\tthis._commentElements[this._focusedComment].setFocus(true);\n\t\t}\n\t}\n\n\tprivate getActiveComment(): CommentNode | ReviewZoneWidget {\n\t\treturn this._commentElements.filter(node => node.isEditing)[0] || this;\n\t}\n\n\t/**\n\t * Command based actions.\n\t */\n\tprivate createCommentWidgetActions(container: HTMLElement, model: ITextModel) {\n\t\tconst commentThread = this._commentThread;\n\n\t\tconst menu = this._commentMenus.getCommentThreadActions(commentThread, this._contextKeyService);\n\n\t\tthis._disposables.add(menu);\n\t\tthis._disposables.add(menu.onDidChange(() => {\n\t\t\tthis._commentFormActions.setActions(menu);\n\t\t}));\n\n\t\tthis._commentFormActions = new CommentFormActions(container, async (action: IAction) => {\n\t\t\tif (!commentThread.comments || !commentThread.comments.length) {\n\t\t\t\tlet newPosition = this.getPosition();\n\n\t\t\t\tif (newPosition) {\n\t\t\t\t\tthis.commentService.updateCommentThreadTemplate(this.owner, commentThread.commentThreadHandle, new Range(newPosition.lineNumber, 1, newPosition.lineNumber, 1));\n\t\t\t\t}\n\t\t\t}\n\t\t\taction.run({\n\t\t\t\tthread: this._commentThread,\n\t\t\t\ttext: this._commentReplyComponent?.editor.getValue(),\n\t\t\t\t$mid: 8\n\t\t\t});\n\n\t\t\tthis.hideReplyArea();\n\t\t}, this.themeService);\n\n\t\tthis._commentFormActions.setActions(menu);\n\t}\n\n\tprivate createNewCommentNode(comment: modes.Comment): CommentNode {\n\t\tlet newCommentNode = this._scopedInstatiationService.createInstance(CommentNode,\n\t\t\tthis._commentThread,\n\t\t\tcomment,\n\t\t\tthis.owner,\n\t\t\tthis.editor.getModel()!.uri,\n\t\t\tthis._parentEditor,\n\t\t\tthis,\n\t\t\tthis._markdownRenderer);\n\n\t\tthis._disposables.add(newCommentNode);\n\t\tthis._disposables.add(newCommentNode.onDidClick(clickedNode =>\n\t\t\tthis.setFocusedComment(this._commentElements.findIndex(commentNode => commentNode.comment.uniqueIdInThread === clickedNode.comment.uniqueIdInThread))\n\t\t));\n\n\t\treturn newCommentNode;\n\t}\n\n\tasync submitComment(): Promise<void> {\n\t\tconst activeComment = this.getActiveComment();\n\t\tif (activeComment instanceof ReviewZoneWidget) {\n\t\t\tif (this._commentFormActions) {\n\t\t\t\tthis._commentFormActions.triggerDefaultAction();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createThreadLabel() {\n\t\tlet label: string | undefined;\n\t\tlabel = this._commentThread.label;\n\n\t\tif (label === undefined) {\n\t\t\tif (!(this._commentThread.comments && this._commentThread.comments.length)) {\n\t\t\t\tlabel = nls.localize('startThread', \"Start discussion\");\n\t\t\t}\n\t\t}\n\n\t\tif (label) {\n\t\t\tthis._headingLabel.textContent = strings.escape(label);\n\t\t\tthis._headingLabel.setAttribute('aria-label', label);\n\t\t}\n\t}\n\n\tprivate expandReplyArea() {\n\t\tif (!this._commentReplyComponent?.form.classList.contains('expand')) {\n\t\t\tthis._commentReplyComponent?.form.classList.add('expand');\n\t\t\tthis._commentReplyComponent?.editor.focus();\n\t\t}\n\t}\n\n\tprivate hideReplyArea() {\n\t\tif (this._commentReplyComponent) {\n\t\t\tthis._commentReplyComponent.editor.setValue('');\n\t\t\tthis._commentReplyComponent.editor.getDomNode()!.style.outline = '';\n\t\t}\n\t\tthis._pendingComment = '';\n\t\tthis._commentReplyComponent?.form.classList.remove('expand');\n\t\tthis._error.textContent = '';\n\t\tthis._error.classList.add('hidden');\n\t}\n\n\tprivate createReplyButton(commentEditor: ICodeEditor, commentForm: HTMLElement) {\n\t\tthis._reviewThreadReplyButton = <HTMLButtonElement>dom.append(commentForm, dom.$(`button.review-thread-reply-button.${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`));\n\t\tthis._reviewThreadReplyButton.title = this._commentOptions?.prompt || nls.localize('reply', \"Reply...\");\n\n\t\tthis._reviewThreadReplyButton.textContent = this._commentOptions?.prompt || nls.localize('reply', \"Reply...\");\n\t\t// bind click/escape actions for reviewThreadReplyButton and textArea\n\t\tthis._disposables.add(dom.addDisposableListener(this._reviewThreadReplyButton, 'click', _ => this.expandReplyArea()));\n\t\tthis._disposables.add(dom.addDisposableListener(this._reviewThreadReplyButton, 'focus', _ => this.expandReplyArea()));\n\n\t\tcommentEditor.onDidBlurEditorWidget(() => {\n\t\t\tif (commentEditor.getModel()!.getValueLength() === 0 && commentForm.classList.contains('expand')) {\n\t\t\t\tcommentForm.classList.remove('expand');\n\t\t\t}\n\t\t});\n\t}\n\n\t_refresh() {\n\t\tif (this._isExpanded && this._bodyElement) {\n\t\t\tlet dimensions = dom.getClientArea(this._bodyElement);\n\n\t\t\tthis._commentElements.forEach(element => {\n\t\t\t\telement.layout();\n\t\t\t});\n\n\t\t\tconst headHeight = Math.ceil(this.editor.getOption(EditorOption.lineHeight) * 1.2);\n\t\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\t\tconst arrowHeight = Math.round(lineHeight / 3);\n\t\t\tconst frameThickness = Math.round(lineHeight / 9) * 2;\n\n\t\t\tconst computedLinesNumber = Math.ceil((headHeight + dimensions.height + arrowHeight + frameThickness + 8 /** margin bottom to avoid margin collapse */) / lineHeight);\n\n\t\t\tif (this._viewZone?.heightInLines === computedLinesNumber) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet currentPosition = this.getPosition();\n\n\t\t\tif (this._viewZone && currentPosition && currentPosition.lineNumber !== this._viewZone.afterLineNumber) {\n\t\t\t\tthis._viewZone.afterLineNumber = currentPosition.lineNumber;\n\t\t\t}\n\n\t\t\tif (!this._commentThread.comments || !this._commentThread.comments.length) {\n\t\t\t\tthis._commentReplyComponent?.editor.focus();\n\t\t\t}\n\n\t\t\tthis._relayout(computedLinesNumber);\n\t\t}\n\t}\n\n\tprivate setCommentEditorDecorations() {\n\t\tconst model = this._commentReplyComponent && this._commentReplyComponent.editor.getModel();\n\t\tif (model) {\n\t\t\tconst valueLength = model.getValueLength();\n\t\t\tconst hasExistingComments = this._commentThread.comments && this._commentThread.comments.length > 0;\n\t\t\tconst placeholder = valueLength > 0\n\t\t\t\t? ''\n\t\t\t\t: hasExistingComments\n\t\t\t\t\t? (this._commentOptions?.placeHolder || nls.localize('reply', \"Reply...\"))\n\t\t\t\t\t: (this._commentOptions?.placeHolder || nls.localize('newComment', \"Type a new comment\"));\n\t\t\tconst decorations = [{\n\t\t\t\trange: {\n\t\t\t\t\tstartLineNumber: 0,\n\t\t\t\t\tendLineNumber: 0,\n\t\t\t\t\tstartColumn: 0,\n\t\t\t\t\tendColumn: 1\n\t\t\t\t},\n\t\t\t\trenderOptions: {\n\t\t\t\t\tafter: {\n\t\t\t\t\t\tcontentText: placeholder,\n\t\t\t\t\t\tcolor: `${transparent(editorForeground, 0.4)(this.themeService.getColorTheme())}`\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}];\n\n\t\t\tthis._commentReplyComponent?.editor.setDecorations(COMMENTEDITOR_DECORATION_KEY, decorations);\n\t\t}\n\t}\n\n\tprivate mouseDownInfo: { lineNumber: number } | null = null;\n\n\tprivate onEditorMouseDown(e: IEditorMouseEvent): void {\n\t\tthis.mouseDownInfo = null;\n\n\t\tconst range = e.target.range;\n\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.event.leftButton) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.target.type !== MouseTargetType.GUTTER_LINE_DECORATIONS) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = e.target.detail as IMarginData;\n\t\tconst gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\n\n\t\t// don't collide with folding and git decorations\n\t\tif (gutterOffsetX > 14) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mouseDownInfo = { lineNumber: range.startLineNumber };\n\t}\n\n\tprivate onEditorMouseUp(e: IEditorMouseEvent): void {\n\t\tif (!this.mouseDownInfo) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { lineNumber } = this.mouseDownInfo;\n\t\tthis.mouseDownInfo = null;\n\n\t\tconst range = e.target.range;\n\n\t\tif (!range || range.startLineNumber !== lineNumber) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.target.type !== MouseTargetType.GUTTER_LINE_DECORATIONS) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.target.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._commentGlyph && this._commentGlyph.getPosition().position!.lineNumber !== lineNumber) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.target.element.className.indexOf('comment-thread') >= 0) {\n\t\t\tthis.toggleExpand(lineNumber);\n\t\t}\n\t}\n\n\tprivate _applyTheme(theme: IColorTheme) {\n\t\tconst borderColor = theme.getColor(peekViewBorder);\n\t\tthis.style({\n\t\t\tarrowColor: borderColor || Color.transparent,\n\t\t\tframeColor: borderColor || Color.transparent\n\t\t});\n\n\t\tconst content: string[] = [];\n\n\t\tif (borderColor) {\n\t\t\tcontent.push(`.monaco-editor .review-widget > .body { border-top: 1px solid ${borderColor} }`);\n\t\t}\n\n\t\tconst linkColor = theme.getColor(textLinkForeground);\n\t\tif (linkColor) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .comment-body a { color: ${linkColor} }`);\n\t\t}\n\n\t\tconst linkActiveColor = theme.getColor(textLinkActiveForeground);\n\t\tif (linkActiveColor) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .comment-body a:hover, a:active { color: ${linkActiveColor} }`);\n\t\t}\n\n\t\tconst focusColor = theme.getColor(focusBorder);\n\t\tif (focusColor) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .comment-body a:focus { outline: 1px solid ${focusColor}; }`);\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .monaco-editor.focused { outline: 1px solid ${focusColor}; }`);\n\t\t}\n\n\t\tconst blockQuoteBackground = theme.getColor(textBlockQuoteBackground);\n\t\tif (blockQuoteBackground) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .review-comment blockquote { background: ${blockQuoteBackground}; }`);\n\t\t}\n\n\t\tconst blockQuoteBOrder = theme.getColor(textBlockQuoteBorder);\n\t\tif (blockQuoteBOrder) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .review-comment blockquote { border-color: ${blockQuoteBOrder}; }`);\n\t\t}\n\n\t\tconst border = theme.getColor(PANEL_BORDER);\n\t\tif (border) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label { border-color: ${border}; }`);\n\t\t}\n\n\t\tconst hcBorder = theme.getColor(contrastBorder);\n\t\tif (hcBorder) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .comment-form .review-thread-reply-button { outline-color: ${hcBorder}; }`);\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .monaco-editor { outline: 1px solid ${hcBorder}; }`);\n\t\t}\n\n\t\tconst errorBorder = theme.getColor(inputValidationErrorBorder);\n\t\tif (errorBorder) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .validation-error { border: 1px solid ${errorBorder}; }`);\n\t\t}\n\n\t\tconst errorBackground = theme.getColor(inputValidationErrorBackground);\n\t\tif (errorBackground) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .validation-error { background: ${errorBackground}; }`);\n\t\t}\n\n\t\tconst errorForeground = theme.getColor(inputValidationErrorForeground);\n\t\tif (errorForeground) {\n\t\t\tcontent.push(`.monaco-editor .review-widget .body .comment-form .validation-error { color: ${errorForeground}; }`);\n\t\t}\n\n\t\tconst fontInfo = this.editor.getOption(EditorOption.fontInfo);\n\t\tconst fontFamilyVar = '--comment-thread-editor-font-family';\n\t\tconst fontSizeVar = '--comment-thread-editor-font-size';\n\t\tconst fontWeightVar = '--comment-thread-editor-font-weight';\n\t\tthis.container?.style.setProperty(fontFamilyVar, fontInfo.fontFamily);\n\t\tthis.container?.style.setProperty(fontSizeVar, `${fontInfo.fontSize}px`);\n\t\tthis.container?.style.setProperty(fontWeightVar, fontInfo.fontWeight);\n\n\t\tcontent.push(`.monaco-editor .review-widget .body code {\n\t\t\tfont-family: var(${fontFamilyVar});\n\t\t\tfont-weight: var(${fontWeightVar});\n\t\t\tfont-size: var(${fontSizeVar});\n\t\t}`);\n\n\t\tthis._styleElement.textContent = content.join('\\n');\n\n\t\t// Editor decorations should also be responsive to theme changes\n\t\tthis.setCommentEditorDecorations();\n\t}\n\n\toverride show(rangeOrPos: IRange | IPosition, heightInLines: number): void {\n\t\tthis._isExpanded = true;\n\t\tsuper.show(rangeOrPos, heightInLines);\n\t\tthis._refresh();\n\t}\n\n\toverride hide() {\n\t\tif (this._isExpanded) {\n\t\t\tthis._isExpanded = false;\n\t\t\t// Focus the container so that the comment editor will be blurred before it is hidden\n\t\t\tthis.editor.focus();\n\t\t}\n\t\tsuper.hide();\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tif (this._resizeObserver) {\n\t\t\tthis._resizeObserver.disconnect();\n\t\t\tthis._resizeObserver = null;\n\t\t}\n\n\t\tif (this._commentGlyph) {\n\t\t\tthis._commentGlyph.dispose();\n\t\t\tthis._commentGlyph = undefined;\n\t\t}\n\n\t\tthis._globalToDispose.dispose();\n\t\tthis._commentThreadDisposables.forEach(global => global.dispose());\n\t\tthis._submitActionsDisposables.forEach(local => local.dispose());\n\t\tthis._onDidClose.fire(undefined);\n\t}\n}\n"]}