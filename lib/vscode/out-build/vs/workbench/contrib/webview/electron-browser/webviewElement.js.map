{"version":3,"file":"webviewElement.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/webview/electron-browser/webviewElement.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { FindInPageOptions, WebviewTag } from 'electron';\nimport { addDisposableListener } from 'vs/base/browser/dom';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { once } from 'vs/base/common/functional';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { FileAccess, Schemas } from 'vs/base/common/network';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IMainProcessService } from 'vs/platform/ipc/electron-sandbox/services';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IRemoteAuthorityResolverService } from 'vs/platform/remote/common/remoteAuthorityResolver';\nimport { ITunnelService } from 'vs/platform/remote/common/tunnel';\nimport { IRequestService } from 'vs/platform/request/common/request';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { webviewPartitionId } from 'vs/platform/webview/common/webviewManagerService';\nimport { BaseWebview, WebviewMessageChannels } from 'vs/workbench/contrib/webview/browser/baseWebviewElement';\nimport { WebviewThemeDataProvider } from 'vs/workbench/contrib/webview/browser/themeing';\nimport { Webview, WebviewContentOptions, WebviewExtensionDescription, WebviewOptions } from 'vs/workbench/contrib/webview/browser/webview';\nimport { WebviewFindDelegate, WebviewFindWidget } from 'vs/workbench/contrib/webview/browser/webviewFindWidget';\nimport { WebviewIgnoreMenuShortcutsManager } from 'vs/workbench/contrib/webview/electron-browser/webviewIgnoreMenuShortcutsManager';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\n\nexport class ElectronWebviewBasedWebview extends BaseWebview<WebviewTag> implements Webview, WebviewFindDelegate {\n\n\tprivate static _webviewKeyboardHandler: WebviewIgnoreMenuShortcutsManager | undefined;\n\n\tprivate static getWebviewKeyboardHandler(\n\t\tconfigService: IConfigurationService,\n\t\tmainProcessService: IMainProcessService,\n\t) {\n\t\tif (!this._webviewKeyboardHandler) {\n\t\t\tthis._webviewKeyboardHandler = new WebviewIgnoreMenuShortcutsManager(configService, mainProcessService);\n\t\t}\n\t\treturn this._webviewKeyboardHandler;\n\t}\n\n\tprivate _webviewFindWidget: WebviewFindWidget | undefined;\n\tprivate _findStarted: boolean = false;\n\n\tconstructor(\n\t\tid: string,\n\t\toptions: WebviewOptions,\n\t\tcontentOptions: WebviewContentOptions,\n\t\textension: WebviewExtensionDescription | undefined,\n\t\tprivate readonly _webviewThemeDataProvider: WebviewThemeDataProvider,\n\t\t@ILogService private readonly _myLogService: ILogService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IMainProcessService mainProcessService: IMainProcessService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IRequestService requestService: IRequestService,\n\t\t@ITunnelService tunnelService: ITunnelService,\n\t\t@IRemoteAuthorityResolverService remoteAuthorityResolverService: IRemoteAuthorityResolverService,\n\t) {\n\t\tsuper(id, options, contentOptions, extension, _webviewThemeDataProvider, {\n\t\t\tnotificationService,\n\t\t\tlogService: _myLogService,\n\t\t\ttelemetryService,\n\t\t\tenvironmentService,\n\t\t\tfileService,\n\t\t\trequestService,\n\t\t\ttunnelService,\n\t\t\tremoteAuthorityResolverService\n\t\t});\n\n\t\t/* __GDPR__\n\t\t\t\"webview.createWebview\" : {\n\t\t\t\t\"extension\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\t\t\"enableFindWidget\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"webviewElementType\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t\t}\n\t\t*/\n\t\ttelemetryService.publicLog('webview.createWebview', {\n\t\t\tenableFindWidget: !!options.enableFindWidget,\n\t\t\textension: extension?.id.value,\n\t\t\twebviewElementType: 'webview',\n\t\t});\n\n\t\tthis._myLogService.debug(`Webview(${this.id}): init`);\n\n\t\tthis._register(addDisposableListener(this.element!, 'dom-ready', once(() => {\n\t\t\tthis._register(ElectronWebviewBasedWebview.getWebviewKeyboardHandler(configurationService, mainProcessService).add(this.element!));\n\t\t})));\n\n\t\tthis._register(addDisposableListener(this.element!, 'console-message', function (e: { level: number; message: string; line: number; sourceId: string; }) {\n\t\t\tconsole.log(`[Embedded Page] ${e.message}`);\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element!, 'dom-ready', () => {\n\t\t\tthis._myLogService.debug(`Webview(${this.id}): dom-ready`);\n\n\t\t\t// Workaround for https://github.com/electron/electron/issues/14474\n\t\t\tif (this.element && (this.isFocused || document.activeElement === this.element)) {\n\t\t\t\tthis.element.blur();\n\t\t\t\tthis.element.focus();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element!, 'crashed', () => {\n\t\t\tconsole.error('embedded page crashed');\n\t\t}));\n\n\t\tthis._register(this.on('synthetic-mouse-event', (rawEvent: any) => {\n\t\t\tif (!this.element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounds = this.element.getBoundingClientRect();\n\t\t\ttry {\n\t\t\t\twindow.dispatchEvent(new MouseEvent(rawEvent.type, {\n\t\t\t\t\t...rawEvent,\n\t\t\t\t\tclientX: rawEvent.clientX + bounds.left,\n\t\t\t\t\tclientY: rawEvent.clientY + bounds.top,\n\t\t\t\t}));\n\t\t\t\treturn;\n\t\t\t} catch {\n\t\t\t\t// CustomEvent was treated as MouseEvent so don't do anything - https://github.com/microsoft/vscode/issues/78915\n\t\t\t\treturn;\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.on('did-set-content', () => {\n\t\t\tthis._myLogService.debug(`Webview(${this.id}): did-set-content`);\n\n\t\t\tif (this.element) {\n\t\t\t\tthis.element.style.flex = '';\n\t\t\t\tthis.element.style.width = '100%';\n\t\t\t\tthis.element.style.height = '100%';\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element!, 'devtools-opened', () => {\n\t\t\tthis._send('devtools-opened');\n\t\t}));\n\n\t\tif (options.enableFindWidget) {\n\t\t\tthis._webviewFindWidget = this._register(instantiationService.createInstance(WebviewFindWidget, this));\n\n\t\t\tthis._register(addDisposableListener(this.element!, 'found-in-page', e => {\n\t\t\t\tthis._hasFindResult.fire(e.result.matches > 0);\n\t\t\t}));\n\n\t\t\tthis.styledFindWidget();\n\t\t}\n\n\t\t// We must ensure to put a `file:` URI as the preload attribute\n\t\t// and not the `vscode-file` URI because preload scripts are loaded\n\t\t// via node.js from the main side and only allow `file:` protocol\n\t\tthis.element!.preload = FileAccess.asFileUri('./pre/electron-index.js', require).toString(true);\n\t\tthis.element!.src = `${Schemas.vscodeWebview}://${this.id}/electron-browser-index.html?platform=electron&id=${this.id}&vscode-resource-origin=${encodeURIComponent(this.webviewResourceEndpoint)}`;\n\t}\n\n\tprotected createElement(options: WebviewOptions) {\n\t\t// Do not start loading the webview yet.\n\t\t// Wait the end of the ctor when all listeners have been hooked up.\n\t\tconst element = document.createElement('webview');\n\n\t\telement.focus = () => {\n\t\t\tthis.doFocus();\n\t\t};\n\n\t\telement.setAttribute('partition', webviewPartitionId);\n\t\telement.setAttribute('webpreferences', 'contextIsolation=yes');\n\t\telement.className = `webview ${options.customClasses || ''}`;\n\n\t\telement.style.flex = '0 1';\n\t\telement.style.width = '0';\n\t\telement.style.height = '0';\n\t\telement.style.outline = '0';\n\n\t\treturn element;\n\t}\n\n\tprotected elementFocusImpl() {\n\t\tthis.element?.focus();\n\t}\n\n\tpublic override set contentOptions(options: WebviewContentOptions) {\n\t\tthis._myLogService.debug(`Webview(${this.id}): will set content options`);\n\t\tsuper.contentOptions = options;\n\t}\n\n\tprotected override get webviewResourceEndpoint(): string {\n\t\treturn `https://${this.id}.vscode-webview-test.com`;\n\t}\n\n\tprotected readonly extraContentOptions = {};\n\n\tpublic mountTo(parent: HTMLElement) {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._webviewFindWidget) {\n\t\t\tparent.appendChild(this._webviewFindWidget.getDomNode()!);\n\t\t}\n\t\tparent.appendChild(this.element);\n\t}\n\n\tprotected async doPostMessage(channel: string, data?: any): Promise<void> {\n\t\tthis._myLogService.debug(`Webview(${this.id}): did post message on '${channel}'`);\n\t\tthis.element?.send(channel, data);\n\t}\n\n\tprotected override style(): void {\n\t\tsuper.style();\n\t\tthis.styledFindWidget();\n\t}\n\n\tprivate styledFindWidget() {\n\t\tthis._webviewFindWidget?.updateTheme(this._webviewThemeDataProvider.getTheme());\n\t}\n\n\tprivate readonly _hasFindResult = this._register(new Emitter<boolean>());\n\tpublic readonly hasFindResult: Event<boolean> = this._hasFindResult.event;\n\n\tpublic startFind(value: string, options?: FindInPageOptions) {\n\t\tif (!value || !this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// ensure options is defined without modifying the original\n\t\toptions = options || {};\n\n\t\t// FindNext must be false for a first request\n\t\tconst findOptions: FindInPageOptions = {\n\t\t\tforward: options.forward,\n\t\t\tfindNext: true,\n\t\t\tmatchCase: options.matchCase\n\t\t};\n\n\t\tthis._findStarted = true;\n\t\tthis.element.findInPage(value, findOptions);\n\t}\n\n\t/**\n\t * Webviews expose a stateful find API.\n\t * Successive calls to find will move forward or backward through onFindResults\n\t * depending on the supplied options.\n\t *\n\t * @param value The string to search for. Empty strings are ignored.\n\t */\n\tpublic find(value: string, previous: boolean): void {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Searching with an empty value will throw an exception\n\t\tif (!value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = { findNext: false, forward: !previous };\n\t\tif (!this._findStarted) {\n\t\t\tthis.startFind(value, options);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.element.findInPage(value, options);\n\t}\n\n\tpublic stopFind(keepSelection?: boolean): void {\n\t\tthis._hasFindResult.fire(false);\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\t\tthis._findStarted = false;\n\t\tthis.element.stopFindInPage(keepSelection ? 'keepSelection' : 'clearSelection');\n\t}\n\n\tpublic showFind() {\n\t\tthis._webviewFindWidget?.reveal();\n\t}\n\n\tpublic hideFind() {\n\t\tthis._webviewFindWidget?.hide();\n\t}\n\n\tpublic runFindAction(previous: boolean) {\n\t\tthis._webviewFindWidget?.find(previous);\n\t}\n\n\tpublic override selectAll() {\n\t\tthis.element?.selectAll();\n\t}\n\n\tpublic override copy() {\n\t\tthis.element?.copy();\n\t}\n\n\tpublic override paste() {\n\t\tthis.element?.paste();\n\t}\n\n\tpublic override cut() {\n\t\tthis.element?.cut();\n\t}\n\n\tpublic override undo() {\n\t\tthis.element?.undo();\n\t}\n\n\tpublic override redo() {\n\t\tthis.element?.redo();\n\t}\n\n\tprotected override on<T = unknown>(channel: WebviewMessageChannels | string, handler: (data: T) => void): IDisposable {\n\t\tif (!this.element) {\n\t\t\tthrow new Error('Cannot add event listener. No webview element found.');\n\t\t}\n\t\treturn addDisposableListener(this.element, 'ipc-message', (event) => {\n\t\t\tif (!this.element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (event.channel === channel && event.args && event.args.length) {\n\t\t\t\thandler(event.args[0]);\n\t\t\t}\n\t\t});\n\t}\n}\n"]}