{"version":3,"file":"outputLinkProvider.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/output/common/outputLinkProvider.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { IModelService } from 'vs/editor/common/services/modelService';\nimport { LinkProviderRegistry, ILink } from 'vs/editor/common/modes';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { OUTPUT_MODE_ID, LOG_MODE_ID } from 'vs/workbench/contrib/output/common/output';\nimport { MonacoWebWorker, createWebWorker } from 'vs/editor/common/services/webWorker';\nimport { ICreateData, OutputLinkComputer } from 'vs/workbench/contrib/output/common/outputLinkComputer';\nimport { IDisposable, dispose } from 'vs/base/common/lifecycle';\n\nexport class OutputLinkProvider {\n\n\tprivate static readonly DISPOSE_WORKER_TIME = 3 * 60 * 1000; // dispose worker after 3 minutes of inactivity\n\n\tprivate worker?: MonacoWebWorker<OutputLinkComputer>;\n\tprivate disposeWorkerScheduler: RunOnceScheduler;\n\tprivate linkProviderRegistration: IDisposable | undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IModelService private readonly modelService: IModelService\n\t) {\n\t\tthis.disposeWorkerScheduler = new RunOnceScheduler(() => this.disposeWorker(), OutputLinkProvider.DISPOSE_WORKER_TIME);\n\n\t\tthis.registerListeners();\n\t\tthis.updateLinkProviderWorker();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis.contextService.onDidChangeWorkspaceFolders(() => this.updateLinkProviderWorker());\n\t}\n\n\tprivate updateLinkProviderWorker(): void {\n\n\t\t// Setup link provider depending on folders being opened or not\n\t\tconst folders = this.contextService.getWorkspace().folders;\n\t\tif (folders.length > 0) {\n\t\t\tif (!this.linkProviderRegistration) {\n\t\t\t\tthis.linkProviderRegistration = LinkProviderRegistry.register([{ language: OUTPUT_MODE_ID, scheme: '*' }, { language: LOG_MODE_ID, scheme: '*' }], {\n\t\t\t\t\tprovideLinks: async model => {\n\t\t\t\t\t\tconst links = await this.provideLinks(model.uri);\n\n\t\t\t\t\t\treturn links && { links };\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tdispose(this.linkProviderRegistration);\n\t\t\tthis.linkProviderRegistration = undefined;\n\t\t}\n\n\t\t// Dispose worker to recreate with folders on next provideLinks request\n\t\tthis.disposeWorker();\n\t\tthis.disposeWorkerScheduler.cancel();\n\t}\n\n\tprivate getOrCreateWorker(): MonacoWebWorker<OutputLinkComputer> {\n\t\tthis.disposeWorkerScheduler.schedule();\n\n\t\tif (!this.worker) {\n\t\t\tconst createData: ICreateData = {\n\t\t\t\tworkspaceFolders: this.contextService.getWorkspace().folders.map(folder => folder.uri.toString())\n\t\t\t};\n\n\t\t\tthis.worker = createWebWorker<OutputLinkComputer>(this.modelService, {\n\t\t\t\tmoduleId: 'vs/workbench/contrib/output/common/outputLinkComputer',\n\t\t\t\tcreateData,\n\t\t\t\tlabel: 'outputLinkComputer'\n\t\t\t});\n\t\t}\n\n\t\treturn this.worker;\n\t}\n\n\tprivate async provideLinks(modelUri: URI): Promise<ILink[]> {\n\t\tconst linkComputer = await this.getOrCreateWorker().withSyncedResources([modelUri]);\n\n\t\treturn linkComputer.computeLinks(modelUri.toString());\n\t}\n\n\tprivate disposeWorker(): void {\n\t\tif (this.worker) {\n\t\t\tthis.worker.dispose();\n\t\t\tthis.worker = undefined;\n\t\t}\n\t}\n}\n"]}