{"version":3,"sources":["vs/workbench/contrib/debug/browser/replFilter.ts"],"names":[],"mappings":"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","file":"replFilter.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { matchesFuzzy } from 'vs/base/common/filters';\nimport { splitGlobAware } from 'vs/base/common/glob';\nimport { ITreeFilter, TreeVisibility, TreeFilterResult } from 'vs/base/browser/ui/tree/tree';\nimport { IReplElement } from 'vs/workbench/contrib/debug/common/debug';\nimport * as DOM from 'vs/base/browser/dom';\nimport { BaseActionViewItem } from 'vs/base/browser/ui/actionbar/actionViewItems';\nimport { Delayer } from 'vs/base/common/async';\nimport { IAction } from 'vs/base/common/actions';\nimport { HistoryInputBox } from 'vs/base/browser/ui/inputbox/inputBox';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IContextViewService } from 'vs/platform/contextview/browser/contextView';\nimport { toDisposable } from 'vs/base/common/lifecycle';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { StandardKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { KeyCode } from 'vs/base/common/keyCodes';\nimport { ContextScopedHistoryInputBox } from 'vs/platform/browser/contextScopedHistoryWidget';\nimport { attachInputBoxStyler, attachStylerCallback } from 'vs/platform/theme/common/styler';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { badgeBackground, badgeForeground, contrastBorder } from 'vs/platform/theme/common/colorRegistry';\nimport { ReplEvaluationResult, ReplEvaluationInput } from 'vs/workbench/contrib/debug/common/replModel';\nimport { localize } from 'vs/nls';\nimport { Variable } from 'vs/workbench/contrib/debug/common/debugModel';\n\n\ntype ParsedQuery = {\n\ttype: 'include' | 'exclude',\n\tquery: string,\n};\n\nexport class ReplFilter implements ITreeFilter<IReplElement> {\n\n\tstatic matchQuery = matchesFuzzy;\n\n\tprivate _parsedQueries: ParsedQuery[] = [];\n\tset filterQuery(query: string) {\n\t\tthis._parsedQueries = [];\n\t\tquery = query.trim();\n\n\t\tif (query && query !== '') {\n\t\t\tconst filters = splitGlobAware(query, ',').map(s => s.trim()).filter(s => !!s.length);\n\t\t\tfor (const f of filters) {\n\t\t\t\tif (f.startsWith('!')) {\n\t\t\t\t\tthis._parsedQueries.push({ type: 'exclude', query: f.slice(1) });\n\t\t\t\t} else {\n\t\t\t\t\tthis._parsedQueries.push({ type: 'include', query: f });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfilter(element: IReplElement, parentVisibility: TreeVisibility): TreeFilterResult<void> {\n\t\tif (element instanceof ReplEvaluationInput || element instanceof ReplEvaluationResult || element instanceof Variable) {\n\t\t\t// Only filter the output events, everything else is visible https://github.com/microsoft/vscode/issues/105863\n\t\t\treturn TreeVisibility.Visible;\n\t\t}\n\n\t\tlet includeQueryPresent = false;\n\t\tlet includeQueryMatched = false;\n\n\t\tconst text = element.toString(true);\n\n\t\tfor (let { type, query } of this._parsedQueries) {\n\t\t\tif (type === 'exclude' && ReplFilter.matchQuery(query, text)) {\n\t\t\t\t// If exclude query matches, ignore all other queries and hide\n\t\t\t\treturn false;\n\t\t\t} else if (type === 'include') {\n\t\t\t\tincludeQueryPresent = true;\n\t\t\t\tif (ReplFilter.matchQuery(query, text)) {\n\t\t\t\t\tincludeQueryMatched = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn includeQueryPresent ? includeQueryMatched : (typeof parentVisibility !== 'undefined' ? parentVisibility : TreeVisibility.Visible);\n\t}\n}\n\nexport interface IFilterStatsProvider {\n\tgetFilterStats(): { total: number, filtered: number };\n}\n\nexport class ReplFilterState {\n\n\tconstructor(private filterStatsProvider: IFilterStatsProvider) { }\n\n\tprivate readonly _onDidChange: Emitter<void> = new Emitter<void>();\n\tget onDidChange(): Event<void> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate readonly _onDidStatsChange: Emitter<void> = new Emitter<void>();\n\tget onDidStatsChange(): Event<void> {\n\t\treturn this._onDidStatsChange.event;\n\t}\n\n\tprivate _filterText = '';\n\tprivate _stats = { total: 0, filtered: 0 };\n\n\tget filterText(): string {\n\t\treturn this._filterText;\n\t}\n\n\tget filterStats(): { total: number, filtered: number } {\n\t\treturn this._stats;\n\t}\n\n\tset filterText(filterText: string) {\n\t\tif (this._filterText !== filterText) {\n\t\t\tthis._filterText = filterText;\n\t\t\tthis._onDidChange.fire();\n\t\t\tthis.updateFilterStats();\n\t\t}\n\t}\n\n\tupdateFilterStats(): void {\n\t\tconst { total, filtered } = this.filterStatsProvider.getFilterStats();\n\t\tif (this._stats.total !== total || this._stats.filtered !== filtered) {\n\t\t\tthis._stats = { total, filtered };\n\t\t\tthis._onDidStatsChange.fire();\n\t\t}\n\t}\n}\n\nexport class ReplFilterActionViewItem extends BaseActionViewItem {\n\n\tprivate delayedFilterUpdate: Delayer<void>;\n\tprivate container!: HTMLElement;\n\tprivate filterBadge!: HTMLElement;\n\tprivate filterInputBox!: HistoryInputBox;\n\n\tconstructor(\n\t\taction: IAction,\n\t\tprivate placeholder: string,\n\t\tprivate filters: ReplFilterState,\n\t\tprivate history: string[],\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t\t@IContextViewService private readonly contextViewService: IContextViewService) {\n\t\tsuper(null, action);\n\t\tthis.delayedFilterUpdate = new Delayer<void>(400);\n\t\tthis._register(toDisposable(() => this.delayedFilterUpdate.cancel()));\n\t}\n\n\toverride render(container: HTMLElement): void {\n\t\tthis.container = container;\n\t\tthis.container.classList.add('repl-panel-filter-container');\n\n\t\tthis.element = DOM.append(this.container, DOM.$(''));\n\t\tthis.element.className = this.class;\n\t\tthis.createInput(this.element);\n\t\tthis.createBadge(this.element);\n\t\tthis.updateClass();\n\t}\n\n\toverride focus(): void {\n\t\tif (this.filterInputBox) {\n\t\t\tthis.filterInputBox.focus();\n\t\t}\n\t}\n\n\toverride blur(): void {\n\t\tif (this.filterInputBox) {\n\t\t\tthis.filterInputBox.blur();\n\t\t}\n\t}\n\n\toverride setFocusable(): void {\n\t\t// noop input elements are focusable by default\n\t}\n\n\tgetHistory(): string[] {\n\t\treturn this.filterInputBox.getHistory();\n\t}\n\n\toverride get trapsArrowNavigation(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate clearFilterText(): void {\n\t\tthis.filterInputBox.value = '';\n\t}\n\n\tprivate createInput(container: HTMLElement): void {\n\t\tthis.filterInputBox = this._register(this.instantiationService.createInstance(ContextScopedHistoryInputBox, container, this.contextViewService, {\n\t\t\tplaceholder: this.placeholder,\n\t\t\thistory: this.history\n\t\t}));\n\t\tthis._register(attachInputBoxStyler(this.filterInputBox, this.themeService));\n\t\tthis.filterInputBox.value = this.filters.filterText;\n\n\t\tthis._register(this.filterInputBox.onDidChange(() => this.delayedFilterUpdate.trigger(() => this.onDidInputChange(this.filterInputBox!))));\n\t\tthis._register(this.filters.onDidChange(() => {\n\t\t\tthis.filterInputBox.value = this.filters.filterText;\n\t\t}));\n\t\tthis._register(DOM.addStandardDisposableListener(this.filterInputBox.inputElement, DOM.EventType.KEY_DOWN, (e: any) => this.onInputKeyDown(e)));\n\t\tthis._register(DOM.addStandardDisposableListener(container, DOM.EventType.KEY_DOWN, this.handleKeyboardEvent));\n\t\tthis._register(DOM.addStandardDisposableListener(container, DOM.EventType.KEY_UP, this.handleKeyboardEvent));\n\t\tthis._register(DOM.addStandardDisposableListener(this.filterInputBox.inputElement, DOM.EventType.CLICK, (e) => {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t}));\n\t}\n\n\tprivate onDidInputChange(inputbox: HistoryInputBox) {\n\t\tinputbox.addToHistory();\n\t\tthis.filters.filterText = inputbox.value;\n\t}\n\n\t// Action toolbar is swallowing some keys for action items which should not be for an input box\n\tprivate handleKeyboardEvent(event: StandardKeyboardEvent) {\n\t\tif (event.equals(KeyCode.Space)\n\t\t\t|| event.equals(KeyCode.LeftArrow)\n\t\t\t|| event.equals(KeyCode.RightArrow)\n\t\t\t|| event.equals(KeyCode.Escape)\n\t\t) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\t}\n\n\tprivate onInputKeyDown(event: StandardKeyboardEvent) {\n\t\tif (event.equals(KeyCode.Escape)) {\n\t\t\tthis.clearFilterText();\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tprivate createBadge(container: HTMLElement): void {\n\t\tconst controlsContainer = DOM.append(container, DOM.$('.repl-panel-filter-controls'));\n\t\tconst filterBadge = this.filterBadge = DOM.append(controlsContainer, DOM.$('.repl-panel-filter-badge'));\n\t\tthis._register(attachStylerCallback(this.themeService, { badgeBackground, badgeForeground, contrastBorder }, colors => {\n\t\t\tconst background = colors.badgeBackground ? colors.badgeBackground.toString() : '';\n\t\t\tconst foreground = colors.badgeForeground ? colors.badgeForeground.toString() : '';\n\t\t\tconst border = colors.contrastBorder ? colors.contrastBorder.toString() : '';\n\n\t\t\tfilterBadge.style.backgroundColor = background;\n\n\t\t\tfilterBadge.style.borderWidth = border ? '1px' : '';\n\t\t\tfilterBadge.style.borderStyle = border ? 'solid' : '';\n\t\t\tfilterBadge.style.borderColor = border;\n\t\t\tfilterBadge.style.color = foreground;\n\t\t}));\n\t\tthis.updateBadge();\n\t\tthis._register(this.filters.onDidStatsChange(() => this.updateBadge()));\n\t}\n\n\tprivate updateBadge(): void {\n\t\tconst { total, filtered } = this.filters.filterStats;\n\t\tconst filterBadgeHidden = total === filtered || total === 0;\n\n\t\tthis.filterBadge.classList.toggle('hidden', filterBadgeHidden);\n\t\tthis.filterBadge.textContent = localize('showing filtered repl lines', \"Showing {0} of {1}\", filtered, total);\n\t\tthis.filterInputBox.inputElement.style.paddingRight = filterBadgeHidden ? '4px' : '150px';\n\t}\n\n\tprotected get class(): string {\n\t\treturn 'panel-action-tree-filter';\n\t}\n}\n"]}