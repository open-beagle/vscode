{"version":3,"sources":["vs/workbench/contrib/debug/browser/exceptionWidget.ts"],"names":[],"mappings":"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","file":"exceptionWidget.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/exceptionWidget';\nimport * as nls from 'vs/nls';\nimport * as dom from 'vs/base/browser/dom';\nimport { ZoneWidget } from 'vs/editor/contrib/zoneWidget/zoneWidget';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IExceptionInfo, IDebugSession, IDebugEditorContribution, EDITOR_CONTRIBUTION_ID } from 'vs/workbench/contrib/debug/common/debug';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { IThemeService, IColorTheme, ThemeIcon } from 'vs/platform/theme/common/themeService';\nimport { Color } from 'vs/base/common/color';\nimport { registerColor } from 'vs/platform/theme/common/colorRegistry';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { LinkDetector } from 'vs/workbench/contrib/debug/browser/linkDetector';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { ActionBar } from 'vs/base/browser/ui/actionbar/actionbar';\nimport { Action } from 'vs/base/common/actions';\nimport { widgetClose } from 'vs/platform/theme/common/iconRegistry';\nconst $ = dom.$;\n\n// theming\n\nexport const debugExceptionWidgetBorder = registerColor('debugExceptionWidget.border', { dark: '#a31515', light: '#a31515', hc: '#a31515' }, nls.localize('debugExceptionWidgetBorder', 'Exception widget border color.'));\nexport const debugExceptionWidgetBackground = registerColor('debugExceptionWidget.background', { dark: '#420b0d', light: '#f1dfde', hc: '#420b0d' }, nls.localize('debugExceptionWidgetBackground', 'Exception widget background color.'));\n\nexport class ExceptionWidget extends ZoneWidget {\n\n\tprivate backgroundColor: Color | undefined;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tprivate exceptionInfo: IExceptionInfo,\n\t\tprivate debugSession: IDebugSession | undefined,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper(editor, { showFrame: true, showArrow: true, isAccessible: true, frameWidth: 1, className: 'exception-widget-container' });\n\n\t\tthis.applyTheme(themeService.getColorTheme());\n\t\tthis._disposables.add(themeService.onDidColorThemeChange(this.applyTheme.bind(this)));\n\n\t\tthis.create();\n\t\tconst onDidLayoutChangeScheduler = new RunOnceScheduler(() => this._doLayout(undefined, undefined), 50);\n\t\tthis._disposables.add(this.editor.onDidLayoutChange(() => onDidLayoutChangeScheduler.schedule()));\n\t\tthis._disposables.add(onDidLayoutChangeScheduler);\n\t}\n\n\tprivate applyTheme(theme: IColorTheme): void {\n\t\tthis.backgroundColor = theme.getColor(debugExceptionWidgetBackground);\n\t\tconst frameColor = theme.getColor(debugExceptionWidgetBorder);\n\t\tthis.style({\n\t\t\tarrowColor: frameColor,\n\t\t\tframeColor: frameColor\n\t\t}); // style() will trigger _applyStyles\n\t}\n\n\tprotected override _applyStyles(): void {\n\t\tif (this.container) {\n\t\t\tthis.container.style.backgroundColor = this.backgroundColor ? this.backgroundColor.toString() : '';\n\t\t}\n\t\tsuper._applyStyles();\n\t}\n\n\tprotected _fillContainer(container: HTMLElement): void {\n\t\tthis.setCssClass('exception-widget');\n\t\t// Set the font size and line height to the one from the editor configuration.\n\t\tconst fontInfo = this.editor.getOption(EditorOption.fontInfo);\n\t\tcontainer.style.fontSize = `${fontInfo.fontSize}px`;\n\t\tcontainer.style.lineHeight = `${fontInfo.lineHeight}px`;\n\t\tcontainer.tabIndex = 0;\n\t\tconst title = $('.title');\n\t\tconst label = $('.label');\n\t\tdom.append(title, label);\n\t\tconst actions = $('.actions');\n\t\tdom.append(title, actions);\n\t\tlabel.textContent = this.exceptionInfo.id ? nls.localize('exceptionThrownWithId', 'Exception has occurred: {0}', this.exceptionInfo.id) : nls.localize('exceptionThrown', 'Exception has occurred.');\n\t\tlet ariaLabel = label.textContent;\n\n\t\tconst actionBar = new ActionBar(actions);\n\t\tactionBar.push(new Action('editor.closeExceptionWidget', nls.localize('close', \"Close\"), ThemeIcon.asClassName(widgetClose), true, async () => {\n\t\t\tconst contribution = this.editor.getContribution<IDebugEditorContribution>(EDITOR_CONTRIBUTION_ID);\n\t\t\tcontribution.closeExceptionWidget();\n\t\t}), { label: false, icon: true });\n\n\t\tdom.append(container, title);\n\n\t\tif (this.exceptionInfo.description) {\n\t\t\tlet description = $('.description');\n\t\t\tdescription.textContent = this.exceptionInfo.description;\n\t\t\tariaLabel += ', ' + this.exceptionInfo.description;\n\t\t\tdom.append(container, description);\n\t\t}\n\n\t\tif (this.exceptionInfo.details && this.exceptionInfo.details.stackTrace) {\n\t\t\tlet stackTrace = $('.stack-trace');\n\t\t\tconst linkDetector = this.instantiationService.createInstance(LinkDetector);\n\t\t\tconst linkedStackTrace = linkDetector.linkify(this.exceptionInfo.details.stackTrace, true, this.debugSession ? this.debugSession.root : undefined);\n\t\t\tstackTrace.appendChild(linkedStackTrace);\n\t\t\tdom.append(container, stackTrace);\n\t\t\tariaLabel += ', ' + this.exceptionInfo.details.stackTrace;\n\t\t}\n\t\tcontainer.setAttribute('aria-label', ariaLabel);\n\t}\n\n\tprotected override _doLayout(_heightInPixel: number | undefined, _widthInPixel: number | undefined): void {\n\t\t// Reload the height with respect to the exception text content and relayout it to match the line count.\n\t\tthis.container!.style.height = 'initial';\n\n\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\tconst arrowHeight = Math.round(lineHeight / 3);\n\t\tconst computedLinesNumber = Math.ceil((this.container!.offsetHeight + arrowHeight) / lineHeight);\n\n\t\tthis._relayout(computedLinesNumber);\n\t}\n\n\tfocus(): void {\n\t\t// Focus into the container for accessibility purposes so the exception and stack trace gets read\n\t\tthis.container?.focus();\n\t}\n\n\thasfocus(): boolean {\n\t\treturn dom.isAncestor(document.activeElement, this.container);\n\t}\n}\n"]}