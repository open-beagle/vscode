{"version":3,"file":"debugger.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/debug/test/node/debugger.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;IAchG,KAAK,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAC9B,IAAI,SAAmB,CAAC;QAExB,MAAM,mBAAmB,GAAG,SAAS,CAAC;QACtC,MAAM,oBAAoB,GAAG;YAC5B,IAAI,EAAE,MAAM;YACZ,KAAK,EAAE,YAAY;YACnB,OAAO,EAAE,yBAAyB;YAClC,IAAI,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC;YACtB,uBAAuB,EAAE;gBACxB,MAAM,EAAE;oBACP,QAAQ,EAAE,CAAC,SAAS,CAAC;oBACrB,UAAU,EAAE;wBACX,OAAO,EAAE;4BACR,MAAM,EAAE,QAAQ;4BAChB,aAAa,EAAE,yCAAyC;4BACxD,SAAS,EAAE,WAAW;yBACtB;qBACD;iBACD;aACD;YACD,SAAS,EAAE,IAAK;YAChB,qBAAqB,EAAE;gBACtB;oBACC,IAAI,EAAE,YAAY;oBAClB,IAAI,EAAE,MAAM;oBACZ,OAAO,EAAE,QAAQ;oBACjB,OAAO,EAAE,WAAW;iBACpB;aACD;SACD,CAAC;QAEF,MAAM,oBAAoB,GAA0B;YACnD,EAAE,EAAE,SAAS;YACb,UAAU,EAAE,IAAI,gCAAmB,CAAC,SAAS,CAAC;YAC9C,IAAI,EAAE,WAAW;YACjB,OAAO,EAAE,OAAO;YAChB,SAAS,EAAE,QAAQ;YACnB,iBAAiB,EAAE,SAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC;YAChD,SAAS,EAAE,KAAK;YAChB,aAAa,EAAE,KAAK;YACpB,kBAAkB,EAAE,KAAK;YACzB,OAAO,EAAE,IAAK;YACd,WAAW,EAAE;gBACZ,WAAW,EAAE;oBACZ,oBAAoB;iBACpB;aACD;SACD,CAAC;QAEF,MAAM,oBAAoB,GAAG;YAC5B,EAAE,EAAE,YAAY;YAChB,UAAU,EAAE,IAAI,gCAAmB,CAAC,YAAY,CAAC;YACjD,IAAI,EAAE,YAAY;YAClB,OAAO,EAAE,OAAO;YAChB,SAAS,EAAE,QAAQ;YACnB,iBAAiB,EAAE,SAAG,CAAC,IAAI,CAAC,UAAU,CAAC;YACvC,SAAS,EAAE,KAAK;YAChB,aAAa,EAAE,KAAK;YACpB,kBAAkB,EAAE,KAAK;YACzB,OAAO,EAAE,IAAK;YACd,WAAW,EAAE;gBACZ,WAAW,EAAE;oBACZ;wBACC,IAAI,EAAE,MAAM;wBACZ,OAAO,EAAE,SAAS;wBAClB,WAAW,EAAE,CAAC,MAAM,CAAC;wBACrB,OAAO,EAAE,aAAa;wBACtB,IAAI,EAAE,CAAC,MAAM,CAAC;qBACd;iBACD;aACD;SACD,CAAC;QAEF,MAAM,oBAAoB,GAAG;YAC5B,EAAE,EAAE,YAAY;YAChB,UAAU,EAAE,IAAI,gCAAmB,CAAC,YAAY,CAAC;YACjD,IAAI,EAAE,YAAY;YAClB,OAAO,EAAE,OAAO;YAChB,SAAS,EAAE,QAAQ;YACnB,iBAAiB,EAAE,SAAG,CAAC,IAAI,CAAC,UAAU,CAAC;YACvC,SAAS,EAAE,KAAK;YAChB,aAAa,EAAE,KAAK;YACpB,kBAAkB,EAAE,KAAK;YACzB,OAAO,EAAE,IAAK;YACd,WAAW,EAAE;gBACZ,WAAW,EAAE;oBACZ;wBACC,IAAI,EAAE,MAAM;wBACZ,GAAG,EAAE;4BACJ,OAAO,EAAE,YAAY;4BACrB,OAAO,EAAE,YAAY;yBACrB;wBACD,KAAK,EAAE;4BACN,OAAO,EAAE,cAAc;4BACvB,OAAO,EAAE,cAAc;yBACvB;wBACD,GAAG,EAAE;4BACJ,OAAO,EAAE,YAAY;4BACrB,OAAO,EAAE,YAAY;yBACrB;qBACD;iBACD;aACD;SACD,CAAC;QAGF,MAAM,cAAc,GAAoB;YACvC,yBAAyB,CAAC,OAAsB,EAAE,MAAe;gBAChE,OAAO,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YACnC,CAAC;SACD,CAAC;QAEF,MAAM,oBAAoB,GAAG,IAAI,mDAAwB,EAAE,CAAC;QAC5D,MAAM,6BAA6B,GAAG,IAAI,qEAAiC,CAAC,oBAAoB,CAAC,CAAC;QAElG,KAAK,CAAC,GAAG,EAAE;YACV,SAAS,GAAG,IAAI,mBAAQ,CAAC,cAAc,EAAE,oBAAoB,EAAE,oBAAoB,EAAE,oBAAoB,EAAE,6BAA6B,EAAE,SAAU,EAAE,SAAU,EAAE,SAAU,CAAC,CAAC;QAC/K,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,GAAG,EAAE;YACb,SAAS,GAAG,IAAK,CAAC;QACnB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,YAAY,EAAE,GAAG,EAAE;YACvB,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,oBAAoB,CAAC,IAAI,CAAC,CAAC;YAC9D,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,KAAK,EAAE,oBAAoB,CAAC,KAAK,CAAC,CAAC;YAEhE,MAAM,EAAE,GAAG,qCAAsB,CAAC,yBAAyB,CAAC,CAAC,oBAAoB,CAAC,EAAE,MAAM,CAAC,CAAC;YAE5F,MAAM,CAAC,WAAW,CAAC,EAAG,CAAC,OAAO,EAAE,CAAA,GAAA,WAAI,CAAA,CAAC,mBAAmB,EAAE,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC;YACzF,MAAM,CAAC,eAAe,CAAC,EAAG,CAAC,IAAI,EAAE,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAC7D,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mBAAmB,EAAE,GAAG,EAAE;YAC9B,MAAM,eAAe,GAAG,SAAS,CAAC,mBAAmB,EAAG,CAAC,CAAC,CAAC,CAAC;YAC5D,MAAM,CAAC,kBAAkB,CAAC,eAAe,EAAE,oBAAoB,CAAC,uBAAuB,CAAC,CAAC;YACzF,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;gBAC9E,MAAM,CAAC,eAAe,CAAO,eAAgB,CAAC,GAAG,CAAC,EAAQ,oBAAoB,CAAC,uBAAuB,CAAC,MAAO,CAAC,GAAG,CAAC,CAAC,CAAC;YACtH,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,sBAAsB,CAAC,EAAE,KAAK,CAAC,CAAC;YACnE,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,eAAe,CAAC,YAAY,CAAE,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,eAAe,CAAC,YAAY,CAAE,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC;YACnE,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,eAAe,CAAC,YAAY,CAAE,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC;YACnE,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,eAAe,CAAC,YAAY,CAAE,CAAC,eAAe,CAAC,EAAE,IAAI,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,oCAAoC,EAAE,GAAG,EAAE;YAC/C,MAAM,EAAE,GAAG,qCAAsB,CAAC,yBAAyB,CAAC,CAAC,oBAAoB,EAAE,oBAAoB,CAAC,EAAE,MAAM,CAAE,CAAC;YACnH,MAAM,CAAC,WAAW,CAAC,EAAE,CAAC,OAAO,EAAE,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;YACzH,MAAM,QAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC;YAC1G,MAAM,CAAC,eAAe,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,MAAM,EAAE,CAAA,GAAA,gBAAS,CAAA,CAAC,UAAU,CAAC,GAAG,QAAQ,EAAE,MAAM,CAAC,CAAC,CAAC;QACrF,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,6BAA6B,EAAE,GAAG,EAAE;YAExC,MAAM,QAAQ,GAAG,CAAC,GAAG;gBACpB,0DAA0D;gBAC1D,wDAAwD;gBACxD,iFAAiF;gBACjF,sBAAsB;gBACtB,sBAAsB;gBACtB,KAAK;gBACL,0BAA0B;gBAC1B,oBAAoB;gBACpB,yBAAyB;gBACzB,2BAA2B;gBAC3B,KAAK;gBACL,IAAI;gBACJ,GAAG,CAAC,CAAC,IAAI,CAAC,6BAA6B,CAAC,MAAM,CAAC,SAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAEvE,OAAO,SAAS,CAAC,8BAA8B,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBAChE,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;YACvC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { join, normalize } from 'vs/base/common/path';\nimport * as platform from 'vs/base/common/platform';\nimport { IDebugAdapterExecutable, IConfig, IDebugSession, IAdapterManager } from 'vs/workbench/contrib/debug/common/debug';\nimport { Debugger } from 'vs/workbench/contrib/debug/common/debugger';\nimport { TestConfigurationService } from 'vs/platform/configuration/test/common/testConfigurationService';\nimport { URI } from 'vs/base/common/uri';\nimport { ExecutableDebugAdapter } from 'vs/workbench/contrib/debug/node/debugAdapter';\nimport { TestTextResourcePropertiesService } from 'vs/editor/test/common/services/testTextResourcePropertiesService';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\n\n\nsuite('Debug - Debugger', () => {\n\tlet _debugger: Debugger;\n\n\tconst extensionFolderPath = '/a/b/c/';\n\tconst debuggerContribution = {\n\t\ttype: 'mock',\n\t\tlabel: 'Mock Debug',\n\t\tprogram: './out/mock/mockDebug.js',\n\t\targs: ['arg1', 'arg2'],\n\t\tconfigurationAttributes: {\n\t\t\tlaunch: {\n\t\t\t\trequired: ['program'],\n\t\t\t\tproperties: {\n\t\t\t\t\tprogram: {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'description': 'Workspace relative path to a text file.',\n\t\t\t\t\t\t'default': 'readme.md'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tvariables: null!,\n\t\tinitialConfigurations: [\n\t\t\t{\n\t\t\t\tname: 'Mock-Debug',\n\t\t\t\ttype: 'mock',\n\t\t\t\trequest: 'launch',\n\t\t\t\tprogram: 'readme.md'\n\t\t\t}\n\t\t]\n\t};\n\n\tconst extensionDescriptor0 = <IExtensionDescription>{\n\t\tid: 'adapter',\n\t\tidentifier: new ExtensionIdentifier('adapter'),\n\t\tname: 'myAdapter',\n\t\tversion: '1.0.0',\n\t\tpublisher: 'vscode',\n\t\textensionLocation: URI.file(extensionFolderPath),\n\t\tisBuiltin: false,\n\t\tisUserBuiltin: false,\n\t\tisUnderDevelopment: false,\n\t\tengines: null!,\n\t\tcontributes: {\n\t\t\t'debuggers': [\n\t\t\t\tdebuggerContribution\n\t\t\t]\n\t\t}\n\t};\n\n\tconst extensionDescriptor1 = {\n\t\tid: 'extension1',\n\t\tidentifier: new ExtensionIdentifier('extension1'),\n\t\tname: 'extension1',\n\t\tversion: '1.0.0',\n\t\tpublisher: 'vscode',\n\t\textensionLocation: URI.file('/e1/b/c/'),\n\t\tisBuiltin: false,\n\t\tisUserBuiltin: false,\n\t\tisUnderDevelopment: false,\n\t\tengines: null!,\n\t\tcontributes: {\n\t\t\t'debuggers': [\n\t\t\t\t{\n\t\t\t\t\ttype: 'mock',\n\t\t\t\t\truntime: 'runtime',\n\t\t\t\t\truntimeArgs: ['rarg'],\n\t\t\t\t\tprogram: 'mockprogram',\n\t\t\t\t\targs: ['parg']\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t};\n\n\tconst extensionDescriptor2 = {\n\t\tid: 'extension2',\n\t\tidentifier: new ExtensionIdentifier('extension2'),\n\t\tname: 'extension2',\n\t\tversion: '1.0.0',\n\t\tpublisher: 'vscode',\n\t\textensionLocation: URI.file('/e2/b/c/'),\n\t\tisBuiltin: false,\n\t\tisUserBuiltin: false,\n\t\tisUnderDevelopment: false,\n\t\tengines: null!,\n\t\tcontributes: {\n\t\t\t'debuggers': [\n\t\t\t\t{\n\t\t\t\t\ttype: 'mock',\n\t\t\t\t\twin: {\n\t\t\t\t\t\truntime: 'winRuntime',\n\t\t\t\t\t\tprogram: 'winProgram'\n\t\t\t\t\t},\n\t\t\t\t\tlinux: {\n\t\t\t\t\t\truntime: 'linuxRuntime',\n\t\t\t\t\t\tprogram: 'linuxProgram'\n\t\t\t\t\t},\n\t\t\t\t\tosx: {\n\t\t\t\t\t\truntime: 'osxRuntime',\n\t\t\t\t\t\tprogram: 'osxProgram'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t};\n\n\n\tconst adapterManager = <IAdapterManager>{\n\t\tgetDebugAdapterDescriptor(session: IDebugSession, config: IConfig): Promise<IDebugAdapterExecutable | undefined> {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t};\n\n\tconst configurationService = new TestConfigurationService();\n\tconst testResourcePropertiesService = new TestTextResourcePropertiesService(configurationService);\n\n\tsetup(() => {\n\t\t_debugger = new Debugger(adapterManager, debuggerContribution, extensionDescriptor0, configurationService, testResourcePropertiesService, undefined!, undefined!, undefined!);\n\t});\n\n\tteardown(() => {\n\t\t_debugger = null!;\n\t});\n\n\ttest('attributes', () => {\n\t\tassert.strictEqual(_debugger.type, debuggerContribution.type);\n\t\tassert.strictEqual(_debugger.label, debuggerContribution.label);\n\n\t\tconst ae = ExecutableDebugAdapter.platformAdapterExecutable([extensionDescriptor0], 'mock');\n\n\t\tassert.strictEqual(ae!.command, join(extensionFolderPath, debuggerContribution.program));\n\t\tassert.deepStrictEqual(ae!.args, debuggerContribution.args);\n\t});\n\n\ttest('schema attributes', () => {\n\t\tconst schemaAttribute = _debugger.getSchemaAttributes()![0];\n\t\tassert.notDeepStrictEqual(schemaAttribute, debuggerContribution.configurationAttributes);\n\t\tObject.keys(debuggerContribution.configurationAttributes.launch).forEach(key => {\n\t\t\tassert.deepStrictEqual((<any>schemaAttribute)[key], (<any>debuggerContribution.configurationAttributes.launch)[key]);\n\t\t});\n\n\t\tassert.strictEqual(schemaAttribute['additionalProperties'], false);\n\t\tassert.strictEqual(!!schemaAttribute['properties']!['request'], true);\n\t\tassert.strictEqual(!!schemaAttribute['properties']!['name'], true);\n\t\tassert.strictEqual(!!schemaAttribute['properties']!['type'], true);\n\t\tassert.strictEqual(!!schemaAttribute['properties']!['preLaunchTask'], true);\n\t});\n\n\ttest('merge platform specific attributes', () => {\n\t\tconst ae = ExecutableDebugAdapter.platformAdapterExecutable([extensionDescriptor1, extensionDescriptor2], 'mock')!;\n\t\tassert.strictEqual(ae.command, platform.isLinux ? 'linuxRuntime' : (platform.isMacintosh ? 'osxRuntime' : 'winRuntime'));\n\t\tconst xprogram = platform.isLinux ? 'linuxProgram' : (platform.isMacintosh ? 'osxProgram' : 'winProgram');\n\t\tassert.deepStrictEqual(ae.args, ['rarg', normalize('/e2/b/c/') + xprogram, 'parg']);\n\t});\n\n\ttest('initial config file content', () => {\n\n\t\tconst expected = ['{',\n\t\t\t'\t// Use IntelliSense to learn about possible attributes.',\n\t\t\t'\t// Hover to view descriptions of existing attributes.',\n\t\t\t'\t// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387',\n\t\t\t'\t\"version\": \"0.2.0\",',\n\t\t\t'\t\"configurations\": [',\n\t\t\t'\t\t{',\n\t\t\t'\t\t\t\"name\": \"Mock-Debug\",',\n\t\t\t'\t\t\t\"type\": \"mock\",',\n\t\t\t'\t\t\t\"request\": \"launch\",',\n\t\t\t'\t\t\t\"program\": \"readme.md\"',\n\t\t\t'\t\t}',\n\t\t\t'\t]',\n\t\t\t'}'].join(testResourcePropertiesService.getEOL(URI.file('somefile')));\n\n\t\treturn _debugger.getInitialConfigurationContent().then(content => {\n\t\t\tassert.strictEqual(content, expected);\n\t\t}, err => assert.fail(err));\n\t});\n});\n"]}