{"version":3,"sources":["vs/workbench/contrib/update/browser/releaseNotesEditor.ts"],"names":[],"mappings":"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","file":"releaseNotesEditor.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/releasenoteseditor';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { escapeMarkdownSyntaxTokens } from 'vs/base/common/htmlContent';\nimport { KeybindingParser } from 'vs/base/common/keybindingParser';\nimport { OS } from 'vs/base/common/platform';\nimport { escape } from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { TokenizationRegistry } from 'vs/editor/common/modes';\nimport { generateTokensCSSForColorMap } from 'vs/editor/common/modes/supports/tokenization';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport * as nls from 'vs/nls';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { asText, IRequestService } from 'vs/platform/request/common/request';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { DEFAULT_MARKDOWN_STYLES, renderMarkdownDocument } from 'vs/workbench/contrib/markdown/common/markdownDocumentRenderer';\nimport { WebviewInput } from 'vs/workbench/contrib/webviewPanel/browser/webviewEditorInput';\nimport { IWebviewWorkbenchService } from 'vs/workbench/contrib/webviewPanel/browser/webviewWorkbenchService';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { ACTIVE_GROUP, IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\n\nexport class ReleaseNotesManager {\n\n\tprivate readonly _releaseNotesCache = new Map<string, Promise<string>>();\n\n\tprivate _currentReleaseNotes: WebviewInput | undefined = undefined;\n\tprivate _lastText: string | undefined;\n\n\tpublic constructor(\n\t\t@IEnvironmentService private readonly _environmentService: IEnvironmentService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IModeService private readonly _modeService: IModeService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IRequestService private readonly _requestService: IRequestService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IProductService private readonly _productService: IProductService\n\t) {\n\t\tTokenizationRegistry.onDidChange(async () => {\n\t\t\tif (!this._currentReleaseNotes || !this._lastText) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst html = await this.renderBody(this._lastText);\n\t\t\tif (this._currentReleaseNotes) {\n\t\t\t\tthis._currentReleaseNotes.webview.html = html;\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic async show(\n\t\taccessor: ServicesAccessor,\n\t\tversion: string\n\t): Promise<boolean> {\n\t\tconst releaseNoteText = await this.loadReleaseNotes(version);\n\t\tthis._lastText = releaseNoteText;\n\t\tconst html = await this.renderBody(releaseNoteText);\n\t\tconst title = nls.localize('releaseNotesInputName', \"Release Notes: {0}\", version);\n\n\t\tconst activeEditorPane = this._editorService.activeEditorPane;\n\t\tif (this._currentReleaseNotes) {\n\t\t\tthis._currentReleaseNotes.setName(title);\n\t\t\tthis._currentReleaseNotes.webview.html = html;\n\t\t\tthis._webviewWorkbenchService.revealWebview(this._currentReleaseNotes, activeEditorPane ? activeEditorPane.group : this._editorGroupService.activeGroup, false);\n\t\t} else {\n\t\t\tthis._currentReleaseNotes = this._webviewWorkbenchService.createWebview(\n\t\t\t\t'vs_code_release_notes',\n\t\t\t\t'releaseNotes',\n\t\t\t\ttitle,\n\t\t\t\t{ group: ACTIVE_GROUP, preserveFocus: false },\n\t\t\t\t{\n\t\t\t\t\ttryRestoreScrollPosition: true,\n\t\t\t\t\tenableFindWidget: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalResourceRoots: []\n\t\t\t\t},\n\t\t\t\tundefined);\n\n\t\t\tthis._currentReleaseNotes.webview.onDidClickLink(uri => this.onDidClickLink(URI.parse(uri)));\n\t\t\tthis._currentReleaseNotes.onWillDispose(() => { this._currentReleaseNotes = undefined; });\n\n\t\t\tthis._currentReleaseNotes.webview.html = html;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async loadReleaseNotes(version: string): Promise<string> {\n\t\tconst match = /^(\\d+\\.\\d+)\\./.exec(version);\n\t\tif (!match) {\n\t\t\tthrow new Error('not found');\n\t\t}\n\n\t\tconst versionLabel = match[1].replace(/\\./g, '_');\n\t\tconst baseUrl = 'https://code.visualstudio.com/raw';\n\t\tconst url = `${baseUrl}/v${versionLabel}.md`;\n\t\tconst unassigned = nls.localize('unassigned', \"unassigned\");\n\n\t\tconst escapeMdHtml = (text: string): string => {\n\t\t\treturn escape(text).replace(/\\\\/g, '\\\\\\\\');\n\t\t};\n\n\t\tconst patchKeybindings = (text: string): string => {\n\t\t\tconst kb = (match: string, kb: string) => {\n\t\t\t\tconst keybinding = this._keybindingService.lookupKeybinding(kb);\n\n\t\t\t\tif (!keybinding) {\n\t\t\t\t\treturn unassigned;\n\t\t\t\t}\n\n\t\t\t\treturn keybinding.getLabel() || unassigned;\n\t\t\t};\n\n\t\t\tconst kbstyle = (match: string, kb: string) => {\n\t\t\t\tconst keybinding = KeybindingParser.parseKeybinding(kb, OS);\n\n\t\t\t\tif (!keybinding) {\n\t\t\t\t\treturn unassigned;\n\t\t\t\t}\n\n\t\t\t\tconst resolvedKeybindings = this._keybindingService.resolveKeybinding(keybinding);\n\n\t\t\t\tif (resolvedKeybindings.length === 0) {\n\t\t\t\t\treturn unassigned;\n\t\t\t\t}\n\n\t\t\t\treturn resolvedKeybindings[0].getLabel() || unassigned;\n\t\t\t};\n\n\t\t\tconst kbCode = (match: string, binding: string) => {\n\t\t\t\tconst resolved = kb(match, binding);\n\t\t\t\treturn resolved ? `<code title=\"${binding}\">${escapeMdHtml(resolved)}</code>` : resolved;\n\t\t\t};\n\n\t\t\tconst kbstyleCode = (match: string, binding: string) => {\n\t\t\t\tconst resolved = kbstyle(match, binding);\n\t\t\t\treturn resolved ? `<code title=\"${binding}\">${escapeMdHtml(resolved)}</code>` : resolved;\n\t\t\t};\n\n\t\t\treturn text\n\t\t\t\t.replace(/`kb\\(([a-z.\\d\\-]+)\\)`/gi, kbCode)\n\t\t\t\t.replace(/`kbstyle\\(([^\\)]+)\\)`/gi, kbstyleCode)\n\t\t\t\t.replace(/kb\\(([a-z.\\d\\-]+)\\)/gi, (match, binding) => escapeMarkdownSyntaxTokens(kb(match, binding)))\n\t\t\t\t.replace(/kbstyle\\(([^\\)]+)\\)/gi, (match, binding) => escapeMarkdownSyntaxTokens(kbstyle(match, binding)));\n\t\t};\n\n\t\tconst fetchReleaseNotes = async () => {\n\t\t\tlet text;\n\t\t\ttry {\n\t\t\t\ttext = await asText(await this._requestService.request({ url }, CancellationToken.None));\n\t\t\t} catch {\n\t\t\t\tthrow new Error('Failed to fetch release notes');\n\t\t\t}\n\n\t\t\tif (!text || !/^#\\s/.test(text)) { // release notes always starts with `#` followed by whitespace\n\t\t\t\tthrow new Error('Invalid release notes');\n\t\t\t}\n\n\t\t\treturn patchKeybindings(text);\n\t\t};\n\n\t\tif (!this._releaseNotesCache.has(version)) {\n\t\t\tthis._releaseNotesCache.set(version, (async () => {\n\t\t\t\ttry {\n\t\t\t\t\treturn await fetchReleaseNotes();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthis._releaseNotesCache.delete(version);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t})());\n\t\t}\n\n\t\treturn this._releaseNotesCache.get(version)!;\n\t}\n\n\tprivate onDidClickLink(uri: URI) {\n\t\tthis.addGAParameters(uri, 'ReleaseNotes')\n\t\t\t.then(updated => this._openerService.open(updated))\n\t\t\t.then(undefined, onUnexpectedError);\n\t}\n\n\tprivate async addGAParameters(uri: URI, origin: string, experiment = '1'): Promise<URI> {\n\t\tif (this._environmentService.isBuilt && !this._environmentService.isExtensionDevelopment && !this._environmentService.disableTelemetry && !!this._productService.enableTelemetry) {\n\t\t\tif (uri.scheme === 'https' && uri.authority === 'code.visualstudio.com') {\n\t\t\t\tconst info = await this._telemetryService.getTelemetryInfo();\n\n\t\t\t\treturn uri.with({ query: `${uri.query ? uri.query + '&' : ''}utm_source=VsCode&utm_medium=${encodeURIComponent(origin)}&utm_campaign=${encodeURIComponent(info.instanceId)}&utm_content=${encodeURIComponent(experiment)}` });\n\t\t\t}\n\t\t}\n\t\treturn uri;\n\t}\n\n\tprivate async renderBody(text: string) {\n\t\tconst nonce = generateUuid();\n\t\tconst content = await renderMarkdownDocument(text, this._extensionService, this._modeService, false);\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\t\tconst css = colorMap ? generateTokensCSSForColorMap(colorMap) : '';\n\t\treturn `<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<base href=\"https://code.visualstudio.com/raw/\">\n\t\t\t\t<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n\t\t\t\t<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src https: data:; media-src https:; style-src 'nonce-${nonce}' https://code.visualstudio.com;\">\n\t\t\t\t<style nonce=\"${nonce}\">\n\t\t\t\t\t${DEFAULT_MARKDOWN_STYLES}\n\t\t\t\t\t${css}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>${content}</body>\n\t\t</html>`;\n\t}\n}\n"]}