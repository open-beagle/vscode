{"version":3,"file":"themes.test.contribution.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/themes/browser/themes.test.contribution.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport { CommandsRegistry } from 'vs/platform/commands/common/commands';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IWorkbenchThemeService, IWorkbenchColorTheme } from 'vs/workbench/services/themes/common/workbenchThemeService';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { EditorResourceAccessor } from 'vs/workbench/common/editor';\nimport { ITextMateService } from 'vs/workbench/services/textMate/common/textMateService';\nimport { IGrammar, StackElement } from 'vscode-textmate';\nimport { TokenizationRegistry, TokenMetadata } from 'vs/editor/common/modes';\nimport { ThemeRule, findMatchingThemeRule } from 'vs/workbench/services/textMate/common/TMHelper';\nimport { Color } from 'vs/base/common/color';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { basename } from 'vs/base/common/resources';\nimport { Schemas } from 'vs/base/common/network';\nimport { splitLines } from 'vs/base/common/strings';\n\ninterface IToken {\n\tc: string;\n\tt: string;\n\tr: { [themeName: string]: string | undefined; };\n}\n\ninterface IThemedToken {\n\ttext: string;\n\tcolor: Color;\n}\n\ninterface IThemesResult {\n\t[themeName: string]: {\n\t\tdocument: ThemeDocument;\n\t\ttokens: IThemedToken[];\n\t};\n}\n\nclass ThemeDocument {\n\tprivate readonly _theme: IWorkbenchColorTheme;\n\tprivate readonly _cache: { [scopes: string]: ThemeRule; };\n\tprivate readonly _defaultColor: string;\n\n\tconstructor(theme: IWorkbenchColorTheme) {\n\t\tthis._theme = theme;\n\t\tthis._cache = Object.create(null);\n\t\tthis._defaultColor = '#000000';\n\t\tfor (let i = 0, len = this._theme.tokenColors.length; i < len; i++) {\n\t\t\tlet rule = this._theme.tokenColors[i];\n\t\t\tif (!rule.scope) {\n\t\t\t\tthis._defaultColor = rule.settings.foreground!;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _generateExplanation(selector: string, color: Color): string {\n\t\treturn `${selector}: ${Color.Format.CSS.formatHexA(color, true).toUpperCase()}`;\n\t}\n\n\tpublic explainTokenColor(scopes: string, color: Color): string {\n\n\t\tlet matchingRule = this._findMatchingThemeRule(scopes);\n\t\tif (!matchingRule) {\n\t\t\tlet expected = Color.fromHex(this._defaultColor);\n\t\t\t// No matching rule\n\t\t\tif (!color.equals(expected)) {\n\t\t\t\tthrow new Error(`[${this._theme.label}]: Unexpected color ${Color.Format.CSS.formatHexA(color)} for ${scopes}. Expected default ${Color.Format.CSS.formatHexA(expected)}`);\n\t\t\t}\n\t\t\treturn this._generateExplanation('default', color);\n\t\t}\n\n\t\tlet expected = Color.fromHex(matchingRule.settings.foreground!);\n\t\tif (!color.equals(expected)) {\n\t\t\tthrow new Error(`[${this._theme.label}]: Unexpected color ${Color.Format.CSS.formatHexA(color)} for ${scopes}. Expected ${Color.Format.CSS.formatHexA(expected)} coming in from ${matchingRule.rawSelector}`);\n\t\t}\n\t\treturn this._generateExplanation(matchingRule.rawSelector, color);\n\t}\n\n\tprivate _findMatchingThemeRule(scopes: string): ThemeRule {\n\t\tif (!this._cache[scopes]) {\n\t\t\tthis._cache[scopes] = findMatchingThemeRule(this._theme, scopes.split(' '))!;\n\t\t}\n\t\treturn this._cache[scopes];\n\t}\n}\n\nclass Snapper {\n\n\tconstructor(\n\t\t@IModeService private readonly modeService: IModeService,\n\t\t@IWorkbenchThemeService private readonly themeService: IWorkbenchThemeService,\n\t\t@ITextMateService private readonly textMateService: ITextMateService\n\t) {\n\t}\n\n\tprivate _themedTokenize(grammar: IGrammar, lines: string[]): IThemedToken[] {\n\t\tlet colorMap = TokenizationRegistry.getColorMap();\n\t\tlet state: StackElement | null = null;\n\t\tlet result: IThemedToken[] = [], resultLen = 0;\n\t\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\t\tlet line = lines[i];\n\n\t\t\tlet tokenizationResult = grammar.tokenizeLine2(line, state);\n\n\t\t\tfor (let j = 0, lenJ = tokenizationResult.tokens.length >>> 1; j < lenJ; j++) {\n\t\t\t\tlet startOffset = tokenizationResult.tokens[(j << 1)];\n\t\t\t\tlet metadata = tokenizationResult.tokens[(j << 1) + 1];\n\t\t\t\tlet endOffset = j + 1 < lenJ ? tokenizationResult.tokens[((j + 1) << 1)] : line.length;\n\t\t\t\tlet tokenText = line.substring(startOffset, endOffset);\n\n\t\t\t\tlet color = TokenMetadata.getForeground(metadata);\n\n\t\t\t\tresult[resultLen++] = {\n\t\t\t\t\ttext: tokenText,\n\t\t\t\t\tcolor: colorMap![color]\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _tokenize(grammar: IGrammar, lines: string[]): IToken[] {\n\t\tlet state: StackElement | null = null;\n\t\tlet result: IToken[] = [];\n\t\tlet resultLen = 0;\n\t\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\t\tlet line = lines[i];\n\n\t\t\tlet tokenizationResult = grammar.tokenizeLine(line, state);\n\t\t\tlet lastScopes: string | null = null;\n\n\t\t\tfor (let j = 0, lenJ = tokenizationResult.tokens.length; j < lenJ; j++) {\n\t\t\t\tlet token = tokenizationResult.tokens[j];\n\t\t\t\tlet tokenText = line.substring(token.startIndex, token.endIndex);\n\t\t\t\tlet tokenScopes = token.scopes.join(' ');\n\n\t\t\t\tif (lastScopes === tokenScopes) {\n\t\t\t\t\tresult[resultLen - 1].c += tokenText;\n\t\t\t\t} else {\n\t\t\t\t\tlastScopes = tokenScopes;\n\t\t\t\t\tresult[resultLen++] = {\n\t\t\t\t\t\tc: tokenText,\n\t\t\t\t\t\tt: tokenScopes,\n\t\t\t\t\t\tr: {\n\t\t\t\t\t\t\tdark_plus: undefined,\n\t\t\t\t\t\t\tlight_plus: undefined,\n\t\t\t\t\t\t\tdark_vs: undefined,\n\t\t\t\t\t\t\tlight_vs: undefined,\n\t\t\t\t\t\t\thc_black: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _getThemesResult(grammar: IGrammar, lines: string[]): Promise<IThemesResult> {\n\t\tlet currentTheme = this.themeService.getColorTheme();\n\n\t\tlet getThemeName = (id: string) => {\n\t\t\tlet part = 'vscode-theme-defaults-themes-';\n\t\t\tlet startIdx = id.indexOf(part);\n\t\t\tif (startIdx !== -1) {\n\t\t\t\treturn id.substring(startIdx + part.length, id.length - 5);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\n\t\tlet result: IThemesResult = {};\n\n\t\tlet themeDatas = await this.themeService.getColorThemes();\n\t\tlet defaultThemes = themeDatas.filter(themeData => !!getThemeName(themeData.id));\n\t\tfor (let defaultTheme of defaultThemes) {\n\t\t\tlet themeId = defaultTheme.id;\n\t\t\tlet success = await this.themeService.setColorTheme(themeId, undefined);\n\t\t\tif (success) {\n\t\t\t\tlet themeName = getThemeName(themeId);\n\t\t\t\tresult[themeName!] = {\n\t\t\t\t\tdocument: new ThemeDocument(this.themeService.getColorTheme()),\n\t\t\t\t\ttokens: this._themedTokenize(grammar, lines)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tawait this.themeService.setColorTheme(currentTheme.id, undefined);\n\t\treturn result;\n\t}\n\n\tprivate _enrichResult(result: IToken[], themesResult: IThemesResult): void {\n\t\tlet index: { [themeName: string]: number; } = {};\n\t\tlet themeNames = Object.keys(themesResult);\n\t\tfor (const themeName of themeNames) {\n\t\t\tindex[themeName] = 0;\n\t\t}\n\n\t\tfor (let i = 0, len = result.length; i < len; i++) {\n\t\t\tlet token = result[i];\n\n\t\t\tfor (const themeName of themeNames) {\n\t\t\t\tlet themedToken = themesResult[themeName].tokens[index[themeName]];\n\n\t\t\t\tthemedToken.text = themedToken.text.substr(token.c.length);\n\t\t\t\ttoken.r[themeName] = themesResult[themeName].document.explainTokenColor(token.t, themedToken.color);\n\t\t\t\tif (themedToken.text.length === 0) {\n\t\t\t\t\tindex[themeName]++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic captureSyntaxTokens(fileName: string, content: string): Promise<IToken[]> {\n\t\tconst modeId = this.modeService.getModeIdByFilepathOrFirstLine(URI.file(fileName));\n\t\treturn this.textMateService.createGrammar(modeId!).then((grammar) => {\n\t\t\tif (!grammar) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tlet lines = splitLines(content);\n\n\t\t\tlet result = this._tokenize(grammar, lines);\n\t\t\treturn this._getThemesResult(grammar, lines).then((themesResult) => {\n\t\t\t\tthis._enrichResult(result, themesResult);\n\t\t\t\treturn result.filter(t => t.c.length > 0);\n\t\t\t});\n\t\t});\n\t}\n}\n\nCommandsRegistry.registerCommand('_workbench.captureSyntaxTokens', function (accessor: ServicesAccessor, resource: URI) {\n\n\tlet process = (resource: URI) => {\n\t\tlet fileService = accessor.get(IFileService);\n\t\tlet fileName = basename(resource);\n\t\tlet snapper = accessor.get(IInstantiationService).createInstance(Snapper);\n\n\t\treturn fileService.readFile(resource).then(content => {\n\t\t\treturn snapper.captureSyntaxTokens(fileName, content.value.toString());\n\t\t});\n\t};\n\n\tif (!resource) {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst file = editorService.activeEditor ? EditorResourceAccessor.getCanonicalUri(editorService.activeEditor, { filterByScheme: Schemas.file }) : null;\n\t\tif (file) {\n\t\t\tprocess(file).then(result => {\n\t\t\t\tconsole.log(result);\n\t\t\t});\n\t\t} else {\n\t\t\tconsole.log('No file editor active');\n\t\t}\n\t} else {\n\t\treturn process(resource);\n\t}\n\treturn undefined;\n});\n"]}