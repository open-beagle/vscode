{"version":3,"sources":["vs/workbench/contrib/format/browser/formatModified.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IAmBhG,CAAA,GAAA,uCAAoB,CAAA,CAAC,MAAM,oBAAqB,SAAQ,+BAAY;QAEnE;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,6BAA6B;gBACjC,KAAK,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAe,EAAE,IAAuB,CAAC;gBAC7D,KAAK,EAAE,uBAAuB;gBAC9B,YAAY,EAAE,2BAAc,CAAC,GAAG,CAAC,qCAAiB,CAAC,QAAQ,EAAE,qCAAiB,CAAC,sCAAsC,CAAC;aACtH,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,MAAmB;YACxD,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,qCAAqB,CAAC,CAAC;YAEzD,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE;gBACvB,OAAO;aACP;YAED,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,cAAc,CAAC,iBAAiB,EAAE,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;YACvF,IAAI,CAAA,GAAA,wBAAe,CAAA,CAAC,MAAM,CAAC,EAAE;gBAC5B,OAAO,YAAY,CAAC,cAAc,CACjC,iDAAwC,EAAE,MAAM,EAAE,MAAM,oBAC/B,mBAAQ,CAAC,IAAI,EAAE,gCAAiB,CAAC,IAAI,CAC9D,CAAC;aACF;QACF,CAAC;KACD,CAAC,CAAC;IAGI,KAAK,UAAU,iBAAiB,CAAC,QAA0B,EAAE,QAAoB;QACvF,MAAM,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,iBAAW,CAAC,CAAC;QAC7C,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,0CAAoB,CAAC,CAAC;QACzD,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,mCAAiB,CAAC,CAAC;QAErD,MAAM,QAAQ,GAAG,MAAM,CAAA,GAAA,wCAAmB,CAAA,CAAC,UAAU,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC;QACrE,IAAI,CAAC,QAAQ,EAAE;YACd,OAAO,SAAS,CAAC;SACjB;QAED,MAAM,MAAM,GAAY,EAAE,CAAC;QAC3B,MAAM,GAAG,GAAG,MAAM,YAAY,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;QAC9D,IAAI;YACH,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,QAAQ,EAAE,QAAQ,CAAC,GAAG,CAAC,EAAE;gBAC/D,OAAO,SAAS,CAAC;aACjB;YACD,MAAM,OAAO,GAAG,MAAM,aAAa,CAAC,gBAAgB,CAAC,QAAQ,EAAE,QAAQ,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;YACpF,IAAI,CAAC,CAAA,GAAA,wBAAe,CAAA,CAAC,OAAO,CAAC,EAAE;gBAC9B,OAAO,SAAS,CAAC;aACjB;YACD,KAAK,IAAI,MAAM,IAAI,OAAO,EAAE;gBAC3B,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,aAAK,CAC3C,MAAM,CAAC,uBAAuB,EAAE,CAAC,EACjC,MAAM,CAAC,qBAAqB,IAAI,MAAM,CAAC,uBAAuB,CAAC,8CAA8C,EAAE,MAAM,CAAC,gBAAgB,CAAC,CACvI,CAAC,CAAC;aACH;SACD;gBAAS;YACT,GAAG,CAAC,OAAO,EAAE,CAAC;SACd;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IA/BD,8CA+BC","file":"formatModified.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from 'vs/base/common/arrays';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction, registerEditorAction, ServicesAccessor } from 'vs/editor/browser/editorExtensions';\nimport { Range } from 'vs/editor/common/core/range';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { IEditorWorkerService } from 'vs/editor/common/services/editorWorkerService';\nimport { ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { formatDocumentRangesWithSelectedProvider, FormattingMode } from 'vs/editor/contrib/format/format';\nimport * as nls from 'vs/nls';\nimport { ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { Progress } from 'vs/platform/progress/common/progress';\nimport { getOriginalResource } from 'vs/workbench/contrib/scm/browser/dirtydiffDecorator';\nimport { ISCMService } from 'vs/workbench/contrib/scm/common/scm';\n\nregisterEditorAction(class FormatModifiedAction extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.formatChanges',\n\t\t\tlabel: nls.localize('formatChanges', \"Format Modified Lines\"),\n\t\t\talias: 'Format Modified Lines',\n\t\t\tprecondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasDocumentSelectionFormattingProvider),\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\tconst instaService = accessor.get(IInstantiationService);\n\n\t\tif (!editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ranges = await instaService.invokeFunction(getModifiedRanges, editor.getModel());\n\t\tif (isNonEmptyArray(ranges)) {\n\t\t\treturn instaService.invokeFunction(\n\t\t\t\tformatDocumentRangesWithSelectedProvider, editor, ranges,\n\t\t\t\tFormattingMode.Explicit, Progress.None, CancellationToken.None\n\t\t\t);\n\t\t}\n\t}\n});\n\n\nexport async function getModifiedRanges(accessor: ServicesAccessor, modified: ITextModel): Promise<Range[] | undefined> {\n\tconst scmService = accessor.get(ISCMService);\n\tconst workerService = accessor.get(IEditorWorkerService);\n\tconst modelService = accessor.get(ITextModelService);\n\n\tconst original = await getOriginalResource(scmService, modified.uri);\n\tif (!original) {\n\t\treturn undefined;\n\t}\n\n\tconst ranges: Range[] = [];\n\tconst ref = await modelService.createModelReference(original);\n\ttry {\n\t\tif (!workerService.canComputeDirtyDiff(original, modified.uri)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst changes = await workerService.computeDirtyDiff(original, modified.uri, false);\n\t\tif (!isNonEmptyArray(changes)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tfor (let change of changes) {\n\t\t\tranges.push(modified.validateRange(new Range(\n\t\t\t\tchange.modifiedStartLineNumber, 1,\n\t\t\t\tchange.modifiedEndLineNumber || change.modifiedStartLineNumber /*endLineNumber is 0 when things got deleted*/, Number.MAX_SAFE_INTEGER)\n\t\t\t));\n\t\t}\n\t} finally {\n\t\tref.dispose();\n\t}\n\n\treturn ranges;\n}\n"]}