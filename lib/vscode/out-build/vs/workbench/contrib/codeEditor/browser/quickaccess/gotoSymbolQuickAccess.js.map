{"version":3,"sources":["vs/workbench/contrib/codeEditor/browser/quickaccess/gotoSymbolQuickAccess.ts"],"names":[],"mappings":"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","file":"gotoSymbolQuickAccess.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { IKeyMods, IQuickPickSeparator, IQuickInputService, IQuickPick } from 'vs/platform/quickinput/common/quickInput';\nimport { IEditor } from 'vs/editor/common/editorCommon';\nimport { IEditorService, SIDE_GROUP } from 'vs/workbench/services/editor/common/editorService';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IQuickAccessRegistry, Extensions as QuickaccessExtensions } from 'vs/platform/quickinput/common/quickAccess';\nimport { AbstractGotoSymbolQuickAccessProvider, IGotoSymbolQuickPickItem } from 'vs/editor/contrib/quickAccess/gotoSymbolQuickAccess';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IWorkbenchEditorConfiguration } from 'vs/workbench/common/editor';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { DisposableStore, IDisposable, toDisposable, Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { timeout } from 'vs/base/common/async';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { registerAction2, Action2 } from 'vs/platform/actions/common/actions';\nimport { KeyMod, KeyCode } from 'vs/base/common/keyCodes';\nimport { prepareQuery } from 'vs/base/common/fuzzyScorer';\nimport { SymbolKind } from 'vs/editor/common/modes';\nimport { fuzzyScore, createMatches } from 'vs/base/common/filters';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { IQuickAccessTextEditorContext } from 'vs/editor/contrib/quickAccess/editorNavigationQuickAccess';\nimport { IOutlineService, OutlineTarget } from 'vs/workbench/services/outline/browser/outline';\nimport { isCompositeEditor } from 'vs/editor/browser/editorBrowser';\n\nexport class GotoSymbolQuickAccessProvider extends AbstractGotoSymbolQuickAccessProvider {\n\n\tprotected readonly onDidActiveTextEditorControlChange = this.editorService.onDidActiveEditorChange;\n\n\tconstructor(\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IOutlineService private readonly outlineService: IOutlineService,\n\t) {\n\t\tsuper({\n\t\t\topenSideBySideDirection: () => this.configuration.openSideBySideDirection\n\t\t});\n\t}\n\n\t//#region DocumentSymbols (text editor required)\n\n\tprivate get configuration() {\n\t\tconst editorConfig = this.configurationService.getValue<IWorkbenchEditorConfiguration>().workbench?.editor;\n\n\t\treturn {\n\t\t\topenEditorPinned: !editorConfig?.enablePreviewFromQuickOpen || !editorConfig?.enablePreview,\n\t\t\topenSideBySideDirection: editorConfig?.openSideBySideDirection\n\t\t};\n\t}\n\n\tprotected get activeTextEditorControl() {\n\t\t// TODO@bpasero this distinction should go away by adopting `IOutlineService`\n\t\t// for all editors (either text based ones or not). Currently text based\n\t\t// editors are not yet using the new outline service infrastructure but the\n\t\t// \"classical\" document symbols approach.\n\n\t\tif (isCompositeEditor(this.editorService.activeEditorPane?.getControl())) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this.editorService.activeTextEditorControl;\n\t}\n\n\tprotected override gotoLocation(context: IQuickAccessTextEditorContext, options: { range: IRange, keyMods: IKeyMods, forceSideBySide?: boolean, preserveFocus?: boolean }): void {\n\n\t\t// Check for sideBySide use\n\t\tif ((options.keyMods.alt || (this.configuration.openEditorPinned && options.keyMods.ctrlCmd) || options.forceSideBySide) && this.editorService.activeEditor) {\n\t\t\tcontext.restoreViewState?.(); // since we open to the side, restore view state in this editor\n\n\t\t\tthis.editorService.openEditor(this.editorService.activeEditor, {\n\t\t\t\tselection: options.range,\n\t\t\t\tpinned: options.keyMods.ctrlCmd || this.configuration.openEditorPinned,\n\t\t\t\tpreserveFocus: options.preserveFocus\n\t\t\t}, SIDE_GROUP);\n\t\t}\n\n\t\t// Otherwise let parent handle it\n\t\telse {\n\t\t\tsuper.gotoLocation(context, options);\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region public methods to use this picker from other pickers\n\n\tprivate static readonly SYMBOL_PICKS_TIMEOUT = 8000;\n\n\tasync getSymbolPicks(model: ITextModel, filter: string, options: { extraContainerLabel?: string }, disposables: DisposableStore, token: CancellationToken): Promise<Array<IGotoSymbolQuickPickItem | IQuickPickSeparator>> {\n\n\t\t// If the registry does not know the model, we wait for as long as\n\t\t// the registry knows it. This helps in cases where a language\n\t\t// registry was not activated yet for providing any symbols.\n\t\t// To not wait forever, we eventually timeout though.\n\t\tconst result = await Promise.race([\n\t\t\tthis.waitForLanguageSymbolRegistry(model, disposables),\n\t\t\ttimeout(GotoSymbolQuickAccessProvider.SYMBOL_PICKS_TIMEOUT)\n\t\t]);\n\n\t\tif (!result || token.isCancellationRequested) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn this.doGetSymbolPicks(this.getDocumentSymbols(model, token), prepareQuery(filter), options, token);\n\t}\n\n\toverride addDecorations(editor: IEditor, range: IRange): void {\n\t\tsuper.addDecorations(editor, range);\n\t}\n\n\toverride clearDecorations(editor: IEditor): void {\n\t\tsuper.clearDecorations(editor);\n\t}\n\n\t//#endregion\n\n\tprotected override provideWithoutTextEditor(picker: IQuickPick<IGotoSymbolQuickPickItem>): IDisposable {\n\t\tif (this.canPickWithOutlineService()) {\n\t\t\treturn this.doGetOutlinePicks(picker);\n\t\t}\n\t\treturn super.provideWithoutTextEditor(picker);\n\t}\n\n\tprivate canPickWithOutlineService(): boolean {\n\t\treturn this.editorService.activeEditorPane ? this.outlineService.canCreateOutline(this.editorService.activeEditorPane) : false;\n\t}\n\n\tprivate doGetOutlinePicks(picker: IQuickPick<IGotoSymbolQuickPickItem>): IDisposable {\n\t\tconst pane = this.editorService.activeEditorPane;\n\t\tif (!pane) {\n\t\t\treturn Disposable.None;\n\t\t}\n\t\tconst cts = new CancellationTokenSource();\n\n\t\tconst disposables = new DisposableStore();\n\t\tdisposables.add(toDisposable(() => cts.dispose(true)));\n\n\t\tpicker.busy = true;\n\n\t\tthis.outlineService.createOutline(pane, OutlineTarget.QuickPick, cts.token).then(outline => {\n\n\t\t\tif (!outline) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\toutline.dispose();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdisposables.add(outline);\n\n\t\t\tconst viewState = outline.captureViewState();\n\t\t\tdisposables.add(toDisposable(() => {\n\t\t\t\tif (picker.selectedItems.length === 0) {\n\t\t\t\t\tviewState.dispose();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst entries = outline.config.quickPickDataSource.getQuickPickElements();\n\n\t\t\tconst items: IGotoSymbolQuickPickItem[] = entries.map((entry, idx) => {\n\t\t\t\treturn {\n\t\t\t\t\tkind: SymbolKind.File,\n\t\t\t\t\tindex: idx,\n\t\t\t\t\tscore: 0,\n\t\t\t\t\tlabel: entry.label,\n\t\t\t\t\tdescription: entry.description,\n\t\t\t\t\tariaLabel: entry.ariaLabel,\n\t\t\t\t\ticonClasses: entry.iconClasses\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tdisposables.add(picker.onDidAccept(() => {\n\t\t\t\tpicker.hide();\n\t\t\t\tconst [entry] = picker.selectedItems;\n\t\t\t\tif (entry && entries[entry.index]) {\n\t\t\t\t\toutline.reveal(entries[entry.index].element, {}, false);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst updatePickerItems = () => {\n\t\t\t\tconst filteredItems = items.filter(item => {\n\t\t\t\t\tif (picker.value === '@') {\n\t\t\t\t\t\t// default, no filtering, scoring...\n\t\t\t\t\t\titem.score = 0;\n\t\t\t\t\t\titem.highlights = undefined;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tconst score = fuzzyScore(picker.value, picker.value.toLowerCase(), 1 /*@-character*/, item.label, item.label.toLowerCase(), 0, true);\n\t\t\t\t\tif (!score) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\titem.score = score[1];\n\t\t\t\t\titem.highlights = { label: createMatches(score) };\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tif (filteredItems.length === 0) {\n\t\t\t\t\tconst label = localize('empty', 'No matching entries');\n\t\t\t\t\tpicker.items = [{ label, index: -1, kind: SymbolKind.String }];\n\t\t\t\t\tpicker.ariaLabel = label;\n\t\t\t\t} else {\n\t\t\t\t\tpicker.items = filteredItems;\n\t\t\t\t}\n\t\t\t};\n\t\t\tupdatePickerItems();\n\t\t\tdisposables.add(picker.onDidChangeValue(updatePickerItems));\n\n\t\t\tconst previewDisposable = new MutableDisposable();\n\t\t\tdisposables.add(previewDisposable);\n\n\t\t\tdisposables.add(picker.onDidChangeActive(() => {\n\t\t\t\tconst [entry] = picker.activeItems;\n\t\t\t\tif (entry && entries[entry.index]) {\n\t\t\t\t\tpreviewDisposable.value = outline.preview(entries[entry.index].element);\n\t\t\t\t} else {\n\t\t\t\t\tpreviewDisposable.clear();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t}).catch(err => {\n\t\t\tonUnexpectedError(err);\n\t\t\tpicker.hide();\n\t\t}).finally(() => {\n\t\t\tpicker.busy = false;\n\t\t});\n\n\t\treturn disposables;\n\t}\n}\n\nRegistry.as<IQuickAccessRegistry>(QuickaccessExtensions.Quickaccess).registerQuickAccessProvider({\n\tctor: GotoSymbolQuickAccessProvider,\n\tprefix: AbstractGotoSymbolQuickAccessProvider.PREFIX,\n\tcontextKey: 'inFileSymbolsPicker',\n\tplaceholder: localize('gotoSymbolQuickAccessPlaceholder', \"Type the name of a symbol to go to.\"),\n\thelpEntries: [\n\t\t{ description: localize('gotoSymbolQuickAccess', \"Go to Symbol in Editor\"), prefix: AbstractGotoSymbolQuickAccessProvider.PREFIX, needsEditor: true },\n\t\t{ description: localize('gotoSymbolByCategoryQuickAccess', \"Go to Symbol in Editor by Category\"), prefix: AbstractGotoSymbolQuickAccessProvider.PREFIX_BY_CATEGORY, needsEditor: true }\n\t]\n});\n\nregisterAction2(class GotoSymbolAction extends Action2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.gotoSymbol',\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('gotoSymbol', \"Go to Symbol in Editor...\"),\n\t\t\t\toriginal: 'Go to Symbol in Editor...'\n\t\t\t},\n\t\t\tf1: true,\n\t\t\tkeybinding: {\n\t\t\t\twhen: undefined,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KEY_O\n\t\t\t}\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor) {\n\t\taccessor.get(IQuickInputService).quickAccess.show(GotoSymbolQuickAccessProvider.PREFIX);\n\t}\n});\n"]}