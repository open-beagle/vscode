{"version":3,"sources":["vs/workbench/contrib/codeEditor/browser/inspectEditorTokens/inspectEditorTokens.ts"],"names":[],"mappings":"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","file":"inspectEditorTokens.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./inspectEditorTokens';\nimport * as nls from 'vs/nls';\nimport * as dom from 'vs/base/browser/dom';\nimport { CharCode } from 'vs/base/common/charCode';\nimport { Color } from 'vs/base/common/color';\nimport { KeyCode } from 'vs/base/common/keyCodes';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { ContentWidgetPositionPreference, IActiveCodeEditor, ICodeEditor, IContentWidget, IContentWidgetPosition } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction, ServicesAccessor, registerEditorAction, registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { FontStyle, LanguageIdentifier, StandardTokenType, TokenMetadata, DocumentSemanticTokensProviderRegistry, SemanticTokensLegend, SemanticTokens, LanguageId, ColorId, DocumentRangeSemanticTokensProviderRegistry } from 'vs/editor/common/modes';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { editorHoverBackground, editorHoverBorder } from 'vs/platform/theme/common/colorRegistry';\nimport { registerThemingParticipant } from 'vs/platform/theme/common/themeService';\nimport { findMatchingThemeRule } from 'vs/workbench/services/textMate/common/TMHelper';\nimport { ITextMateService, IGrammar, IToken, StackElement } from 'vs/workbench/services/textMate/common/textMateService';\nimport { IWorkbenchThemeService } from 'vs/workbench/services/themes/common/workbenchThemeService';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { ColorThemeData, TokenStyleDefinitions, TokenStyleDefinition, TextMateThemingRuleDefinitions } from 'vs/workbench/services/themes/common/colorThemeData';\nimport { SemanticTokenRule, TokenStyleData, TokenStyle } from 'vs/platform/theme/common/tokenClassificationRegistry';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { SEMANTIC_HIGHLIGHTING_SETTING_ID, IEditorSemanticHighlightingOptions } from 'vs/editor/common/services/modelServiceImpl';\nimport { ColorScheme } from 'vs/platform/theme/common/theme';\n\nconst $ = dom.$;\n\nclass InspectEditorTokensController extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.inspectEditorTokens';\n\n\tpublic static get(editor: ICodeEditor): InspectEditorTokensController {\n\t\treturn editor.getContribution<InspectEditorTokensController>(InspectEditorTokensController.ID);\n\t}\n\n\tprivate _editor: ICodeEditor;\n\tprivate _textMateService: ITextMateService;\n\tprivate _themeService: IWorkbenchThemeService;\n\tprivate _modeService: IModeService;\n\tprivate _notificationService: INotificationService;\n\tprivate _configurationService: IConfigurationService;\n\tprivate _widget: InspectEditorTokensWidget | null;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@ITextMateService textMateService: ITextMateService,\n\t\t@IModeService modeService: IModeService,\n\t\t@IWorkbenchThemeService themeService: IWorkbenchThemeService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IConfigurationService configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis._editor = editor;\n\t\tthis._textMateService = textMateService;\n\t\tthis._themeService = themeService;\n\t\tthis._modeService = modeService;\n\t\tthis._notificationService = notificationService;\n\t\tthis._configurationService = configurationService;\n\t\tthis._widget = null;\n\n\t\tthis._register(this._editor.onDidChangeModel((e) => this.stop()));\n\t\tthis._register(this._editor.onDidChangeModelLanguage((e) => this.stop()));\n\t\tthis._register(this._editor.onKeyUp((e) => e.keyCode === KeyCode.Escape && this.stop()));\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis.stop();\n\t\tsuper.dispose();\n\t}\n\n\tpublic launch(): void {\n\t\tif (this._widget) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tthis._widget = new InspectEditorTokensWidget(this._editor, this._textMateService, this._modeService, this._themeService, this._notificationService, this._configurationService);\n\t}\n\n\tpublic stop(): void {\n\t\tif (this._widget) {\n\t\t\tthis._widget.dispose();\n\t\t\tthis._widget = null;\n\t\t}\n\t}\n\n\tpublic toggle(): void {\n\t\tif (!this._widget) {\n\t\t\tthis.launch();\n\t\t} else {\n\t\t\tthis.stop();\n\t\t}\n\t}\n}\n\nclass InspectEditorTokens extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.inspectTMScopes',\n\t\t\tlabel: nls.localize('inspectEditorTokens', \"Developer: Inspect Editor Tokens and Scopes\"),\n\t\t\talias: 'Developer: Inspect Editor Tokens and Scopes',\n\t\t\tprecondition: undefined\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tlet controller = InspectEditorTokensController.get(editor);\n\t\tif (controller) {\n\t\t\tcontroller.toggle();\n\t\t}\n\t}\n}\n\ninterface ITextMateTokenInfo {\n\ttoken: IToken;\n\tmetadata: IDecodedMetadata;\n}\n\ninterface ISemanticTokenInfo {\n\ttype: string;\n\tmodifiers: string[];\n\trange: Range;\n\tmetadata?: IDecodedMetadata,\n\tdefinitions: TokenStyleDefinitions\n}\n\ninterface IDecodedMetadata {\n\tlanguageIdentifier: LanguageIdentifier;\n\ttokenType: StandardTokenType;\n\tbold?: boolean;\n\titalic?: boolean;\n\tunderline?: boolean;\n\tforeground?: string;\n\tbackground?: string;\n}\n\nfunction renderTokenText(tokenText: string): string {\n\tif (tokenText.length > 40) {\n\t\ttokenText = tokenText.substr(0, 20) + '…' + tokenText.substr(tokenText.length - 20);\n\t}\n\tlet result: string = '';\n\tfor (let charIndex = 0, len = tokenText.length; charIndex < len; charIndex++) {\n\t\tlet charCode = tokenText.charCodeAt(charIndex);\n\t\tswitch (charCode) {\n\t\t\tcase CharCode.Tab:\n\t\t\t\tresult += '\\u2192'; // &rarr;\n\t\t\t\tbreak;\n\n\t\t\tcase CharCode.Space:\n\t\t\t\tresult += '\\u00B7'; // &middot;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tresult += String.fromCharCode(charCode);\n\t\t}\n\t}\n\treturn result;\n}\n\ntype SemanticTokensResult = { tokens: SemanticTokens, legend: SemanticTokensLegend };\n\nclass InspectEditorTokensWidget extends Disposable implements IContentWidget {\n\n\tprivate static readonly _ID = 'editor.contrib.inspectEditorTokensWidget';\n\n\t// Editor.IContentWidget.allowEditorOverflow\n\tpublic readonly allowEditorOverflow = true;\n\n\tprivate _isDisposed: boolean;\n\tprivate readonly _editor: IActiveCodeEditor;\n\tprivate readonly _modeService: IModeService;\n\tprivate readonly _themeService: IWorkbenchThemeService;\n\tprivate readonly _textMateService: ITextMateService;\n\tprivate readonly _notificationService: INotificationService;\n\tprivate readonly _configurationService: IConfigurationService;\n\tprivate readonly _model: ITextModel;\n\tprivate readonly _domNode: HTMLElement;\n\tprivate readonly _currentRequestCancellationTokenSource: CancellationTokenSource;\n\n\tconstructor(\n\t\teditor: IActiveCodeEditor,\n\t\ttextMateService: ITextMateService,\n\t\tmodeService: IModeService,\n\t\tthemeService: IWorkbenchThemeService,\n\t\tnotificationService: INotificationService,\n\t\tconfigurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis._isDisposed = false;\n\t\tthis._editor = editor;\n\t\tthis._modeService = modeService;\n\t\tthis._themeService = themeService;\n\t\tthis._textMateService = textMateService;\n\t\tthis._notificationService = notificationService;\n\t\tthis._configurationService = configurationService;\n\t\tthis._model = this._editor.getModel();\n\t\tthis._domNode = document.createElement('div');\n\t\tthis._domNode.className = 'token-inspect-widget';\n\t\tthis._currentRequestCancellationTokenSource = new CancellationTokenSource();\n\t\tthis._beginCompute(this._editor.getPosition());\n\t\tthis._register(this._editor.onDidChangeCursorPosition((e) => this._beginCompute(this._editor.getPosition())));\n\t\tthis._register(themeService.onDidColorThemeChange(_ => this._beginCompute(this._editor.getPosition())));\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => e.affectsConfiguration('editor.semanticHighlighting.enabled') && this._beginCompute(this._editor.getPosition())));\n\t\tthis._editor.addContentWidget(this);\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._isDisposed = true;\n\t\tthis._editor.removeContentWidget(this);\n\t\tthis._currentRequestCancellationTokenSource.cancel();\n\t\tsuper.dispose();\n\t}\n\n\tpublic getId(): string {\n\t\treturn InspectEditorTokensWidget._ID;\n\t}\n\n\tprivate _beginCompute(position: Position): void {\n\t\tconst grammar = this._textMateService.createGrammar(this._model.getLanguageIdentifier().language);\n\t\tconst semanticTokens = this._computeSemanticTokens(position);\n\n\t\tdom.clearNode(this._domNode);\n\t\tthis._domNode.appendChild(document.createTextNode(nls.localize('inspectTMScopesWidget.loading', \"Loading...\")));\n\n\t\tPromise.all([grammar, semanticTokens]).then(([grammar, semanticTokens]) => {\n\t\t\tif (this._isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._compute(grammar, semanticTokens, position);\n\t\t\tthis._domNode.style.maxWidth = `${Math.max(this._editor.getLayoutInfo().width * 0.66, 500)}px`;\n\t\t\tthis._editor.layoutContentWidget(this);\n\t\t}, (err) => {\n\t\t\tthis._notificationService.warn(err);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tInspectEditorTokensController.get(this._editor).stop();\n\t\t\t});\n\t\t});\n\n\t}\n\n\tprivate _isSemanticColoringEnabled() {\n\t\tconst setting = this._configurationService.getValue<IEditorSemanticHighlightingOptions>(SEMANTIC_HIGHLIGHTING_SETTING_ID, { overrideIdentifier: this._model.getLanguageIdentifier().language, resource: this._model.uri })?.enabled;\n\t\tif (typeof setting === 'boolean') {\n\t\t\treturn setting;\n\t\t}\n\t\treturn this._themeService.getColorTheme().semanticHighlighting;\n\t}\n\n\tprivate _compute(grammar: IGrammar | null, semanticTokens: SemanticTokensResult | null, position: Position) {\n\t\tconst textMateTokenInfo = grammar && this._getTokensAtPosition(grammar, position);\n\t\tconst semanticTokenInfo = semanticTokens && this._getSemanticTokenAtPosition(semanticTokens, position);\n\t\tif (!textMateTokenInfo && !semanticTokenInfo) {\n\t\t\tdom.reset(this._domNode, 'No grammar or semantic tokens available.');\n\t\t\treturn;\n\t\t}\n\n\t\tlet tmMetadata = textMateTokenInfo?.metadata;\n\t\tlet semMetadata = semanticTokenInfo?.metadata;\n\n\t\tconst semTokenText = semanticTokenInfo && renderTokenText(this._model.getValueInRange(semanticTokenInfo.range));\n\t\tconst tmTokenText = textMateTokenInfo && renderTokenText(this._model.getLineContent(position.lineNumber).substring(textMateTokenInfo.token.startIndex, textMateTokenInfo.token.endIndex));\n\n\t\tconst tokenText = semTokenText || tmTokenText || '';\n\n\t\tdom.reset(this._domNode,\n\t\t\t$('h2.tiw-token', undefined,\n\t\t\t\ttokenText,\n\t\t\t\t$('span.tiw-token-length', undefined, `${tokenText.length} ${tokenText.length === 1 ? 'char' : 'chars'}`)));\n\t\tdom.append(this._domNode, $('hr.tiw-metadata-separator', { 'style': 'clear:both' }));\n\t\tdom.append(this._domNode, $('table.tiw-metadata-table', undefined,\n\t\t\t$('tbody', undefined,\n\t\t\t\t$('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'language'),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, tmMetadata?.languageIdentifier.language || '')\n\t\t\t\t),\n\t\t\t\t$('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'standard token type' as string),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, this._tokenTypeToString(tmMetadata?.tokenType || StandardTokenType.Other))\n\t\t\t\t),\n\t\t\t\t...this._formatMetadata(semMetadata, tmMetadata)\n\t\t\t)\n\t\t));\n\n\t\tif (semanticTokenInfo) {\n\t\t\tdom.append(this._domNode, $('hr.tiw-metadata-separator'));\n\t\t\tconst table = dom.append(this._domNode, $('table.tiw-metadata-table', undefined));\n\t\t\tconst tbody = dom.append(table, $('tbody', undefined,\n\t\t\t\t$('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'semantic token type' as string),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, semanticTokenInfo.type)\n\t\t\t\t)\n\t\t\t));\n\t\t\tif (semanticTokenInfo.modifiers.length) {\n\t\t\t\tdom.append(tbody, $('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'modifiers'),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, semanticTokenInfo.modifiers.join(' ')),\n\t\t\t\t));\n\t\t\t}\n\t\t\tif (semanticTokenInfo.metadata) {\n\t\t\t\tconst properties: (keyof TokenStyleData)[] = ['foreground', 'bold', 'italic', 'underline'];\n\t\t\t\tconst propertiesByDefValue: { [rule: string]: string[] } = {};\n\t\t\t\tconst allDefValues = new Array<[Array<HTMLElement | string>, string]>(); // remember the order\n\t\t\t\t// first collect to detect when the same rule is used for multiple properties\n\t\t\t\tfor (let property of properties) {\n\t\t\t\t\tif (semanticTokenInfo.metadata[property] !== undefined) {\n\t\t\t\t\t\tconst definition = semanticTokenInfo.definitions[property];\n\t\t\t\t\t\tconst defValue = this._renderTokenStyleDefinition(definition, property);\n\t\t\t\t\t\tconst defValueStr = defValue.map(el => el instanceof HTMLElement ? el.outerHTML : el).join();\n\t\t\t\t\t\tlet properties = propertiesByDefValue[defValueStr];\n\t\t\t\t\t\tif (!properties) {\n\t\t\t\t\t\t\tpropertiesByDefValue[defValueStr] = properties = [];\n\t\t\t\t\t\t\tallDefValues.push([defValue, defValueStr]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tproperties.push(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const [defValue, defValueStr] of allDefValues) {\n\t\t\t\t\tdom.append(tbody, $('tr', undefined,\n\t\t\t\t\t\t$('td.tiw-metadata-key', undefined, propertiesByDefValue[defValueStr].join(', ')),\n\t\t\t\t\t\t$('td.tiw-metadata-value', undefined, ...defValue)\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (textMateTokenInfo) {\n\t\t\tlet theme = this._themeService.getColorTheme();\n\t\t\tdom.append(this._domNode, $('hr.tiw-metadata-separator'));\n\t\t\tconst table = dom.append(this._domNode, $('table.tiw-metadata-table'));\n\t\t\tconst tbody = dom.append(table, $('tbody'));\n\n\t\t\tif (tmTokenText && tmTokenText !== tokenText) {\n\t\t\t\tdom.append(tbody, $('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'textmate token' as string),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, `${tmTokenText} (${tmTokenText.length})`)\n\t\t\t\t));\n\t\t\t}\n\t\t\tconst scopes = new Array<HTMLElement | string>();\n\t\t\tfor (let i = textMateTokenInfo.token.scopes.length - 1; i >= 0; i--) {\n\t\t\t\tscopes.push(textMateTokenInfo.token.scopes[i]);\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tscopes.push($('br'));\n\t\t\t\t}\n\t\t\t}\n\t\t\tdom.append(tbody, $('tr', undefined,\n\t\t\t\t$('td.tiw-metadata-key', undefined, 'textmate scopes' as string),\n\t\t\t\t$('td.tiw-metadata-value.tiw-metadata-scopes', undefined, ...scopes),\n\t\t\t));\n\n\t\t\tlet matchingRule = findMatchingThemeRule(theme, textMateTokenInfo.token.scopes, false);\n\t\t\tconst semForeground = semanticTokenInfo?.metadata?.foreground;\n\t\t\tif (matchingRule) {\n\t\t\t\tif (semForeground !== textMateTokenInfo.metadata.foreground) {\n\t\t\t\t\tlet defValue = $('code.tiw-theme-selector', undefined,\n\t\t\t\t\t\tmatchingRule.rawSelector, $('br'), JSON.stringify(matchingRule.settings, null, '\\t'));\n\t\t\t\t\tif (semForeground) {\n\t\t\t\t\t\tdefValue = $('s', undefined, defValue);\n\t\t\t\t\t}\n\t\t\t\t\tdom.append(tbody, $('tr', undefined,\n\t\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'foreground'),\n\t\t\t\t\t\t$('td.tiw-metadata-value', undefined, defValue),\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t} else if (!semForeground) {\n\t\t\t\tdom.append(tbody, $('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'foreground'),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, 'No theme selector' as string),\n\t\t\t\t));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _formatMetadata(semantic?: IDecodedMetadata, tm?: IDecodedMetadata): Array<HTMLElement | string> {\n\t\tconst elements = new Array<HTMLElement | string>();\n\n\t\tfunction render(property: 'foreground' | 'background') {\n\t\t\tlet value = semantic?.[property] || tm?.[property];\n\t\t\tif (value !== undefined) {\n\t\t\t\tconst semanticStyle = semantic?.[property] ? 'tiw-metadata-semantic' : '';\n\t\t\t\telements.push($('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, property),\n\t\t\t\t\t$(`td.tiw-metadata-value.${semanticStyle}`, undefined, value)\n\t\t\t\t));\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tconst foreground = render('foreground');\n\t\tconst background = render('background');\n\t\tif (foreground && background) {\n\t\t\tconst backgroundColor = Color.fromHex(background), foregroundColor = Color.fromHex(foreground);\n\t\t\tif (backgroundColor.isOpaque()) {\n\t\t\t\telements.push($('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'contrast ratio' as string),\n\t\t\t\t\t$('td.tiw-metadata-value', undefined, backgroundColor.getContrastRatio(foregroundColor.makeOpaque(backgroundColor)).toFixed(2))\n\t\t\t\t));\n\t\t\t} else {\n\t\t\t\telements.push($('tr', undefined,\n\t\t\t\t\t$('td.tiw-metadata-key', undefined, 'Contrast ratio cannot be precise for background colors that use transparency' as string),\n\t\t\t\t\t$('td.tiw-metadata-value')\n\t\t\t\t));\n\t\t\t}\n\t\t}\n\n\t\tconst fontStyleLabels = new Array<HTMLElement | string>();\n\n\t\tfunction addStyle(key: 'bold' | 'italic' | 'underline') {\n\t\t\tif (semantic && semantic[key]) {\n\t\t\t\tfontStyleLabels.push($('span.tiw-metadata-semantic', undefined, key));\n\t\t\t} else if (tm && tm[key]) {\n\t\t\t\tfontStyleLabels.push(key);\n\t\t\t}\n\t\t}\n\t\taddStyle('bold');\n\t\taddStyle('italic');\n\t\taddStyle('underline');\n\t\tif (fontStyleLabels.length) {\n\t\t\telements.push($('tr', undefined,\n\t\t\t\t$('td.tiw-metadata-key', undefined, 'font style' as string),\n\t\t\t\t$('td.tiw-metadata-value', undefined, fontStyleLabels.join(' '))\n\t\t\t));\n\t\t}\n\t\treturn elements;\n\t}\n\n\tprivate _decodeMetadata(metadata: number): IDecodedMetadata {\n\t\tlet colorMap = this._themeService.getColorTheme().tokenColorMap;\n\t\tlet languageId = TokenMetadata.getLanguageId(metadata);\n\t\tlet tokenType = TokenMetadata.getTokenType(metadata);\n\t\tlet fontStyle = TokenMetadata.getFontStyle(metadata);\n\t\tlet foreground = TokenMetadata.getForeground(metadata);\n\t\tlet background = TokenMetadata.getBackground(metadata);\n\t\treturn {\n\t\t\tlanguageIdentifier: this._modeService.getLanguageIdentifier(languageId)!,\n\t\t\ttokenType: tokenType,\n\t\t\tbold: (fontStyle & FontStyle.Bold) ? true : undefined,\n\t\t\titalic: (fontStyle & FontStyle.Italic) ? true : undefined,\n\t\t\tunderline: (fontStyle & FontStyle.Underline) ? true : undefined,\n\t\t\tforeground: colorMap[foreground],\n\t\t\tbackground: colorMap[background]\n\t\t};\n\t}\n\n\tprivate _tokenTypeToString(tokenType: StandardTokenType): string {\n\t\tswitch (tokenType) {\n\t\t\tcase StandardTokenType.Other: return 'Other';\n\t\t\tcase StandardTokenType.Comment: return 'Comment';\n\t\t\tcase StandardTokenType.String: return 'String';\n\t\t\tcase StandardTokenType.RegEx: return 'RegEx';\n\t\t\tdefault: return '??';\n\t\t}\n\t}\n\n\tprivate _getTokensAtPosition(grammar: IGrammar, position: Position): ITextMateTokenInfo {\n\t\tconst lineNumber = position.lineNumber;\n\t\tlet stateBeforeLine = this._getStateBeforeLine(grammar, lineNumber);\n\n\t\tlet tokenizationResult1 = grammar.tokenizeLine(this._model.getLineContent(lineNumber), stateBeforeLine);\n\t\tlet tokenizationResult2 = grammar.tokenizeLine2(this._model.getLineContent(lineNumber), stateBeforeLine);\n\n\t\tlet token1Index = 0;\n\t\tfor (let i = tokenizationResult1.tokens.length - 1; i >= 0; i--) {\n\t\t\tlet t = tokenizationResult1.tokens[i];\n\t\t\tif (position.column - 1 >= t.startIndex) {\n\t\t\t\ttoken1Index = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet token2Index = 0;\n\t\tfor (let i = (tokenizationResult2.tokens.length >>> 1); i >= 0; i--) {\n\t\t\tif (position.column - 1 >= tokenizationResult2.tokens[(i << 1)]) {\n\t\t\t\ttoken2Index = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttoken: tokenizationResult1.tokens[token1Index],\n\t\t\tmetadata: this._decodeMetadata(tokenizationResult2.tokens[(token2Index << 1) + 1])\n\t\t};\n\t}\n\n\tprivate _getStateBeforeLine(grammar: IGrammar, lineNumber: number): StackElement | null {\n\t\tlet state: StackElement | null = null;\n\n\t\tfor (let i = 1; i < lineNumber; i++) {\n\t\t\tlet tokenizationResult = grammar.tokenizeLine(this._model.getLineContent(i), state);\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\n\t\treturn state;\n\t}\n\n\tprivate isSemanticTokens(token: any): token is SemanticTokens {\n\t\treturn token && token.data;\n\t}\n\n\tprivate async _computeSemanticTokens(position: Position): Promise<SemanticTokensResult | null> {\n\t\tif (!this._isSemanticColoringEnabled()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst tokenProviders = DocumentSemanticTokensProviderRegistry.ordered(this._model);\n\t\tif (tokenProviders.length) {\n\t\t\tconst provider = tokenProviders[0];\n\t\t\tconst tokens = await Promise.resolve(provider.provideDocumentSemanticTokens(this._model, null, this._currentRequestCancellationTokenSource.token));\n\t\t\tif (this.isSemanticTokens(tokens)) {\n\t\t\t\treturn { tokens, legend: provider.getLegend() };\n\t\t\t}\n\t\t}\n\t\tconst rangeTokenProviders = DocumentRangeSemanticTokensProviderRegistry.ordered(this._model);\n\t\tif (rangeTokenProviders.length) {\n\t\t\tconst provider = rangeTokenProviders[0];\n\t\t\tconst lineNumber = position.lineNumber;\n\t\t\tconst range = new Range(lineNumber, 1, lineNumber, this._model.getLineMaxColumn(lineNumber));\n\t\t\tconst tokens = await Promise.resolve(provider.provideDocumentRangeSemanticTokens(this._model, range, this._currentRequestCancellationTokenSource.token));\n\t\t\tif (this.isSemanticTokens(tokens)) {\n\t\t\t\treturn { tokens, legend: provider.getLegend() };\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate _getSemanticTokenAtPosition(semanticTokens: SemanticTokensResult, pos: Position): ISemanticTokenInfo | null {\n\t\tconst tokenData = semanticTokens.tokens.data;\n\t\tconst defaultLanguage = this._model.getLanguageIdentifier().language;\n\t\tlet lastLine = 0;\n\t\tlet lastCharacter = 0;\n\t\tconst posLine = pos.lineNumber - 1, posCharacter = pos.column - 1; // to 0-based position\n\t\tfor (let i = 0; i < tokenData.length; i += 5) {\n\t\t\tconst lineDelta = tokenData[i], charDelta = tokenData[i + 1], len = tokenData[i + 2], typeIdx = tokenData[i + 3], modSet = tokenData[i + 4];\n\t\t\tconst line = lastLine + lineDelta; // 0-based\n\t\t\tconst character = lineDelta === 0 ? lastCharacter + charDelta : charDelta; // 0-based\n\t\t\tif (posLine === line && character <= posCharacter && posCharacter < character + len) {\n\t\t\t\tconst type = semanticTokens.legend.tokenTypes[typeIdx] || 'not in legend (ignored)';\n\t\t\t\tconst modifiers = [];\n\t\t\t\tlet modifierSet = modSet;\n\t\t\t\tfor (let modifierIndex = 0; modifierSet > 0 && modifierIndex < semanticTokens.legend.tokenModifiers.length; modifierIndex++) {\n\t\t\t\t\tif (modifierSet & 1) {\n\t\t\t\t\t\tmodifiers.push(semanticTokens.legend.tokenModifiers[modifierIndex]);\n\t\t\t\t\t}\n\t\t\t\t\tmodifierSet = modifierSet >> 1;\n\t\t\t\t}\n\t\t\t\tif (modifierSet > 0) {\n\t\t\t\t\tmodifiers.push('not in legend (ignored)');\n\t\t\t\t}\n\t\t\t\tconst range = new Range(line + 1, character + 1, line + 1, character + 1 + len);\n\t\t\t\tconst definitions = {};\n\t\t\t\tconst colorMap = this._themeService.getColorTheme().tokenColorMap;\n\t\t\t\tconst theme = this._themeService.getColorTheme() as ColorThemeData;\n\t\t\t\tconst tokenStyle = theme.getTokenStyleMetadata(type, modifiers, defaultLanguage, true, definitions);\n\n\t\t\t\tlet metadata: IDecodedMetadata | undefined = undefined;\n\t\t\t\tif (tokenStyle) {\n\t\t\t\t\tmetadata = {\n\t\t\t\t\t\tlanguageIdentifier: this._modeService.getLanguageIdentifier(LanguageId.Null)!,\n\t\t\t\t\t\ttokenType: StandardTokenType.Other,\n\t\t\t\t\t\tbold: tokenStyle?.bold,\n\t\t\t\t\t\titalic: tokenStyle?.italic,\n\t\t\t\t\t\tunderline: tokenStyle?.underline,\n\t\t\t\t\t\tforeground: colorMap[tokenStyle?.foreground || ColorId.None]\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn { type, modifiers, range, metadata, definitions };\n\t\t\t}\n\t\t\tlastLine = line;\n\t\t\tlastCharacter = character;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate _renderTokenStyleDefinition(definition: TokenStyleDefinition | undefined, property: keyof TokenStyleData): Array<HTMLElement | string> {\n\t\tconst elements = new Array<HTMLElement | string>();\n\t\tif (definition === undefined) {\n\t\t\treturn elements;\n\t\t}\n\t\tconst theme = this._themeService.getColorTheme() as ColorThemeData;\n\n\t\tif (Array.isArray(definition)) {\n\t\t\tconst scopesDefinition: TextMateThemingRuleDefinitions = {};\n\t\t\ttheme.resolveScopes(definition, scopesDefinition);\n\t\t\tconst matchingRule = scopesDefinition[property];\n\t\t\tif (matchingRule && scopesDefinition.scope) {\n\t\t\t\tconst scopes = $('ul.tiw-metadata-values');\n\t\t\t\tconst strScopes = Array.isArray(matchingRule.scope) ? matchingRule.scope : [String(matchingRule.scope)];\n\n\t\t\t\tfor (let strScope of strScopes) {\n\t\t\t\t\tscopes.appendChild($('li.tiw-metadata-value.tiw-metadata-scopes', undefined, strScope));\n\t\t\t\t}\n\n\t\t\t\telements.push(\n\t\t\t\t\tscopesDefinition.scope.join(' '),\n\t\t\t\t\tscopes,\n\t\t\t\t\t$('code.tiw-theme-selector', undefined, JSON.stringify(matchingRule.settings, null, '\\t')));\n\t\t\t\treturn elements;\n\t\t\t}\n\t\t\treturn elements;\n\t\t} else if (SemanticTokenRule.is(definition)) {\n\t\t\tconst scope = theme.getTokenStylingRuleScope(definition);\n\t\t\tif (scope === 'setting') {\n\t\t\t\telements.push(`User settings: ${definition.selector.id} - ${this._renderStyleProperty(definition.style, property)}`);\n\t\t\t\treturn elements;\n\t\t\t} else if (scope === 'theme') {\n\t\t\t\telements.push(`Color theme: ${definition.selector.id} - ${this._renderStyleProperty(definition.style, property)}`);\n\t\t\t\treturn elements;\n\t\t\t}\n\t\t\treturn elements;\n\t\t} else {\n\t\t\tconst style = theme.resolveTokenStyleValue(definition);\n\t\t\telements.push(`Default: ${style ? this._renderStyleProperty(style, property) : ''}`);\n\t\t\treturn elements;\n\t\t}\n\t}\n\n\tprivate _renderStyleProperty(style: TokenStyle, property: keyof TokenStyleData) {\n\t\tswitch (property) {\n\t\t\tcase 'foreground': return style.foreground ? Color.Format.CSS.formatHexA(style.foreground, true) : '';\n\t\t\tdefault: return style[property] !== undefined ? String(style[property]) : '';\n\t\t}\n\t}\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tpublic getPosition(): IContentWidgetPosition {\n\t\treturn {\n\t\t\tposition: this._editor.getPosition(),\n\t\t\tpreference: [ContentWidgetPositionPreference.BELOW, ContentWidgetPositionPreference.ABOVE]\n\t\t};\n\t}\n}\n\nregisterEditorContribution(InspectEditorTokensController.ID, InspectEditorTokensController);\nregisterEditorAction(InspectEditorTokens);\n\nregisterThemingParticipant((theme, collector) => {\n\tconst border = theme.getColor(editorHoverBorder);\n\tif (border) {\n\t\tlet borderWidth = theme.type === ColorScheme.HIGH_CONTRAST ? 2 : 1;\n\t\tcollector.addRule(`.monaco-editor .token-inspect-widget { border: ${borderWidth}px solid ${border}; }`);\n\t\tcollector.addRule(`.monaco-editor .token-inspect-widget .tiw-metadata-separator { background-color: ${border}; }`);\n\t}\n\tconst background = theme.getColor(editorHoverBackground);\n\tif (background) {\n\t\tcollector.addRule(`.monaco-editor .token-inspect-widget { background-color: ${background}; }`);\n\t}\n});\n"]}