{"version":3,"sources":["vs/workbench/contrib/codeEditor/browser/diffEditorHelper.ts"],"names":[],"mappings":"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","file":"diffEditorHelper.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { IDiffEditor } from 'vs/editor/browser/editorBrowser';\nimport { registerDiffEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { IDiffEditorContribution } from 'vs/editor/common/editorCommon';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { FloatingClickWidget } from 'vs/workbench/browser/codeeditor';\nimport { IDiffComputationResult } from 'vs/editor/common/services/editorWorkerService';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { INotificationService, Severity } from 'vs/platform/notification/common/notification';\n\nconst enum WidgetState {\n\tHidden,\n\tHintWhitespace\n}\n\nclass DiffEditorHelperContribution extends Disposable implements IDiffEditorContribution {\n\n\tpublic static ID = 'editor.contrib.diffEditorHelper';\n\n\tprivate _helperWidget: FloatingClickWidget | null;\n\tprivate _helperWidgetListener: IDisposable | null;\n\tprivate _state: WidgetState;\n\n\tconstructor(\n\t\tprivate readonly _diffEditor: IDiffEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t) {\n\t\tsuper();\n\t\tthis._helperWidget = null;\n\t\tthis._helperWidgetListener = null;\n\t\tthis._state = WidgetState.Hidden;\n\n\n\t\tthis._register(this._diffEditor.onDidUpdateDiff(() => {\n\t\t\tconst diffComputationResult = this._diffEditor.getDiffComputationResult();\n\t\t\tthis._setState(this._deduceState(diffComputationResult));\n\n\t\t\tif (diffComputationResult && diffComputationResult.quitEarly) {\n\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\tSeverity.Warning,\n\t\t\t\t\tnls.localize('hintTimeout', \"The diff algorithm was stopped early (after {0} ms.)\", this._diffEditor.maxComputationTime),\n\t\t\t\t\t[{\n\t\t\t\t\t\tlabel: nls.localize('removeTimeout', \"Remove Limit\"),\n\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\tthis._configurationService.updateValue('diffEditor.maxComputationTime', 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}],\n\t\t\t\t\t{}\n\t\t\t\t);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _deduceState(diffComputationResult: IDiffComputationResult | null): WidgetState {\n\t\tif (!diffComputationResult) {\n\t\t\treturn WidgetState.Hidden;\n\t\t}\n\t\tif (this._diffEditor.ignoreTrimWhitespace && diffComputationResult.changes.length === 0 && !diffComputationResult.identical) {\n\t\t\treturn WidgetState.HintWhitespace;\n\t\t}\n\t\treturn WidgetState.Hidden;\n\t}\n\n\tprivate _setState(newState: WidgetState) {\n\t\tif (this._state === newState) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._state = newState;\n\n\t\tif (this._helperWidgetListener) {\n\t\t\tthis._helperWidgetListener.dispose();\n\t\t\tthis._helperWidgetListener = null;\n\t\t}\n\t\tif (this._helperWidget) {\n\t\t\tthis._helperWidget.dispose();\n\t\t\tthis._helperWidget = null;\n\t\t}\n\n\t\tif (this._state === WidgetState.HintWhitespace) {\n\t\t\tthis._helperWidget = this._instantiationService.createInstance(FloatingClickWidget, this._diffEditor.getModifiedEditor(), nls.localize('hintWhitespace', \"Show Whitespace Differences\"), null);\n\t\t\tthis._helperWidgetListener = this._helperWidget.onClick(() => this._onDidClickHelperWidget());\n\t\t\tthis._helperWidget.render();\n\t\t}\n\t}\n\n\tprivate _onDidClickHelperWidget(): void {\n\t\tif (this._state === WidgetState.HintWhitespace) {\n\t\t\tthis._configurationService.updateValue('diffEditor.ignoreTrimWhitespace', false);\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t}\n}\n\nregisterDiffEditorContribution(DiffEditorHelperContribution.ID, DiffEditorHelperContribution);\n"]}