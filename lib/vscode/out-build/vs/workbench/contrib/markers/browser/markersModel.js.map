{"version":3,"file":"markersModel.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/markers/browser/markersModel.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IAehG,SAAgB,mBAAmB,CAAC,CAAU,EAAE,CAAU;QACzD,OAAO,kBAAM,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC;IAC/C,CAAC;IAFD,kDAEC;IAED,SAAS,sBAAsB,CAAC,CAAkB,EAAE,CAAkB;QACrE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC;QACjC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC;QACjC,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,IAAI,cAAc,IAAI,cAAc,EAAE;YACrC,GAAG,GAAG,wBAAc,CAAC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,EAAE,cAAc,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;SAC7F;QACD,IAAI,GAAG,KAAK,CAAC,EAAE;YACd,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;SACnE;QACD,OAAO,GAAG,CAAC;IACZ,CAAC;IAGD,MAAa,eAAe;QAU3B,YAAqB,EAAU,EAAW,QAAa;YAAlC,OAAE,GAAF,EAAE,CAAQ;YAAW,aAAQ,GAAR,QAAQ,CAAK;YAJ/C,gBAAW,GAAG,IAAI,iBAAW,EAAY,CAAC;YAE1C,WAAM,GAAW,CAAC,CAAC;YAG1B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;YACjC,IAAI,CAAC,IAAI,GAAG,CAAA,GAAA,oBAAQ,CAAA,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACrC,CAAC;QAED,IAAI,OAAO;YACV,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBACzB,IAAI,CAAC,cAAc,GAAG,CAAA,GAAA,gBAAO,CAAA,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;aACpG;YACD,OAAO,IAAI,CAAC,cAAc,CAAC;QAC5B,CAAC;QAED,GAAG,CAAC,GAAQ;YACX,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAClC,CAAC;QAED,GAAG,CAAC,GAAQ,EAAE,MAAgB;YAC7B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACjB,IAAI,CAAA,GAAA,wBAAe,CAAA,CAAC,MAAM,CAAC,EAAE;gBAC5B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;gBAClC,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC;gBAC7B,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;aAChC;QACF,CAAC;QAED,MAAM,CAAC,GAAQ;YACd,IAAI,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACtC,IAAI,KAAK,EAAE;gBACV,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC;gBAC5B,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;gBAChC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;aAC7B;QACF,CAAC;QAED,IAAI,KAAK;YACR,OAAO,IAAI,CAAC,MAAM,CAAC;QACpB,CAAC;QAEO,MAAM,CAAC,eAAe,CAAC,CAAS,EAAE,CAAS;YAClD,OAAO,wBAAc,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC;mBAC/D,kBAAM,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC;mBACtC,aAAK,CAAC,wBAAwB,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;QACxD,CAAC;KACD;IArDD,0CAqDC;IAED,MAAa,MAAM;QAalB,YACU,EAAU,EACV,MAAe,EACf,qBAA2C,EAAE;YAF7C,OAAE,GAAF,EAAE,CAAQ;YACV,WAAM,GAAN,MAAM,CAAS;YACf,uBAAkB,GAAlB,kBAAkB,CAA2B;QACnD,CAAC;QAfL,IAAI,QAAQ,KAAU,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;QACpD,IAAI,KAAK,KAAa,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;QAG3C,IAAI,KAAK;YACR,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBACjB,IAAI,CAAC,MAAM,GAAG,CAAA,GAAA,oBAAU,CAAA,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;aAC9C;YACD,OAAO,IAAI,CAAC,MAAM,CAAC;QACpB,CAAC;QAQD,QAAQ;YACP,OAAO,IAAI,CAAC,SAAS,iCACjB,IAAI,CAAC,MAAM,KACd,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EACnC,kBAAkB,EAAE,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,iCAAM,CAAC,CAAC,GAAG,KAAE,QAAQ,EAAE,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,IAAG,CAAC,CAAC,CAAC,CAAC,SAAS,KAC9I,IAAI,EAAE,IAAI,CAAC,CAAC;QAChB,CAAC;KACD;IA1BD,wBA0BC;IAED,MAAa,kBAAkB;QAE9B,YACU,EAAU,EACV,MAAe,EACf,GAAwB;YAFxB,OAAE,GAAF,EAAE,CAAQ;YACV,WAAM,GAAN,MAAM,CAAS;YACf,QAAG,GAAH,GAAG,CAAqB;QAC9B,CAAC;KACL;IAPD,gDAOC;IAQD,MAAa,YAAY;QAgBxB;YAdQ,0BAAqB,GAAkC,SAAS,CAAC;YAExD,iBAAY,GAAG,IAAI,eAAO,EAAsB,CAAC;YACzD,gBAAW,GAA8B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;YAyBlE,WAAM,GAAW,CAAC,CAAC;YAb1B,IAAI,CAAC,cAAc,GAAG,IAAI,GAAG,EAA2B,CAAC;QAC1D,CAAC;QAXD,IAAI,eAAe;YAClB,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE;gBAChC,IAAI,CAAC,qBAAqB,GAAG,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;aAC5F;YACD,OAAO,IAAI,CAAC,qBAAqB,CAAC;QACnC,CAAC;QAQD,KAAK;YACJ,MAAM,OAAO,GAAG,IAAI,GAAG,EAAmB,CAAC;YAC3C,KAAK,MAAM,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,EAAE;gBAC1D,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;aAC5B;YACD,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;YAC5B,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YAChB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,GAAG,EAAmB,EAAE,OAAO,EAAE,IAAI,GAAG,EAAmB,EAAE,CAAC,CAAC;QAC7G,CAAC;QAGD,IAAI,KAAK;YACR,OAAO,IAAI,CAAC,MAAM,CAAC;QACpB,CAAC;QAED,kBAAkB,CAAC,QAAa;YAC/B,OAAO,CAAA,GAAA,2BAAmB,CAAA,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,kBAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QAC9F,CAAC;QAED,kBAAkB,CAAC,gBAAoC;YACtD,MAAM,MAAM,GAAuB,EAAE,KAAK,EAAE,IAAI,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,GAAG,EAAE,EAAE,CAAC;YAChG,KAAK,MAAM,CAAC,QAAQ,EAAE,UAAU,CAAC,IAAI,gBAAgB,EAAE;gBAEtD,MAAM,GAAG,GAAG,kBAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;gBACpD,IAAI,eAAe,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBAEnD,IAAI,CAAA,GAAA,wBAAe,CAAA,CAAC,UAAU,CAAC,EAAE;oBAChC,cAAc;oBACd,IAAI,CAAC,eAAe,EAAE;wBACrB,MAAM,iBAAiB,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC;wBACvD,eAAe,GAAG,IAAI,eAAe,CAAC,iBAAiB,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;wBAC5F,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,EAAE,eAAe,CAAC,CAAC;wBAC9C,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;qBAClC;yBAAM;wBACN,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;qBACpC;oBACD,MAAM,iBAAiB,GAAG,IAAI,GAAG,EAAkB,CAAC;oBACpD,MAAM,OAAO,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE;wBAC5C,MAAM,GAAG,GAAG,qBAAW,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;wBAC3C,MAAM,KAAK,GAAG,iBAAiB,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;wBAC9C,iBAAiB,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;wBAEtC,MAAM,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAC,eAAgB,CAAC,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC;wBAEzF,IAAI,kBAAkB,GAAqC,SAAS,CAAC;wBACrE,IAAI,SAAS,CAAC,kBAAkB,EAAE;4BACjC,kBAAkB,GAAG,SAAS,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,CAAC,IAAI,kBAAkB,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,aAAa,EAAE,CAAC,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;yBAC3N;wBAED,OAAO,IAAI,MAAM,CAAC,QAAQ,EAAE,SAAS,EAAE,kBAAkB,CAAC,CAAC;oBAC5D,CAAC,CAAC,CAAC;oBAEH,IAAI,CAAC,MAAM,IAAI,eAAe,CAAC,KAAK,CAAC;oBACrC,eAAe,CAAC,GAAG,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;oBACvC,IAAI,CAAC,MAAM,IAAI,eAAe,CAAC,KAAK,CAAC;iBAErC;qBAAM,IAAI,eAAe,EAAE;oBAC3B,QAAQ;oBACR,IAAI,CAAC,MAAM,IAAI,eAAe,CAAC,KAAK,CAAC;oBACrC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;oBACjC,IAAI,CAAC,MAAM,IAAI,eAAe,CAAC,KAAK,CAAC;oBACrC,IAAI,eAAe,CAAC,KAAK,KAAK,CAAC,EAAE;wBAChC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;wBAChC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;qBACpC;yBAAM;wBACN,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;qBACpC;iBACD;aACD;YAED,IAAI,CAAC,qBAAqB,GAAG,SAAS,CAAC;YACvC,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE;gBACpE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aAC/B;QACF,CAAC;QAEO,EAAE,CAAC,GAAG,MAA2B;YACxC,MAAM,MAAM,GAAG,IAAI,aAAM,EAAE,CAAC;YAC5B,KAAK,MAAM,KAAK,IAAI,MAAM,EAAE;gBAC3B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACnB;YACD,OAAO,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;QAC1B,CAAC;QAED,OAAO;YACN,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;YAC5B,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;QAC7B,CAAC;KACD;IA5GD,oCA4GC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { basename, extUri } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { Range, IRange } from 'vs/editor/common/core/range';\nimport { IMarker, MarkerSeverity, IRelatedInformation, IMarkerData } from 'vs/platform/markers/common/markers';\nimport { isNonEmptyArray, flatten } from 'vs/base/common/arrays';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Hasher } from 'vs/base/common/hash';\nimport { withUndefinedAsNull } from 'vs/base/common/types';\nimport { splitLines } from 'vs/base/common/strings';\n\nexport type MarkerElement = ResourceMarkers | Marker | RelatedInformation;\n\nexport function compareMarkersByUri(a: IMarker, b: IMarker) {\n\treturn extUri.compare(a.resource, b.resource);\n}\n\nfunction compareResourceMarkers(a: ResourceMarkers, b: ResourceMarkers): number {\n\tlet [firstMarkerOfA] = a.markers;\n\tlet [firstMarkerOfB] = b.markers;\n\tlet res = 0;\n\tif (firstMarkerOfA && firstMarkerOfB) {\n\t\tres = MarkerSeverity.compare(firstMarkerOfA.marker.severity, firstMarkerOfB.marker.severity);\n\t}\n\tif (res === 0) {\n\t\tres = a.path.localeCompare(b.path) || a.name.localeCompare(b.name);\n\t}\n\treturn res;\n}\n\n\nexport class ResourceMarkers {\n\n\treadonly path: string;\n\n\treadonly name: string;\n\n\tprivate _markersMap = new ResourceMap<Marker[]>();\n\tprivate _cachedMarkers: Marker[] | undefined;\n\tprivate _total: number = 0;\n\n\tconstructor(readonly id: string, readonly resource: URI) {\n\t\tthis.path = this.resource.fsPath;\n\t\tthis.name = basename(this.resource);\n\t}\n\n\tget markers(): readonly Marker[] {\n\t\tif (!this._cachedMarkers) {\n\t\t\tthis._cachedMarkers = flatten([...this._markersMap.values()]).sort(ResourceMarkers._compareMarkers);\n\t\t}\n\t\treturn this._cachedMarkers;\n\t}\n\n\thas(uri: URI) {\n\t\treturn this._markersMap.has(uri);\n\t}\n\n\tset(uri: URI, marker: Marker[]) {\n\t\tthis.delete(uri);\n\t\tif (isNonEmptyArray(marker)) {\n\t\t\tthis._markersMap.set(uri, marker);\n\t\t\tthis._total += marker.length;\n\t\t\tthis._cachedMarkers = undefined;\n\t\t}\n\t}\n\n\tdelete(uri: URI) {\n\t\tlet array = this._markersMap.get(uri);\n\t\tif (array) {\n\t\t\tthis._total -= array.length;\n\t\t\tthis._cachedMarkers = undefined;\n\t\t\tthis._markersMap.delete(uri);\n\t\t}\n\t}\n\n\tget total() {\n\t\treturn this._total;\n\t}\n\n\tprivate static _compareMarkers(a: Marker, b: Marker): number {\n\t\treturn MarkerSeverity.compare(a.marker.severity, b.marker.severity)\n\t\t\t|| extUri.compare(a.resource, b.resource)\n\t\t\t|| Range.compareRangesUsingStarts(a.marker, b.marker);\n\t}\n}\n\nexport class Marker {\n\n\tget resource(): URI { return this.marker.resource; }\n\tget range(): IRange { return this.marker; }\n\n\tprivate _lines: string[] | undefined;\n\tget lines(): string[] {\n\t\tif (!this._lines) {\n\t\t\tthis._lines = splitLines(this.marker.message);\n\t\t}\n\t\treturn this._lines;\n\t}\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly marker: IMarker,\n\t\treadonly relatedInformation: RelatedInformation[] = []\n\t) { }\n\n\ttoString(): string {\n\t\treturn JSON.stringify({\n\t\t\t...this.marker,\n\t\t\tresource: this.marker.resource.path,\n\t\t\trelatedInformation: this.relatedInformation.length ? this.relatedInformation.map(r => ({ ...r.raw, resource: r.raw.resource.path })) : undefined\n\t\t}, null, '\\t');\n\t}\n}\n\nexport class RelatedInformation {\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly marker: IMarker,\n\t\treadonly raw: IRelatedInformation\n\t) { }\n}\n\nexport interface MarkerChangesEvent {\n\treadonly added: Set<ResourceMarkers>;\n\treadonly removed: Set<ResourceMarkers>;\n\treadonly updated: Set<ResourceMarkers>;\n}\n\nexport class MarkersModel {\n\n\tprivate cachedSortedResources: ResourceMarkers[] | undefined = undefined;\n\n\tprivate readonly _onDidChange = new Emitter<MarkerChangesEvent>();\n\treadonly onDidChange: Event<MarkerChangesEvent> = this._onDidChange.event;\n\n\tget resourceMarkers(): ResourceMarkers[] {\n\t\tif (!this.cachedSortedResources) {\n\t\t\tthis.cachedSortedResources = [...this.resourcesByUri.values()].sort(compareResourceMarkers);\n\t\t}\n\t\treturn this.cachedSortedResources;\n\t}\n\n\tprivate resourcesByUri: Map<string, ResourceMarkers>;\n\n\tconstructor() {\n\t\tthis.resourcesByUri = new Map<string, ResourceMarkers>();\n\t}\n\n\treset(): void {\n\t\tconst removed = new Set<ResourceMarkers>();\n\t\tfor (const resourceMarker of this.resourcesByUri.values()) {\n\t\t\tremoved.add(resourceMarker);\n\t\t}\n\t\tthis.resourcesByUri.clear();\n\t\tthis._total = 0;\n\t\tthis._onDidChange.fire({ removed, added: new Set<ResourceMarkers>(), updated: new Set<ResourceMarkers>() });\n\t}\n\n\tprivate _total: number = 0;\n\tget total(): number {\n\t\treturn this._total;\n\t}\n\n\tgetResourceMarkers(resource: URI): ResourceMarkers | null {\n\t\treturn withUndefinedAsNull(this.resourcesByUri.get(extUri.getComparisonKey(resource, true)));\n\t}\n\n\tsetResourceMarkers(resourcesMarkers: [URI, IMarker[]][]): void {\n\t\tconst change: MarkerChangesEvent = { added: new Set(), removed: new Set(), updated: new Set() };\n\t\tfor (const [resource, rawMarkers] of resourcesMarkers) {\n\n\t\t\tconst key = extUri.getComparisonKey(resource, true);\n\t\t\tlet resourceMarkers = this.resourcesByUri.get(key);\n\n\t\t\tif (isNonEmptyArray(rawMarkers)) {\n\t\t\t\t// update, add\n\t\t\t\tif (!resourceMarkers) {\n\t\t\t\t\tconst resourceMarkersId = this.id(resource.toString());\n\t\t\t\t\tresourceMarkers = new ResourceMarkers(resourceMarkersId, resource.with({ fragment: null }));\n\t\t\t\t\tthis.resourcesByUri.set(key, resourceMarkers);\n\t\t\t\t\tchange.added.add(resourceMarkers);\n\t\t\t\t} else {\n\t\t\t\t\tchange.updated.add(resourceMarkers);\n\t\t\t\t}\n\t\t\t\tconst markersCountByKey = new Map<string, number>();\n\t\t\t\tconst markers = rawMarkers.map((rawMarker) => {\n\t\t\t\t\tconst key = IMarkerData.makeKey(rawMarker);\n\t\t\t\t\tconst index = markersCountByKey.get(key) || 0;\n\t\t\t\t\tmarkersCountByKey.set(key, index + 1);\n\n\t\t\t\t\tconst markerId = this.id(resourceMarkers!.id, key, index, rawMarker.resource.toString());\n\n\t\t\t\t\tlet relatedInformation: RelatedInformation[] | undefined = undefined;\n\t\t\t\t\tif (rawMarker.relatedInformation) {\n\t\t\t\t\t\trelatedInformation = rawMarker.relatedInformation.map((r, index) => new RelatedInformation(this.id(markerId, r.resource.toString(), r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn, index), rawMarker, r));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Marker(markerId, rawMarker, relatedInformation);\n\t\t\t\t});\n\n\t\t\t\tthis._total -= resourceMarkers.total;\n\t\t\t\tresourceMarkers.set(resource, markers);\n\t\t\t\tthis._total += resourceMarkers.total;\n\n\t\t\t} else if (resourceMarkers) {\n\t\t\t\t// clear\n\t\t\t\tthis._total -= resourceMarkers.total;\n\t\t\t\tresourceMarkers.delete(resource);\n\t\t\t\tthis._total += resourceMarkers.total;\n\t\t\t\tif (resourceMarkers.total === 0) {\n\t\t\t\t\tthis.resourcesByUri.delete(key);\n\t\t\t\t\tchange.removed.add(resourceMarkers);\n\t\t\t\t} else {\n\t\t\t\t\tchange.updated.add(resourceMarkers);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.cachedSortedResources = undefined;\n\t\tif (change.added.size || change.removed.size || change.updated.size) {\n\t\t\tthis._onDidChange.fire(change);\n\t\t}\n\t}\n\n\tprivate id(...values: (string | number)[]): string {\n\t\tconst hasher = new Hasher();\n\t\tfor (const value of values) {\n\t\t\thasher.hash(value);\n\t\t}\n\t\treturn `${hasher.value}`;\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t\tthis.resourcesByUri.clear();\n\t}\n}\n"]}