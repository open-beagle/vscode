{"version":3,"file":"webviewEditorInputSerializer.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/webviewPanel/browser/webviewEditorInputSerializer.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IEditorInputSerializer } from 'vs/workbench/common/editor';\nimport { WebviewContentOptions, WebviewExtensionDescription, WebviewOptions } from 'vs/workbench/contrib/webview/browser/webview';\nimport { WebviewIcons } from 'vs/workbench/contrib/webviewPanel/browser/webviewIconManager';\nimport { WebviewInput } from './webviewEditorInput';\nimport { IWebviewWorkbenchService } from './webviewWorkbenchService';\n\nexport type SerializedWebviewOptions = WebviewOptions & WebviewContentOptions;\n\ninterface SerializedIconPath {\n\tlight: string | UriComponents;\n\tdark: string | UriComponents;\n}\n\nexport interface SerializedWebview {\n\treadonly id: string;\n\treadonly viewType: string;\n\treadonly title: string;\n\treadonly options: SerializedWebviewOptions;\n\treadonly extensionLocation: UriComponents | undefined;\n\treadonly extensionId: string | undefined;\n\treadonly state: any;\n\treadonly iconPath: SerializedIconPath | undefined;\n\treadonly group?: number;\n}\n\nexport interface DeserializedWebview {\n\treadonly id: string;\n\treadonly viewType: string;\n\treadonly title: string;\n\treadonly webviewOptions: WebviewOptions;\n\treadonly contentOptions: WebviewContentOptions;\n\treadonly extension: WebviewExtensionDescription | undefined;\n\treadonly state: any;\n\treadonly iconPath: WebviewIcons | undefined;\n\treadonly group?: number;\n}\n\nexport class WebviewEditorInputSerializer implements IEditorInputSerializer {\n\n\tpublic static readonly ID = WebviewInput.typeId;\n\n\tpublic constructor(\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService\n\t) { }\n\n\tpublic canSerialize(input: WebviewInput): boolean {\n\t\treturn this._webviewWorkbenchService.shouldPersist(input);\n\t}\n\n\tpublic serialize(input: WebviewInput): string | undefined {\n\t\tif (!this._webviewWorkbenchService.shouldPersist(input)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst data = this.toJson(input);\n\t\ttry {\n\t\t\treturn JSON.stringify(data);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic deserialize(\n\t\t_instantiationService: IInstantiationService,\n\t\tserializedEditorInput: string\n\t): WebviewInput {\n\t\tconst data = this.fromJson(JSON.parse(serializedEditorInput));\n\t\treturn this._webviewWorkbenchService.reviveWebview({\n\t\t\tid: data.id,\n\t\t\tviewType: data.viewType,\n\t\t\ttitle: data.title,\n\t\t\ticonPath: data.iconPath,\n\t\t\tstate: data.state,\n\t\t\twebviewOptions: data.webviewOptions,\n\t\t\tcontentOptions: data.contentOptions,\n\t\t\textension: data.extension,\n\t\t\tgroup: data.group\n\t\t});\n\t}\n\n\tprotected fromJson(data: SerializedWebview): DeserializedWebview {\n\t\treturn {\n\t\t\t...data,\n\t\t\textension: reviveWebviewExtensionDescription(data.extensionId, data.extensionLocation),\n\t\t\ticonPath: reviveIconPath(data.iconPath),\n\t\t\tstate: reviveState(data.state),\n\t\t\twebviewOptions: restoreWebviewOptions(data.options),\n\t\t\tcontentOptions: restoreWebviewContentOptions(data.options),\n\t\t};\n\t}\n\n\tprotected toJson(input: WebviewInput): SerializedWebview {\n\t\treturn {\n\t\t\tid: input.id,\n\t\t\tviewType: input.viewType,\n\t\t\ttitle: input.getName(),\n\t\t\toptions: { ...input.webview.options, ...input.webview.contentOptions },\n\t\t\textensionLocation: input.extension ? input.extension.location : undefined,\n\t\t\textensionId: input.extension && input.extension.id ? input.extension.id.value : undefined,\n\t\t\tstate: input.webview.state,\n\t\t\ticonPath: input.iconPath ? { light: input.iconPath.light, dark: input.iconPath.dark, } : undefined,\n\t\t\tgroup: input.group\n\t\t};\n\t}\n}\n\nexport function reviveWebviewExtensionDescription(\n\textensionId: string | undefined,\n\textensionLocation: UriComponents | undefined,\n): WebviewExtensionDescription | undefined {\n\tif (!extensionId) {\n\t\treturn undefined;\n\t}\n\n\tconst location = reviveUri(extensionLocation);\n\tif (!location) {\n\t\treturn undefined;\n\t}\n\n\treturn {\n\t\tid: new ExtensionIdentifier(extensionId),\n\t\tlocation,\n\t};\n}\n\nfunction reviveIconPath(data: SerializedIconPath | undefined) {\n\tif (!data) {\n\t\treturn undefined;\n\t}\n\n\tconst light = reviveUri(data.light);\n\tconst dark = reviveUri(data.dark);\n\treturn light && dark ? { light, dark } : undefined;\n}\n\nfunction reviveUri(data: string | UriComponents): URI;\nfunction reviveUri(data: string | UriComponents | undefined): URI | undefined;\nfunction reviveUri(data: string | UriComponents | undefined): URI | undefined {\n\tif (!data) {\n\t\treturn undefined;\n\t}\n\n\ttry {\n\t\tif (typeof data === 'string') {\n\t\t\treturn URI.parse(data);\n\t\t}\n\t\treturn URI.from(data);\n\t} catch {\n\t\treturn undefined;\n\t}\n}\n\nfunction reviveState(state: unknown | undefined): undefined | string {\n\treturn typeof state === 'string' ? state : undefined;\n}\n\nexport function restoreWebviewOptions(options: SerializedWebviewOptions): WebviewOptions {\n\treturn options;\n}\n\nexport function restoreWebviewContentOptions(options: SerializedWebviewOptions): WebviewContentOptions {\n\treturn {\n\t\t...options,\n\t\tlocalResourceRoots: options.localResourceRoots?.map(uri => reviveUri(uri)),\n\t};\n}\n"]}