{"version":3,"sources":["vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts"],"names":[],"mappings":"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","file":"scmRepositoriesViewPane.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/scm';\nimport { localize } from 'vs/nls';\nimport { ViewPane, IViewPaneOptions } from 'vs/workbench/browser/parts/views/viewPane';\nimport { append, $ } from 'vs/base/browser/dom';\nimport { IListVirtualDelegate, IListContextMenuEvent, IListEvent } from 'vs/base/browser/ui/list/list';\nimport { ISCMRepository, ISCMService, ISCMViewService } from 'vs/workbench/contrib/scm/common/scm';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { WorkbenchList } from 'vs/platform/list/browser/listService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IViewDescriptorService } from 'vs/workbench/common/views';\nimport { SIDE_BAR_BACKGROUND } from 'vs/workbench/common/theme';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { RepositoryRenderer } from 'vs/workbench/contrib/scm/browser/scmRepositoryRenderer';\nimport { collectContextMenuActions, getActionViewItemProvider } from 'vs/workbench/contrib/scm/browser/util';\nimport { Orientation } from 'vs/base/browser/ui/sash/sash';\n\nclass ListDelegate implements IListVirtualDelegate<ISCMRepository> {\n\n\tgetHeight(): number {\n\t\treturn 22;\n\t}\n\n\tgetTemplateId(): string {\n\t\treturn RepositoryRenderer.TEMPLATE_ID;\n\t}\n}\n\nexport class SCMRepositoriesViewPane extends ViewPane {\n\n\tprivate list!: WorkbenchList<ISCMRepository>;\n\n\tconstructor(\n\t\toptions: IViewPaneOptions,\n\t\t@ISCMService protected scmService: ISCMService,\n\t\t@ISCMViewService protected scmViewService: ISCMViewService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ITelemetryService telemetryService: ITelemetryService\n\t) {\n\t\tsuper(options, keybindingService, contextMenuService, configurationService, contextKeyService, viewDescriptorService, instantiationService, openerService, themeService, telemetryService);\n\t}\n\n\tprotected override renderBody(container: HTMLElement): void {\n\t\tsuper.renderBody(container);\n\n\t\tconst listContainer = append(container, $('.scm-view.scm-repositories-view'));\n\n\t\tconst delegate = new ListDelegate();\n\t\tconst renderer = this.instantiationService.createInstance(RepositoryRenderer, getActionViewItemProvider(this.instantiationService));\n\t\tconst identityProvider = { getId: (r: ISCMRepository) => r.provider.id };\n\n\t\tthis.list = this.instantiationService.createInstance(WorkbenchList, `SCM Main`, listContainer, delegate, [renderer], {\n\t\t\tidentityProvider,\n\t\t\thorizontalScrolling: false,\n\t\t\toverrideStyles: {\n\t\t\t\tlistBackground: SIDE_BAR_BACKGROUND\n\t\t\t},\n\t\t\taccessibilityProvider: {\n\t\t\t\tgetAriaLabel(r: ISCMRepository) {\n\t\t\t\t\treturn r.provider.label;\n\t\t\t\t},\n\t\t\t\tgetWidgetAriaLabel() {\n\t\t\t\t\treturn localize('scm', \"Source Control Repositories\");\n\t\t\t\t}\n\t\t\t}\n\t\t}) as WorkbenchList<ISCMRepository>;\n\n\t\tthis._register(this.list);\n\t\tthis._register(this.list.onDidChangeSelection(this.onListSelectionChange, this));\n\t\tthis._register(this.list.onContextMenu(this.onListContextMenu, this));\n\n\t\tthis._register(this.scmViewService.onDidChangeVisibleRepositories(this.updateListSelection, this));\n\n\t\tthis._register(this.scmService.onDidAddRepository(this.onDidAddRepository, this));\n\t\tthis._register(this.scmService.onDidRemoveRepository(this.onDidRemoveRepository, this));\n\n\t\tfor (const repository of this.scmService.repositories) {\n\t\t\tthis.onDidAddRepository(repository);\n\t\t}\n\n\t\tif (this.orientation === Orientation.VERTICAL) {\n\t\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\t\tif (e.affectsConfiguration('scm.repositories.visible')) {\n\t\t\t\t\tthis.updateBodySize();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tthis.updateListSelection();\n\t}\n\n\tprivate onDidAddRepository(repository: ISCMRepository): void {\n\t\tthis.list.splice(this.list.length, 0, [repository]);\n\t\tthis.updateBodySize();\n\t}\n\n\tprivate onDidRemoveRepository(repository: ISCMRepository): void {\n\t\tconst index = this.list.indexOf(repository);\n\n\t\tif (index > -1) {\n\t\t\tthis.list.splice(index, 1);\n\t\t}\n\n\t\tthis.updateBodySize();\n\t}\n\n\toverride focus(): void {\n\t\tthis.list.domFocus();\n\t}\n\n\tprotected override layoutBody(height: number, width: number): void {\n\t\tsuper.layoutBody(height, width);\n\t\tthis.list.layout(height, width);\n\t}\n\n\tprivate updateBodySize(): void {\n\t\tif (this.orientation === Orientation.HORIZONTAL) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleCount = this.configurationService.getValue<number>('scm.repositories.visible');\n\t\tconst empty = this.list.length === 0;\n\t\tconst size = Math.min(this.list.length, visibleCount) * 22;\n\n\t\tthis.minimumBodySize = visibleCount === 0 ? 22 : size;\n\t\tthis.maximumBodySize = visibleCount === 0 ? Number.POSITIVE_INFINITY : empty ? Number.POSITIVE_INFINITY : size;\n\t}\n\n\tprivate onListContextMenu(e: IListContextMenuEvent<ISCMRepository>): void {\n\t\tif (!e.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = e.element.provider;\n\t\tconst menus = this.scmViewService.menus.getRepositoryMenus(provider);\n\t\tconst menu = menus.repositoryMenu;\n\t\tconst [actions, disposable] = collectContextMenuActions(menu);\n\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => e.anchor,\n\t\t\tgetActions: () => actions,\n\t\t\tgetActionsContext: () => provider,\n\t\t\tonHide() {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate onListSelectionChange(e: IListEvent<ISCMRepository>): void {\n\t\tif (e.browserEvent && e.elements.length > 0) {\n\t\t\tconst scrollTop = this.list.scrollTop;\n\t\t\tthis.scmViewService.visibleRepositories = e.elements;\n\t\t\tthis.list.scrollTop = scrollTop;\n\t\t}\n\t}\n\n\tprivate updateListSelection(): void {\n\t\tconst set = new Set();\n\n\t\tfor (const repository of this.scmViewService.visibleRepositories) {\n\t\t\tset.add(repository);\n\t\t}\n\n\t\tconst selection: number[] = [];\n\n\t\tfor (let i = 0; i < this.list.length; i++) {\n\t\t\tif (set.has(this.list.element(i))) {\n\t\t\t\tselection.push(i);\n\t\t\t}\n\t\t}\n\n\t\tthis.list.setSelection(selection);\n\n\t\tif (selection.length > 0) {\n\t\t\tthis.list.setFocus([selection[0]]);\n\t\t}\n\t}\n}\n"]}