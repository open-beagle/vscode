{"version":3,"file":"menus.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/scm/browser/menus.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/scm';\nimport { Emitter } from 'vs/base/common/event';\nimport { IDisposable, Disposable, DisposableStore, dispose } from 'vs/base/common/lifecycle';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IMenuService, MenuId, IMenu } from 'vs/platform/actions/common/actions';\nimport { IAction } from 'vs/base/common/actions';\nimport { createAndFillInActionBarActions } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { ISCMResource, ISCMResourceGroup, ISCMProvider, ISCMRepository, ISCMService, ISCMMenus, ISCMRepositoryMenus } from 'vs/workbench/contrib/scm/common/scm';\nimport { equals } from 'vs/base/common/arrays';\nimport { ISplice } from 'vs/base/common/sequence';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\n\nfunction actionEquals(a: IAction, b: IAction): boolean {\n\treturn a.id === b.id;\n}\n\nexport class SCMTitleMenu implements IDisposable {\n\n\tprivate _actions: IAction[] = [];\n\tget actions(): IAction[] { return this._actions; }\n\n\tprivate _secondaryActions: IAction[] = [];\n\tget secondaryActions(): IAction[] { return this._secondaryActions; }\n\n\tprivate readonly _onDidChangeTitle = new Emitter<void>();\n\treadonly onDidChangeTitle = this._onDidChangeTitle.event;\n\n\treadonly menu: IMenu;\n\tprivate listener: IDisposable = Disposable.None;\n\tprivate disposables = new DisposableStore();\n\n\tconstructor(\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tthis.menu = menuService.createMenu(MenuId.SCMTitle, contextKeyService);\n\t\tthis.disposables.add(this.menu);\n\n\t\tthis.menu.onDidChange(this.updateTitleActions, this, this.disposables);\n\t\tthis.updateTitleActions();\n\t}\n\n\tprivate updateTitleActions(): void {\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst disposable = createAndFillInActionBarActions(this.menu, { shouldForwardArgs: true }, { primary, secondary });\n\n\t\tif (equals(primary, this._actions, actionEquals) && equals(secondary, this._secondaryActions, actionEquals)) {\n\t\t\tdisposable.dispose();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.listener.dispose();\n\t\tthis.listener = disposable;\n\t\tthis._actions = primary;\n\t\tthis._secondaryActions = secondary;\n\n\t\tthis._onDidChangeTitle.fire();\n\t}\n\n\tdispose(): void {\n\t\tthis.menu.dispose();\n\t\tthis.listener.dispose();\n\t}\n}\n\ninterface IContextualResourceMenuItem {\n\treadonly menu: IMenu;\n\tdispose(): void;\n}\n\nclass SCMMenusItem implements IDisposable {\n\n\tprivate _resourceGroupMenu: IMenu | undefined;\n\tget resourceGroupMenu(): IMenu {\n\t\tif (!this._resourceGroupMenu) {\n\t\t\tthis._resourceGroupMenu = this.menuService.createMenu(MenuId.SCMResourceGroupContext, this.contextKeyService);\n\t\t}\n\n\t\treturn this._resourceGroupMenu;\n\t}\n\n\tprivate _resourceFolderMenu: IMenu | undefined;\n\tget resourceFolderMenu(): IMenu {\n\t\tif (!this._resourceFolderMenu) {\n\t\t\tthis._resourceFolderMenu = this.menuService.createMenu(MenuId.SCMResourceFolderContext, this.contextKeyService);\n\t\t}\n\n\t\treturn this._resourceFolderMenu;\n\t}\n\n\tprivate genericResourceMenu: IMenu | undefined;\n\tprivate contextualResourceMenus: Map<string /* contextValue */, IContextualResourceMenuItem> | undefined;\n\n\tconstructor(\n\t\tprivate contextKeyService: IContextKeyService,\n\t\tprivate menuService: IMenuService\n\t) { }\n\n\tgetResourceMenu(resource: ISCMResource): IMenu {\n\t\tif (typeof resource.contextValue === 'undefined') {\n\t\t\tif (!this.genericResourceMenu) {\n\t\t\t\tthis.genericResourceMenu = this.menuService.createMenu(MenuId.SCMResourceContext, this.contextKeyService);\n\t\t\t}\n\n\t\t\treturn this.genericResourceMenu;\n\t\t}\n\n\t\tif (!this.contextualResourceMenus) {\n\t\t\tthis.contextualResourceMenus = new Map<string, IContextualResourceMenuItem>();\n\t\t}\n\n\t\tlet item = this.contextualResourceMenus.get(resource.contextValue);\n\n\t\tif (!item) {\n\t\t\tconst contextKeyService = this.contextKeyService.createOverlay([['scmResourceState', resource.contextValue]]);\n\t\t\tconst menu = this.menuService.createMenu(MenuId.SCMResourceContext, contextKeyService);\n\n\t\t\titem = {\n\t\t\t\tmenu, dispose() {\n\t\t\t\t\tmenu.dispose();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.contextualResourceMenus.set(resource.contextValue, item);\n\t\t}\n\n\t\treturn item.menu;\n\t}\n\n\tdispose(): void {\n\t\tthis.resourceGroupMenu?.dispose();\n\t\tthis.genericResourceMenu?.dispose();\n\n\t\tif (this.contextualResourceMenus) {\n\t\t\tdispose(this.contextualResourceMenus.values());\n\t\t\tthis.contextualResourceMenus.clear();\n\t\t\tthis.contextualResourceMenus = undefined;\n\t\t}\n\n\t\tthis.resourceFolderMenu?.dispose();\n\t}\n}\n\nexport class SCMRepositoryMenus implements ISCMRepositoryMenus, IDisposable {\n\n\tprivate contextKeyService: IContextKeyService;\n\n\treadonly titleMenu: SCMTitleMenu;\n\tprivate readonly resourceGroups: ISCMResourceGroup[] = [];\n\tprivate readonly resourceGroupMenusItems = new Map<ISCMResourceGroup, SCMMenusItem>();\n\n\tprivate _repositoryMenu: IMenu | undefined;\n\tget repositoryMenu(): IMenu {\n\t\tif (!this._repositoryMenu) {\n\t\t\tthis._repositoryMenu = this.menuService.createMenu(MenuId.SCMSourceControl, this.contextKeyService);\n\t\t\tthis.disposables.add(this._repositoryMenu);\n\t\t}\n\n\t\treturn this._repositoryMenu;\n\t}\n\n\tprivate readonly disposables = new DisposableStore();\n\n\tconstructor(\n\t\tprovider: ISCMProvider,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IMenuService private readonly menuService: IMenuService\n\t) {\n\t\tthis.contextKeyService = contextKeyService.createOverlay([\n\t\t\t['scmProvider', provider.contextValue],\n\t\t\t['scmProviderRootUri', provider.rootUri?.toString()],\n\t\t\t['scmProviderHasRootUri', !!provider.rootUri],\n\t\t]);\n\n\t\tconst serviceCollection = new ServiceCollection([IContextKeyService, this.contextKeyService]);\n\t\tinstantiationService = instantiationService.createChild(serviceCollection);\n\t\tthis.titleMenu = instantiationService.createInstance(SCMTitleMenu);\n\n\t\tprovider.groups.onDidSplice(this.onDidSpliceGroups, this, this.disposables);\n\t\tthis.onDidSpliceGroups({ start: 0, deleteCount: 0, toInsert: provider.groups.elements });\n\t}\n\n\tgetResourceGroupMenu(group: ISCMResourceGroup): IMenu {\n\t\treturn this.getOrCreateResourceGroupMenusItem(group).resourceGroupMenu;\n\t}\n\n\tgetResourceMenu(resource: ISCMResource): IMenu {\n\t\treturn this.getOrCreateResourceGroupMenusItem(resource.resourceGroup).getResourceMenu(resource);\n\t}\n\n\tgetResourceFolderMenu(group: ISCMResourceGroup): IMenu {\n\t\treturn this.getOrCreateResourceGroupMenusItem(group).resourceFolderMenu;\n\t}\n\n\tprivate getOrCreateResourceGroupMenusItem(group: ISCMResourceGroup): SCMMenusItem {\n\t\tlet result = this.resourceGroupMenusItems.get(group);\n\n\t\tif (!result) {\n\t\t\tconst contextKeyService = this.contextKeyService.createOverlay([\n\t\t\t\t['scmResourceGroup', group.id],\n\t\t\t]);\n\n\t\t\tresult = new SCMMenusItem(contextKeyService, this.menuService);\n\t\t\tthis.resourceGroupMenusItems.set(group, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate onDidSpliceGroups({ start, deleteCount, toInsert }: ISplice<ISCMResourceGroup>): void {\n\t\tconst deleted = this.resourceGroups.splice(start, deleteCount, ...toInsert);\n\n\t\tfor (const group of deleted) {\n\t\t\tconst item = this.resourceGroupMenusItems.get(group);\n\t\t\titem?.dispose();\n\t\t\tthis.resourceGroupMenusItems.delete(group);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.disposables.dispose();\n\t\tthis.resourceGroupMenusItems.forEach(item => item.dispose());\n\t}\n}\n\nexport class SCMMenus implements ISCMMenus, IDisposable {\n\n\treadonly titleMenu: SCMTitleMenu;\n\tprivate readonly disposables = new DisposableStore();\n\tprivate readonly menus = new Map<ISCMProvider, { menus: SCMRepositoryMenus, dispose: () => void }>();\n\n\tconstructor(\n\t\t@ISCMService scmService: ISCMService,\n\t\t@IInstantiationService private instantiationService: IInstantiationService\n\t) {\n\t\tthis.titleMenu = instantiationService.createInstance(SCMTitleMenu);\n\t\tscmService.onDidRemoveRepository(this.onDidRemoveRepository, this, this.disposables);\n\t}\n\n\tprivate onDidRemoveRepository(repository: ISCMRepository): void {\n\t\tconst menus = this.menus.get(repository.provider);\n\t\tmenus?.dispose();\n\t\tthis.menus.delete(repository.provider);\n\t}\n\n\tgetRepositoryMenus(provider: ISCMProvider): SCMRepositoryMenus {\n\t\tlet result = this.menus.get(provider);\n\n\t\tif (!result) {\n\t\t\tconst menus = this.instantiationService.createInstance(SCMRepositoryMenus, provider);\n\t\t\tconst dispose = () => {\n\t\t\t\tmenus.dispose();\n\t\t\t\tthis.menus.delete(provider);\n\t\t\t};\n\n\t\t\tresult = { menus, dispose };\n\t\t\tthis.menus.set(provider, result);\n\t\t}\n\n\t\treturn result.menus;\n\t}\n\n\tdispose(): void {\n\t\tthis.disposables.dispose();\n\t}\n}\n"]}