{"version":3,"sources":["vs/workbench/contrib/terminal/browser/links/terminalLink.ts"],"names":[],"mappings":"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","file":"terminalLink.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IViewportRange, IBufferRange, ILink, ILinkDecorations, Terminal } from 'xterm';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport * as dom from 'vs/base/browser/dom';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { convertBufferRangeToViewport } from 'vs/workbench/contrib/terminal/browser/links/terminalLinkHelpers';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport { localize } from 'vs/nls';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\n\nexport const OPEN_FILE_LABEL = localize('openFile', 'Open file in editor');\nexport const FOLDER_IN_WORKSPACE_LABEL = localize('focusFolder', 'Focus folder in explorer');\nexport const FOLDER_NOT_IN_WORKSPACE_LABEL = localize('openFolder', 'Open folder in new window');\n\nexport class TerminalLink extends DisposableStore implements ILink {\n\tdecorations: ILinkDecorations;\n\n\tprivate _tooltipScheduler: RunOnceScheduler | undefined;\n\tprivate _hoverListeners: DisposableStore | undefined;\n\n\tprivate readonly _onInvalidated = new Emitter<void>();\n\tpublic get onInvalidated(): Event<void> { return this._onInvalidated.event; }\n\n\tconstructor(\n\t\tprivate readonly _xterm: Terminal,\n\t\tpublic readonly range: IBufferRange,\n\t\tpublic readonly text: string,\n\t\tprivate readonly _viewportY: number,\n\t\tprivate readonly _activateCallback: (event: MouseEvent | undefined, uri: string) => void,\n\t\tprivate readonly _tooltipCallback: (link: TerminalLink, viewportRange: IViewportRange, modifierDownCallback?: () => void, modifierUpCallback?: () => void) => void,\n\t\tprivate readonly _isHighConfidenceLink: boolean,\n\t\tpublic readonly label: string | undefined,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis.decorations = {\n\t\t\tpointerCursor: false,\n\t\t\tunderline: this._isHighConfidenceLink\n\t\t};\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._hoverListeners?.dispose();\n\t\tthis._hoverListeners = undefined;\n\t\tthis._tooltipScheduler?.dispose();\n\t\tthis._tooltipScheduler = undefined;\n\t}\n\n\tactivate(event: MouseEvent | undefined, text: string): void {\n\t\tthis._activateCallback(event, text);\n\t}\n\n\thover(event: MouseEvent, text: string): void {\n\t\t// Listen for modifier before handing it off to the hover to handle so it gets disposed correctly\n\t\tthis._hoverListeners = new DisposableStore();\n\t\tthis._hoverListeners.add(dom.addDisposableListener(document, 'keydown', e => {\n\t\t\tif (!e.repeat && this._isModifierDown(e)) {\n\t\t\t\tthis._enableDecorations();\n\t\t\t}\n\t\t}));\n\t\tthis._hoverListeners.add(dom.addDisposableListener(document, 'keyup', e => {\n\t\t\tif (!e.repeat && !this._isModifierDown(e)) {\n\t\t\t\tthis._disableDecorations();\n\t\t\t}\n\t\t}));\n\n\t\t// Listen for when the terminal renders on the same line as the link\n\t\tthis._hoverListeners.add(this._xterm.onRender(e => {\n\t\t\tconst viewportRangeY = this.range.start.y - this._viewportY;\n\t\t\tif (viewportRangeY >= e.start && viewportRangeY <= e.end) {\n\t\t\t\tthis._onInvalidated.fire();\n\t\t\t}\n\t\t}));\n\n\t\t// Only show the tooltip and highlight for high confidence links (not word/search workspace\n\t\t// links). Feedback was that this makes using the terminal overly noisy.\n\t\tif (this._isHighConfidenceLink) {\n\t\t\tthis._tooltipScheduler = new RunOnceScheduler(() => {\n\t\t\t\tthis._tooltipCallback(\n\t\t\t\t\tthis,\n\t\t\t\t\tconvertBufferRangeToViewport(this.range, this._viewportY),\n\t\t\t\t\tthis._isHighConfidenceLink ? () => this._enableDecorations() : undefined,\n\t\t\t\t\tthis._isHighConfidenceLink ? () => this._disableDecorations() : undefined\n\t\t\t\t);\n\t\t\t\t// Clear out scheduler until next hover event\n\t\t\t\tthis._tooltipScheduler?.dispose();\n\t\t\t\tthis._tooltipScheduler = undefined;\n\t\t\t}, this._configurationService.getValue<number>('workbench.hover.delay'));\n\t\t\tthis.add(this._tooltipScheduler);\n\t\t\tthis._tooltipScheduler.schedule();\n\t\t}\n\n\t\tconst origin = { x: event.pageX, y: event.pageY };\n\t\tthis._hoverListeners.add(dom.addDisposableListener(document, dom.EventType.MOUSE_MOVE, e => {\n\t\t\t// Update decorations\n\t\t\tif (this._isModifierDown(e)) {\n\t\t\t\tthis._enableDecorations();\n\t\t\t} else {\n\t\t\t\tthis._disableDecorations();\n\t\t\t}\n\n\t\t\t// Reset the scheduler if the mouse moves too much\n\t\t\tif (Math.abs(e.pageX - origin.x) > window.devicePixelRatio * 2 || Math.abs(e.pageY - origin.y) > window.devicePixelRatio * 2) {\n\t\t\t\torigin.x = e.pageX;\n\t\t\t\torigin.y = e.pageY;\n\t\t\t\tthis._tooltipScheduler?.schedule();\n\t\t\t}\n\t\t}));\n\t}\n\n\tleave(): void {\n\t\tthis._hoverListeners?.dispose();\n\t\tthis._hoverListeners = undefined;\n\t\tthis._tooltipScheduler?.dispose();\n\t\tthis._tooltipScheduler = undefined;\n\t}\n\n\tprivate _enableDecorations(): void {\n\t\tif (!this.decorations.pointerCursor) {\n\t\t\tthis.decorations.pointerCursor = true;\n\t\t}\n\t\tif (!this.decorations.underline) {\n\t\t\tthis.decorations.underline = true;\n\t\t}\n\t}\n\n\tprivate _disableDecorations(): void {\n\t\tif (this.decorations.pointerCursor) {\n\t\t\tthis.decorations.pointerCursor = false;\n\t\t}\n\t\tif (this.decorations.underline !== this._isHighConfidenceLink) {\n\t\t\tthis.decorations.underline = this._isHighConfidenceLink;\n\t\t}\n\t}\n\n\tprivate _isModifierDown(event: MouseEvent | KeyboardEvent): boolean {\n\t\tconst multiCursorModifier = this._configurationService.getValue<'ctrlCmd' | 'alt'>('editor.multiCursorModifier');\n\t\tif (multiCursorModifier === 'ctrlCmd') {\n\t\t\treturn !!event.altKey;\n\t\t}\n\t\treturn isMacintosh ? event.metaKey : event.ctrlKey;\n\t}\n}\n"]}