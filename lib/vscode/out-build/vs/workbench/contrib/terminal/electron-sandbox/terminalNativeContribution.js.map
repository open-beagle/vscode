{"version":3,"file":"terminalNativeContribution.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/terminal/electron-sandbox/terminalNativeContribution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAchG,IAAa,0BAA0B,GAAvC,MAAa,0BAA2B,SAAQ,sBAAU;QAGzD,YACgC,YAA0B,EACtB,gBAAkC,EACrC,oBAA2C,EAC7C,kBAAuC,EACxC,iBAAqC;YAElE,KAAK,EAAE,CAAC;YANuB,iBAAY,GAAZ,YAAY,CAAc;YACtB,qBAAgB,GAAhB,gBAAgB,CAAkB;YACrC,yBAAoB,GAApB,oBAAoB,CAAuB;YAC7C,uBAAkB,GAAlB,kBAAkB,CAAqB;YACxC,sBAAiB,GAAjB,iBAAiB,CAAoB;YAIlE,qBAAW,CAAC,EAAE,CAAC,kBAAkB,EAAE,CAAC,CAAU,EAAE,OAA+B,EAAE,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;YACtH,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAE1E,MAAM,UAAU,GAAG,kBAAkB,CAAC,aAAa,EAAE,CAAC;YACtD,IAAI,UAAU,IAAI,UAAU,CAAC,eAAe,EAAE;gBAC7C,CAAA,GAAA,4CAA2B,CAAA,EAAE,CAAC;aAC9B;QACF,CAAC;QAEO,WAAW;YAClB,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;QACrF,CAAC;QAEO,KAAK,CAAC,kBAAkB,CAAC,OAA+B;;YAC/D,4FAA4F;YAC5F,0FAA0F;YAC1F,6EAA6E;YAC7E,IAAI,OAAO,CAAC,WAAW,KAAK,QAAQ,IAAI,OAAO,CAAC,WAAW,EAAE;gBAC5D,MAAM,iBAAiB,GAAG,SAAG,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;gBAC5E,MAAM,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,CAAC;gBAE/C,wBAAwB;gBACxB,MAAA,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,EAAE,0CAAE,KAAK,EAAE,CAAC;aACnD;QACF,CAAC;QAEO,gBAAgB,CAAC,IAAS;YACjC,4CAA4C;YAC5C,OAAO,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE;gBAClC,IAAI,OAAO,GAAG,KAAK,CAAC;gBACpB,MAAM,QAAQ,GAAG,WAAW,CAAC,KAAK,IAAI,EAAE;oBACvC,IAAI,CAAC,OAAO,EAAE;wBACb,OAAO,GAAG,IAAI,CAAC;wBACf,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;wBACpD,OAAO,GAAG,KAAK,CAAC;wBAEhB,IAAI,CAAC,MAAM,EAAE;4BACZ,aAAa,CAAC,QAAQ,CAAC,CAAC;4BACxB,OAAO,CAAC,SAAS,CAAC,CAAC;yBACnB;qBACD;gBACF,CAAC,EAAE,IAAI,CAAC,CAAC;YACV,CAAC,CAAC,CAAC;QACJ,CAAC;KACD,CAAA;IAxDY,0BAA0B;QAIpC,WAAA,oBAAY,CAAA;QACZ,WAAA,2BAAgB,CAAA;QAChB,WAAA,qCAAqB,CAAA;QACrB,WAAA,wCAAmB,CAAA;QACnB,WAAA,2BAAkB,CAAA;OARR,0BAA0B,CAwDtC;IAxDY,gEAA0B","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ipcRenderer } from 'vs/base/parts/sandbox/electron-sandbox/globals';\nimport { INativeOpenFileRequest } from 'vs/platform/windows/common/windows';\nimport { URI } from 'vs/base/common/uri';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { registerRemoteContributions } from 'vs/workbench/contrib/terminal/electron-sandbox/terminalRemote';\nimport { IRemoteAgentService } from 'vs/workbench/services/remote/common/remoteAgentService';\nimport { INativeHostService } from 'vs/platform/native/electron-sandbox/native';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { ITerminalService } from 'vs/workbench/contrib/terminal/browser/terminal';\nimport { IWorkbenchContribution } from 'vs/workbench/common/contributions';\n\nexport class TerminalNativeContribution extends Disposable implements IWorkbenchContribution {\n\tpublic _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IInstantiationService readonly instantiationService: IInstantiationService,\n\t\t@IRemoteAgentService readonly remoteAgentService: IRemoteAgentService,\n\t\t@INativeHostService readonly nativeHostService: INativeHostService\n\t) {\n\t\tsuper();\n\n\t\tipcRenderer.on('vscode:openFiles', (_: unknown, request: INativeOpenFileRequest) => this._onOpenFileRequest(request));\n\t\tthis._register(nativeHostService.onDidResumeOS(() => this._onOsResume()));\n\n\t\tconst connection = remoteAgentService.getConnection();\n\t\tif (connection && connection.remoteAuthority) {\n\t\t\tregisterRemoteContributions();\n\t\t}\n\t}\n\n\tprivate _onOsResume(): void {\n\t\tthis._terminalService.terminalInstances.forEach(instance => instance.forceRedraw());\n\t}\n\n\tprivate async _onOpenFileRequest(request: INativeOpenFileRequest): Promise<void> {\n\t\t// if the request to open files is coming in from the integrated terminal (identified though\n\t\t// the termProgram variable) and we are instructed to wait for editors close, wait for the\n\t\t// marker file to get deleted and then focus back to the integrated terminal.\n\t\tif (request.termProgram === 'vscode' && request.filesToWait) {\n\t\t\tconst waitMarkerFileUri = URI.revive(request.filesToWait.waitMarkerFileUri);\n\t\t\tawait this._whenFileDeleted(waitMarkerFileUri);\n\n\t\t\t// Focus active terminal\n\t\t\tthis._terminalService.getActiveInstance()?.focus();\n\t\t}\n\t}\n\n\tprivate _whenFileDeleted(path: URI): Promise<void> {\n\t\t// Complete when wait marker file is deleted\n\t\treturn new Promise<void>(resolve => {\n\t\t\tlet running = false;\n\t\t\tconst interval = setInterval(async () => {\n\t\t\t\tif (!running) {\n\t\t\t\t\trunning = true;\n\t\t\t\t\tconst exists = await this._fileService.exists(path);\n\t\t\t\t\trunning = false;\n\n\t\t\t\t\tif (!exists) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\t}\n}\n"]}