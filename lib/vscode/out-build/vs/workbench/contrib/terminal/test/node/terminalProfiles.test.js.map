{"version":3,"file":"terminalProfiles.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/contrib/terminal/test/node/terminalProfiles.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, fail, ok, strictEqual } from 'assert';\nimport { isWindows } from 'vs/base/common/platform';\nimport { SafeConfigProvider } from 'vs/platform/terminal/common/terminal';\nimport { ITerminalConfiguration, ITerminalProfile, ITerminalProfiles, ProfileSource } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { detectAvailableProfiles, IFsProvider } from 'vs/workbench/contrib/terminal/node/terminalProfiles';\n\n/**\n * Assets that two profiles objects are equal, this will treat explicit undefined and unset\n * properties the same. Order of the profiles is ignored.\n */\nfunction profilesEqual(actualProfiles: ITerminalProfile[], expectedProfiles: ITerminalProfile[]) {\n\tstrictEqual(actualProfiles.length, expectedProfiles.length);\n\tfor (const expected of expectedProfiles) {\n\t\tconst actual = actualProfiles.find(e => e.profileName === expected.profileName);\n\t\tok(actual, `Expected profile ${expected.profileName} not found`);\n\t\tstrictEqual(actual.profileName, expected.profileName);\n\t\tstrictEqual(actual.path, expected.path);\n\t\tdeepStrictEqual(actual.args, expected.args);\n\t\tstrictEqual(actual.isAutoDetected, expected.isAutoDetected);\n\t\tstrictEqual(actual.overrideName, expected.overrideName);\n\t}\n}\n\nfunction buildTestSafeConfigProvider(config: ITestTerminalConfig): SafeConfigProvider {\n\treturn (key: string) => {\n\t\tswitch (key) {\n\t\t\tcase 'terminal.integrated.profiles.linux': return config.profiles.linux as any;\n\t\t\tcase 'terminal.integrated.profiles.osx': return config.profiles.osx as any;\n\t\t\tcase 'terminal.integrated.profiles.windows': return config.profiles.windows as any;\n\t\t\tcase 'terminal.integrated.useWslProfiles': return config.useWslProfiles;\n\t\t\tdefault: throw new Error('Unexpected config key');\n\t\t}\n\t};\n}\n\nsuite('Workbench - TerminalProfiles', () => {\n\tsuite('detectAvailableProfiles', () => {\n\t\tif (isWindows) {\n\t\t\ttest('should detect Git Bash and provide login args', async () => {\n\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t'C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe'\n\t\t\t\t]);\n\t\t\t\tconst config: ITestTerminalConfig = {\n\t\t\t\t\tprofiles: {\n\t\t\t\t\t\twindows: {\n\t\t\t\t\t\t\t'Git Bash': { source: ProfileSource.GitBash }\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlinux: {},\n\t\t\t\t\t\tosx: {}\n\t\t\t\t\t},\n\t\t\t\t\tuseWslProfiles: false\n\t\t\t\t};\n\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(config), fsProvider, undefined, undefined, undefined);\n\t\t\t\tconst expected = [\n\t\t\t\t\t{ profileName: 'Git Bash', path: 'C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe', args: ['--login'] }\n\t\t\t\t];\n\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t});\n\t\t\ttest('should allow source to have args', async () => {\n\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t'C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe'\n\t\t\t\t]);\n\t\t\t\tconst config: ITestTerminalConfig = {\n\t\t\t\t\tprofiles: {\n\t\t\t\t\t\twindows: {\n\t\t\t\t\t\t\t'PowerShell NoProfile': { source: ProfileSource.Pwsh, args: ['-NoProfile'], overrideName: true }\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlinux: {},\n\t\t\t\t\t\tosx: {},\n\t\t\t\t\t},\n\t\t\t\t\tuseWslProfiles: false\n\t\t\t\t};\n\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(config), fsProvider, undefined, undefined, undefined);\n\t\t\t\tconst expected = [\n\t\t\t\t\t{ profileName: 'PowerShell NoProfile', path: 'C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe', overrideName: true, args: ['-NoProfile'] }\n\t\t\t\t];\n\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t});\n\t\t\ttest('configured args should override default source ones', async () => {\n\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t'C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe'\n\t\t\t\t]);\n\t\t\t\tconst config: ITestTerminalConfig = {\n\t\t\t\t\tprofiles: {\n\t\t\t\t\t\twindows: {\n\t\t\t\t\t\t\t'Git Bash': { source: ProfileSource.GitBash, args: [] }\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlinux: {},\n\t\t\t\t\t\tosx: {}\n\t\t\t\t\t},\n\t\t\t\t\tuseWslProfiles: false\n\t\t\t\t};\n\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(config), fsProvider, undefined, undefined, undefined);\n\t\t\t\tconst expected = [{ profileName: 'Git Bash', path: 'C:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe', args: [], isAutoDetected: undefined, overrideName: undefined }];\n\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t});\n\t\t\tsuite('pwsh source detection/fallback', async () => {\n\t\t\t\tconst pwshSourceConfig = ({\n\t\t\t\t\tprofiles: {\n\t\t\t\t\t\twindows: {\n\t\t\t\t\t\t\t'PowerShell': { source: ProfileSource.Pwsh }\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlinux: {},\n\t\t\t\t\t\tosx: {},\n\t\t\t\t\t},\n\t\t\t\t\tuseWslProfiles: false\n\t\t\t\t} as ITestTerminalConfig) as ITerminalConfiguration;\n\n\t\t\t\ttest('should prefer pwsh 7 to Windows PowerShell', async () => {\n\t\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t\t'C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe',\n\t\t\t\t\t\t'C:\\\\Sysnative\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe',\n\t\t\t\t\t\t'C:\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe'\n\t\t\t\t\t]);\n\t\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(pwshSourceConfig), fsProvider, undefined, undefined, undefined);\n\t\t\t\t\tconst expected = [\n\t\t\t\t\t\t{ profileName: 'PowerShell', path: 'C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe' }\n\t\t\t\t\t];\n\t\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t\t});\n\t\t\t\ttest('should prefer pwsh 7 to pwsh 6', async () => {\n\t\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t\t'C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe',\n\t\t\t\t\t\t'C:\\\\Program Files\\\\PowerShell\\\\6\\\\pwsh.exe',\n\t\t\t\t\t\t'C:\\\\Sysnative\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe',\n\t\t\t\t\t\t'C:\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe'\n\t\t\t\t\t]);\n\t\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(pwshSourceConfig), fsProvider, undefined, undefined, undefined);\n\t\t\t\t\tconst expected = [\n\t\t\t\t\t\t{ profileName: 'PowerShell', path: 'C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe' }\n\t\t\t\t\t];\n\t\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t\t});\n\t\t\t\ttest.skip('should fallback to Windows PowerShell', async () => {\n\t\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t\t'C:\\\\Windows\\\\Sysnative\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe',\n\t\t\t\t\t\t'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe'\n\t\t\t\t\t]);\n\t\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(pwshSourceConfig), fsProvider, undefined, undefined, undefined);\n\t\t\t\t\tstrictEqual(profiles.length, 1);\n\t\t\t\t\tstrictEqual(profiles[0].profileName, 'PowerShell');\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tconst absoluteConfig = ({\n\t\t\t\tprofiles: {\n\t\t\t\t\twindows: {},\n\t\t\t\t\tosx: {\n\t\t\t\t\t\t'fakeshell1': { path: '/bin/fakeshell1' },\n\t\t\t\t\t\t'fakeshell2': { path: '/bin/fakeshell2' },\n\t\t\t\t\t\t'fakeshell3': { path: '/bin/fakeshell3' }\n\t\t\t\t\t},\n\t\t\t\t\tlinux: {\n\t\t\t\t\t\t'fakeshell1': { path: '/bin/fakeshell1' },\n\t\t\t\t\t\t'fakeshell2': { path: '/bin/fakeshell2' },\n\t\t\t\t\t\t'fakeshell3': { path: '/bin/fakeshell3' }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tuseWslProfiles: false\n\t\t\t} as ITestTerminalConfig) as ITerminalConfiguration;\n\t\t\tconst onPathConfig = ({\n\t\t\t\tprofiles: {\n\t\t\t\t\twindows: {},\n\t\t\t\t\tosx: {\n\t\t\t\t\t\t'fakeshell1': { path: 'fakeshell1' },\n\t\t\t\t\t\t'fakeshell2': { path: 'fakeshell2' },\n\t\t\t\t\t\t'fakeshell3': { path: 'fakeshell3' }\n\t\t\t\t\t},\n\t\t\t\t\tlinux: {\n\t\t\t\t\t\t'fakeshell1': { path: 'fakeshell1' },\n\t\t\t\t\t\t'fakeshell2': { path: 'fakeshell2' },\n\t\t\t\t\t\t'fakeshell3': { path: 'fakeshell3' }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tuseWslProfiles: false\n\t\t\t} as ITestTerminalConfig) as ITerminalConfiguration;\n\n\t\t\ttest('should detect shells via absolute paths', async () => {\n\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t'/bin/fakeshell1',\n\t\t\t\t\t'/bin/fakeshell3'\n\t\t\t\t]);\n\t\t\t\tconst profiles = await detectAvailableProfiles(true, buildTestSafeConfigProvider(absoluteConfig), fsProvider, undefined, undefined, undefined);\n\t\t\t\tconst expected: ITerminalProfile[] = [\n\t\t\t\t\t{ profileName: 'fakeshell1', path: '/bin/fakeshell1' },\n\t\t\t\t\t{ profileName: 'fakeshell3', path: '/bin/fakeshell3' }\n\t\t\t\t];\n\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t});\n\t\t\ttest('should auto detect shells via /etc/shells', async () => {\n\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t'/bin/fakeshell1',\n\t\t\t\t\t'/bin/fakeshell3'\n\t\t\t\t], '/bin/fakeshell1\\n/bin/fakeshell3');\n\t\t\t\tconst profiles = await detectAvailableProfiles(false, buildTestSafeConfigProvider(onPathConfig), fsProvider, undefined, undefined, undefined);\n\t\t\t\tconst expected: ITerminalProfile[] = [\n\t\t\t\t\t{ profileName: 'fakeshell1', path: 'fakeshell1' },\n\t\t\t\t\t{ profileName: 'fakeshell3', path: 'fakeshell3' }\n\t\t\t\t];\n\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t});\n\t\t\ttest('should validate auto detected shells from /etc/shells exist', async () => {\n\t\t\t\t// fakeshell3 exists in /etc/shells but not on FS\n\t\t\t\tconst fsProvider = createFsProvider([\n\t\t\t\t\t'/bin/fakeshell1'\n\t\t\t\t], '/bin/fakeshell1\\n/bin/fakeshell3');\n\t\t\t\tconst profiles = await detectAvailableProfiles(false, buildTestSafeConfigProvider(onPathConfig), fsProvider, undefined, undefined, undefined);\n\t\t\t\tconst expected: ITerminalProfile[] = [\n\t\t\t\t\t{ profileName: 'fakeshell1', path: 'fakeshell1' }\n\t\t\t\t];\n\t\t\t\tprofilesEqual(profiles, expected);\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction createFsProvider(expectedPaths: string[], etcShellsContent: string = ''): IFsProvider {\n\t\tconst provider = {\n\t\t\tasync existsFile(path: string): Promise<boolean> {\n\t\t\t\treturn expectedPaths.includes(path);\n\t\t\t},\n\t\t\tasync readFile(path: string, options: { encoding: BufferEncoding, flag?: string | number } | BufferEncoding): Promise<string> {\n\t\t\t\tif (path !== '/etc/shells') {\n\t\t\t\t\tfail('Unexected path');\n\t\t\t\t}\n\t\t\t\treturn etcShellsContent;\n\t\t\t}\n\t\t};\n\t\treturn provider;\n\t}\n});\n\nexport interface ITestTerminalConfig {\n\tprofiles: ITerminalProfiles;\n\tuseWslProfiles: boolean\n}\n"]}