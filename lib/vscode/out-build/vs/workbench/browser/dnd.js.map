{"version":3,"file":"dnd.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/browser/dnd.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAyChG,MAAa,uBAAuB;QAEnC,YAA4B,UAA6B;YAA7B,eAAU,GAAV,UAAU,CAAmB;QAAI,CAAC;KAC9D;IAHD,0DAGC;IAED,MAAa,4BAA4B;QAExC,YAA4B,UAA2B;YAA3B,eAAU,GAAV,UAAU,CAAiB;QAAI,CAAC;KAC5D;IAHD,oEAGC;IAaY,QAAA,iBAAiB,GAAG;QAChC,OAAO,EAAE,aAAa;QACtB,KAAK,EAAE,WAAW;KAClB,CAAC;IAEF,SAAgB,gBAAgB,CAAC,CAAY,EAAE,YAAsB;QACpE,MAAM,SAAS,GAA6C,EAAE,CAAC;QAC/D,IAAI,CAAC,CAAC,YAAY,IAAI,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;YAEtD,iCAAiC;YACjC,IAAI,CAAC,YAAY,EAAE;gBAElB,8BAA8B;gBAC9B,MAAM,cAAc,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,yBAAiB,CAAC,OAAO,CAAC,CAAC;gBACzE,IAAI,cAAc,EAAE;oBACnB,IAAI;wBACH,MAAM,cAAc,GAA+B,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;wBAC9E,cAAc,CAAC,OAAO,CAAC,aAAa,CAAC,EAAE;4BACtC,SAAS,CAAC,IAAI,CAAC;gCACd,QAAQ,EAAE,SAAG,CAAC,KAAK,CAAC,aAAa,CAAC,QAAQ,CAAC;gCAC3C,YAAY,EAAE,aAAa,CAAC,YAAY;gCACxC,OAAO,EAAE,aAAa,CAAC,OAAO;gCAC9B,QAAQ,EAAE,aAAa,CAAC,QAAQ;gCAChC,IAAI,EAAE,aAAa,CAAC,IAAI;gCACxB,UAAU,EAAE,KAAK;6BACjB,CAAC,CAAC;wBACJ,CAAC,CAAC,CAAC;qBACH;oBAAC,OAAO,KAAK,EAAE;wBACf,mBAAmB;qBACnB;iBACD;gBAED,2BAA2B;qBACtB;oBACJ,IAAI;wBACH,MAAM,gBAAgB,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,mBAAa,CAAC,SAAS,CAAC,CAAC;wBACzE,IAAI,gBAAgB,EAAE;4BACrB,MAAM,WAAW,GAAa,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;4BAC3D,SAAS,CAAC,IAAI,CAAC,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,QAAQ,EAAE,SAAG,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,UAAU,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;yBACnG;qBACD;oBAAC,OAAO,KAAK,EAAE;wBACf,mBAAmB;qBACnB;iBACD;aACD;YAED,iCAAiC;YACjC,IAAI,CAAC,CAAC,YAAY,IAAI,CAAC,CAAC,YAAY,CAAC,KAAK,EAAE;gBAC3C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACrD,MAAM,IAAI,GAAG,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACrC,IAAI,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,IAAI,CAAC,mBAAmB,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC,wBAAwB,EAAE;wBACnI,IAAI;4BACH,SAAS,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,SAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;yBACpE;wBAAC,OAAO,KAAK,EAAE;4BACf,cAAc;yBACd;qBACD;iBACD;aACD;YAED,+BAA+B;YAC/B,MAAM,YAAY,GAAG,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,yBAAiB,CAAC,KAAK,CAAC,CAAC;YACrE,IAAI,YAAY,EAAE;gBACjB,IAAI;oBACH,MAAM,SAAS,GAAa,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;oBACrD,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;wBAC5B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,KAAK,QAAQ,CAAC,CAAC,wBAAwB,EAAE;4BAChG,SAAS,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,SAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;yBACnE;oBACF,CAAC,CAAC,CAAC;iBACH;gBAAC,OAAO,KAAK,EAAE;oBACf,mBAAmB;iBACnB;aACD;SACD;QAED,OAAO,SAAS,CAAC;IAClB,CAAC;IAxED,4CAwEC;IAWD;;;OAGG;IACH,IAAa,oBAAoB,GAAjC,MAAa,oBAAoB;QAEhC,YACS,OAAqC,EACd,WAAyB,EACnB,iBAAqC,EACvC,eAAiC,EACxB,wBAAmD,EAC9D,aAA6B,EACnB,uBAAiD,EAC7D,WAAyB;YAPhD,YAAO,GAAP,OAAO,CAA8B;YACd,gBAAW,GAAX,WAAW,CAAc;YACnB,sBAAiB,GAAjB,iBAAiB,CAAoB;YACvC,oBAAe,GAAf,eAAe,CAAkB;YACxB,6BAAwB,GAAxB,wBAAwB,CAA2B;YAC9D,kBAAa,GAAb,aAAa,CAAgB;YACnB,4BAAuB,GAAvB,uBAAuB,CAA0B;YAC7D,gBAAW,GAAX,WAAW,CAAc;QAEzD,CAAC;QAED,KAAK,CAAC,UAAU,CAAC,KAAgB,EAAE,kBAAkD,EAAE,SAA0D,EAAE,WAAoB;YACtK,MAAM,uBAAuB,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,CAAC,CAAC;YACnL,IAAI,CAAC,uBAAuB,CAAC,MAAM,EAAE;gBACpC,OAAO;aACP;YAED,4DAA4D;YAC5D,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;YAE/B,yCAAyC;YACzC,MAAM,kBAAkB,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,uBAAuB,CAAC,CAAC;YAC5E,IAAI,kBAAkB,EAAE;gBACvB,OAAO,CAAC,qFAAqF;aAC7F;YAED,iFAAiF;YACjF,MAAM,WAAW,GAAkB,uBAAuB,CAAC,MAAM,CAAC,sBAAsB,CAAC,EAAE,CAAC,sBAAsB,CAAC,UAAU,IAAI,sBAAsB,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;YAC9N,IAAI,WAAW,CAAC,MAAM,EAAE;gBACvB,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;aACtD;YAED,MAAM,OAAO,GAA+B,uBAAuB,CAAC,GAAG,CAAC,sBAAsB,CAAC,EAAE,CAAC,CAAC;gBAClG,QAAQ,EAAE,sBAAsB,CAAC,QAAQ;gBACzC,QAAQ,EAAG,sBAAyC,CAAC,QAAQ;gBAC7D,IAAI,EAAG,sBAAyC,CAAC,IAAI;gBACrD,OAAO,kCACF,sBAAyC,CAAC,OAAO,KACrD,MAAM,EAAE,IAAI,EACZ,KAAK,EAAE,WAAW,GAClB;aACD,CAAC,CAAC,CAAC;YAEJ,iBAAiB;YACjB,MAAM,WAAW,GAAG,kBAAkB,EAAE,CAAC;YACzC,MAAM,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;YAE3D,gCAAgC;YAChC,SAAS,CAAC,WAAW,CAAC,CAAC;QACxB,CAAC;QAEO,KAAK,CAAC,YAAY,CAAC,uBAAiE;YAE3F,wCAAwC;YACxC,MAAM,YAAY,GAAqB,uBAAuB,CAAC,MAAM,CAAC,sBAAsB,CAAC,EAAE,CAAC,CAAC,sBAAsB,CAAC,UAAU,IAAI,OAAQ,sBAAyC,CAAC,YAAY,KAAK,QAAQ,CAAC,CAAC;YACnN,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC5B,MAAM,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE,CAAC,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;gBAC5F,OAAO,KAAK,CAAC;aACb;YAED,oEAAoE;YACpE,IAAI,IAAI,CAAC,OAAO,CAAC,kBAAkB,EAAE;gBACpC,MAAM,2BAA2B,GAAG,uBAAuB,CAAC,MAAM,CAAC,sBAAsB,CAAC,EAAE,CAAC,sBAAsB,CAAC,UAAU,IAAI,sBAAsB,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;gBAChN,IAAI,2BAA2B,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC3C,OAAO,IAAI,CAAC,uBAAuB,CAAC,2BAA2B,CAAC,CAAC;iBACjE;aACD;YAED,OAAO,KAAK,CAAC;QACd,CAAC;QAEO,KAAK,CAAC,qBAAqB,CAAC,kBAAkC;YACrE,MAAM,iBAAiB,GAAG,mBAAQ,CAAC,EAAE,CAA8B,yBAAgB,CAAC,oBAAoB,CAAC,CAAC,yBAAyB,EAAE,CAAC;YAEtI,mFAAmF;YACnF,IAAI,kBAAkB,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,EAAE;gBAC5D,MAAM,sBAAsB,GAAG,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,EAAE,IAAI,EAAE,kBAAkB,CAAC,IAAI,EAAE,QAAQ,EAAE,kBAAkB,CAAC,QAAQ,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,QAAQ,CAAC;gBAC5K,IAAI,sBAAsB,EAAE;oBAC3B,kBAAkB,CAAC,QAAQ,GAAG,sBAAsB,CAAC;iBACrD;aACD;YAED,uDAAuD;iBAClD,IAAI,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,kBAAkB,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAE,QAAQ,EAAE,kBAAkB,CAAC,QAAQ,EAAE,MAAM,EAAE,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE;gBAC/K,OAAO,KAAK,CAAC;aACb;YAED,kEAAkE;YAClE,kEAAkE;YAClE,IAAI,OAAO,kBAAkB,CAAC,YAAY,KAAK,QAAQ,EAAE;gBACxD,IAAI;oBACH,MAAM,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,kBAAkB,CAAC,QAAQ,EAAE,MAAM,EAAE,wBAAU,EAAE,EAAE,CAAA,GAAA,yBAAgB,CAAA,CAAC,iBAAQ,CAAC,UAAU,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;iBAClL;gBAAC,OAAO,CAAC,EAAE;oBACX,eAAe;iBACf;aACD;YAED,OAAO,KAAK,CAAC;QACd,CAAC;QAEO,KAAK,CAAC,uBAAuB,CAAC,mBAA0B;YAC/D,MAAM,MAAM,GAAsB,EAAE,CAAC;YACrC,MAAM,UAAU,GAAmC,EAAE,CAAC;YAEtD,MAAM,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,GAAG,CAAC,KAAK,EAAC,kBAAkB,EAAC,EAAE;gBAEpE,sBAAsB;gBACtB,IAAI,CAAA,GAAA,sCAAyB,CAAA,CAAC,kBAAkB,CAAC,EAAE;oBAClD,MAAM,CAAC,IAAI,CAAC,EAAE,YAAY,EAAE,kBAAkB,EAAE,CAAC,CAAC;oBAElD,OAAO;iBACP;gBAED,mBAAmB;gBACnB,IAAI;oBACH,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;oBAChE,IAAI,IAAI,CAAC,WAAW,EAAE;wBACrB,MAAM,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;wBAC1C,UAAU,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;qBACxC;iBACD;gBAAC,OAAO,KAAK,EAAE;oBACf,eAAe;iBACf;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,gEAAgE;YAChE,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE;gBACxB,OAAO,KAAK,CAAC;aACb;YAED,uBAAuB;YACvB,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;YAEzB,oEAAoE;YACpE,IAAI,MAAM,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;gBACjE,MAAM,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;aAC1C;YAED,mFAAmF;iBAC9E;gBACJ,MAAM,IAAI,CAAC,uBAAuB,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC;aACvE;YAED,OAAO,IAAI,CAAC;QACb,CAAC;KACD,CAAA;IApJY,oBAAoB;QAI9B,WAAA,oBAAY,CAAA;QACZ,WAAA,+BAAkB,CAAA;QAClB,WAAA,4BAAgB,CAAA;QAChB,WAAA,6CAAyB,CAAA;QACzB,WAAA,8BAAc,CAAA;QACd,WAAA,2CAAwB,CAAA;QACxB,WAAA,mBAAY,CAAA;OAVF,oBAAoB,CAoJhC;IApJY,oDAAoB;IAsJjC,SAAgB,yBAAyB,CAAC,QAA0B,EAAE,SAA4D,EAAE,eAAoE,EAAE,KAAiC;QAC1O,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE;YAClD,OAAO;SACP;QAED,MAAM,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;YACnC,IAAI,SAAG,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;gBACnB,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,WAAW,EAAE,KAAK,CAAC,wCAAwC,EAAE,CAAC;aACtF;YAED,OAAO,GAAG,CAAC;QACZ,CAAC,CAAC,CAAC;QAEH,gDAAgD;QAChD,MAAM,aAAa,GAAG,oBAAS,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC;QAChD,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,mBAAa,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA,GAAA,gBAAS,CAAA,CAAC,CAAA,GAAA,6BAAoB,CAAA,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;QAE1N,8FAA8F;QAC9F,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE;YAC5B,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,mBAAa,CAAC,YAAY,EAAE,CAAC,kBAAW,EAAE,CAAA,GAAA,oBAAQ,CAAA,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,oBAAU,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;SACxK;QAED,4FAA4F;QAC5F,MAAM,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;QAC5D,IAAI,KAAK,CAAC,MAAM,EAAE;YACjB,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,mBAAa,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC;SACjH;QAED,iEAAiE;QACjE,MAAM,eAAe,GAAG,QAAQ,CAAC,GAAG,CAAC,4BAAgB,CAAC,CAAC;QACvD,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,8BAAc,CAAC,CAAC;QAEnD,MAAM,cAAc,GAA+B,EAAE,CAAC;QACtD,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACpB,IAAI,OAAO,GAAmC,SAAS,CAAC;YAExD,2CAA2C;YAC3C,IAAI,OAAO,eAAe,KAAK,UAAU,EAAE;gBAC1C,OAAO,GAAG,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aACzC;YAED,4EAA4E;iBACvE;gBACJ,OAAO,GAAG;oBACT,SAAS,EAAE,CAAC,GAAG,EAAE;wBAChB,MAAM,kBAAkB,GAAG,aAAa,CAAC,yBAAyB,CAAC;wBACnE,KAAK,MAAM,iBAAiB,IAAI,kBAAkB,EAAE;4BACnD,IAAI,CAAA,GAAA,4BAAY,CAAA,CAAC,iBAAiB,CAAC,EAAE;gCACpC,MAAM,KAAK,GAAG,iBAAiB,CAAC,QAAQ,EAAE,CAAC;gCAC3C,IAAI,CAAA,GAAA,mBAAO,CAAA,CAAC,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;oCACvC,OAAO,CAAA,GAAA,2BAAmB,CAAA,CAAC,iBAAiB,CAAC,aAAa,EAAE,CAAC,CAAC;iCAC9D;6BACD;yBACD;wBAED,OAAO,SAAS,CAAC;oBAClB,CAAC,CAAC,EAAE;iBACJ,CAAC;aACF;YAED,gDAAgD;YAChD,IAAI,QAAQ,GAAuB,SAAS,CAAC;YAC7C,IAAI,IAAI,GAAuB,SAAS,CAAC;YAEzC,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACjJ,IAAI,KAAK,EAAE;gBACV,QAAQ,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;gBAC/B,IAAI,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;aACvB;YAED,8DAA8D;YAC9D,gEAAgE;YAChE,IAAI,YAAY,GAAuB,SAAS,CAAC;YACjD,IAAI,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,OAAO,EAAE,EAAE;gBACrB,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC;aAChD;YAED,wBAAwB;YACxB,cAAc,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,YAAY,EAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC;QACpG,CAAC,CAAC,CAAC;QAEH,IAAI,cAAc,CAAC,MAAM,EAAE;YAC1B,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,yBAAiB,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,CAAC;SACtF;IACF,CAAC;IApFD,8DAoFC;IAED;;OAEG;IACH,MAAa,sBAAsB;QAOlC;YACC,yCAAyC;QAC1C,CAAC;QAED,MAAM,CAAC,WAAW;YACjB,OAAO,sBAAsB,CAAC,QAAqC,CAAC;QACrE,CAAC;QAED,OAAO,CAAC,KAAQ;YACf,OAAO,KAAK,IAAI,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC;QACtC,CAAC;QAED,SAAS,CAAC,KAAQ;YACjB,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACxB,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;gBACvB,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC;aACtB;QACF,CAAC;QAED,OAAO,CAAC,KAAQ;YACf,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACxB,OAAO,IAAI,CAAC,IAAI,CAAC;aACjB;YAED,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,OAAO,CAAC,IAAS,EAAE,KAAQ;YAC1B,IAAI,KAAK,EAAE;gBACV,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;aACnB;QACF,CAAC;;IAvCF,wDAwCC;IAtCwB,+BAAQ,GAAG,IAAI,sBAAsB,EAAE,CAAC;IAiDjE,MAAa,mBAAoB,SAAQ,sBAAU;QAQlD,YAAoB,OAAoB,EAAU,SAAwC;YACzF,KAAK,EAAE,CAAC;YADW,YAAO,GAAP,OAAO,CAAa;YAAU,cAAS,GAAT,SAAS,CAA+B;YAN1F,+DAA+D;YAC/D,6DAA6D;YAC7D,iEAAiE;YACjE,cAAc;YACN,YAAO,GAAW,CAAC,CAAC;YAK3B,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1B,CAAC;QAEO,iBAAiB;YACxB,IAAI,CAAC,SAAS,CAAC,CAAA,GAAA,2BAAqB,CAAA,CAAC,IAAI,CAAC,OAAO,EAAE,eAAS,CAAC,UAAU,EAAE,CAAC,CAAY,EAAE,EAAE;gBACzF,IAAI,CAAC,OAAO,EAAE,CAAC;gBAEf,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;YAC/B,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,SAAS,CAAC,CAAA,GAAA,2BAAqB,CAAA,CAAC,IAAI,CAAC,OAAO,EAAE,eAAS,CAAC,SAAS,EAAE,CAAC,CAAY,EAAE,EAAE;gBACxF,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC,qHAAqH;gBAEzI,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE;oBAC9B,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;iBAC7B;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,SAAS,CAAC,CAAA,GAAA,2BAAqB,CAAA,CAAC,IAAI,CAAC,OAAO,EAAE,eAAS,CAAC,UAAU,EAAE,CAAC,CAAY,EAAE,EAAE;gBACzF,IAAI,CAAC,OAAO,EAAE,CAAC;gBAEf,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE;oBACvB,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;iBAC9B;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,SAAS,CAAC,CAAA,GAAA,2BAAqB,CAAA,CAAC,IAAI,CAAC,OAAO,EAAE,eAAS,CAAC,QAAQ,EAAE,CAAC,CAAY,EAAE,EAAE;gBACvF,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;gBACjB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAC7B,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,SAAS,CAAC,CAAA,GAAA,2BAAqB,CAAA,CAAC,IAAI,CAAC,OAAO,EAAE,eAAS,CAAC,IAAI,EAAE,CAAC,CAAY,EAAE,EAAE;gBACnF,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;gBACjB,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAC1B,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;KACD;IA/CD,kDA+CC;IAED,SAAgB,gBAAgB,CAAC,KAAgB,EAAE,GAAG,eAAyB;QAC9E,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE;YACxB,OAAO,KAAK,CAAC;SACb;QAED,MAAM,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC;QAC3C,MAAM,kBAAkB,GAAa,EAAE,CAAC;QACxC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,kCAAkC;SACvF;QAED,KAAK,MAAM,QAAQ,IAAI,eAAe,EAAE;YACvC,IAAI,kBAAkB,CAAC,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,EAAE;gBAC5D,OAAO,IAAI,CAAC;aACZ;SACD;QAED,OAAO,KAAK,CAAC;IACd,CAAC;IAlBD,4CAkBC;IAmBD,MAAa,wBAAwB;QACpC,YAAoB,IAA0B,EAAU,EAAU;YAA9C,SAAI,GAAJ,IAAI,CAAsB;YAAU,OAAE,GAAF,EAAE,CAAQ;QAAI,CAAC;QACvE,MAAM,CAAC,YAA0B;YAChC,QAAQ;QACT,CAAC;QACD,OAAO;YAIN,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;QACzC,CAAC;KACD;IAXD,4DAWC;IAOD,MAAa,0BAA0B;QACtC,YAAoB,YAAoB;YAApB,iBAAY,GAAZ,YAAY,CAAQ;QAAI,CAAC;QAE7C,IAAI,EAAE;YACL,OAAO,IAAI,CAAC,YAAY,CAAC;QAC1B,CAAC;KACD;IAND,gEAMC;IAED,MAAa,qBAAqB;QACjC,YAAoB,OAAe;YAAf,YAAO,GAAP,OAAO,CAAQ;QAAI,CAAC;QAExC,IAAI,EAAE;YACL,OAAO,IAAI,CAAC,OAAO,CAAC;QACrB,CAAC;KACD;IAND,sDAMC;IAID,MAAa,4BAA6B,SAAQ,sBAAU;QAW3D;YACC,KAAK,EAAE,CAAC;YAVD,iBAAY,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,eAAO,EAAyB,CAAC,CAAC;YACpE,eAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,eAAO,EAAyB,CAAC,CAAC;YAUzE,IAAI,CAAC,YAAY,GAAG,sBAAsB,CAAC,WAAW,EAAsD,CAAC;YAE7G,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;gBACxC,MAAM,EAAE,GAAG,CAAC,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC;gBAC1C,MAAM,IAAI,GAAG,CAAC,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAC9C,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;gBACrC,IAAI,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,OAAO,GAAG,EAAE,MAAK,EAAE,EAAE;oBAC9B,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;iBACtH;YACF,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAlBD,MAAM,KAAK,QAAQ;YAClB,IAAI,CAAC,4BAA4B,CAAC,SAAS,EAAE;gBAC5C,4BAA4B,CAAC,SAAS,GAAG,IAAI,4BAA4B,EAAE,CAAC;aAC5E;YACD,OAAO,4BAA4B,CAAC,SAAS,CAAC;QAC/C,CAAC;QAcO,YAAY,CAAC,IAAc;YAClC,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC,0BAA0B,CAAC,SAAS,CAAC,EAAE;gBACxH,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;gBACjI,IAAI,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE;oBACpB,OAAO,IAAI,wBAAwB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;iBACtD;aACD;YACD,OAAO,SAAS,CAAC;QAClB,CAAC;QACO,aAAa,CAAC,EAAU,EAAE,IAAc;YAC/C,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,IAAI,qBAAqB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,0BAA0B,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;QAC7M,CAAC;QACD,cAAc,CAAC,OAAoB,EAAE,SAAiD;YACrF,MAAM,eAAe,GAAG,IAAI,2BAAe,EAAE,CAAC;YAC9C,eAAe,CAAC,GAAG,CAAC,IAAI,mBAAmB,CAAC,OAAO,EAAE;gBACpD,SAAS,EAAE,CAAC,CAAC,EAAE;oBACd,QAAQ;gBACT,CAAC;gBACD,WAAW,EAAE,CAAC,CAAC,EAAE;oBAChB,CAAC,CAAC,cAAc,EAAE,CAAC;oBACnB,IAAI,SAAS,CAAC,WAAW,EAAE;wBAC1B,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBACzE,IAAI,IAAI,EAAE;4BACT,SAAS,CAAC,WAAW,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;yBAChE;qBACD;gBACF,CAAC;gBACD,WAAW,EAAE,CAAC,CAAC,EAAE;oBAChB,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBACzE,IAAI,SAAS,CAAC,WAAW,IAAI,IAAI,EAAE;wBAClC,SAAS,CAAC,WAAW,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;qBAChE;gBACF,CAAC;gBACD,MAAM,EAAE,CAAC,CAAC,EAAE;oBACX,IAAI,SAAS,CAAC,MAAM,EAAE;wBACrB,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBACzE,IAAI,CAAC,IAAI,EAAE;4BACV,OAAO;yBACP;wBAED,SAAS,CAAC,MAAM,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;wBAE3D,oEAAoE;wBACpE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;qBAC/D;gBACF,CAAC;gBACD,UAAU,EAAE,CAAC,CAAC,EAAE;oBACf,CAAC,CAAC,cAAc,EAAE,CAAC;oBACnB,IAAI,SAAS,CAAC,UAAU,EAAE;wBACzB,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBACzE,IAAI,CAAC,IAAI,EAAE;4BACV,OAAO;yBACP;wBAED,SAAS,CAAC,UAAU,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;qBAC/D;gBACF,CAAC;aACD,CAAC,CAAC,CAAC;YACJ,IAAI,SAAS,CAAC,WAAW,EAAE;gBAC1B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;oBAC3B,SAAS,CAAC,WAAY,CAAC,CAAC,CAAC,CAAC;gBAC3B,CAAC,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;aAC1B;YACD,IAAI,SAAS,CAAC,SAAS,EAAE;gBACxB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;oBACzB,SAAS,CAAC,SAAU,CAAC,CAAC,CAAC,CAAC;gBACzB,CAAC,CAAC,CAAC;aACH;YACD,OAAO,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;QACxC,CAAC;QAED,iBAAiB,CAAC,OAAoB,EAAE,mBAAyD,EAAE,SAAiD;YACnJ,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC;YACzB,MAAM,eAAe,GAAG,IAAI,2BAAe,EAAE,CAAC;YAC9C,eAAe,CAAC,GAAG,CAAC,CAAA,GAAA,2BAAqB,CAAA,CAAC,OAAO,EAAE,eAAS,CAAC,UAAU,EAAE,CAAC,CAAC,EAAE;gBAC5E,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,mBAAmB,EAAE,CAAC;gBAC3C,IAAI,CAAC,aAAa,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;gBAE7B,IAAI,CAAC,CAAC,YAAY,EAAE;oBACnB,CAAC,CAAC,YAAY,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;iBAC3C;gBAED,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAE,EAAE,CAAC,CAAC;YACrF,CAAC,CAAC,CAAC,CAAC;YACJ,eAAe,CAAC,GAAG,CAAC,IAAI,mBAAmB,CAAC,OAAO,EAAE;gBACpD,SAAS,EAAE,CAAC,CAAC,EAAE;oBACd,MAAM,EAAE,IAAI,EAAE,GAAG,mBAAmB,EAAE,CAAC;oBACvC,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;oBAErC,IAAI,CAAC,IAAI,EAAE;wBACV,OAAO;qBACP;oBAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;gBAChE,CAAC;gBACD,WAAW,EAAE,CAAC,CAAC,EAAE;oBAEhB,IAAI,SAAS,CAAC,WAAW,EAAE;wBAC1B,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBACzE,IAAI,CAAC,IAAI,EAAE;4BACV,OAAO;yBACP;wBAED,IAAI,IAAI,EAAE;4BACT,SAAS,CAAC,WAAW,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;yBAChE;qBACD;gBACF,CAAC;gBACD,WAAW,EAAE,CAAC,CAAC,EAAE;oBAChB,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBACzE,IAAI,CAAC,IAAI,EAAE;wBACV,OAAO;qBACP;oBAED,IAAI,SAAS,CAAC,WAAW,EAAE;wBAC1B,SAAS,CAAC,WAAW,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;qBAChE;gBACF,CAAC;gBACD,MAAM,EAAE,CAAC,CAAC,EAAE;oBACX,IAAI,SAAS,CAAC,MAAM,EAAE;wBACrB,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBAEzE,IAAI,CAAC,IAAI,EAAE;4BACV,OAAO;yBACP;wBACD,SAAS,CAAC,MAAM,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;wBAE3D,oEAAoE;wBACpE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;qBAC/D;gBACF,CAAC;gBACD,UAAU,EAAE,CAAC,CAAC,EAAE;oBACf,IAAI,SAAS,CAAC,UAAU,EAAE;wBACzB,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBACzE,IAAI,CAAC,IAAI,EAAE;4BACV,OAAO;yBACP;wBAED,SAAS,CAAC,UAAU,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,eAAe,EAAE,IAAK,EAAE,CAAC,CAAC;qBAC/D;gBACF,CAAC;aACD,CAAC,CAAC,CAAC;YACJ,IAAI,SAAS,CAAC,WAAW,EAAE;gBAC1B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;oBAC3B,SAAS,CAAC,WAAY,CAAC,CAAC,CAAC,CAAC;gBAC3B,CAAC,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;aAC1B;YACD,IAAI,SAAS,CAAC,SAAS,EAAE;gBACxB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;oBACzB,SAAS,CAAC,SAAU,CAAC,CAAC,CAAC,CAAC;gBACzB,CAAC,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;aAC1B;YACD,OAAO,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;QACxC,CAAC;KACD;IAlLD,oEAkLC;IAED,SAAgB,gBAAgB,CAAC,YAAiC,EAAE,UAA6C,EAAE,YAAqB;QACvI,IAAI,CAAC,YAAY,EAAE;YAClB,OAAO;SACP;QAED,YAAY,CAAC,UAAU,GAAG,YAAY,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC;IAC9D,CAAC;IAND,4CAMC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { hasWorkspaceFileExtension, IWorkspaceFolderCreationData, IRecentFile, IWorkspacesService } from 'vs/platform/workspaces/common/workspaces';\nimport { normalize } from 'vs/base/common/path';\nimport { basename, isEqual } from 'vs/base/common/resources';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IWindowOpenable } from 'vs/platform/windows/common/windows';\nimport { URI } from 'vs/base/common/uri';\nimport { ITextFileService } from 'vs/workbench/services/textfile/common/textfiles';\nimport { bufferToReadable, VSBuffer } from 'vs/base/common/buffer';\nimport { FileAccess, Schemas } from 'vs/base/common/network';\nimport { ITextEditorOptions } from 'vs/platform/editor/common/editor';\nimport { DataTransfers, IDragAndDropData } from 'vs/base/browser/dnd';\nimport { DragMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { normalizeDriveLetter } from 'vs/base/common/labels';\nimport { MIME_BINARY } from 'vs/base/common/mime';\nimport { isWindows } from 'vs/base/common/platform';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { isCodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IEditorIdentifier, GroupIdentifier, IEditorInputFactoryRegistry, EditorExtensions } from 'vs/workbench/common/editor';\nimport { IEditorService, IResourceEditorInputType } from 'vs/workbench/services/editor/common/editorService';\nimport { Disposable, IDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { addDisposableListener, EventType } from 'vs/base/browser/dom';\nimport { IEditorGroup } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IWorkspaceEditingService } from 'vs/workbench/services/workspaces/common/workspaceEditing';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\nimport { IWorkingCopyBackupService } from 'vs/workbench/services/workingCopy/common/workingCopyBackup';\nimport { Emitter } from 'vs/base/common/event';\nimport { NO_TYPE_ID } from 'vs/workbench/services/workingCopy/common/workingCopy';\n\nexport interface IDraggedResource {\n\tresource: URI;\n\tisExternal: boolean;\n}\n\ninterface ISerializedDraggedResource {\n\tresource: string;\n}\n\nexport class DraggedEditorIdentifier {\n\n\tconstructor(public readonly identifier: IEditorIdentifier) { }\n}\n\nexport class DraggedEditorGroupIdentifier {\n\n\tconstructor(public readonly identifier: GroupIdentifier) { }\n}\n\ninterface IDraggedEditorProps {\n\tdirtyContent?: string;\n\tencoding?: string;\n\tmode?: string;\n\toptions?: ITextEditorOptions;\n}\n\nexport interface IDraggedEditor extends IDraggedResource, IDraggedEditorProps { }\n\nexport interface ISerializedDraggedEditor extends ISerializedDraggedResource, IDraggedEditorProps { }\n\nexport const CodeDataTransfers = {\n\tEDITORS: 'CodeEditors',\n\tFILES: 'CodeFiles'\n};\n\nexport function extractResources(e: DragEvent, externalOnly?: boolean): Array<IDraggedResource | IDraggedEditor> {\n\tconst resources: Array<IDraggedResource | IDraggedEditor> = [];\n\tif (e.dataTransfer && e.dataTransfer.types.length > 0) {\n\n\t\t// Check for window-to-window DND\n\t\tif (!externalOnly) {\n\n\t\t\t// Data Transfer: Code Editors\n\t\t\tconst rawEditorsData = e.dataTransfer.getData(CodeDataTransfers.EDITORS);\n\t\t\tif (rawEditorsData) {\n\t\t\t\ttry {\n\t\t\t\t\tconst draggedEditors: ISerializedDraggedEditor[] = JSON.parse(rawEditorsData);\n\t\t\t\t\tdraggedEditors.forEach(draggedEditor => {\n\t\t\t\t\t\tresources.push({\n\t\t\t\t\t\t\tresource: URI.parse(draggedEditor.resource),\n\t\t\t\t\t\t\tdirtyContent: draggedEditor.dirtyContent,\n\t\t\t\t\t\t\toptions: draggedEditor.options,\n\t\t\t\t\t\t\tencoding: draggedEditor.encoding,\n\t\t\t\t\t\t\tmode: draggedEditor.mode,\n\t\t\t\t\t\t\tisExternal: false\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// Invalid transfer\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Data Transfer: Resources\n\t\t\telse {\n\t\t\t\ttry {\n\t\t\t\t\tconst rawResourcesData = e.dataTransfer.getData(DataTransfers.RESOURCES);\n\t\t\t\t\tif (rawResourcesData) {\n\t\t\t\t\t\tconst uriStrArray: string[] = JSON.parse(rawResourcesData);\n\t\t\t\t\t\tresources.push(...uriStrArray.map(uriStr => ({ resource: URI.parse(uriStr), isExternal: false })));\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// Invalid transfer\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check for native file transfer\n\t\tif (e.dataTransfer && e.dataTransfer.files) {\n\t\t\tfor (let i = 0; i < e.dataTransfer.files.length; i++) {\n\t\t\t\tconst file = e.dataTransfer.files[i];\n\t\t\t\tif (file?.path /* Electron only */ && !resources.some(resource => resource.resource.fsPath === file.path) /* prevent duplicates */) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresources.push({ resource: URI.file(file.path), isExternal: true });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t// Invalid URI\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check for CodeFiles transfer\n\t\tconst rawCodeFiles = e.dataTransfer.getData(CodeDataTransfers.FILES);\n\t\tif (rawCodeFiles) {\n\t\t\ttry {\n\t\t\t\tconst codeFiles: string[] = JSON.parse(rawCodeFiles);\n\t\t\t\tcodeFiles.forEach(codeFile => {\n\t\t\t\t\tif (!resources.some(resource => resource.resource.fsPath === codeFile) /* prevent duplicates */) {\n\t\t\t\t\t\tresources.push({ resource: URI.file(codeFile), isExternal: true });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\t// Invalid transfer\n\t\t\t}\n\t\t}\n\t}\n\n\treturn resources;\n}\n\nexport interface IResourcesDropHandlerOptions {\n\n\t/**\n\t * Whether to open the actual workspace when a workspace configuration file is dropped\n\t * or whether to open the configuration file within the editor as normal file.\n\t */\n\tallowWorkspaceOpen: boolean;\n}\n\n/**\n * Shared function across some components to handle drag & drop of resources. E.g. of folders and workspace files\n * to open them in the window instead of the editor or to handle dirty editors being dropped between instances of Code.\n */\nexport class ResourcesDropHandler {\n\n\tconstructor(\n\t\tprivate options: IResourcesDropHandlerOptions,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkspacesService private readonly workspacesService: IWorkspacesService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IWorkingCopyBackupService private readonly workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IWorkspaceEditingService private readonly workspaceEditingService: IWorkspaceEditingService,\n\t\t@IHostService private readonly hostService: IHostService\n\t) {\n\t}\n\n\tasync handleDrop(event: DragEvent, resolveTargetGroup: () => IEditorGroup | undefined, afterDrop: (targetGroup: IEditorGroup | undefined) => void, targetIndex?: number): Promise<void> {\n\t\tconst untitledOrFileResources = extractResources(event).filter(resource => this.fileService.canHandleResource(resource.resource) || resource.resource.scheme === Schemas.untitled);\n\t\tif (!untitledOrFileResources.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make the window active to handle the drop properly within\n\t\tawait this.hostService.focus();\n\n\t\t// Check for special things being dropped\n\t\tconst isWorkspaceOpening = await this.doHandleDrop(untitledOrFileResources);\n\t\tif (isWorkspaceOpening) {\n\t\t\treturn; // return early if the drop operation resulted in this window changing to a workspace\n\t\t}\n\n\t\t// Add external ones to recently open list unless dropped resource is a workspace\n\t\tconst recentFiles: IRecentFile[] = untitledOrFileResources.filter(untitledOrFileResource => untitledOrFileResource.isExternal && untitledOrFileResource.resource.scheme === Schemas.file).map(d => ({ fileUri: d.resource }));\n\t\tif (recentFiles.length) {\n\t\t\tthis.workspacesService.addRecentlyOpened(recentFiles);\n\t\t}\n\n\t\tconst editors: IResourceEditorInputType[] = untitledOrFileResources.map(untitledOrFileResource => ({\n\t\t\tresource: untitledOrFileResource.resource,\n\t\t\tencoding: (untitledOrFileResource as IDraggedEditor).encoding,\n\t\t\tmode: (untitledOrFileResource as IDraggedEditor).mode,\n\t\t\toptions: {\n\t\t\t\t...(untitledOrFileResource as IDraggedEditor).options,\n\t\t\t\tpinned: true,\n\t\t\t\tindex: targetIndex\n\t\t\t}\n\t\t}));\n\n\t\t// Open in Editor\n\t\tconst targetGroup = resolveTargetGroup();\n\t\tawait this.editorService.openEditors(editors, targetGroup);\n\n\t\t// Finish with provided function\n\t\tafterDrop(targetGroup);\n\t}\n\n\tprivate async doHandleDrop(untitledOrFileResources: Array<IDraggedResource | IDraggedEditor>): Promise<boolean> {\n\n\t\t// Check for dirty editors being dropped\n\t\tconst dirtyEditors: IDraggedEditor[] = untitledOrFileResources.filter(untitledOrFileResource => !untitledOrFileResource.isExternal && typeof (untitledOrFileResource as IDraggedEditor).dirtyContent === 'string');\n\t\tif (dirtyEditors.length > 0) {\n\t\t\tawait Promise.all(dirtyEditors.map(dirtyEditor => this.handleDirtyEditorDrop(dirtyEditor)));\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check for workspace file being dropped if we are allowed to do so\n\t\tif (this.options.allowWorkspaceOpen) {\n\t\t\tconst externalFileOnDiskResources = untitledOrFileResources.filter(untitledOrFileResource => untitledOrFileResource.isExternal && untitledOrFileResource.resource.scheme === Schemas.file).map(d => d.resource);\n\t\t\tif (externalFileOnDiskResources.length > 0) {\n\t\t\t\treturn this.handleWorkspaceFileDrop(externalFileOnDiskResources);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate async handleDirtyEditorDrop(droppedDirtyEditor: IDraggedEditor): Promise<boolean> {\n\t\tconst fileEditorFactory = Registry.as<IEditorInputFactoryRegistry>(EditorExtensions.EditorInputFactories).getFileEditorInputFactory();\n\n\t\t// Untitled: always ensure that we open a new untitled editor for each file we drop\n\t\tif (droppedDirtyEditor.resource.scheme === Schemas.untitled) {\n\t\t\tconst untitledEditorResource = this.editorService.createEditorInput({ mode: droppedDirtyEditor.mode, encoding: droppedDirtyEditor.encoding, forceUntitled: true }).resource;\n\t\t\tif (untitledEditorResource) {\n\t\t\t\tdroppedDirtyEditor.resource = untitledEditorResource;\n\t\t\t}\n\t\t}\n\n\t\t// File: ensure the file is not dirty or opened already\n\t\telse if (this.textFileService.isDirty(droppedDirtyEditor.resource) || this.editorService.isOpened({ resource: droppedDirtyEditor.resource, typeId: fileEditorFactory.typeId })) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If the dropped editor is dirty with content we simply take that\n\t\t// content and turn it into a backup so that it loads the contents\n\t\tif (typeof droppedDirtyEditor.dirtyContent === 'string') {\n\t\t\ttry {\n\t\t\t\tawait this.workingCopyBackupService.backup({ resource: droppedDirtyEditor.resource, typeId: NO_TYPE_ID }, bufferToReadable(VSBuffer.fromString(droppedDirtyEditor.dirtyContent)));\n\t\t\t} catch (e) {\n\t\t\t\t// Ignore error\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate async handleWorkspaceFileDrop(fileOnDiskResources: URI[]): Promise<boolean> {\n\t\tconst toOpen: IWindowOpenable[] = [];\n\t\tconst folderURIs: IWorkspaceFolderCreationData[] = [];\n\n\t\tawait Promise.all(fileOnDiskResources.map(async fileOnDiskResource => {\n\n\t\t\t// Check for Workspace\n\t\t\tif (hasWorkspaceFileExtension(fileOnDiskResource)) {\n\t\t\t\ttoOpen.push({ workspaceUri: fileOnDiskResource });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check for Folder\n\t\t\ttry {\n\t\t\t\tconst stat = await this.fileService.resolve(fileOnDiskResource);\n\t\t\t\tif (stat.isDirectory) {\n\t\t\t\t\ttoOpen.push({ folderUri: stat.resource });\n\t\t\t\t\tfolderURIs.push({ uri: stat.resource });\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Ignore error\n\t\t\t}\n\t\t}));\n\n\t\t// Return early if no external resource is a folder or workspace\n\t\tif (toOpen.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Pass focus to window\n\t\tthis.hostService.focus();\n\n\t\t// Open in separate windows if we drop workspaces or just one folder\n\t\tif (toOpen.length > folderURIs.length || folderURIs.length === 1) {\n\t\t\tawait this.hostService.openWindow(toOpen);\n\t\t}\n\n\t\t// folders.length > 1: Multiple folders: Create new workspace with folders and open\n\t\telse {\n\t\t\tawait this.workspaceEditingService.createAndEnterWorkspace(folderURIs);\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nexport function fillResourceDataTransfers(accessor: ServicesAccessor, resources: (URI | { resource: URI, isDirectory: boolean })[], optionsCallback: ((resource: URI) => ITextEditorOptions) | undefined, event: DragMouseEvent | DragEvent): void {\n\tif (resources.length === 0 || !event.dataTransfer) {\n\t\treturn;\n\t}\n\n\tconst sources = resources.map(obj => {\n\t\tif (URI.isUri(obj)) {\n\t\t\treturn { resource: obj, isDirectory: false /* assume resource is not a directory */ };\n\t\t}\n\n\t\treturn obj;\n\t});\n\n\t// Text: allows to paste into text-capable areas\n\tconst lineDelimiter = isWindows ? '\\r\\n' : '\\n';\n\tevent.dataTransfer.setData(DataTransfers.TEXT, sources.map(source => source.resource.scheme === Schemas.file ? normalize(normalizeDriveLetter(source.resource.fsPath)) : source.resource.toString()).join(lineDelimiter));\n\n\t// Download URL: enables support to drag a tab as file to desktop (only single file supported)\n\tif (!sources[0].isDirectory) {\n\t\tevent.dataTransfer.setData(DataTransfers.DOWNLOAD_URL, [MIME_BINARY, basename(sources[0].resource), FileAccess.asBrowserUri(sources[0].resource).toString()].join(':'));\n\t}\n\n\t// Resource URLs: allows to drop multiple resources to a target in VS Code (not directories)\n\tconst files = sources.filter(source => !source.isDirectory);\n\tif (files.length) {\n\t\tevent.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify(files.map(file => file.resource.toString())));\n\t}\n\n\t// Editors: enables cross window DND of tabs into the editor area\n\tconst textFileService = accessor.get(ITextFileService);\n\tconst editorService = accessor.get(IEditorService);\n\n\tconst draggedEditors: ISerializedDraggedEditor[] = [];\n\tfiles.forEach(file => {\n\t\tlet options: ITextEditorOptions | undefined = undefined;\n\n\t\t// Use provided callback for editor options\n\t\tif (typeof optionsCallback === 'function') {\n\t\t\toptions = optionsCallback(file.resource);\n\t\t}\n\n\t\t// Otherwise try to figure out the view state from opened editors that match\n\t\telse {\n\t\t\toptions = {\n\t\t\t\tviewState: (() => {\n\t\t\t\t\tconst textEditorControls = editorService.visibleTextEditorControls;\n\t\t\t\t\tfor (const textEditorControl of textEditorControls) {\n\t\t\t\t\t\tif (isCodeEditor(textEditorControl)) {\n\t\t\t\t\t\t\tconst model = textEditorControl.getModel();\n\t\t\t\t\t\t\tif (isEqual(model?.uri, file.resource)) {\n\t\t\t\t\t\t\t\treturn withNullAsUndefined(textEditorControl.saveViewState());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t})()\n\t\t\t};\n\t\t}\n\n\t\t// Try to find encoding and mode from text model\n\t\tlet encoding: string | undefined = undefined;\n\t\tlet mode: string | undefined = undefined;\n\n\t\tconst model = file.resource.scheme === Schemas.untitled ? textFileService.untitled.get(file.resource) : textFileService.files.get(file.resource);\n\t\tif (model) {\n\t\t\tencoding = model.getEncoding();\n\t\t\tmode = model.getMode();\n\t\t}\n\n\t\t// If the resource is dirty or untitled, send over its content\n\t\t// to restore dirty state. Get that from the text model directly\n\t\tlet dirtyContent: string | undefined = undefined;\n\t\tif (model?.isDirty()) {\n\t\t\tdirtyContent = model.textEditorModel.getValue();\n\t\t}\n\n\t\t// Add as dragged editor\n\t\tdraggedEditors.push({ resource: file.resource.toString(), dirtyContent, options, encoding, mode });\n\t});\n\n\tif (draggedEditors.length) {\n\t\tevent.dataTransfer.setData(CodeDataTransfers.EDITORS, JSON.stringify(draggedEditors));\n\t}\n}\n\n/**\n * A singleton to store transfer data during drag & drop operations that are only valid within the application.\n */\nexport class LocalSelectionTransfer<T> {\n\n\tprivate static readonly INSTANCE = new LocalSelectionTransfer();\n\n\tprivate data?: T[];\n\tprivate proto?: T;\n\n\tprivate constructor() {\n\t\t// protect against external instantiation\n\t}\n\n\tstatic getInstance<T>(): LocalSelectionTransfer<T> {\n\t\treturn LocalSelectionTransfer.INSTANCE as LocalSelectionTransfer<T>;\n\t}\n\n\thasData(proto: T): boolean {\n\t\treturn proto && proto === this.proto;\n\t}\n\n\tclearData(proto: T): void {\n\t\tif (this.hasData(proto)) {\n\t\t\tthis.proto = undefined;\n\t\t\tthis.data = undefined;\n\t\t}\n\t}\n\n\tgetData(proto: T): T[] | undefined {\n\t\tif (this.hasData(proto)) {\n\t\t\treturn this.data;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tsetData(data: T[], proto: T): void {\n\t\tif (proto) {\n\t\t\tthis.data = data;\n\t\t\tthis.proto = proto;\n\t\t}\n\t}\n}\n\nexport interface IDragAndDropObserverCallbacks {\n\tonDragEnter: (e: DragEvent) => void;\n\tonDragLeave: (e: DragEvent) => void;\n\tonDrop: (e: DragEvent) => void;\n\tonDragEnd: (e: DragEvent) => void;\n\n\tonDragOver?: (e: DragEvent) => void;\n}\n\nexport class DragAndDropObserver extends Disposable {\n\n\t// A helper to fix issues with repeated DRAG_ENTER / DRAG_LEAVE\n\t// calls see https://github.com/microsoft/vscode/issues/14470\n\t// when the element has child elements where the events are fired\n\t// repeadedly.\n\tprivate counter: number = 0;\n\n\tconstructor(private element: HTMLElement, private callbacks: IDragAndDropObserverCallbacks) {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(addDisposableListener(this.element, EventType.DRAG_ENTER, (e: DragEvent) => {\n\t\t\tthis.counter++;\n\n\t\t\tthis.callbacks.onDragEnter(e);\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element, EventType.DRAG_OVER, (e: DragEvent) => {\n\t\t\te.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n\t\t\tif (this.callbacks.onDragOver) {\n\t\t\t\tthis.callbacks.onDragOver(e);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element, EventType.DRAG_LEAVE, (e: DragEvent) => {\n\t\t\tthis.counter--;\n\n\t\t\tif (this.counter === 0) {\n\t\t\t\tthis.callbacks.onDragLeave(e);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element, EventType.DRAG_END, (e: DragEvent) => {\n\t\t\tthis.counter = 0;\n\t\t\tthis.callbacks.onDragEnd(e);\n\t\t}));\n\n\t\tthis._register(addDisposableListener(this.element, EventType.DROP, (e: DragEvent) => {\n\t\t\tthis.counter = 0;\n\t\t\tthis.callbacks.onDrop(e);\n\t\t}));\n\t}\n}\n\nexport function containsDragType(event: DragEvent, ...dragTypesToFind: string[]): boolean {\n\tif (!event.dataTransfer) {\n\t\treturn false;\n\t}\n\n\tconst dragTypes = event.dataTransfer.types;\n\tconst lowercaseDragTypes: string[] = [];\n\tfor (let i = 0; i < dragTypes.length; i++) {\n\t\tlowercaseDragTypes.push(dragTypes[i].toLowerCase()); // somehow the types are lowercase\n\t}\n\n\tfor (const dragType of dragTypesToFind) {\n\t\tif (lowercaseDragTypes.indexOf(dragType.toLowerCase()) >= 0) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport type Before2D = { verticallyBefore: boolean; horizontallyBefore: boolean; };\n\nexport interface ICompositeDragAndDrop {\n\tdrop(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent, before?: Before2D): void;\n\tonDragOver(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent): boolean;\n\tonDragEnter(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent): boolean;\n}\n\nexport interface ICompositeDragAndDropObserverCallbacks {\n\tonDragEnter?: (e: IDraggedCompositeData) => void;\n\tonDragLeave?: (e: IDraggedCompositeData) => void;\n\tonDrop?: (e: IDraggedCompositeData) => void;\n\tonDragOver?: (e: IDraggedCompositeData) => void;\n\tonDragStart?: (e: IDraggedCompositeData) => void;\n\tonDragEnd?: (e: IDraggedCompositeData) => void;\n}\n\nexport class CompositeDragAndDropData implements IDragAndDropData {\n\tconstructor(private type: 'view' | 'composite', private id: string) { }\n\tupdate(dataTransfer: DataTransfer): void {\n\t\t// no-op\n\t}\n\tgetData(): {\n\t\ttype: 'view' | 'composite';\n\t\tid: string;\n\t} {\n\t\treturn { type: this.type, id: this.id };\n\t}\n}\n\nexport interface IDraggedCompositeData {\n\teventData: DragEvent;\n\tdragAndDropData: CompositeDragAndDropData;\n}\n\nexport class DraggedCompositeIdentifier {\n\tconstructor(private _compositeId: string) { }\n\n\tget id(): string {\n\t\treturn this._compositeId;\n\t}\n}\n\nexport class DraggedViewIdentifier {\n\tconstructor(private _viewId: string) { }\n\n\tget id(): string {\n\t\treturn this._viewId;\n\t}\n}\n\nexport type ViewType = 'composite' | 'view';\n\nexport class CompositeDragAndDropObserver extends Disposable {\n\tprivate transferData: LocalSelectionTransfer<DraggedCompositeIdentifier | DraggedViewIdentifier>;\n\tprivate _onDragStart = this._register(new Emitter<IDraggedCompositeData>());\n\tprivate _onDragEnd = this._register(new Emitter<IDraggedCompositeData>());\n\tprivate static _instance: CompositeDragAndDropObserver | undefined;\n\tstatic get INSTANCE(): CompositeDragAndDropObserver {\n\t\tif (!CompositeDragAndDropObserver._instance) {\n\t\t\tCompositeDragAndDropObserver._instance = new CompositeDragAndDropObserver();\n\t\t}\n\t\treturn CompositeDragAndDropObserver._instance;\n\t}\n\tprivate constructor() {\n\t\tsuper();\n\t\tthis.transferData = LocalSelectionTransfer.getInstance<DraggedCompositeIdentifier | DraggedViewIdentifier>();\n\n\t\tthis._register(this._onDragEnd.event(e => {\n\t\t\tconst id = e.dragAndDropData.getData().id;\n\t\t\tconst type = e.dragAndDropData.getData().type;\n\t\t\tconst data = this.readDragData(type);\n\t\t\tif (data?.getData().id === id) {\n\t\t\t\tthis.transferData.clearData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t\t\t}\n\t\t}));\n\t}\n\tprivate readDragData(type: ViewType): CompositeDragAndDropData | undefined {\n\t\tif (this.transferData.hasData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype)) {\n\t\t\tconst data = this.transferData.getData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t\t\tif (data && data[0]) {\n\t\t\t\treturn new CompositeDragAndDropData(type, data[0].id);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\tprivate writeDragData(id: string, type: ViewType): void {\n\t\tthis.transferData.setData([type === 'view' ? new DraggedViewIdentifier(id) : new DraggedCompositeIdentifier(id)], type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t}\n\tregisterTarget(element: HTMLElement, callbacks: ICompositeDragAndDropObserverCallbacks): IDisposable {\n\t\tconst disposableStore = new DisposableStore();\n\t\tdisposableStore.add(new DragAndDropObserver(element, {\n\t\t\tonDragEnd: e => {\n\t\t\t\t// no-op\n\t\t\t},\n\t\t\tonDragEnter: e => {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (callbacks.onDragEnter) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tcallbacks.onDragEnter({ eventData: e, dragAndDropData: data! });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: e => {\n\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\tif (callbacks.onDragLeave && data) {\n\t\t\t\t\tcallbacks.onDragLeave({ eventData: e, dragAndDropData: data! });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDrop: e => {\n\t\t\t\tif (callbacks.onDrop) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDrop({ eventData: e, dragAndDropData: data! });\n\n\t\t\t\t\t// Fire drag event in case drop handler destroys the dragged element\n\t\t\t\t\tthis._onDragEnd.fire({ eventData: e, dragAndDropData: data! });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragOver: e => {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (callbacks.onDragOver) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDragOver({ eventData: e, dragAndDropData: data! });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t\tif (callbacks.onDragStart) {\n\t\t\tthis._onDragStart.event(e => {\n\t\t\t\tcallbacks.onDragStart!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\t\tif (callbacks.onDragEnd) {\n\t\t\tthis._onDragEnd.event(e => {\n\t\t\t\tcallbacks.onDragEnd!(e);\n\t\t\t});\n\t\t}\n\t\treturn this._register(disposableStore);\n\t}\n\n\tregisterDraggable(element: HTMLElement, draggedItemProvider: () => { type: ViewType, id: string }, callbacks: ICompositeDragAndDropObserverCallbacks): IDisposable {\n\t\telement.draggable = true;\n\t\tconst disposableStore = new DisposableStore();\n\t\tdisposableStore.add(addDisposableListener(element, EventType.DRAG_START, e => {\n\t\t\tconst { id, type } = draggedItemProvider();\n\t\t\tthis.writeDragData(id, type);\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\te.dataTransfer.setDragImage(element, 0, 0);\n\t\t\t}\n\n\t\t\tthis._onDragStart.fire({ eventData: e, dragAndDropData: this.readDragData(type)! });\n\t\t}));\n\t\tdisposableStore.add(new DragAndDropObserver(element, {\n\t\t\tonDragEnd: e => {\n\t\t\t\tconst { type } = draggedItemProvider();\n\t\t\t\tconst data = this.readDragData(type);\n\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._onDragEnd.fire({ eventData: e, dragAndDropData: data! });\n\t\t\t},\n\t\t\tonDragEnter: e => {\n\n\t\t\t\tif (callbacks.onDragEnter) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tcallbacks.onDragEnter({ eventData: e, dragAndDropData: data! });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: e => {\n\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (callbacks.onDragLeave) {\n\t\t\t\t\tcallbacks.onDragLeave({ eventData: e, dragAndDropData: data! });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDrop: e => {\n\t\t\t\tif (callbacks.onDrop) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcallbacks.onDrop({ eventData: e, dragAndDropData: data! });\n\n\t\t\t\t\t// Fire drag event in case drop handler destroys the dragged element\n\t\t\t\t\tthis._onDragEnd.fire({ eventData: e, dragAndDropData: data! });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragOver: e => {\n\t\t\t\tif (callbacks.onDragOver) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDragOver({ eventData: e, dragAndDropData: data! });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t\tif (callbacks.onDragStart) {\n\t\t\tthis._onDragStart.event(e => {\n\t\t\t\tcallbacks.onDragStart!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\t\tif (callbacks.onDragEnd) {\n\t\t\tthis._onDragEnd.event(e => {\n\t\t\t\tcallbacks.onDragEnd!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\t\treturn this._register(disposableStore);\n\t}\n}\n\nexport function toggleDropEffect(dataTransfer: DataTransfer | null, dropEffect: 'none' | 'copy' | 'link' | 'move', shouldHaveIt: boolean) {\n\tif (!dataTransfer) {\n\t\treturn;\n\t}\n\n\tdataTransfer.dropEffect = shouldHaveIt ? dropEffect : 'none';\n}\n"]}