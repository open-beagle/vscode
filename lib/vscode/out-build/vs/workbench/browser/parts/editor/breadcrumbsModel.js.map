{"version":3,"file":"breadcrumbsModel.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/browser/parts/editor/breadcrumbsModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { DisposableStore, MutableDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { isEqual, dirname } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { IWorkspaceContextService, IWorkspaceFolder, WorkbenchState } from 'vs/platform/workspace/common/workspace';\nimport { Schemas } from 'vs/base/common/network';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { BreadcrumbsConfig } from 'vs/workbench/browser/parts/editor/breadcrumbs';\nimport { FileKind } from 'vs/platform/files/common/files';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { IOutline, IOutlineService, OutlineTarget } from 'vs/workbench/services/outline/browser/outline';\nimport { IEditorPane } from 'vs/workbench/common/editor';\n\nexport class FileElement {\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly kind: FileKind\n\t) { }\n}\n\ntype FileInfo = { path: FileElement[], folder?: IWorkspaceFolder };\n\nexport class OutlineElement2 {\n\tconstructor(\n\t\treadonly element: IOutline<any> | any,\n\t\treadonly outline: IOutline<any>\n\t) { }\n}\n\nexport class BreadcrumbsModel {\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _fileInfo: FileInfo;\n\n\tprivate readonly _cfgEnabled: BreadcrumbsConfig<boolean>;\n\tprivate readonly _cfgFilePath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\tprivate readonly _cfgSymbolPath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\n\tprivate readonly _currentOutline = new MutableDisposable<IOutline<any>>();\n\tprivate readonly _outlineDisposables = new DisposableStore();\n\n\tprivate readonly _onDidUpdate = new Emitter<this>();\n\treadonly onDidUpdate: Event<this> = this._onDidUpdate.event;\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\teditor: IEditorPane | undefined,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly _workspaceService: IWorkspaceContextService,\n\t\t@IOutlineService private readonly _outlineService: IOutlineService,\n\t) {\n\t\tthis._cfgEnabled = BreadcrumbsConfig.IsEnabled.bindTo(configurationService);\n\t\tthis._cfgFilePath = BreadcrumbsConfig.FilePath.bindTo(configurationService);\n\t\tthis._cfgSymbolPath = BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n\n\t\tthis._disposables.add(this._cfgFilePath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._disposables.add(this._cfgSymbolPath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._fileInfo = this._initFilePathInfo(resource);\n\n\t\tif (editor) {\n\t\t\tthis._bindToEditor(editor);\n\t\t\tthis._disposables.add(_outlineService.onDidChange(() => this._bindToEditor(editor)));\n\t\t}\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tdispose(): void {\n\t\tthis._cfgEnabled.dispose();\n\t\tthis._cfgFilePath.dispose();\n\t\tthis._cfgSymbolPath.dispose();\n\t\tthis._currentOutline.dispose();\n\t\tthis._outlineDisposables.dispose();\n\t\tthis._disposables.dispose();\n\t\tthis._onDidUpdate.dispose();\n\t}\n\n\tisRelative(): boolean {\n\t\treturn Boolean(this._fileInfo.folder);\n\t}\n\n\tgetElements(): ReadonlyArray<FileElement | OutlineElement2> {\n\t\tlet result: (FileElement | OutlineElement2)[] = [];\n\n\t\t// file path elements\n\t\tif (this._cfgFilePath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._fileInfo.path);\n\t\t} else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n\t\t\tresult = result.concat(this._fileInfo.path.slice(-1));\n\t\t}\n\n\t\tif (this._cfgSymbolPath.getValue() === 'off') {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (!this._currentOutline.value) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst breadcrumbsElements = this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();\n\t\tfor (let i = this._cfgSymbolPath.getValue() === 'last' && breadcrumbsElements.length > 0 ? breadcrumbsElements.length - 1 : 0; i < breadcrumbsElements.length; i++) {\n\t\t\tresult.push(new OutlineElement2(breadcrumbsElements[i], this._currentOutline.value));\n\t\t}\n\n\t\tif (breadcrumbsElements.length === 0 && !this._currentOutline.value.isEmpty) {\n\t\t\tresult.push(new OutlineElement2(this._currentOutline.value, this._currentOutline.value));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _initFilePathInfo(uri: URI): FileInfo {\n\n\t\tif (uri.scheme === Schemas.untitled) {\n\t\t\treturn {\n\t\t\t\tfolder: undefined,\n\t\t\t\tpath: []\n\t\t\t};\n\t\t}\n\n\t\tlet info: FileInfo = {\n\t\t\tfolder: withNullAsUndefined(this._workspaceService.getWorkspaceFolder(uri)),\n\t\t\tpath: []\n\t\t};\n\n\t\tlet uriPrefix: URI | null = uri;\n\t\twhile (uriPrefix && uriPrefix.path !== '/') {\n\t\t\tif (info.folder && isEqual(info.folder.uri, uriPrefix)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinfo.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? FileKind.FILE : FileKind.FOLDER));\n\t\t\tlet prevPathLength = uriPrefix.path.length;\n\t\t\turiPrefix = dirname(uriPrefix);\n\t\t\tif (uriPrefix.path.length === prevPathLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (info.folder && this._workspaceService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tinfo.path.unshift(new FileElement(info.folder.uri, FileKind.ROOT_FOLDER));\n\t\t}\n\t\treturn info;\n\t}\n\n\tprivate _bindToEditor(editor: IEditorPane): void {\n\t\tconst newCts = new CancellationTokenSource();\n\t\tthis._currentOutline.clear();\n\t\tthis._outlineDisposables.clear();\n\t\tthis._outlineDisposables.add(toDisposable(() => newCts.dispose(true)));\n\n\t\tthis._outlineService.createOutline(editor, OutlineTarget.Breadcrumbs, newCts.token).then(outline => {\n\t\t\tif (newCts.token.isCancellationRequested) {\n\t\t\t\t// cancelled: dispose new outline and reset\n\t\t\t\toutline?.dispose();\n\t\t\t\toutline = undefined;\n\t\t\t}\n\t\t\tthis._currentOutline.value = outline;\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tif (outline) {\n\t\t\t\tthis._outlineDisposables.add(outline.onDidChange(() => this._onDidUpdate.fire(this)));\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n}\n"]}