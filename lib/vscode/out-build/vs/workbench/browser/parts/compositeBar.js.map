{"version":3,"sources":["vs/workbench/browser/parts/compositeBar.ts"],"names":[],"mappings":"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","file":"compositeBar.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { IAction, toAction } from 'vs/base/common/actions';\nimport { illegalArgument } from 'vs/base/common/errors';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { IBadge } from 'vs/workbench/services/activity/common/activity';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ActionBar, ActionsOrientation } from 'vs/base/browser/ui/actionbar/actionbar';\nimport { CompositeActionViewItem, CompositeOverflowActivityAction, ICompositeActivity, CompositeOverflowActivityActionViewItem, ActivityAction, ICompositeBar, ICompositeBarColors, IActivityHoverOptions } from 'vs/workbench/browser/parts/compositeBarActions';\nimport { Dimension, $, addDisposableListener, EventType, EventHelper, isAncestor } from 'vs/base/browser/dom';\nimport { StandardMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { Widget } from 'vs/base/browser/ui/widget';\nimport { isUndefinedOrNull } from 'vs/base/common/types';\nimport { IColorTheme } from 'vs/platform/theme/common/themeService';\nimport { Emitter } from 'vs/base/common/event';\nimport { ViewContainerLocation, IViewDescriptorService } from 'vs/workbench/common/views';\nimport { IPaneComposite } from 'vs/workbench/common/panecomposite';\nimport { IComposite } from 'vs/workbench/common/composite';\nimport { CompositeDragAndDropData, CompositeDragAndDropObserver, IDraggedCompositeData, ICompositeDragAndDrop, Before2D, toggleDropEffect } from 'vs/workbench/browser/dnd';\n\nexport interface ICompositeBarItem {\n\tid: string;\n\tname?: string;\n\tpinned: boolean;\n\torder?: number;\n\tvisible: boolean;\n}\n\nexport class CompositeDragAndDrop implements ICompositeDragAndDrop {\n\n\tconstructor(\n\t\tprivate viewDescriptorService: IViewDescriptorService,\n\t\tprivate targetContainerLocation: ViewContainerLocation,\n\t\tprivate openComposite: (id: string, focus?: boolean) => Promise<IPaneComposite | null>,\n\t\tprivate moveComposite: (from: string, to: string, before?: Before2D) => void,\n\t\tprivate getItems: () => ICompositeBarItem[],\n\t) { }\n\n\tdrop(data: CompositeDragAndDropData, targetCompositeId: string | undefined, originalEvent: DragEvent, before?: Before2D): void {\n\t\tconst dragData = data.getData();\n\n\t\tif (dragData.type === 'composite') {\n\t\t\tconst currentContainer = this.viewDescriptorService.getViewContainerById(dragData.id)!;\n\t\t\tconst currentLocation = this.viewDescriptorService.getViewContainerLocation(currentContainer);\n\n\t\t\t// ... on the same composite bar\n\t\t\tif (currentLocation === this.targetContainerLocation) {\n\t\t\t\tif (targetCompositeId) {\n\t\t\t\t\tthis.moveComposite(dragData.id, targetCompositeId, before);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// ... on a different composite bar\n\t\t\telse {\n\t\t\t\tconst viewsToMove = this.viewDescriptorService.getViewContainerModel(currentContainer)!.allViewDescriptors;\n\t\t\t\tif (viewsToMove.some(v => !v.canMoveView)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.viewDescriptorService.moveViewContainerToLocation(currentContainer, this.targetContainerLocation, this.getTargetIndex(targetCompositeId, before));\n\t\t\t}\n\t\t}\n\n\t\tif (dragData.type === 'view') {\n\t\t\tconst viewToMove = this.viewDescriptorService.getViewDescriptorById(dragData.id)!;\n\n\t\t\tif (viewToMove && viewToMove.canMoveView) {\n\t\t\t\tthis.viewDescriptorService.moveViewToLocation(viewToMove, this.targetContainerLocation);\n\n\t\t\t\tconst newContainer = this.viewDescriptorService.getViewContainerByViewId(viewToMove.id)!;\n\n\t\t\t\tif (targetCompositeId) {\n\t\t\t\t\tthis.moveComposite(newContainer.id, targetCompositeId, before);\n\t\t\t\t}\n\n\t\t\t\tthis.openComposite(newContainer.id, true).then(composite => {\n\t\t\t\t\tif (composite) {\n\t\t\t\t\t\tcomposite.openView(viewToMove.id, true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tonDragEnter(data: CompositeDragAndDropData, targetCompositeId: string | undefined, originalEvent: DragEvent): boolean {\n\t\treturn this.canDrop(data, targetCompositeId);\n\t}\n\n\tonDragOver(data: CompositeDragAndDropData, targetCompositeId: string | undefined, originalEvent: DragEvent): boolean {\n\t\treturn this.canDrop(data, targetCompositeId);\n\t}\n\n\tprivate getTargetIndex(targetId: string | undefined, before2d: Before2D | undefined): number | undefined {\n\t\tif (!targetId) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst items = this.getItems();\n\t\tconst before = this.targetContainerLocation === ViewContainerLocation.Panel ? before2d?.horizontallyBefore : before2d?.verticallyBefore;\n\t\treturn items.filter(o => o.visible).findIndex(o => o.id === targetId) + (before ? 0 : 1);\n\t}\n\n\tprivate canDrop(data: CompositeDragAndDropData, targetCompositeId: string | undefined): boolean {\n\t\tconst dragData = data.getData();\n\n\t\tif (dragData.type === 'composite') {\n\t\t\t// Dragging a composite\n\t\t\tconst currentContainer = this.viewDescriptorService.getViewContainerById(dragData.id)!;\n\t\t\tconst currentLocation = this.viewDescriptorService.getViewContainerLocation(currentContainer);\n\n\t\t\t// ... to the same composite location\n\t\t\tif (currentLocation === this.targetContainerLocation) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// ... to another composite location\n\t\t\tconst draggedViews = this.viewDescriptorService.getViewContainerModel(currentContainer)!.allViewDescriptors;\n\n\t\t\t// ... all views must be movable\n\t\t\treturn !draggedViews.some(v => !v.canMoveView);\n\t\t} else {\n\t\t\t// Dragging an individual view\n\t\t\tconst viewDescriptor = this.viewDescriptorService.getViewDescriptorById(dragData.id);\n\n\t\t\t// ... that cannot move\n\t\t\tif (!viewDescriptor || !viewDescriptor.canMoveView) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// ... to create a view container\n\t\t\treturn true;\n\t\t}\n\t}\n}\n\nexport interface ICompositeBarOptions {\n\n\treadonly icon: boolean;\n\treadonly orientation: ActionsOrientation;\n\treadonly colors: (theme: IColorTheme) => ICompositeBarColors;\n\treadonly compositeSize: number;\n\treadonly overflowActionSize: number;\n\treadonly dndHandler: ICompositeDragAndDrop;\n\treadonly activityHoverOptions: IActivityHoverOptions;\n\treadonly preventLoopNavigation?: boolean;\n\n\tgetActivityAction: (compositeId: string) => ActivityAction;\n\tgetCompositePinnedAction: (compositeId: string) => IAction;\n\tgetOnCompositeClickAction: (compositeId: string) => IAction;\n\tfillExtraContextMenuActions: (actions: IAction[]) => void;\n\tgetContextMenuActionsForComposite: (compositeId: string) => IAction[];\n\topenComposite: (compositeId: string) => Promise<IComposite | null>;\n\tgetDefaultCompositeId: () => string;\n\thidePart: () => void;\n}\n\nexport class CompositeBar extends Widget implements ICompositeBar {\n\n\tprivate readonly _onDidChange = this._register(new Emitter<void>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate dimension: Dimension | undefined;\n\n\tprivate compositeSwitcherBar: ActionBar | undefined;\n\tprivate compositeOverflowAction: CompositeOverflowActivityAction | undefined;\n\tprivate compositeOverflowActionViewItem: CompositeOverflowActivityActionViewItem | undefined;\n\n\tprivate model: CompositeBarModel;\n\tprivate visibleComposites: string[];\n\tprivate compositeSizeInBar: Map<string, number>;\n\n\tconstructor(\n\t\titems: ICompositeBarItem[],\n\t\tprivate readonly options: ICompositeBarOptions,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService\n\t) {\n\t\tsuper();\n\n\t\tthis.model = new CompositeBarModel(items, options);\n\t\tthis.visibleComposites = [];\n\t\tthis.compositeSizeInBar = new Map<string, number>();\n\t\tthis.computeSizes(this.model.visibleItems);\n\t}\n\n\tgetCompositeBarItems(): ICompositeBarItem[] {\n\t\treturn [...this.model.items];\n\t}\n\n\tsetCompositeBarItems(items: ICompositeBarItem[]): void {\n\t\tif (this.model.setItems(items)) {\n\t\t\tthis.updateCompositeSwitcher();\n\t\t}\n\t}\n\n\tgetPinnedComposites(): ICompositeBarItem[] {\n\t\treturn this.model.pinnedItems;\n\t}\n\n\tgetVisibleComposites(): ICompositeBarItem[] {\n\t\treturn this.model.visibleItems;\n\t}\n\n\tcreate(parent: HTMLElement): HTMLElement {\n\t\tconst actionBarDiv = parent.appendChild($('.composite-bar'));\n\t\tthis.compositeSwitcherBar = this._register(new ActionBar(actionBarDiv, {\n\t\t\tactionViewItemProvider: action => {\n\t\t\t\tif (action instanceof CompositeOverflowActivityAction) {\n\t\t\t\t\treturn this.compositeOverflowActionViewItem;\n\t\t\t\t}\n\t\t\t\tconst item = this.model.findItem(action.id);\n\t\t\t\treturn item && this.instantiationService.createInstance(\n\t\t\t\t\tCompositeActionViewItem,\n\t\t\t\t\t{ draggable: true, colors: this.options.colors, icon: this.options.icon, hoverOptions: this.options.activityHoverOptions },\n\t\t\t\t\taction as ActivityAction,\n\t\t\t\t\titem.pinnedAction,\n\t\t\t\t\tcompositeId => this.options.getContextMenuActionsForComposite(compositeId),\n\t\t\t\t\t() => this.getContextMenuActions(),\n\t\t\t\t\tthis.options.dndHandler,\n\t\t\t\t\tthis\n\t\t\t\t);\n\t\t\t},\n\t\t\torientation: this.options.orientation,\n\t\t\tariaLabel: localize('activityBarAriaLabel', \"Active View Switcher\"),\n\t\t\tanimated: false,\n\t\t\tpreventLoopNavigation: this.options.preventLoopNavigation,\n\t\t\ttriggerKeys: { keyDown: true }\n\t\t}));\n\n\t\t// Contextmenu for composites\n\t\tthis._register(addDisposableListener(parent, EventType.CONTEXT_MENU, e => this.showContextMenu(e)));\n\n\t\tlet insertDropBefore: Before2D | undefined = undefined;\n\t\t// Register a drop target on the whole bar to prevent forbidden feedback\n\t\tthis._register(CompositeDragAndDropObserver.INSTANCE.registerTarget(parent, {\n\t\t\tonDragOver: (e: IDraggedCompositeData) => {\n\t\t\t\t// don't add feedback if this is over the composite bar actions or there are no actions\n\t\t\t\tconst visibleItems = this.getVisibleComposites();\n\t\t\t\tif (!visibleItems.length || (e.eventData.target && isAncestor(e.eventData.target as HTMLElement, actionBarDiv))) {\n\t\t\t\t\tinsertDropBefore = this.updateFromDragging(parent, false, false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst insertAtFront = this.insertAtFront(actionBarDiv, e.eventData);\n\t\t\t\tconst target = insertAtFront ? visibleItems[0] : visibleItems[visibleItems.length - 1];\n\t\t\t\tconst validDropTarget = this.options.dndHandler.onDragOver(e.dragAndDropData, target.id, e.eventData);\n\t\t\t\ttoggleDropEffect(e.eventData.dataTransfer, 'move', validDropTarget);\n\t\t\t\tinsertDropBefore = this.updateFromDragging(parent, validDropTarget, insertAtFront);\n\t\t\t},\n\n\t\t\tonDragLeave: (e: IDraggedCompositeData) => {\n\t\t\t\tinsertDropBefore = this.updateFromDragging(parent, false, false);\n\t\t\t},\n\t\t\tonDragEnd: (e: IDraggedCompositeData) => {\n\t\t\t\tinsertDropBefore = this.updateFromDragging(parent, false, false);\n\t\t\t},\n\t\t\tonDrop: (e: IDraggedCompositeData) => {\n\t\t\t\tconst visibleItems = this.getVisibleComposites();\n\t\t\t\tif (visibleItems.length) {\n\t\t\t\t\tconst target = this.insertAtFront(actionBarDiv, e.eventData) ? visibleItems[0] : visibleItems[visibleItems.length - 1];\n\t\t\t\t\tthis.options.dndHandler.drop(e.dragAndDropData, target.id, e.eventData, insertDropBefore);\n\t\t\t\t}\n\t\t\t\tinsertDropBefore = this.updateFromDragging(parent, false, false);\n\t\t\t}\n\t\t}));\n\n\t\treturn actionBarDiv;\n\t}\n\n\tprivate insertAtFront(element: HTMLElement, event: DragEvent): boolean {\n\t\tconst rect = element.getBoundingClientRect();\n\t\tconst posX = event.clientX;\n\t\tconst posY = event.clientY;\n\n\t\tswitch (this.options.orientation) {\n\t\t\tcase ActionsOrientation.HORIZONTAL:\n\t\t\t\treturn posX < rect.left;\n\t\t\tcase ActionsOrientation.VERTICAL:\n\t\t\t\treturn posY < rect.top;\n\t\t}\n\t}\n\n\tprivate updateFromDragging(element: HTMLElement, showFeedback: boolean, front: boolean): Before2D | undefined {\n\t\telement.classList.toggle('dragged-over-head', showFeedback && front);\n\t\telement.classList.toggle('dragged-over-tail', showFeedback && !front);\n\n\t\tif (!showFeedback) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn { verticallyBefore: front, horizontallyBefore: front };\n\t}\n\n\tfocus(index?: number): void {\n\t\tif (this.compositeSwitcherBar) {\n\t\t\tthis.compositeSwitcherBar.focus(index);\n\t\t}\n\t}\n\n\tlayout(dimension: Dimension): void {\n\t\tthis.dimension = dimension;\n\t\tif (dimension.height === 0 || dimension.width === 0) {\n\t\t\t// Do not layout if not visible. Otherwise the size measurment would be computed wrongly\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.compositeSizeInBar.size === 0) {\n\t\t\t// Compute size of each composite by getting the size from the css renderer\n\t\t\t// Size is later used for overflow computation\n\t\t\tthis.computeSizes(this.model.visibleItems);\n\t\t}\n\n\t\tthis.updateCompositeSwitcher();\n\t}\n\n\taddComposite({ id, name, order, requestedIndex }: { id: string; name: string, order?: number, requestedIndex?: number; }): void {\n\t\t// Add to the model\n\t\tif (this.model.add(id, name, order, requestedIndex)) {\n\t\t\tthis.computeSizes([this.model.findItem(id)]);\n\t\t\tthis.updateCompositeSwitcher();\n\t\t}\n\t}\n\n\tremoveComposite(id: string): void {\n\n\t\t// If it pinned, unpin it first\n\t\tif (this.isPinned(id)) {\n\t\t\tthis.unpin(id);\n\t\t}\n\n\t\t// Remove from the model\n\t\tif (this.model.remove(id)) {\n\t\t\tthis.updateCompositeSwitcher();\n\t\t}\n\t}\n\n\thideComposite(id: string): void {\n\t\tif (this.model.hide(id)) {\n\t\t\tthis.resetActiveComposite(id);\n\t\t\tthis.updateCompositeSwitcher();\n\t\t}\n\t}\n\n\tactivateComposite(id: string): void {\n\t\tconst previousActiveItem = this.model.activeItem;\n\t\tif (this.model.activate(id)) {\n\t\t\t// Update if current composite is neither visible nor pinned\n\t\t\t// or previous active composite is not pinned\n\t\t\tif (this.visibleComposites.indexOf(id) === - 1 || (!!this.model.activeItem && !this.model.activeItem.pinned) || (previousActiveItem && !previousActiveItem.pinned)) {\n\t\t\t\tthis.updateCompositeSwitcher();\n\t\t\t}\n\t\t}\n\t}\n\n\tdeactivateComposite(id: string): void {\n\t\tconst previousActiveItem = this.model.activeItem;\n\t\tif (this.model.deactivate()) {\n\t\t\tif (previousActiveItem && !previousActiveItem.pinned) {\n\t\t\t\tthis.updateCompositeSwitcher();\n\t\t\t}\n\t\t}\n\t}\n\n\tshowActivity(compositeId: string, badge: IBadge, clazz?: string, priority?: number): IDisposable {\n\t\tif (!badge) {\n\t\t\tthrow illegalArgument('badge');\n\t\t}\n\n\t\tif (typeof priority !== 'number') {\n\t\t\tpriority = 0;\n\t\t}\n\n\t\tconst activity: ICompositeActivity = { badge, clazz, priority };\n\t\tthis.model.addActivity(compositeId, activity);\n\n\t\treturn toDisposable(() => this.model.removeActivity(compositeId, activity));\n\t}\n\n\tasync pin(compositeId: string, open?: boolean): Promise<void> {\n\t\tif (this.model.setPinned(compositeId, true)) {\n\t\t\tthis.updateCompositeSwitcher();\n\n\t\t\tif (open) {\n\t\t\t\tawait this.options.openComposite(compositeId);\n\t\t\t\tthis.activateComposite(compositeId); // Activate after opening\n\t\t\t}\n\t\t}\n\t}\n\n\tunpin(compositeId: string): void {\n\t\tif (this.model.setPinned(compositeId, false)) {\n\n\t\t\tthis.updateCompositeSwitcher();\n\n\t\t\tthis.resetActiveComposite(compositeId);\n\t\t}\n\t}\n\n\tprivate resetActiveComposite(compositeId: string) {\n\t\tconst defaultCompositeId = this.options.getDefaultCompositeId();\n\n\t\t// Case: composite is not the active one or the active one is a different one\n\t\t// Solv: we do nothing\n\t\tif (!this.model.activeItem || this.model.activeItem.id !== compositeId) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Deactivate itself\n\t\tthis.deactivateComposite(compositeId);\n\n\t\t// Case: composite is not the default composite and default composite is still showing\n\t\t// Solv: we open the default composite\n\t\tif (defaultCompositeId !== compositeId && this.isPinned(defaultCompositeId)) {\n\t\t\tthis.options.openComposite(defaultCompositeId);\n\t\t}\n\n\t\t// Case: we closed the last visible composite\n\t\t// Solv: we hide the part\n\t\telse if (this.visibleComposites.length === 0) {\n\t\t\tthis.options.hidePart();\n\t\t}\n\n\t\t// Case: we closed the default composite\n\t\t// Solv: we open the next visible composite from top\n\t\telse {\n\t\t\tthis.options.openComposite(this.visibleComposites.filter(cid => cid !== compositeId)[0]);\n\t\t}\n\t}\n\n\tisPinned(compositeId: string): boolean {\n\t\tconst item = this.model.findItem(compositeId);\n\t\treturn item?.pinned;\n\t}\n\n\tmove(compositeId: string, toCompositeId: string, before?: boolean): void {\n\n\t\tif (before !== undefined) {\n\t\t\tconst fromIndex = this.model.items.findIndex(c => c.id === compositeId);\n\t\t\tlet toIndex = this.model.items.findIndex(c => c.id === toCompositeId);\n\n\t\t\tif (fromIndex >= 0 && toIndex >= 0) {\n\t\t\t\tif (!before && fromIndex > toIndex) {\n\t\t\t\t\ttoIndex++;\n\t\t\t\t}\n\n\t\t\t\tif (before && fromIndex < toIndex) {\n\t\t\t\t\ttoIndex--;\n\t\t\t\t}\n\n\t\t\t\tif (toIndex < this.model.items.length && toIndex >= 0 && toIndex !== fromIndex) {\n\t\t\t\t\tif (this.model.move(this.model.items[fromIndex].id, this.model.items[toIndex].id)) {\n\t\t\t\t\t\t// timeout helps to prevent artifacts from showing up\n\t\t\t\t\t\tsetTimeout(() => this.updateCompositeSwitcher(), 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (this.model.move(compositeId, toCompositeId)) {\n\t\t\t\t// timeout helps to prevent artifacts from showing up\n\t\t\t\tsetTimeout(() => this.updateCompositeSwitcher(), 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetAction(compositeId: string): ActivityAction {\n\t\tconst item = this.model.findItem(compositeId);\n\t\treturn item?.activityAction;\n\t}\n\n\tprivate computeSizes(items: ICompositeBarModelItem[]): void {\n\t\tconst size = this.options.compositeSize;\n\t\tif (size) {\n\t\t\titems.forEach(composite => this.compositeSizeInBar.set(composite.id, size));\n\t\t} else {\n\t\t\tconst compositeSwitcherBar = this.compositeSwitcherBar;\n\t\t\tif (compositeSwitcherBar && this.dimension && this.dimension.height !== 0 && this.dimension.width !== 0) {\n\t\t\t\t// Compute sizes only if visible. Otherwise the size measurment would be computed wrongly.\n\t\t\t\tconst currentItemsLength = compositeSwitcherBar.viewItems.length;\n\t\t\t\tcompositeSwitcherBar.push(items.map(composite => composite.activityAction));\n\t\t\t\titems.map((composite, index) => this.compositeSizeInBar.set(composite.id, this.options.orientation === ActionsOrientation.VERTICAL\n\t\t\t\t\t? compositeSwitcherBar.getHeight(currentItemsLength + index)\n\t\t\t\t\t: compositeSwitcherBar.getWidth(currentItemsLength + index)\n\t\t\t\t));\n\t\t\t\titems.forEach(() => compositeSwitcherBar.pull(compositeSwitcherBar.viewItems.length - 1));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateCompositeSwitcher(): void {\n\t\tconst compositeSwitcherBar = this.compositeSwitcherBar;\n\t\tif (!compositeSwitcherBar || !this.dimension) {\n\t\t\treturn; // We have not been rendered yet so there is nothing to update.\n\t\t}\n\n\t\tlet compositesToShow = this.model.visibleItems.filter(item =>\n\t\t\titem.pinned\n\t\t\t|| (this.model.activeItem && this.model.activeItem.id === item.id) /* Show the active composite even if it is not pinned */\n\t\t).map(item => item.id);\n\n\t\t// Ensure we are not showing more composites than we have height for\n\t\tlet overflows = false;\n\t\tlet maxVisible = compositesToShow.length;\n\t\tlet size = 0;\n\t\tconst limit = this.options.orientation === ActionsOrientation.VERTICAL ? this.dimension.height : this.dimension.width;\n\t\tfor (let i = 0; i < compositesToShow.length && size <= limit; i++) {\n\t\t\tsize += this.compositeSizeInBar.get(compositesToShow[i])!;\n\t\t\tif (size > limit) {\n\t\t\t\tmaxVisible = i;\n\t\t\t}\n\t\t}\n\t\toverflows = compositesToShow.length > maxVisible;\n\n\t\tif (overflows) {\n\t\t\tsize -= this.compositeSizeInBar.get(compositesToShow[maxVisible])!;\n\t\t\tcompositesToShow = compositesToShow.slice(0, maxVisible);\n\t\t\tsize += this.options.overflowActionSize;\n\t\t}\n\t\t// Check if we need to make extra room for the overflow action\n\t\tif (size > limit) {\n\t\t\tsize -= this.compositeSizeInBar.get(compositesToShow.pop()!)!;\n\t\t}\n\n\t\t// We always try show the active composite\n\t\tif (this.model.activeItem && compositesToShow.every(compositeId => !!this.model.activeItem && compositeId !== this.model.activeItem.id)) {\n\t\t\tconst removedComposite = compositesToShow.pop()!;\n\t\t\tsize = size - this.compositeSizeInBar.get(removedComposite)! + this.compositeSizeInBar.get(this.model.activeItem.id)!;\n\t\t\tcompositesToShow.push(this.model.activeItem.id);\n\t\t}\n\n\t\t// The active composite might have bigger size than the removed composite, check for overflow again\n\t\tif (size > limit) {\n\t\t\tcompositesToShow.length ? compositesToShow.splice(compositesToShow.length - 2, 1) : compositesToShow.pop();\n\t\t}\n\n\t\t// Remove the overflow action if there are no overflows\n\t\tif (!overflows && this.compositeOverflowAction) {\n\t\t\tcompositeSwitcherBar.pull(compositeSwitcherBar.length() - 1);\n\n\t\t\tthis.compositeOverflowAction.dispose();\n\t\t\tthis.compositeOverflowAction = undefined;\n\n\t\t\tif (this.compositeOverflowActionViewItem) {\n\t\t\t\tthis.compositeOverflowActionViewItem.dispose();\n\t\t\t}\n\t\t\tthis.compositeOverflowActionViewItem = undefined;\n\t\t}\n\n\t\t// Pull out composites that overflow or got hidden\n\t\tconst compositesToRemove: number[] = [];\n\t\tthis.visibleComposites.forEach((compositeId, index) => {\n\t\t\tif (!compositesToShow.includes(compositeId)) {\n\t\t\t\tcompositesToRemove.push(index);\n\t\t\t}\n\t\t});\n\t\tcompositesToRemove.reverse().forEach(index => {\n\t\t\tconst actionViewItem = compositeSwitcherBar.viewItems[index];\n\t\t\tcompositeSwitcherBar.pull(index);\n\t\t\tactionViewItem.dispose();\n\t\t\tthis.visibleComposites.splice(index, 1);\n\t\t});\n\n\t\t// Update the positions of the composites\n\t\tcompositesToShow.forEach((compositeId, newIndex) => {\n\t\t\tconst currentIndex = this.visibleComposites.indexOf(compositeId);\n\t\t\tif (newIndex !== currentIndex) {\n\t\t\t\tif (currentIndex !== -1) {\n\t\t\t\t\tconst actionViewItem = compositeSwitcherBar.viewItems[currentIndex];\n\t\t\t\t\tcompositeSwitcherBar.pull(currentIndex);\n\t\t\t\t\tactionViewItem.dispose();\n\t\t\t\t\tthis.visibleComposites.splice(currentIndex, 1);\n\t\t\t\t}\n\n\t\t\t\tcompositeSwitcherBar.push(this.model.findItem(compositeId).activityAction, { label: true, icon: this.options.icon, index: newIndex });\n\t\t\t\tthis.visibleComposites.splice(newIndex, 0, compositeId);\n\t\t\t}\n\t\t});\n\n\t\t// Add overflow action as needed\n\t\tif ((overflows && !this.compositeOverflowAction)) {\n\t\t\tthis.compositeOverflowAction = this.instantiationService.createInstance(CompositeOverflowActivityAction, () => {\n\t\t\t\tif (this.compositeOverflowActionViewItem) {\n\t\t\t\t\tthis.compositeOverflowActionViewItem.showMenu();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.compositeOverflowActionViewItem = this.instantiationService.createInstance(\n\t\t\t\tCompositeOverflowActivityActionViewItem,\n\t\t\t\tthis.compositeOverflowAction,\n\t\t\t\t() => this.getOverflowingComposites(),\n\t\t\t\t() => this.model.activeItem ? this.model.activeItem.id : undefined,\n\t\t\t\tcompositeId => {\n\t\t\t\t\tconst item = this.model.findItem(compositeId);\n\t\t\t\t\treturn item?.activity[0]?.badge;\n\t\t\t\t},\n\t\t\t\tthis.options.getOnCompositeClickAction,\n\t\t\t\tthis.options.colors,\n\t\t\t\tthis.options.activityHoverOptions\n\t\t\t);\n\n\t\t\tcompositeSwitcherBar.push(this.compositeOverflowAction, { label: false, icon: true });\n\t\t}\n\n\t\tthis._onDidChange.fire();\n\t}\n\n\tprivate getOverflowingComposites(): { id: string, name?: string; }[] {\n\t\tlet overflowingIds = this.model.visibleItems.filter(item => item.pinned).map(item => item.id);\n\n\t\t// Show the active composite even if it is not pinned\n\t\tif (this.model.activeItem && !this.model.activeItem.pinned) {\n\t\t\toverflowingIds.push(this.model.activeItem.id);\n\t\t}\n\n\t\toverflowingIds = overflowingIds.filter(compositeId => !this.visibleComposites.includes(compositeId));\n\t\treturn this.model.visibleItems.filter(c => overflowingIds.includes(c.id)).map(item => { return { id: item.id, name: this.getAction(item.id)?.label || item.name }; });\n\t}\n\n\tprivate showContextMenu(e: MouseEvent): void {\n\t\tEventHelper.stop(e, true);\n\t\tconst event = new StandardMouseEvent(e);\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => { return { x: event.posx, y: event.posy }; },\n\t\t\tgetActions: () => this.getContextMenuActions()\n\t\t});\n\t}\n\n\tgetContextMenuActions(): IAction[] {\n\t\tconst actions: IAction[] = this.model.visibleItems\n\t\t\t.map(({ id, name, activityAction }) => (toAction({\n\t\t\t\tid,\n\t\t\t\tlabel: this.getAction(id).label || name || id,\n\t\t\t\tchecked: this.isPinned(id),\n\t\t\t\tenabled: activityAction.enabled,\n\t\t\t\trun: () => {\n\t\t\t\t\tif (this.isPinned(id)) {\n\t\t\t\t\t\tthis.unpin(id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.pin(id, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})));\n\n\t\tthis.options.fillExtraContextMenuActions(actions);\n\n\t\treturn actions;\n\t}\n}\n\ninterface ICompositeBarModelItem extends ICompositeBarItem {\n\tactivityAction: ActivityAction;\n\tpinnedAction: IAction;\n\tactivity: ICompositeActivity[];\n}\n\nclass CompositeBarModel {\n\n\tprivate _items: ICompositeBarModelItem[] = [];\n\tprivate readonly options: ICompositeBarOptions;\n\tactiveItem?: ICompositeBarModelItem;\n\n\tconstructor(\n\t\titems: ICompositeBarItem[],\n\t\toptions: ICompositeBarOptions\n\t) {\n\t\tthis.options = options;\n\t\tthis.setItems(items);\n\t}\n\n\tget items(): ICompositeBarModelItem[] {\n\t\treturn this._items;\n\t}\n\n\tsetItems(items: ICompositeBarItem[]): boolean {\n\t\tconst result: ICompositeBarModelItem[] = [];\n\t\tlet hasChanges: boolean = false;\n\t\tif (!this.items || this.items.length === 0) {\n\t\t\tthis._items = items.map(i => this.createCompositeBarItem(i.id, i.name, i.order, i.pinned, i.visible));\n\t\t\thasChanges = true;\n\t\t} else {\n\t\t\tconst existingItems = this.items;\n\t\t\tfor (let index = 0; index < items.length; index++) {\n\t\t\t\tconst newItem = items[index];\n\t\t\t\tconst existingItem = existingItems.filter(({ id }) => id === newItem.id)[0];\n\t\t\t\tif (existingItem) {\n\t\t\t\t\tif (\n\t\t\t\t\t\texistingItem.pinned !== newItem.pinned ||\n\t\t\t\t\t\tindex !== existingItems.indexOf(existingItem)\n\t\t\t\t\t) {\n\t\t\t\t\t\texistingItem.pinned = newItem.pinned;\n\t\t\t\t\t\tresult.push(existingItem);\n\t\t\t\t\t\thasChanges = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(existingItem);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(this.createCompositeBarItem(newItem.id, newItem.name, newItem.order, newItem.pinned, newItem.visible));\n\t\t\t\t\thasChanges = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._items = result;\n\t\t}\n\n\t\treturn hasChanges;\n\t}\n\n\tget visibleItems(): ICompositeBarModelItem[] {\n\t\treturn this.items.filter(item => item.visible);\n\t}\n\n\tget pinnedItems(): ICompositeBarModelItem[] {\n\t\treturn this.items.filter(item => item.visible && item.pinned);\n\t}\n\n\tprivate createCompositeBarItem(id: string, name: string | undefined, order: number | undefined, pinned: boolean, visible: boolean): ICompositeBarModelItem {\n\t\tconst options = this.options;\n\t\treturn {\n\t\t\tid, name, pinned, order, visible,\n\t\t\tactivity: [],\n\t\t\tget activityAction() {\n\t\t\t\treturn options.getActivityAction(id);\n\t\t\t},\n\t\t\tget pinnedAction() {\n\t\t\t\treturn options.getCompositePinnedAction(id);\n\t\t\t}\n\t\t};\n\t}\n\n\tadd(id: string, name: string, order: number | undefined, requestedIndex: number | undefined): boolean {\n\t\tconst item = this.findItem(id);\n\t\tif (item) {\n\t\t\tlet changed = false;\n\t\t\titem.name = name;\n\t\t\tif (!isUndefinedOrNull(order)) {\n\t\t\t\tchanged = item.order !== order;\n\t\t\t\titem.order = order;\n\t\t\t}\n\t\t\tif (!item.visible) {\n\t\t\t\titem.visible = true;\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\t\treturn changed;\n\t\t} else {\n\t\t\tconst item = this.createCompositeBarItem(id, name, order, true, true);\n\t\t\tif (!isUndefinedOrNull(requestedIndex)) {\n\t\t\t\tlet index = 0;\n\t\t\t\tlet rIndex = requestedIndex;\n\t\t\t\twhile (rIndex > 0 && index < this.items.length) {\n\t\t\t\t\tif (this.items[index++].visible) {\n\t\t\t\t\t\trIndex--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.items.splice(index, 0, item);\n\t\t\t} else if (isUndefinedOrNull(order)) {\n\t\t\t\tthis.items.push(item);\n\t\t\t} else {\n\t\t\t\tlet index = 0;\n\t\t\t\twhile (index < this.items.length && typeof this.items[index].order === 'number' && this.items[index].order! < order) {\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t\tthis.items.splice(index, 0, item);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tremove(id: string): boolean {\n\t\tfor (let index = 0; index < this.items.length; index++) {\n\t\t\tif (this.items[index].id === id) {\n\t\t\t\tthis.items.splice(index, 1);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\thide(id: string): boolean {\n\t\tfor (const item of this.items) {\n\t\t\tif (item.id === id) {\n\t\t\t\tif (item.visible) {\n\t\t\t\t\titem.visible = false;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tmove(compositeId: string, toCompositeId: string): boolean {\n\n\t\tconst fromIndex = this.findIndex(compositeId);\n\t\tconst toIndex = this.findIndex(toCompositeId);\n\n\t\t// Make sure both items are known to the model\n\t\tif (fromIndex === -1 || toIndex === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst sourceItem = this.items.splice(fromIndex, 1)[0];\n\t\tthis.items.splice(toIndex, 0, sourceItem);\n\n\t\t// Make sure a moved composite gets pinned\n\t\tsourceItem.pinned = true;\n\n\t\treturn true;\n\t}\n\n\tsetPinned(id: string, pinned: boolean): boolean {\n\t\tfor (const item of this.items) {\n\t\t\tif (item.id === id) {\n\t\t\t\tif (item.pinned !== pinned) {\n\t\t\t\t\titem.pinned = pinned;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\taddActivity(id: string, activity: ICompositeActivity): boolean {\n\t\tconst item = this.findItem(id);\n\t\tif (item) {\n\t\t\tconst stack = item.activity;\n\t\t\tfor (let i = 0; i <= stack.length; i++) {\n\t\t\t\tif (i === stack.length) {\n\t\t\t\t\tstack.push(activity);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (stack[i].priority <= activity.priority) {\n\t\t\t\t\tstack.splice(i, 0, activity);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.updateActivity(id);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tremoveActivity(id: string, activity: ICompositeActivity): boolean {\n\t\tconst item = this.findItem(id);\n\t\tif (item) {\n\t\t\tconst index = item.activity.indexOf(activity);\n\t\t\tif (index !== -1) {\n\t\t\t\titem.activity.splice(index, 1);\n\t\t\t\tthis.updateActivity(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tupdateActivity(id: string): void {\n\t\tconst item = this.findItem(id);\n\t\tif (item) {\n\t\t\tif (item.activity.length) {\n\t\t\t\tconst [{ badge, clazz }] = item.activity;\n\t\t\t\titem.activityAction.setBadge(badge, clazz);\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.activityAction.setBadge(undefined);\n\t\t\t}\n\t\t}\n\t}\n\n\tactivate(id: string): boolean {\n\t\tif (!this.activeItem || this.activeItem.id !== id) {\n\t\t\tif (this.activeItem) {\n\t\t\t\tthis.deactivate();\n\t\t\t}\n\t\t\tfor (const item of this.items) {\n\t\t\t\tif (item.id === id) {\n\t\t\t\t\tthis.activeItem = item;\n\t\t\t\t\tthis.activeItem.activityAction.activate();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tdeactivate(): boolean {\n\t\tif (this.activeItem) {\n\t\t\tthis.activeItem.activityAction.deactivate();\n\t\t\tthis.activeItem = undefined;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tfindItem(id: string): ICompositeBarModelItem {\n\t\treturn this.items.filter(item => item.id === id)[0];\n\t}\n\n\tprivate findIndex(id: string): number {\n\t\tfor (let index = 0; index < this.items.length; index++) {\n\t\t\tif (this.items[index].id === id) {\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n}\n"]}