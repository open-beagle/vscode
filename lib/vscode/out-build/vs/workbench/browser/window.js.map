{"version":3,"sources":["vs/workbench/browser/window.ts"],"names":[],"mappings":"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","file":"window.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { setFullscreen } from 'vs/base/browser/browser';\nimport { addDisposableListener, addDisposableThrottledListener, detectFullscreen, EventHelper, EventType, windowOpenNoOpener } from 'vs/base/browser/dom';\nimport { domEvent } from 'vs/base/browser/event';\nimport { timeout } from 'vs/base/common/async';\nimport { Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { isIOS, isMacintosh } from 'vs/base/common/platform';\nimport Severity from 'vs/base/common/severity';\nimport { URI } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { registerWindowDriver } from 'vs/platform/driver/browser/driver';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IOpenerService, matchesScheme } from 'vs/platform/opener/common/opener';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\nimport { IWorkbenchLayoutService } from 'vs/workbench/services/layout/browser/layoutService';\nimport { BrowserLifecycleService } from 'vs/workbench/services/lifecycle/browser/lifecycleService';\nimport { ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\n\nexport class BrowserWindow extends Disposable {\n\n\tconstructor(\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@ILifecycleService private readonly lifecycleService: BrowserLifecycleService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t\tthis.create();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Lifecycle\n\t\tthis._register(this.lifecycleService.onWillShutdown(() => this.onWillShutdown()));\n\n\t\t// Layout\n\t\tconst viewport = isIOS && window.visualViewport ? window.visualViewport /** Visual viewport */ : window /** Layout viewport */;\n\t\tthis._register(addDisposableListener(viewport, EventType.RESIZE, () => this.onWindowResize()));\n\n\t\t// Prevent the back/forward gestures in macOS\n\t\tthis._register(addDisposableListener(this.layoutService.container, EventType.WHEEL, e => e.preventDefault(), { passive: false }));\n\n\t\t// Prevent native context menus in web\n\t\tthis._register(addDisposableListener(this.layoutService.container, EventType.CONTEXT_MENU, e => EventHelper.stop(e, true)));\n\n\t\t// Prevent default navigation on drop\n\t\tthis._register(addDisposableListener(this.layoutService.container, EventType.DROP, e => EventHelper.stop(e, true)));\n\n\t\t// Fullscreen (Browser)\n\t\t[EventType.FULLSCREEN_CHANGE, EventType.WK_FULLSCREEN_CHANGE].forEach(event => {\n\t\t\tthis._register(addDisposableListener(document, event, () => setFullscreen(!!detectFullscreen())));\n\t\t});\n\n\t\t// Fullscreen (Native)\n\t\tthis._register(addDisposableThrottledListener(viewport, EventType.RESIZE, () => {\n\t\t\tsetFullscreen(!!detectFullscreen());\n\t\t}, undefined, isMacintosh ? 2000 /* adjust for macOS animation */ : 800 /* can be throttled */));\n\t}\n\n\tprivate onWindowResize(): void {\n\t\tthis.logService.trace(`web.main#${isIOS && window.visualViewport ? 'visualViewport' : 'window'}Resize`);\n\n\t\tthis.layoutService.layout();\n\t}\n\n\tprivate onWillShutdown(): void {\n\n\t\t// Try to detect some user interaction with the workbench\n\t\t// when shutdown has happened to not show the dialog e.g.\n\t\t// when navigation takes a longer time.\n\t\tEvent.toPromise(Event.any(\n\t\t\tEvent.once(domEvent(document.body, EventType.KEY_DOWN, true)),\n\t\t\tEvent.once(domEvent(document.body, EventType.MOUSE_DOWN, true))\n\t\t)).then(async () => {\n\n\t\t\t// Delay the dialog in case the user interacted\n\t\t\t// with the page before it transitioned away\n\t\t\tawait timeout(3000);\n\n\t\t\t// This should normally not happen, but if for some reason\n\t\t\t// the workbench was shutdown while the page is still there,\n\t\t\t// inform the user that only a reload can bring back a working\n\t\t\t// state.\n\t\t\tconst res = await this.dialogService.show(\n\t\t\t\tSeverity.Error,\n\t\t\t\tlocalize('shutdownError', \"An unexpected error occurred that requires a reload of this page.\"),\n\t\t\t\t[\n\t\t\t\t\tlocalize('reload', \"Reload\")\n\t\t\t\t],\n\t\t\t\t{\n\t\t\t\t\tdetail: localize('shutdownErrorDetail', \"The workbench was unexpectedly disposed while running.\")\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (res.choice === 0) {\n\t\t\t\tthis.hostService.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate create(): void {\n\n\t\t// Driver\n\t\tif (this.environmentService.options?.developmentOptions?.enableSmokeTestDriver) {\n\t\t\t(async () => this._register(await registerWindowDriver()))();\n\t\t}\n\n\t\t// Handle open calls\n\t\tthis.setupOpenHandlers();\n\n\t\t// Label formatting\n\t\tthis.registerLabelFormatters();\n\t}\n\n\tprivate setupOpenHandlers(): void {\n\n\t\t// We need to ignore the `beforeunload` event while\n\t\t// we handle external links to open specifically for\n\t\t// the case of application protocols that e.g. invoke\n\t\t// vscode itself. We do not want to open these links\n\t\t// in a new window because that would leave a blank\n\t\t// window to the user, but using `window.location.href`\n\t\t// will trigger the `beforeunload`.\n\t\tthis.openerService.setDefaultExternalOpener({\n\t\t\topenExternal: async (href: string) => {\n\t\t\t\tif (matchesScheme(href, Schemas.http) || matchesScheme(href, Schemas.https)) {\n\t\t\t\t\tconst opened = windowOpenNoOpener(href);\n\t\t\t\t\tif (!opened) {\n\t\t\t\t\t\tconst showResult = await this.dialogService.show(Severity.Warning, localize('unableToOpenExternal', \"The browser interrupted the opening of a new tab or window. Press 'Open' to open it anyway.\"),\n\t\t\t\t\t\t\t[localize('open', \"Open\"), localize('learnMore', \"Learn More\"), localize('cancel', \"Cancel\")], { cancelId: 2, detail: href });\n\t\t\t\t\t\tif (showResult.choice === 0) {\n\t\t\t\t\t\t\twindowOpenNoOpener(href);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (showResult.choice === 1) {\n\t\t\t\t\t\t\tawait this.openerService.open(URI.parse('https://aka.ms/allow-vscode-popup'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.lifecycleService.withExpectedUnload(() => window.location.href = href);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registerLabelFormatters() {\n\t\tthis.labelService.registerFormatter({\n\t\t\tscheme: Schemas.userData,\n\t\t\tpriority: true,\n\t\t\tformatting: {\n\t\t\t\tlabel: '(Settings) ${path}',\n\t\t\t\tseparator: '/',\n\t\t\t}\n\t\t});\n\t}\n}\n"]}