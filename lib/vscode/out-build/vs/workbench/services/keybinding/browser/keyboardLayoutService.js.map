{"version":3,"sources":["vs/workbench/services/keybinding/browser/keyboardLayoutService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IA8BhG,MAAa,gCAAgC;QAwC5C;QACC,sDAAsD;QACtD,4CAA4C;QAC5C,2CAA2C;;YAvC3B,+BAA0B,GAAG,IAAI,eAAO,EAAQ,CAAC;YAClD,8BAAyB,GAAgB,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC;YAwC9F,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC5B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YACvB,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;YACf,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAE9B,IAA6B,SAAU,CAAC,QAAQ,IAA6B,SAAU,CAAC,QAAQ,CAAC,gBAAgB,EAAE;gBACzF,SAAU,CAAC,QAAQ,CAAC,gBAAiB,CAAC,cAAc,EAAE,GAAG,EAAE;oBACnF,oCAAoC;oBACpC,IAAI,CAAC,qBAAqB,EAAE,CAAC,IAAI,CAAC,CAAC,OAAgC,EAAE,EAAE;wBACtE,IAAI,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,EAAE;4BACrC,OAAO;yBACP;wBAED,IAAI,CAAC,uBAAuB,EAAE,CAAC;oBAChC,CAAC,CAAC,CAAC;gBACJ,CAAC,CAAC,CAAC;aACH;QACF,CAAC;QAnDD,IAAI,YAAY;YACf,OAAO,IAAI,CAAC,iBAAiB,CAAC;QAC/B,CAAC;QAED,IAAI,WAAW;YACd,OAAO,IAAI,CAAC,YAAY,CAAC;QAC1B,CAAC;QAED,IAAI,oBAAoB;YACvB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACvB,OAAO,IAAI,CAAC;aACZ;YAED,OAAO,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC;QAChE,CAAC;QAED,IAAI,gBAAgB;YACnB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACvB,OAAO,IAAI,CAAC;aACZ;YAED,OAAO,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC;QACjE,CAAC;QAED,IAAI,eAAe;YAClB,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAC/D,CAAC;QA2BD,sBAAsB,CAAC,MAAkB;YACxC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC/B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC;QAC/B,CAAC;QAED,oBAAoB,CAAC,MAAkB;YACtC,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YACtC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAC3B,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC1C,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QACpC,CAAC;QAED,oBAAoB,CAAC,UAAmC;YACvD,IAAI,CAAC,UAAU,EAAE;gBAChB,OAAO,IAAI,CAAC;aACZ;YAED,IAAI,UAAU,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAE5C,IAAI,UAAU,EAAE;gBACf,IAAI,QAAQ,GAAG,UAAU,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;gBAC/C,IAAI,QAAQ,KAAK,CAAC,EAAE;oBACnB,OAAO;wBACN,MAAM,EAAE,UAAU;wBAClB,KAAK,EAAE,CAAC;qBACR,CAAC;iBACF;gBAED,IAAI,MAAM,GAAG,UAAU,CAAC;gBACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBAC1C,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;oBAC9C,IAAI,KAAK,GAAG,QAAQ,EAAE;wBACrB,IAAI,KAAK,KAAK,CAAC,EAAE;4BAChB,OAAO;gCACN,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;gCACpB,KAAK,EAAE,CAAC;6BACR,CAAC;yBACF;wBAED,QAAQ,GAAG,KAAK,CAAC;wBACjB,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;qBACtB;iBACD;gBAED,OAAO;oBACN,MAAM;oBACN,KAAK,EAAE,QAAQ;iBACf,CAAC;aACF;YAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC1C,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE;oBACxC,OAAO;wBACN,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;wBACpB,KAAK,EAAE,CAAC;qBACR,CAAC;iBACF;aACD;YAED,OAAO,IAAI,CAAC;QACb,CAAC;QAED,mBAAmB;YAClB,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;YAEjF,IAAI,iBAAiB,CAAC,MAAM,EAAE;gBAC7B,OAAO,iBAAiB,CAAC,CAAC,CAAC,CAAC;aAC5B;YAED,OAAO,IAAI,CAAC;QACb,CAAC;QAED,kBAAkB,CAAC,MAA+B;YACjD,OAAO,IAAI,CAAC,iBAAiB,IAAI,MAAM,IAAI,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACtF,CAAC;QAED,mBAAmB;YAClB,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;QACrD,CAAC;QAED,mBAAmB,CAAC,MAA+B;YAClD,IAAI,aAAa,GAAG,KAAK,CAAC;YAC1B,IAAI,qBAAqB,GAAG,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;YAC9D,IAAI,qBAAqB,EAAE;gBAC1B,2CAA2C;gBAE3C,+HAA+H;gBAC/H,2CAA2C;gBAC3C,6BAA6B;gBAC7B,+DAA+D;gBAC/D,iFAAiF;gBACjF,WAAW;gBACX,IAAI;gBAEJ,uFAAuF;gBACvF,oCAAoC;gBACpC,kBAAkB;gBAClB,oFAAoF;gBACpF,MAAM;gBACN,yEAAyE;gBACzE,gGAAgG;gBAChG,QAAQ;gBACR,2DAA2D;gBAC3D,uBAAuB;gBACvB,wFAAwF;gBACxF,MAAM;gBACN,KAAK;gBAEL,sLAAsL;gBAEtL,UAAU;gBACV,IAAI;gBAEJ,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE;oBAC5B,IAAI,CAAC,iBAAiB,GAAG,qBAAqB,CAAC,MAAM,CAAC;oBACtD,aAAa,GAAG,IAAI,CAAC;iBACrB;qBAAM,IAAI,MAAM,EAAE;oBAClB,IAAI,qBAAqB,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;wBAC5F,IAAI,CAAC,iBAAiB,GAAG,qBAAqB,CAAC,MAAM,CAAC;wBACtD,aAAa,GAAG,IAAI,CAAC;qBACrB;iBACD;aACD;YAED,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE;gBAC5B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBACpD,aAAa,GAAG,IAAI,CAAC;aACrB;YAED,IAAI,CAAC,IAAI,CAAC,iBAAiB,IAAI,CAAC,aAAa,EAAE;gBAC9C,OAAO;aACP;YAED,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAExD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAC3B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAE1C,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC/C,CAAC;QAED,mBAAmB,CAAC,UAAsB;YACzC,IAAI,CAAC,iBAAiB,GAAG,UAAU,CAAC;YAEpC,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAExD,IAAI,KAAK,KAAK,CAAC,EAAE;gBAChB,OAAO;aACP;YAED,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAC3B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAE1C,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC/C,CAAC;QAEM,uBAAuB;YAC7B,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACpD,CAAC;QAEO,0BAA0B,CAAC,WAAoB,EAAE,aAA8B;YACtF,IAAI,CAAC,WAAW,EAAE;gBACjB,OAAO;aACP;YAED,IAAI,CAAC,qBAAqB,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;gBACvD,0BAA0B;gBAC1B,IAAI,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,EAAE;oBACpC,OAAO;iBACP;gBACD,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC;YAClC,CAAC,CAAC,CAAC;QACJ,CAAC;QAEM,iBAAiB,CAAC,cAA8B;YACtD,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACvB,OAAO,IAAI,+DAA8B,CAAC,aAAE,CAAC,CAAC;aAC9C;YACD,IAAI,cAAc,oBAA2B,EAAE;gBAC9C,gCAAgC;gBAChC,OAAO,IAAI,+DAA8B,CAAC,aAAE,CAAC,CAAC;aAC9C;YACD,OAAO,IAAI,CAAC,eAAgB,CAAC;QAC9B,CAAC;QAEM,8BAA8B,CAAC,aAA6B;YAClE,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACvB,OAAO;aACP;YAED,IAAI,iBAAiB,GAAG,IAAI,CAAC,+BAA+B,CAAC,aAAa,CAAC,CAAC;YAE5E,IAAI,iBAAiB,EAAE;gBACtB,OAAO;aACP;YAED,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QACtD,CAAC;QAEM,iBAAiB,CAAC,UAAkB;YAC1C,IAAI,cAAc,GAAiB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAA,GAAA,oCAAmB,CAAA,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,UAAU,CAAC,CAAC;YAEhI,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC9B,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;aAC5C;QACF,CAAC;QAEO,gBAAgB,CAAC,UAAsB;YAC9C,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YAEzB,IAAI,CAAC,eAAe,GAAG,IAAI,qCAAoB,CAAC,4BAA4B,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC,CAAC;YAChH,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC;QACxC,CAAC;QAEO,MAAM,CAAC,qBAAqB,CAAC,UAAsB;YAC1D,IAAI,UAAU,GAAG,UAAU,CAAC,OAAO,CAAC;YACpC,MAAM,YAAY,GAAG,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,YAAY,CAAC;YACtD,IAAI,aAAE,oBAA4B,EAAE;gBACnC,OAAO,IAAI,6CAAqB,CAAC,YAAY,EAA2B,UAAU,CAAC,CAAC;aACpF;YACD,IAAI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;gBACzC,+FAA+F;gBAC/F,OAAO,IAAI,+DAA8B,CAAC,aAAE,CAAC,CAAC;aAC9C;YAED,OAAO,IAAI,+CAAsB,CAAC,YAAY,EAA4B,UAAU,EAAE,aAAE,CAAC,CAAC;QAC3F,CAAC;QAED,qBAAqB;QACb,+BAA+B,CAAC,aAA6B;YACpE,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACvB,OAAO,IAAI,CAAC;aACZ;YAED,MAAM,qBAAqB,GAAG,aAAsC,CAAC;YACrE,MAAM,aAAa,GAAG,IAAI,CAAC,iBAAiB,CAAC;YAC7C,IAAI,CAAC,aAAa,EAAE;gBACnB,OAAO,IAAI,CAAC;aACZ;YAED,IAAI,qBAAqB,CAAC,YAAY,CAAC,GAAG,KAAK,MAAM,IAAI,qBAAqB,CAAC,YAAY,CAAC,WAAW,EAAE;gBACxG,OAAO,IAAI,CAAC;aACZ;YAED,MAAM,OAAO,GAAG,aAAa,CAAC,OAAO,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC;YAElE,IAAI,CAAC,OAAO,EAAE;gBACb,OAAO,KAAK,CAAC;aACb;YAED,IAAI,OAAO,CAAC,KAAK,KAAK,EAAE,EAAE;gBACzB,oFAAoF;gBACpF,IAAI,aAAa,CAAC,OAAO,IAAI,aAAa,CAAC,OAAO,EAAE;oBACnD,UAAU,CAAC,GAAG,EAAE;wBACf,IAAI,CAAC,qBAAqB,EAAE,CAAC,IAAI,CAAC,CAAC,MAAuC,EAAE,EAAE;4BAC7E,IAAI,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,EAAE;gCACpC,OAAO;6BACP;4BAED,IAAI,CAAC,uBAAuB,EAAE,CAAC;wBAChC,CAAC,CAAC,CAAC;oBACJ,CAAC,EAAE,GAAG,CAAC,CAAC;iBACR;gBACD,OAAO,IAAI,CAAC;aACZ;YAED,MAAM,aAAa,GAAG,qBAAqB,CAAC,MAAM,IAAI,qBAAqB,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;gBAC9G,qBAAqB,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;oBACjD,qBAAqB,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC;YAErE,MAAM,MAAM,GAAG,CAAC,qBAAqB,CAAC,MAAM,IAAI,qBAAqB,CAAC,QAAQ,IAAI,OAAO,CAAC,uBAAuB,CAAC;gBACjH,CAAC,qBAAqB,CAAC,MAAM,IAAI,OAAO,CAAC,kBAAkB,CAAC;gBAC5D,CAAC,qBAAqB,CAAC,QAAQ,IAAI,OAAO,CAAC,kBAAkB,CAAC;gBAC9D,OAAO,CAAC,cAAc,CAAC;YAExB,IAAI,MAAM,IAAI,qBAAqB,CAAC,YAAY,CAAC,GAAG,KAAK,MAAM,EAAE;gBAChE,OAAO,KAAK,CAAC;aACb;YAED,gHAAgH;YAChH,IAAI,CAAC,MAAM,IAAI,qBAAqB,CAAC,YAAY,CAAC,GAAG,KAAK,aAAa,EAAE;gBACxE,OAAO,KAAK,CAAC;aACb;YAED,OAAO,IAAI,CAAC;QACb,CAAC;QAEO,KAAK,CAAC,qBAAqB,CAAC,aAA8B;YACjE,IAAK,SAAiB,CAAC,QAAQ,EAAE;gBAChC,IAAI;oBACH,OAAQ,SAAiB,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,CAAC,CAAM,EAAE,EAAE;wBACjE,IAAI,GAAG,GAAqB,EAAE,CAAC;wBAC/B,KAAK,IAAI,GAAG,IAAI,CAAC,EAAE;4BAClB,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG;gCACb,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;gCACf,WAAW,EAAE,EAAE;gCACf,WAAW,EAAE,EAAE;gCACf,gBAAgB,EAAE,EAAE;6BACpB,CAAC;yBACF;wBAED,OAAO,GAAG,CAAC;wBAEX,gEAAgE;wBAEhE,+BAA+B;wBAC/B,gDAAgD;wBAChD,IAAI;wBAEJ,eAAe;oBAChB,CAAC,CAAC,CAAC;iBACH;gBAAC,WAAM;oBACP,mEAAmE;iBACnE;aACD;iBAAM,IAAI,aAAa,IAAI,CAAC,aAAa,CAAC,QAAQ,IAAI,CAAC,aAAa,CAAC,MAAM,IAAI,CAAC,aAAa,CAAC,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE;gBACjI,IAAI,GAAG,GAAqB,EAAE,CAAC;gBAC/B,MAAM,qBAAqB,GAAG,aAAsC,CAAC;gBACrE,GAAG,CAAC,qBAAqB,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG;oBAC9C,OAAO,EAAE,qBAAqB,CAAC,YAAY,CAAC,GAAG;oBAC/C,WAAW,EAAE,EAAE;oBACf,WAAW,EAAE,EAAE;oBACf,gBAAgB,EAAE,EAAE;iBACpB,CAAC;gBAEF,MAAM,qBAAqB,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;gBAE7D,IAAI,qBAAqB,EAAE;oBAC1B,OAAO,GAAG,CAAC;iBACX;gBAED,OAAO,IAAI,CAAC;aACZ;YAED,OAAO,IAAI,CAAC;QACb,CAAC;KAGD;IAlZD,4EAkZC;IAED,MAAa,4BAA6B,SAAQ,gCAAgC;QACjF,YAAY,mBAAyC,EAAE,cAA+B,EAAE,cAA+B;YACtH,8DAA8D;YAC9D,KAAK,EAAE,CAAC;YAER,MAAM,QAAQ,GAAG,oBAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,sBAAW,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC;YAEtE,gDAAO,+EAA+E,GAAG,QAAQ,4BAAE,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE;gBAC7G,IAAI,WAAW,GAAkB,CAAC,CAAC,0BAA0B,CAAC,QAAQ,CAAC,WAAW,CAAC;gBACnF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,uBAAU,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;gBAClJ,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC;gBAC9B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,IAAI,CAAC,uBAAuB,EAAE,CAAC;YAChC,CAAC,CAAC,CAAC;QACJ,CAAC;KACD;IAfD,oEAeC;IAED,MAAM,kBAAmB,SAAQ,sBAAU;QAS1C,YACkB,sBAA2B,EAC3B,WAAyB;YAE1C,KAAK,EAAE,CAAC;YAHS,2BAAsB,GAAtB,sBAAsB,CAAK;YAC3B,gBAAW,GAAX,WAAW,CAAc;YARxB,iBAAY,GAAkB,IAAI,CAAC,SAAS,CAAC,IAAI,eAAO,EAAQ,CAAC,CAAC;YAC5E,gBAAW,GAAgB,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;YAW3D,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAE5B,IAAI,CAAC,4BAA4B,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,wBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBAC1G,IAAI,OAAO,EAAE;oBACZ,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;iBACzB;YACF,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAET,IAAI,CAAC,SAAS,CAAC,aAAK,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,4BAA4B,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;QACnK,CAAC;QAjBD,IAAI,cAAc,KAAwB,OAAO,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;QAmBxE,KAAK,CAAC,UAAU;YACf,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC;QACrB,CAAC;QAEO,KAAK,CAAC,MAAM;YACnB,MAAM,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC;YACtC,IAAI;gBACH,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;gBAC7E,MAAM,KAAK,GAAG,CAAA,GAAA,YAAK,CAAA,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;gBAC9C,IAAI,CAAA,GAAA,kBAAW,CAAA,CAAC,KAAK,CAAC,KAAK,QAAQ,EAAE;oBACpC,MAAM,UAAU,GAAG,KAAK,CAAC,MAAM,CAAC;oBAChC,MAAM,QAAQ,GAAG,KAAK,CAAC,UAAU,CAAC;oBAClC,IAAI,CAAC,eAAe,GAAG,uBAAU,CAAC,iCAAiC,CAAC,UAAU,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;iBAChG;qBAAM;oBACN,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;iBAC5B;aACD;YAAC,OAAO,CAAC,EAAE;gBACX,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;aAC5B;YAED,OAAO,QAAQ,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QAC1E,CAAC;KAED;IAED,IAAa,4BAA4B,GAAzC,MAAa,4BAA6B,SAAQ,sBAAU;QAY3D,YACsB,kBAAuC,EAC9C,WAAyB,EACjB,mBAAyC,EAC9C,cAA+B,EAC/B,cAA+B,EACjB,oBAA2C;YAE1E,KAAK,EAAE,CAAC;YAFuB,yBAAoB,GAApB,oBAAoB,CAAuB;YAf1D,+BAA0B,GAAG,IAAI,eAAO,EAAQ,CAAC;YAClD,8BAAyB,GAAgB,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC;YAI9E,yBAAoB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,6BAAiB,EAAE,CAAC,CAAC;YAa/E,MAAM,cAAc,GAAG,oBAAoB,CAAC,QAAQ,CAAqB,UAAU,CAAC,CAAC;YACrF,MAAM,MAAM,GAAG,cAAc,CAAC,MAAM,CAAC;YACrC,IAAI,CAAC,mBAAmB,GAAG,MAAM,aAAN,MAAM,cAAN,MAAM,GAAI,YAAY,CAAC;YAClD,IAAI,CAAC,QAAQ,GAAG,IAAI,4BAA4B,CAAC,mBAAmB,EAAE,cAAc,EAAE,cAAc,CAAC,CAAC;YAEtG,IAAI,CAAC,wBAAwB,EAAE,CAAC;YAEhC,IAAI,MAAM,IAAI,MAAM,KAAK,YAAY,EAAE;gBACtC,sBAAsB;gBACtB,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;aACxC;YAED,IAAI,CAAC,SAAS,CAAC,oBAAoB,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE;gBAChE,IAAI,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE;oBACnD,MAAM,cAAc,GAAG,oBAAoB,CAAC,QAAQ,CAAqB,UAAU,CAAC,CAAC;oBACrF,MAAM,MAAM,GAAG,cAAc,CAAC,MAAM,CAAC;oBACrC,IAAI,CAAC,mBAAmB,GAAG,MAAM,CAAC;oBAElC,IAAI,MAAM,KAAK,YAAY,EAAE;wBAC5B,IAAI,CAAC,wBAAwB,EAAE,CAAC;wBAChC,IAAI,CAAC,QAAQ,CAAC,uBAAuB,EAAE,CAAC;qBACxC;yBAAM;wBACN,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;wBACxC,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE,CAAC;qBAClC;iBACD;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,mBAAmB,GAAG,IAAI,kBAAkB,CAAC,kBAAkB,CAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC;YAC1G,IAAI,CAAC,mBAAmB,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE;gBAC/C,IAAI,IAAI,CAAC,mBAAmB,CAAC,cAAc,EAAE;oBAC5C,IAAI,CAAC,QAAQ,CAAC,sBAAsB,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;oBAE9E,IAAI,CAAC,8BAA8B,EAAE,CAAC;iBACtC;YACF,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,GAAG,EAAE;gBACxD,IAAI,mBAAmB,GAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;gBAElG,IAAI,mBAAmB,CAAC,MAAM,EAAE;oBAC/B,IAAI,IAAI,CAAC,mBAAmB,CAAC,cAAc,EAAE;wBAC5C,mBAAmB,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;qBACvE;yBAAM;wBACN,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC;qBAC3D;iBACD;qBAAM;oBACN,IAAI,IAAI,CAAC,mBAAmB,CAAC,cAAc,EAAE;wBAC5C,IAAI,CAAC,QAAQ,CAAC,sBAAsB,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;qBAC9E;iBACD;gBAED,IAAI,CAAC,8BAA8B,EAAE,CAAC;YACvC,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAED,8BAA8B;YAC7B,MAAM,cAAc,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAqB,UAAU,CAAC,CAAC;YAC1F,MAAM,MAAM,GAAG,cAAc,CAAC,MAAM,CAAC;YAErC,IAAI,MAAM,IAAI,IAAI,CAAC,mBAAmB,CAAC,cAAc,EAAE;gBACtD,IAAI,CAAA,GAAA,oCAAmB,CAAA,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE;oBAEjH,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE;wBAC/E,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;qBAC3E;iBACD;aACD;QACF,CAAC;QAED,wBAAwB;YACvB,IAAI,CAAC,oBAAoB,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,GAAG,EAAE;gBAC9E,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC;YACxC,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,iBAAiB,CAAC,cAA8B;YAC/C,OAAO,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;QACxD,CAAC;QAEM,wBAAwB;YAC9B,OAAO,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC;QAC3C,CAAC;QAEM,qBAAqB;YAC3B,OAAO,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC;QACtC,CAAC;QAEM,qBAAqB;YAC3B,OAAO,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC;QACvC,CAAC;QAEM,8BAA8B,CAAC,aAA6B;YAClE,IAAI,IAAI,CAAC,mBAAmB,KAAK,YAAY,EAAE;gBAC9C,OAAO;aACP;YAED,IAAI,CAAC,QAAQ,CAAC,8BAA8B,CAAC,aAAa,CAAC,CAAC;QAC7D,CAAC;KACD,CAAA;IAxHY,4BAA4B;QAatC,WAAA,iCAAmB,CAAA;QACnB,WAAA,oBAAY,CAAA;QACZ,WAAA,mCAAoB,CAAA;QACpB,WAAA,yBAAe,CAAA;QACf,WAAA,0BAAe,CAAA;QACf,WAAA,qCAAqB,CAAA;OAlBX,4BAA4B,CAwHxC;IAxHY,oEAA4B;IA0HzC,CAAA,GAAA,8BAAiB,CAAA,CAAC,uCAAsB,EAAE,4BAA4B,EAAE,IAAI,CAAC,CAAC;IAE9E,gBAAgB;IAChB,MAAM,qBAAqB,GAAG,mBAAQ,CAAC,EAAE,CAAyB,kCAAgB,CAAC,aAAa,CAAC,CAAC;IAClG,MAAM,qBAAqB,GAAuB;QACjD,IAAI,EAAE,UAAU;QAChB,OAAO,EAAE,EAAE;QACX,MAAM,EAAE,QAAQ;QAChB,OAAO,EAAE,GAAG,CAAC,QAAQ,CAAC,CAA4B,EAAE,IAAU,CAAC;QAC/D,YAAY,EAAE;YACb,iBAAiB,EAAE;gBAClB,MAAM,EAAE,QAAQ;gBAChB,SAAS,EAAE,YAAY;gBACvB,aAAa,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAwB,EAAE,IAA0C,CAAC;aACjG;SACD;KACD,CAAC;IAEF,qBAAqB,CAAC,qBAAqB,CAAC,qBAAqB,CAAC,CAAC","file":"keyboardLayoutService.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { KeymapInfo, IRawMixedKeyboardMapping, IKeymapInfo } from 'vs/workbench/services/keybinding/common/keymapInfo';\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { DispatchConfig } from 'vs/platform/keyboardLayout/common/dispatchConfig';\nimport { IKeyboardMapper, CachedKeyboardMapper } from 'vs/platform/keyboardLayout/common/keyboardMapper';\nimport { OS, OperatingSystem, isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { WindowsKeyboardMapper } from 'vs/workbench/services/keybinding/common/windowsKeyboardMapper';\nimport { MacLinuxFallbackKeyboardMapper } from 'vs/workbench/services/keybinding/common/macLinuxFallbackKeyboardMapper';\nimport { IKeyboardEvent } from 'vs/platform/keybinding/common/keybinding';\nimport { MacLinuxKeyboardMapper } from 'vs/workbench/services/keybinding/common/macLinuxKeyboardMapper';\nimport { StandardKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { URI } from 'vs/base/common/uri';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { parse, getNodeType } from 'vs/base/common/json';\nimport * as objects from 'vs/base/common/objects';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { Extensions as ConfigExtensions, IConfigurationRegistry, IConfigurationNode } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { INavigatorWithKeyboard } from 'vs/workbench/services/keybinding/browser/navigatorKeyboard';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { getKeyboardLayoutId, IKeyboardLayoutInfo, IKeyboardLayoutService, IKeyboardMapping, IMacLinuxKeyboardMapping, IWindowsKeyboardMapping } from 'vs/platform/keyboardLayout/common/keyboardLayout';\n\nexport class BrowserKeyboardMapperFactoryBase {\n\t// keyboard mapper\n\tprotected _initialized: boolean;\n\tprotected _keyboardMapper: IKeyboardMapper | null;\n\tprivate readonly _onDidChangeKeyboardMapper = new Emitter<void>();\n\tpublic readonly onDidChangeKeyboardMapper: Event<void> = this._onDidChangeKeyboardMapper.event;\n\n\t// keymap infos\n\tprotected _keymapInfos: KeymapInfo[];\n\tprotected _mru: KeymapInfo[];\n\tprivate _activeKeymapInfo: KeymapInfo | null;\n\n\tget activeKeymap(): KeymapInfo | null {\n\t\treturn this._activeKeymapInfo;\n\t}\n\n\tget keymapInfos(): KeymapInfo[] {\n\t\treturn this._keymapInfos;\n\t}\n\n\tget activeKeyboardLayout(): IKeyboardLayoutInfo | null {\n\t\tif (!this._initialized) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._activeKeymapInfo && this._activeKeymapInfo.layout;\n\t}\n\n\tget activeKeyMapping(): IKeyboardMapping | null {\n\t\tif (!this._initialized) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._activeKeymapInfo && this._activeKeymapInfo.mapping;\n\t}\n\n\tget keyboardLayouts(): IKeyboardLayoutInfo[] {\n\t\treturn this._keymapInfos.map(keymapInfo => keymapInfo.layout);\n\t}\n\n\tprotected constructor(\n\t\t// private _notificationService: INotificationService,\n\t\t// private _storageService: IStorageService,\n\t\t// private _commandService: ICommandService\n\t) {\n\t\tthis._keyboardMapper = null;\n\t\tthis._initialized = false;\n\t\tthis._keymapInfos = [];\n\t\tthis._mru = [];\n\t\tthis._activeKeymapInfo = null;\n\n\t\tif ((<INavigatorWithKeyboard>navigator).keyboard && (<INavigatorWithKeyboard>navigator).keyboard.addEventListener) {\n\t\t\t(<INavigatorWithKeyboard>navigator).keyboard.addEventListener!('layoutchange', () => {\n\t\t\t\t// Update user keyboard map settings\n\t\t\t\tthis._getBrowserKeyMapping().then((mapping: IKeyboardMapping | null) => {\n\t\t\t\t\tif (this.isKeyMappingActive(mapping)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.onKeyboardLayoutChanged();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tregisterKeyboardLayout(layout: KeymapInfo) {\n\t\tthis._keymapInfos.push(layout);\n\t\tthis._mru = this._keymapInfos;\n\t}\n\n\tremoveKeyboardLayout(layout: KeymapInfo): void {\n\t\tlet index = this._mru.indexOf(layout);\n\t\tthis._mru.splice(index, 1);\n\t\tindex = this._keymapInfos.indexOf(layout);\n\t\tthis._keymapInfos.splice(index, 1);\n\t}\n\n\tgetMatchedKeymapInfo(keyMapping: IKeyboardMapping | null): { result: KeymapInfo, score: number } | null {\n\t\tif (!keyMapping) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet usStandard = this.getUSStandardLayout();\n\n\t\tif (usStandard) {\n\t\t\tlet maxScore = usStandard.getScore(keyMapping);\n\t\t\tif (maxScore === 0) {\n\t\t\t\treturn {\n\t\t\t\t\tresult: usStandard,\n\t\t\t\t\tscore: 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet result = usStandard;\n\t\t\tfor (let i = 0; i < this._mru.length; i++) {\n\t\t\t\tlet score = this._mru[i].getScore(keyMapping);\n\t\t\t\tif (score > maxScore) {\n\t\t\t\t\tif (score === 0) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tresult: this._mru[i],\n\t\t\t\t\t\t\tscore: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tmaxScore = score;\n\t\t\t\t\tresult = this._mru[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tresult,\n\t\t\t\tscore: maxScore\n\t\t\t};\n\t\t}\n\n\t\tfor (let i = 0; i < this._mru.length; i++) {\n\t\t\tif (this._mru[i].fuzzyEqual(keyMapping)) {\n\t\t\t\treturn {\n\t\t\t\t\tresult: this._mru[i],\n\t\t\t\t\tscore: 0\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetUSStandardLayout() {\n\t\tconst usStandardLayouts = this._mru.filter(layout => layout.layout.isUSStandard);\n\n\t\tif (usStandardLayouts.length) {\n\t\t\treturn usStandardLayouts[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisKeyMappingActive(keymap: IKeyboardMapping | null) {\n\t\treturn this._activeKeymapInfo && keymap && this._activeKeymapInfo.fuzzyEqual(keymap);\n\t}\n\n\tsetUSKeyboardLayout() {\n\t\tthis._activeKeymapInfo = this.getUSStandardLayout();\n\t}\n\n\tsetActiveKeyMapping(keymap: IKeyboardMapping | null) {\n\t\tlet keymapUpdated = false;\n\t\tlet matchedKeyboardLayout = this.getMatchedKeymapInfo(keymap);\n\t\tif (matchedKeyboardLayout) {\n\t\t\t// let score = matchedKeyboardLayout.score;\n\n\t\t\t// Due to https://bugs.chromium.org/p/chromium/issues/detail?id=977609, any key after a dead key will generate a wrong mapping,\n\t\t\t// we shoud avoid yielding the false error.\n\t\t\t// if (keymap && score < 0) {\n\t\t\t// const donotAskUpdateKey = 'missing.keyboardlayout.donotask';\n\t\t\t// if (this._storageService.getBoolean(donotAskUpdateKey, StorageScope.GLOBAL)) {\n\t\t\t// \treturn;\n\t\t\t// }\n\n\t\t\t// the keyboard layout doesn't actually match the key event or the keymap from chromium\n\t\t\t// this._notificationService.prompt(\n\t\t\t// \tSeverity.Info,\n\t\t\t// \tnls.localize('missing.keyboardlayout', 'Fail to find matching keyboard layout'),\n\t\t\t// \t[{\n\t\t\t// \t\tlabel: nls.localize('keyboardLayoutMissing.configure', \"Configure\"),\n\t\t\t// \t\trun: () => this._commandService.executeCommand('workbench.action.openKeyboardLayoutPicker')\n\t\t\t// \t}, {\n\t\t\t// \t\tlabel: nls.localize('neverAgain', \"Don't Show Again\"),\n\t\t\t// \t\tisSecondary: true,\n\t\t\t// \t\trun: () => this._storageService.store(donotAskUpdateKey, true, StorageScope.GLOBAL)\n\t\t\t// \t}]\n\t\t\t// );\n\n\t\t\t// console.warn('Active keymap/keyevent does not match current keyboard layout', JSON.stringify(keymap), this._activeKeymapInfo ? JSON.stringify(this._activeKeymapInfo.layout) : '');\n\n\t\t\t// return;\n\t\t\t// }\n\n\t\t\tif (!this._activeKeymapInfo) {\n\t\t\t\tthis._activeKeymapInfo = matchedKeyboardLayout.result;\n\t\t\t\tkeymapUpdated = true;\n\t\t\t} else if (keymap) {\n\t\t\t\tif (matchedKeyboardLayout.result.getScore(keymap) > this._activeKeymapInfo.getScore(keymap)) {\n\t\t\t\t\tthis._activeKeymapInfo = matchedKeyboardLayout.result;\n\t\t\t\t\tkeymapUpdated = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this._activeKeymapInfo) {\n\t\t\tthis._activeKeymapInfo = this.getUSStandardLayout();\n\t\t\tkeymapUpdated = true;\n\t\t}\n\n\t\tif (!this._activeKeymapInfo || !keymapUpdated) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this._mru.indexOf(this._activeKeymapInfo);\n\n\t\tthis._mru.splice(index, 1);\n\t\tthis._mru.unshift(this._activeKeymapInfo);\n\n\t\tthis._setKeyboardData(this._activeKeymapInfo);\n\t}\n\n\tsetActiveKeymapInfo(keymapInfo: KeymapInfo) {\n\t\tthis._activeKeymapInfo = keymapInfo;\n\n\t\tconst index = this._mru.indexOf(this._activeKeymapInfo);\n\n\t\tif (index === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mru.splice(index, 1);\n\t\tthis._mru.unshift(this._activeKeymapInfo);\n\n\t\tthis._setKeyboardData(this._activeKeymapInfo);\n\t}\n\n\tpublic onKeyboardLayoutChanged(): void {\n\t\tthis._updateKeyboardLayoutAsync(this._initialized);\n\t}\n\n\tprivate _updateKeyboardLayoutAsync(initialized: boolean, keyboardEvent?: IKeyboardEvent) {\n\t\tif (!initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._getBrowserKeyMapping(keyboardEvent).then(keyMap => {\n\t\t\t// might be false positive\n\t\t\tif (this.isKeyMappingActive(keyMap)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.setActiveKeyMapping(keyMap);\n\t\t});\n\t}\n\n\tpublic getKeyboardMapper(dispatchConfig: DispatchConfig): IKeyboardMapper {\n\t\tif (!this._initialized) {\n\t\t\treturn new MacLinuxFallbackKeyboardMapper(OS);\n\t\t}\n\t\tif (dispatchConfig === DispatchConfig.KeyCode) {\n\t\t\t// Forcefully set to use keyCode\n\t\t\treturn new MacLinuxFallbackKeyboardMapper(OS);\n\t\t}\n\t\treturn this._keyboardMapper!;\n\t}\n\n\tpublic validateCurrentKeyboardMapping(keyboardEvent: IKeyboardEvent): void {\n\t\tif (!this._initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet isCurrentKeyboard = this._validateCurrentKeyboardMapping(keyboardEvent);\n\n\t\tif (isCurrentKeyboard) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateKeyboardLayoutAsync(true, keyboardEvent);\n\t}\n\n\tpublic setKeyboardLayout(layoutName: string) {\n\t\tlet matchedLayouts: KeymapInfo[] = this.keymapInfos.filter(keymapInfo => getKeyboardLayoutId(keymapInfo.layout) === layoutName);\n\n\t\tif (matchedLayouts.length > 0) {\n\t\t\tthis.setActiveKeymapInfo(matchedLayouts[0]);\n\t\t}\n\t}\n\n\tprivate _setKeyboardData(keymapInfo: KeymapInfo): void {\n\t\tthis._initialized = true;\n\n\t\tthis._keyboardMapper = new CachedKeyboardMapper(BrowserKeyboardMapperFactory._createKeyboardMapper(keymapInfo));\n\t\tthis._onDidChangeKeyboardMapper.fire();\n\t}\n\n\tprivate static _createKeyboardMapper(keymapInfo: KeymapInfo): IKeyboardMapper {\n\t\tlet rawMapping = keymapInfo.mapping;\n\t\tconst isUSStandard = !!keymapInfo.layout.isUSStandard;\n\t\tif (OS === OperatingSystem.Windows) {\n\t\t\treturn new WindowsKeyboardMapper(isUSStandard, <IWindowsKeyboardMapping>rawMapping);\n\t\t}\n\t\tif (Object.keys(rawMapping).length === 0) {\n\t\t\t// Looks like reading the mappings failed (most likely Mac + Japanese/Chinese keyboard layouts)\n\t\t\treturn new MacLinuxFallbackKeyboardMapper(OS);\n\t\t}\n\n\t\treturn new MacLinuxKeyboardMapper(isUSStandard, <IMacLinuxKeyboardMapping>rawMapping, OS);\n\t}\n\n\t//#region Browser API\n\tprivate _validateCurrentKeyboardMapping(keyboardEvent: IKeyboardEvent): boolean {\n\t\tif (!this._initialized) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst standardKeyboardEvent = keyboardEvent as StandardKeyboardEvent;\n\t\tconst currentKeymap = this._activeKeymapInfo;\n\t\tif (!currentKeymap) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (standardKeyboardEvent.browserEvent.key === 'Dead' || standardKeyboardEvent.browserEvent.isComposing) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst mapping = currentKeymap.mapping[standardKeyboardEvent.code];\n\n\t\tif (!mapping) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (mapping.value === '') {\n\t\t\t// The value is empty when the key is not a printable character, we skip validation.\n\t\t\tif (keyboardEvent.ctrlKey || keyboardEvent.metaKey) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._getBrowserKeyMapping().then((keymap: IRawMixedKeyboardMapping | null) => {\n\t\t\t\t\t\tif (this.isKeyMappingActive(keymap)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.onKeyboardLayoutChanged();\n\t\t\t\t\t});\n\t\t\t\t}, 350);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tconst expectedValue = standardKeyboardEvent.altKey && standardKeyboardEvent.shiftKey ? mapping.withShiftAltGr :\n\t\t\tstandardKeyboardEvent.altKey ? mapping.withAltGr :\n\t\t\t\tstandardKeyboardEvent.shiftKey ? mapping.withShift : mapping.value;\n\n\t\tconst isDead = (standardKeyboardEvent.altKey && standardKeyboardEvent.shiftKey && mapping.withShiftAltGrIsDeadKey) ||\n\t\t\t(standardKeyboardEvent.altKey && mapping.withAltGrIsDeadKey) ||\n\t\t\t(standardKeyboardEvent.shiftKey && mapping.withShiftIsDeadKey) ||\n\t\t\tmapping.valueIsDeadKey;\n\n\t\tif (isDead && standardKeyboardEvent.browserEvent.key !== 'Dead') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// TODO, this assumption is wrong as `browserEvent.key` doesn't necessarily equal expectedValue from real keymap\n\t\tif (!isDead && standardKeyboardEvent.browserEvent.key !== expectedValue) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async _getBrowserKeyMapping(keyboardEvent?: IKeyboardEvent): Promise<IRawMixedKeyboardMapping | null> {\n\t\tif ((navigator as any).keyboard) {\n\t\t\ttry {\n\t\t\t\treturn (navigator as any).keyboard.getLayoutMap().then((e: any) => {\n\t\t\t\t\tlet ret: IKeyboardMapping = {};\n\t\t\t\t\tfor (let key of e) {\n\t\t\t\t\t\tret[key[0]] = {\n\t\t\t\t\t\t\t'value': key[1],\n\t\t\t\t\t\t\t'withShift': '',\n\t\t\t\t\t\t\t'withAltGr': '',\n\t\t\t\t\t\t\t'withShiftAltGr': ''\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\n\t\t\t\t\t// const matchedKeyboardLayout = this.getMatchedKeymapInfo(ret);\n\n\t\t\t\t\t// if (matchedKeyboardLayout) {\n\t\t\t\t\t// \treturn matchedKeyboardLayout.result.mapping;\n\t\t\t\t\t// }\n\n\t\t\t\t\t// return null;\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\t// getLayoutMap can throw if invoked from a nested browsing context\n\t\t\t}\n\t\t} else if (keyboardEvent && !keyboardEvent.shiftKey && !keyboardEvent.altKey && !keyboardEvent.metaKey && !keyboardEvent.metaKey) {\n\t\t\tlet ret: IKeyboardMapping = {};\n\t\t\tconst standardKeyboardEvent = keyboardEvent as StandardKeyboardEvent;\n\t\t\tret[standardKeyboardEvent.browserEvent.code] = {\n\t\t\t\t'value': standardKeyboardEvent.browserEvent.key,\n\t\t\t\t'withShift': '',\n\t\t\t\t'withAltGr': '',\n\t\t\t\t'withShiftAltGr': ''\n\t\t\t};\n\n\t\t\tconst matchedKeyboardLayout = this.getMatchedKeymapInfo(ret);\n\n\t\t\tif (matchedKeyboardLayout) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t//#endregion\n}\n\nexport class BrowserKeyboardMapperFactory extends BrowserKeyboardMapperFactoryBase {\n\tconstructor(notificationService: INotificationService, storageService: IStorageService, commandService: ICommandService) {\n\t\t// super(notificationService, storageService, commandService);\n\t\tsuper();\n\n\t\tconst platform = isWindows ? 'win' : isMacintosh ? 'darwin' : 'linux';\n\n\t\timport('vs/workbench/services/keybinding/browser/keyboardLayouts/layout.contribution.' + platform).then((m) => {\n\t\t\tlet keymapInfos: IKeymapInfo[] = m.KeyboardLayoutContribution.INSTANCE.layoutInfos;\n\t\t\tthis._keymapInfos.push(...keymapInfos.map(info => (new KeymapInfo(info.layout, info.secondaryLayouts, info.mapping, info.isUserKeyboardLayout))));\n\t\t\tthis._mru = this._keymapInfos;\n\t\t\tthis._initialized = true;\n\t\t\tthis.onKeyboardLayoutChanged();\n\t\t});\n\t}\n}\n\nclass UserKeyboardLayout extends Disposable {\n\n\tprivate readonly reloadConfigurationScheduler: RunOnceScheduler;\n\tprotected readonly _onDidChange: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tprivate _keyboardLayout: KeymapInfo | null;\n\tget keyboardLayout(): KeymapInfo | null { return this._keyboardLayout; }\n\n\tconstructor(\n\t\tprivate readonly keyboardLayoutResource: URI,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._keyboardLayout = null;\n\n\t\tthis.reloadConfigurationScheduler = this._register(new RunOnceScheduler(() => this.reload().then(changed => {\n\t\t\tif (changed) {\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t}\n\t\t}), 50));\n\n\t\tthis._register(Event.filter(this.fileService.onDidFilesChange, e => e.contains(this.keyboardLayoutResource))(() => this.reloadConfigurationScheduler.schedule()));\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tawait this.reload();\n\t}\n\n\tprivate async reload(): Promise<boolean> {\n\t\tconst existing = this._keyboardLayout;\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.keyboardLayoutResource);\n\t\t\tconst value = parse(content.value.toString());\n\t\t\tif (getNodeType(value) === 'object') {\n\t\t\t\tconst layoutInfo = value.layout;\n\t\t\t\tconst mappings = value.rawMapping;\n\t\t\t\tthis._keyboardLayout = KeymapInfo.createKeyboardLayoutFromDebugInfo(layoutInfo, mappings, true);\n\t\t\t} else {\n\t\t\t\tthis._keyboardLayout = null;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis._keyboardLayout = null;\n\t\t}\n\n\t\treturn existing ? !objects.equals(existing, this._keyboardLayout) : true;\n\t}\n\n}\n\nexport class BrowserKeyboardLayoutService extends Disposable implements IKeyboardLayoutService {\n\tpublic _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeKeyboardLayout = new Emitter<void>();\n\tpublic readonly onDidChangeKeyboardLayout: Event<void> = this._onDidChangeKeyboardLayout.event;\n\n\tprivate _userKeyboardLayout: UserKeyboardLayout;\n\n\tprivate readonly layoutChangeListener = this._register(new MutableDisposable());\n\tprivate readonly _factory: BrowserKeyboardMapperFactory;\n\tprivate _keyboardLayoutMode: string;\n\n\tconstructor(\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\t\tconst keyboardConfig = configurationService.getValue<{ layout: string }>('keyboard');\n\t\tconst layout = keyboardConfig.layout;\n\t\tthis._keyboardLayoutMode = layout ?? 'autodetect';\n\t\tthis._factory = new BrowserKeyboardMapperFactory(notificationService, storageService, commandService);\n\n\t\tthis.registerKeyboardListener();\n\n\t\tif (layout && layout !== 'autodetect') {\n\t\t\t// set keyboard layout\n\t\t\tthis._factory.setKeyboardLayout(layout);\n\t\t}\n\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectedKeys.indexOf('keyboard.layout') >= 0) {\n\t\t\t\tconst keyboardConfig = configurationService.getValue<{ layout: string }>('keyboard');\n\t\t\t\tconst layout = keyboardConfig.layout;\n\t\t\t\tthis._keyboardLayoutMode = layout;\n\n\t\t\t\tif (layout === 'autodetect') {\n\t\t\t\t\tthis.registerKeyboardListener();\n\t\t\t\t\tthis._factory.onKeyboardLayoutChanged();\n\t\t\t\t} else {\n\t\t\t\t\tthis._factory.setKeyboardLayout(layout);\n\t\t\t\t\tthis.layoutChangeListener.clear();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._userKeyboardLayout = new UserKeyboardLayout(environmentService.keyboardLayoutResource, fileService);\n\t\tthis._userKeyboardLayout.initialize().then(() => {\n\t\t\tif (this._userKeyboardLayout.keyboardLayout) {\n\t\t\t\tthis._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout);\n\n\t\t\t\tthis.setUserKeyboardLayoutIfMatched();\n\t\t\t}\n\t\t});\n\n\t\tthis._register(this._userKeyboardLayout.onDidChange(() => {\n\t\t\tlet userKeyboardLayouts = this._factory.keymapInfos.filter(layout => layout.isUserKeyboardLayout);\n\n\t\t\tif (userKeyboardLayouts.length) {\n\t\t\t\tif (this._userKeyboardLayout.keyboardLayout) {\n\t\t\t\t\tuserKeyboardLayouts[0].update(this._userKeyboardLayout.keyboardLayout);\n\t\t\t\t} else {\n\t\t\t\t\tthis._factory.removeKeyboardLayout(userKeyboardLayouts[0]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._userKeyboardLayout.keyboardLayout) {\n\t\t\t\t\tthis._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setUserKeyboardLayoutIfMatched();\n\t\t}));\n\t}\n\n\tsetUserKeyboardLayoutIfMatched() {\n\t\tconst keyboardConfig = this.configurationService.getValue<{ layout: string }>('keyboard');\n\t\tconst layout = keyboardConfig.layout;\n\n\t\tif (layout && this._userKeyboardLayout.keyboardLayout) {\n\t\t\tif (getKeyboardLayoutId(this._userKeyboardLayout.keyboardLayout.layout) === layout && this._factory.activeKeymap) {\n\n\t\t\t\tif (!this._userKeyboardLayout.keyboardLayout.equal(this._factory.activeKeymap)) {\n\t\t\t\t\tthis._factory.setActiveKeymapInfo(this._userKeyboardLayout.keyboardLayout);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tregisterKeyboardListener() {\n\t\tthis.layoutChangeListener.value = this._factory.onDidChangeKeyboardMapper(() => {\n\t\t\tthis._onDidChangeKeyboardLayout.fire();\n\t\t});\n\t}\n\n\tgetKeyboardMapper(dispatchConfig: DispatchConfig): IKeyboardMapper {\n\t\treturn this._factory.getKeyboardMapper(dispatchConfig);\n\t}\n\n\tpublic getCurrentKeyboardLayout(): IKeyboardLayoutInfo | null {\n\t\treturn this._factory.activeKeyboardLayout;\n\t}\n\n\tpublic getAllKeyboardLayouts(): IKeyboardLayoutInfo[] {\n\t\treturn this._factory.keyboardLayouts;\n\t}\n\n\tpublic getRawKeyboardMapping(): IKeyboardMapping | null {\n\t\treturn this._factory.activeKeyMapping;\n\t}\n\n\tpublic validateCurrentKeyboardMapping(keyboardEvent: IKeyboardEvent): void {\n\t\tif (this._keyboardLayoutMode !== 'autodetect') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._factory.validateCurrentKeyboardMapping(keyboardEvent);\n\t}\n}\n\nregisterSingleton(IKeyboardLayoutService, BrowserKeyboardLayoutService, true);\n\n// Configuration\nconst configurationRegistry = Registry.as<IConfigurationRegistry>(ConfigExtensions.Configuration);\nconst keyboardConfiguration: IConfigurationNode = {\n\t'id': 'keyboard',\n\t'order': 15,\n\t'type': 'object',\n\t'title': nls.localize('keyboardConfigurationTitle', \"Keyboard\"),\n\t'properties': {\n\t\t'keyboard.layout': {\n\t\t\t'type': 'string',\n\t\t\t'default': 'autodetect',\n\t\t\t'description': nls.localize('keyboard.layout.config', \"Control the keyboard layout used in web.\")\n\t\t}\n\t}\n};\n\nconfigurationRegistry.registerConfiguration(keyboardConfiguration);\n"]}