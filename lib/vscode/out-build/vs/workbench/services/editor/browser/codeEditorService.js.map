{"version":3,"file":"codeEditorService.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/editor/browser/codeEditorService.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ICodeEditor, isCodeEditor, isDiffEditor, isCompositeEditor, getCodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { CodeEditorServiceImpl } from 'vs/editor/browser/services/codeEditorServiceImpl';\nimport { ScrollType } from 'vs/editor/common/editorCommon';\nimport { IResourceEditorInput } from 'vs/platform/editor/common/editor';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { IWorkbenchEditorConfiguration, TextEditorOptions } from 'vs/workbench/common/editor';\nimport { ACTIVE_GROUP, IEditorService, SIDE_GROUP } from 'vs/workbench/services/editor/common/editorService';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { isEqual } from 'vs/base/common/resources';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\n\nexport class CodeEditorService extends CodeEditorServiceImpl {\n\n\tconstructor(\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper(null, themeService);\n\t}\n\n\tgetActiveCodeEditor(): ICodeEditor | null {\n\t\tconst activeTextEditorControl = this.editorService.activeTextEditorControl;\n\t\tif (isCodeEditor(activeTextEditorControl)) {\n\t\t\treturn activeTextEditorControl;\n\t\t}\n\n\t\tif (isDiffEditor(activeTextEditorControl)) {\n\t\t\treturn activeTextEditorControl.getModifiedEditor();\n\t\t}\n\n\t\tconst activeControl = this.editorService.activeEditorPane?.getControl();\n\t\tif (isCompositeEditor(activeControl) && isCodeEditor(activeControl.activeCodeEditor)) {\n\t\t\treturn activeControl.activeCodeEditor;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync openCodeEditor(input: IResourceEditorInput, source: ICodeEditor | null, sideBySide?: boolean): Promise<ICodeEditor | null> {\n\n\t\t// Special case: If the active editor is a diff editor and the request to open originates and\n\t\t// targets the modified side of it, we just apply the request there to prevent opening the modified\n\t\t// side as separate editor.\n\t\tconst activeTextEditorControl = this.editorService.activeTextEditorControl;\n\t\tif (\n\t\t\t!sideBySide &&\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// we need the current active group to be the taret\n\t\t\tisDiffEditor(activeTextEditorControl) && \t\t\t\t\t\t\t\t\t// we only support this for active text diff editors\n\t\t\tinput.options &&\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// we need options to apply\n\t\t\tinput.resource &&\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// we need a request resource to compare with\n\t\t\tactiveTextEditorControl.getModel() &&\t\t\t\t\t\t\t\t\t\t// we need a target model to compare with\n\t\t\tsource === activeTextEditorControl.getModifiedEditor() && \t\t\t\t\t// we need the source of this request to be the modified side of the diff editor\n\t\t\tisEqual(input.resource, activeTextEditorControl.getModel()!.modified.uri) \t// we need the input resources to match with modified side\n\t\t) {\n\t\t\tconst targetEditor = activeTextEditorControl.getModifiedEditor();\n\n\t\t\tconst textOptions = TextEditorOptions.create(input.options);\n\t\t\ttextOptions.apply(targetEditor, ScrollType.Smooth);\n\n\t\t\treturn targetEditor;\n\t\t}\n\n\t\t// Open using our normal editor service\n\t\treturn this.doOpenCodeEditor(input, source, sideBySide);\n\t}\n\n\tprivate async doOpenCodeEditor(input: IResourceEditorInput, source: ICodeEditor | null, sideBySide?: boolean): Promise<ICodeEditor | null> {\n\n\t\t// Special case: we want to detect the request to open an editor that\n\t\t// is different from the current one to decide whether the current editor\n\t\t// should be pinned or not. This ensures that the source of a navigation\n\t\t// is not being replaced by the target. An example is \"Goto definition\"\n\t\t// that otherwise would replace the editor everytime the user navigates.\n\t\tconst enablePreviewFromCodeNavigation = this.configurationService.getValue<IWorkbenchEditorConfiguration>().workbench?.editor?.enablePreviewFromCodeNavigation;\n\t\tif (\n\t\t\t!enablePreviewFromCodeNavigation &&              \t// we only need to do this if the configuration requires it\n\t\t\tsource &&\t\t\t\t\t\t\t\t\t\t\t// we need to know the origin of the navigation\n\t\t\t!input.options?.pinned &&\t\t\t\t\t\t\t// we only need to look at preview editors that open\n\t\t\t!sideBySide &&\t\t\t\t\t\t\t\t\t\t// we only need to care if editor opens in same group\n\t\t\t!isEqual(source.getModel()?.uri, input.resource)\t// we only need to do this if the editor is about to change\n\t\t) {\n\t\t\tfor (const visiblePane of this.editorService.visibleEditorPanes) {\n\t\t\t\tif (getCodeEditor(visiblePane.getControl()) === source) {\n\t\t\t\t\tvisiblePane.group.pinEditor();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Open as editor\n\t\tconst control = await this.editorService.openEditor(input, sideBySide ? SIDE_GROUP : ACTIVE_GROUP);\n\t\tif (control) {\n\t\t\tconst widget = control.getControl();\n\t\t\tif (isCodeEditor(widget)) {\n\t\t\t\treturn widget;\n\t\t\t}\n\n\t\t\tif (isCompositeEditor(widget) && isCodeEditor(widget.activeCodeEditor)) {\n\t\t\t\treturn widget.activeCodeEditor;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nregisterSingleton(ICodeEditorService, CodeEditorService, true);\n"]}