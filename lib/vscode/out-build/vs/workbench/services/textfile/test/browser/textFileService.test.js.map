{"version":3,"file":"textFileService.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/textfile/test/browser/textFileService.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { workbenchInstantiationService, TestServiceAccessor, TestTextFileEditorModelManager } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { toResource } from 'vs/base/test/common/utils';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { TextFileEditorModel } from 'vs/workbench/services/textfile/common/textFileEditorModel';\nimport { FileOperation } from 'vs/platform/files/common/files';\nimport { ModesRegistry } from 'vs/editor/common/modes/modesRegistry';\n\nsuite('Files - TextFileService', () => {\n\n\tlet instantiationService: IInstantiationService;\n\tlet model: TextFileEditorModel;\n\tlet accessor: TestServiceAccessor;\n\n\tsetup(() => {\n\t\tinstantiationService = workbenchInstantiationService();\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t});\n\n\tteardown(() => {\n\t\tmodel?.dispose();\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).dispose();\n\t});\n\n\ttest('isDirty/getDirty - files and untitled', async function () {\n\t\tmodel = instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/file.txt'), 'utf8', undefined);\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).add(model.resource, model);\n\n\t\tawait model.resolve();\n\n\t\tassert.ok(!accessor.textFileService.isDirty(model.resource));\n\t\tmodel.textEditorModel!.setValue('foo');\n\n\t\tassert.ok(accessor.textFileService.isDirty(model.resource));\n\n\t\tconst untitled = await accessor.textFileService.untitled.resolve();\n\n\t\tassert.ok(!accessor.textFileService.isDirty(untitled.resource));\n\t\tuntitled.textEditorModel?.setValue('changed');\n\n\t\tassert.ok(accessor.textFileService.isDirty(untitled.resource));\n\n\t\tuntitled.dispose();\n\t\tmodel.dispose();\n\t});\n\n\ttest('save - file', async function () {\n\t\tmodel = instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/file.txt'), 'utf8', undefined);\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).add(model.resource, model);\n\n\t\tawait model.resolve();\n\t\tmodel.textEditorModel!.setValue('foo');\n\t\tassert.ok(accessor.textFileService.isDirty(model.resource));\n\n\t\tconst res = await accessor.textFileService.save(model.resource);\n\t\tassert.strictEqual(res?.toString(), model.resource.toString());\n\t\tassert.ok(!accessor.textFileService.isDirty(model.resource));\n\t});\n\n\ttest('saveAll - file', async function () {\n\t\tmodel = instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/file.txt'), 'utf8', undefined);\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).add(model.resource, model);\n\n\t\tawait model.resolve();\n\t\tmodel.textEditorModel!.setValue('foo');\n\t\tassert.ok(accessor.textFileService.isDirty(model.resource));\n\n\t\tconst res = await accessor.textFileService.save(model.resource);\n\t\tassert.strictEqual(res?.toString(), model.resource.toString());\n\t\tassert.ok(!accessor.textFileService.isDirty(model.resource));\n\t});\n\n\ttest('saveAs - file', async function () {\n\t\tmodel = instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/file.txt'), 'utf8', undefined);\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).add(model.resource, model);\n\t\taccessor.fileDialogService.setPickFileToSave(model.resource);\n\n\t\tawait model.resolve();\n\t\tmodel.textEditorModel!.setValue('foo');\n\t\tassert.ok(accessor.textFileService.isDirty(model.resource));\n\n\t\tconst res = await accessor.textFileService.saveAs(model.resource);\n\t\tassert.strictEqual(res!.toString(), model.resource.toString());\n\t\tassert.ok(!accessor.textFileService.isDirty(model.resource));\n\t});\n\n\ttest('revert - file', async function () {\n\t\tmodel = instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/file.txt'), 'utf8', undefined);\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).add(model.resource, model);\n\t\taccessor.fileDialogService.setPickFileToSave(model.resource);\n\n\t\tawait model.resolve();\n\t\tmodel!.textEditorModel!.setValue('foo');\n\t\tassert.ok(accessor.textFileService.isDirty(model.resource));\n\n\t\tawait accessor.textFileService.revert(model.resource);\n\t\tassert.ok(!accessor.textFileService.isDirty(model.resource));\n\t});\n\n\ttest('create does not overwrite existing model', async function () {\n\t\tmodel = instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/file.txt'), 'utf8', undefined);\n\t\t(<TestTextFileEditorModelManager>accessor.textFileService.files).add(model.resource, model);\n\n\t\tawait model.resolve();\n\t\tmodel!.textEditorModel!.setValue('foo');\n\t\tassert.ok(accessor.textFileService.isDirty(model.resource));\n\n\t\tlet eventCounter = 0;\n\n\t\tconst disposable1 = accessor.workingCopyFileService.addFileOperationParticipant({\n\t\t\tparticipate: async files => {\n\t\t\t\tassert.strictEqual(files[0].target.toString(), model.resource.toString());\n\t\t\t\teventCounter++;\n\t\t\t}\n\t\t});\n\n\t\tconst disposable2 = accessor.workingCopyFileService.onDidRunWorkingCopyFileOperation(e => {\n\t\t\tassert.strictEqual(e.operation, FileOperation.CREATE);\n\t\t\tassert.strictEqual(e.files[0].target.toString(), model.resource.toString());\n\t\t\teventCounter++;\n\t\t});\n\n\t\tawait accessor.textFileService.create([{ resource: model.resource, value: 'Foo' }]);\n\t\tassert.ok(!accessor.textFileService.isDirty(model.resource));\n\n\t\tassert.strictEqual(eventCounter, 2);\n\n\t\tdisposable1.dispose();\n\t\tdisposable2.dispose();\n\t});\n\n\ttest('Filename Suggestion - Suggest prefix only when there are no relevant extensions', () => {\n\t\tModesRegistry.registerLanguage({\n\t\t\tid: 'plumbus0',\n\t\t\textensions: ['.one', '.two']\n\t\t});\n\n\t\tlet suggested = accessor.textFileService.suggestFilename('shleem', 'Untitled-1');\n\t\tassert.strictEqual(suggested, 'Untitled-1');\n\t});\n\n\ttest('Filename Suggestion - Suggest prefix with first extension', () => {\n\t\tModesRegistry.registerLanguage({\n\t\t\tid: 'plumbus1',\n\t\t\textensions: ['.shleem', '.gazorpazorp'],\n\t\t\tfilenames: ['plumbus']\n\t\t});\n\n\t\tlet suggested = accessor.textFileService.suggestFilename('plumbus1', 'Untitled-1');\n\t\tassert.strictEqual(suggested, 'Untitled-1.shleem');\n\t});\n\n\ttest('Filename Suggestion - Suggest filename if there are no extensions', () => {\n\t\tModesRegistry.registerLanguage({\n\t\t\tid: 'plumbus2',\n\t\t\tfilenames: ['plumbus', 'shleem', 'gazorpazorp']\n\t\t});\n\n\t\tlet suggested = accessor.textFileService.suggestFilename('plumbus2', 'Untitled-1');\n\t\tassert.strictEqual(suggested, 'plumbus');\n\t});\n});\n"]}