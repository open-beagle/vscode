{"version":3,"sources":["vs/workbench/services/authentication/browser/authenticationService.ts"],"names":[],"mappings":"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","file":"authenticationService.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { flatten } from 'vs/base/common/arrays';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\nimport { Disposable, IDisposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { isWeb } from 'vs/base/common/platform';\nimport { isFalsyOrWhitespace } from 'vs/base/common/strings';\nimport { isString } from 'vs/base/common/types';\nimport { AuthenticationProviderInformation, AuthenticationSession, AuthenticationSessionsChangeEvent } from 'vs/editor/common/modes';\nimport * as nls from 'vs/nls';\nimport { MenuId, MenuRegistry } from 'vs/platform/actions/common/actions';\nimport { CommandsRegistry } from 'vs/platform/commands/common/commands';\nimport { ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Severity } from 'vs/platform/notification/common/notification';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { IQuickInputService } from 'vs/platform/quickinput/common/quickInput';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { MainThreadAuthenticationProvider } from 'vs/workbench/api/browser/mainThreadAuthentication';\nimport { IActivityService, NumberBadge } from 'vs/workbench/services/activity/common/activity';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\nimport { ActivationKind, IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\nimport { ExtensionsRegistry } from 'vs/workbench/services/extensions/common/extensionsRegistry';\nimport { IRemoteAgentService } from 'vs/workbench/services/remote/common/remoteAgentService';\n\nexport function getAuthenticationProviderActivationEvent(id: string): string { return `onAuthenticationRequest:${id}`; }\n\nexport interface IAccountUsage {\n\textensionId: string;\n\textensionName: string;\n\tlastUsed: number;\n}\n\nconst VSO_ALLOWED_EXTENSIONS = ['github.vscode-pull-request-github', 'github.vscode-pull-request-github-insiders', 'vscode.git', 'ms-vsonline.vsonline', 'vscode.github-browser', 'ms-vscode.github-browser', 'ms-vscode.remotehub', 'ms-vscode.remotehub-insiders', 'github.codespaces'];\n\nexport function readAccountUsages(storageService: IStorageService, providerId: string, accountName: string,): IAccountUsage[] {\n\tconst accountKey = `${providerId}-${accountName}-usages`;\n\tconst storedUsages = storageService.get(accountKey, StorageScope.GLOBAL);\n\tlet usages: IAccountUsage[] = [];\n\tif (storedUsages) {\n\t\ttry {\n\t\t\tusages = JSON.parse(storedUsages);\n\t\t} catch (e) {\n\t\t\t// ignore\n\t\t}\n\t}\n\n\treturn usages;\n}\n\nexport function removeAccountUsage(storageService: IStorageService, providerId: string, accountName: string): void {\n\tconst accountKey = `${providerId}-${accountName}-usages`;\n\tstorageService.remove(accountKey, StorageScope.GLOBAL);\n}\n\nexport function addAccountUsage(storageService: IStorageService, providerId: string, accountName: string, extensionId: string, extensionName: string) {\n\tconst accountKey = `${providerId}-${accountName}-usages`;\n\tconst usages = readAccountUsages(storageService, providerId, accountName);\n\n\tconst existingUsageIndex = usages.findIndex(usage => usage.extensionId === extensionId);\n\tif (existingUsageIndex > -1) {\n\t\tusages.splice(existingUsageIndex, 1, {\n\t\t\textensionId,\n\t\t\textensionName,\n\t\t\tlastUsed: Date.now()\n\t\t});\n\t} else {\n\t\tusages.push({\n\t\t\textensionId,\n\t\t\textensionName,\n\t\t\tlastUsed: Date.now()\n\t\t});\n\t}\n\n\tstorageService.store(accountKey, JSON.stringify(usages), StorageScope.GLOBAL, StorageTarget.MACHINE);\n}\n\nexport type AuthenticationSessionInfo = { readonly id: string, readonly accessToken: string, readonly providerId: string, readonly canSignOut?: boolean };\nexport async function getCurrentAuthenticationSessionInfo(environmentService: IWorkbenchEnvironmentService, productService: IProductService): Promise<AuthenticationSessionInfo | undefined> {\n\tif (environmentService.options?.credentialsProvider) {\n\t\tconst authenticationSessionValue = await environmentService.options.credentialsProvider.getPassword(`${productService.urlProtocol}.login`, 'account');\n\t\tif (authenticationSessionValue) {\n\t\t\tconst authenticationSessionInfo: AuthenticationSessionInfo = JSON.parse(authenticationSessionValue);\n\t\t\tif (authenticationSessionInfo\n\t\t\t\t&& isString(authenticationSessionInfo.id)\n\t\t\t\t&& isString(authenticationSessionInfo.accessToken)\n\t\t\t\t&& isString(authenticationSessionInfo.providerId)\n\t\t\t) {\n\t\t\t\treturn authenticationSessionInfo;\n\t\t\t}\n\t\t}\n\t}\n\treturn undefined;\n}\n\nexport const IAuthenticationService = createDecorator<IAuthenticationService>('IAuthenticationService');\n\nexport interface IAuthenticationService {\n\treadonly _serviceBrand: undefined;\n\n\tisAuthenticationProviderRegistered(id: string): boolean;\n\tgetProviderIds(): string[];\n\tregisterAuthenticationProvider(id: string, provider: MainThreadAuthenticationProvider): void;\n\tunregisterAuthenticationProvider(id: string): void;\n\tisAccessAllowed(providerId: string, accountName: string, extensionId: string): boolean | undefined;\n\tupdatedAllowedExtension(providerId: string, accountName: string, extensionId: string, extensionName: string, isAllowed: boolean): Promise<void>;\n\tshowGetSessionPrompt(providerId: string, accountName: string, extensionId: string, extensionName: string): Promise<boolean>;\n\tselectSession(providerId: string, extensionId: string, extensionName: string, scopes: string[], possibleSessions: readonly AuthenticationSession[]): Promise<AuthenticationSession>;\n\trequestSessionAccess(providerId: string, extensionId: string, extensionName: string, scopes: string[], possibleSessions: readonly AuthenticationSession[]): void;\n\tcompleteSessionAccessRequest(providerId: string, extensionId: string, extensionName: string, scopes: string[]): Promise<void>\n\trequestNewSession(providerId: string, scopes: string[], extensionId: string, extensionName: string): Promise<void>;\n\tsessionsUpdate(providerId: string, event: AuthenticationSessionsChangeEvent): void;\n\n\treadonly onDidRegisterAuthenticationProvider: Event<AuthenticationProviderInformation>;\n\treadonly onDidUnregisterAuthenticationProvider: Event<AuthenticationProviderInformation>;\n\n\treadonly onDidChangeSessions: Event<{ providerId: string, label: string, event: AuthenticationSessionsChangeEvent }>;\n\n\t// TODO @RMacfarlane completely remove this property\n\tdeclaredProviders: AuthenticationProviderInformation[];\n\treadonly onDidChangeDeclaredProviders: Event<AuthenticationProviderInformation[]>;\n\n\tgetSessions(id: string, scopes?: string[], activateImmediate?: boolean): Promise<ReadonlyArray<AuthenticationSession>>;\n\tgetLabel(providerId: string): string;\n\tsupportsMultipleAccounts(providerId: string): boolean;\n\tcreateSession(providerId: string, scopes: string[], activateImmediate?: boolean): Promise<AuthenticationSession>;\n\tremoveSession(providerId: string, sessionId: string): Promise<void>;\n\n\tmanageTrustedExtensionsForAccount(providerId: string, accountName: string): Promise<void>;\n\tremoveAccountSessions(providerId: string, accountName: string, sessions: AuthenticationSession[]): Promise<void>;\n}\n\nexport interface AllowedExtension {\n\tid: string;\n\tname: string;\n\tallowed?: boolean;\n}\n\nexport function readAllowedExtensions(storageService: IStorageService, providerId: string, accountName: string): AllowedExtension[] {\n\tlet trustedExtensions: AllowedExtension[] = [];\n\ttry {\n\t\tconst trustedExtensionSrc = storageService.get(`${providerId}-${accountName}`, StorageScope.GLOBAL);\n\t\tif (trustedExtensionSrc) {\n\t\t\ttrustedExtensions = JSON.parse(trustedExtensionSrc);\n\t\t}\n\t} catch (err) { }\n\n\treturn trustedExtensions;\n}\n\nexport interface SessionRequest {\n\tdisposables: IDisposable[];\n\trequestingExtensionIds: string[];\n}\n\nexport interface SessionRequestInfo {\n\t[scopes: string]: SessionRequest;\n}\n\nCommandsRegistry.registerCommand('workbench.getCodeExchangeProxyEndpoints', function (accessor, _) {\n\tconst environmentService = accessor.get(IWorkbenchEnvironmentService);\n\treturn environmentService.options?.codeExchangeProxyEndpoints;\n});\n\nconst authenticationDefinitionSchema: IJSONSchema = {\n\ttype: 'object',\n\tadditionalProperties: false,\n\tproperties: {\n\t\tid: {\n\t\t\ttype: 'string',\n\t\t\tdescription: nls.localize('authentication.id', 'The id of the authentication provider.')\n\t\t},\n\t\tlabel: {\n\t\t\ttype: 'string',\n\t\t\tdescription: nls.localize('authentication.label', 'The human readable name of the authentication provider.'),\n\t\t}\n\t}\n};\n\nconst authenticationExtPoint = ExtensionsRegistry.registerExtensionPoint<AuthenticationProviderInformation[]>({\n\textensionPoint: 'authentication',\n\tjsonSchema: {\n\t\tdescription: nls.localize({ key: 'authenticationExtensionPoint', comment: [`'Contributes' means adds here`] }, 'Contributes authentication'),\n\t\ttype: 'array',\n\t\titems: authenticationDefinitionSchema\n\t}\n});\n\nexport class AuthenticationService extends Disposable implements IAuthenticationService {\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _placeholderMenuItem: IDisposable | undefined;\n\tprivate _signInRequestItems = new Map<string, SessionRequestInfo>();\n\tprivate _sessionAccessRequestItems = new Map<string, { [extensionId: string]: { disposables: IDisposable[], possibleSessions: AuthenticationSession[] } }>();\n\tprivate _accountBadgeDisposable = this._register(new MutableDisposable());\n\n\tprivate _authenticationProviders: Map<string, MainThreadAuthenticationProvider> = new Map<string, MainThreadAuthenticationProvider>();\n\n\t/**\n\t * All providers that have been statically declared by extensions. These may not be registered.\n\t */\n\tdeclaredProviders: AuthenticationProviderInformation[] = [];\n\n\tprivate _onDidRegisterAuthenticationProvider: Emitter<AuthenticationProviderInformation> = this._register(new Emitter<AuthenticationProviderInformation>());\n\treadonly onDidRegisterAuthenticationProvider: Event<AuthenticationProviderInformation> = this._onDidRegisterAuthenticationProvider.event;\n\n\tprivate _onDidUnregisterAuthenticationProvider: Emitter<AuthenticationProviderInformation> = this._register(new Emitter<AuthenticationProviderInformation>());\n\treadonly onDidUnregisterAuthenticationProvider: Event<AuthenticationProviderInformation> = this._onDidUnregisterAuthenticationProvider.event;\n\n\tprivate _onDidChangeSessions: Emitter<{ providerId: string, label: string, event: AuthenticationSessionsChangeEvent }> = this._register(new Emitter<{ providerId: string, label: string, event: AuthenticationSessionsChangeEvent }>());\n\treadonly onDidChangeSessions: Event<{ providerId: string, label: string, event: AuthenticationSessionsChangeEvent }> = this._onDidChangeSessions.event;\n\n\tprivate _onDidChangeDeclaredProviders: Emitter<AuthenticationProviderInformation[]> = this._register(new Emitter<AuthenticationProviderInformation[]>());\n\treadonly onDidChangeDeclaredProviders: Event<AuthenticationProviderInformation[]> = this._onDidChangeDeclaredProviders.event;\n\n\tconstructor(\n\t\t@IActivityService private readonly activityService: IActivityService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService\n\t) {\n\t\tsuper();\n\t\tthis._placeholderMenuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\tcommand: {\n\t\t\t\tid: 'noAuthenticationProviders',\n\t\t\t\ttitle: nls.localize('loading', \"Loading...\"),\n\t\t\t\tprecondition: ContextKeyExpr.false()\n\t\t\t},\n\t\t});\n\n\t\tauthenticationExtPoint.setHandler((extensions, { added, removed }) => {\n\t\t\tadded.forEach(point => {\n\t\t\t\tfor (const provider of point.value) {\n\t\t\t\t\tif (isFalsyOrWhitespace(provider.id)) {\n\t\t\t\t\t\tpoint.collector.error(nls.localize('authentication.missingId', 'An authentication contribution must specify an id.'));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isFalsyOrWhitespace(provider.label)) {\n\t\t\t\t\t\tpoint.collector.error(nls.localize('authentication.missingLabel', 'An authentication contribution must specify a label.'));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.declaredProviders.some(p => p.id === provider.id)) {\n\t\t\t\t\t\tthis.declaredProviders.push(provider);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpoint.collector.error(nls.localize('authentication.idConflict', \"This authentication id '{0}' has already been registered\", provider.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst removedExtPoints = flatten(removed.map(r => r.value));\n\t\t\tremovedExtPoints.forEach(point => {\n\t\t\t\tconst index = this.declaredProviders.findIndex(provider => provider.id === point.id);\n\t\t\t\tif (index > -1) {\n\t\t\t\t\tthis.declaredProviders.splice(index, 1);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._onDidChangeDeclaredProviders.fire(this.declaredProviders);\n\t\t});\n\t}\n\n\tgetProviderIds(): string[] {\n\t\tconst providerIds: string[] = [];\n\t\tthis._authenticationProviders.forEach(provider => {\n\t\t\tproviderIds.push(provider.id);\n\t\t});\n\t\treturn providerIds;\n\t}\n\n\tisAuthenticationProviderRegistered(id: string): boolean {\n\t\treturn this._authenticationProviders.has(id);\n\t}\n\n\tregisterAuthenticationProvider(id: string, authenticationProvider: MainThreadAuthenticationProvider): void {\n\t\tthis._authenticationProviders.set(id, authenticationProvider);\n\t\tthis._onDidRegisterAuthenticationProvider.fire({ id, label: authenticationProvider.label });\n\n\t\tif (this._placeholderMenuItem) {\n\t\t\tthis._placeholderMenuItem.dispose();\n\t\t\tthis._placeholderMenuItem = undefined;\n\t\t}\n\t}\n\n\tunregisterAuthenticationProvider(id: string): void {\n\t\tconst provider = this._authenticationProviders.get(id);\n\t\tif (provider) {\n\t\t\tprovider.dispose();\n\t\t\tthis._authenticationProviders.delete(id);\n\t\t\tthis._onDidUnregisterAuthenticationProvider.fire({ id, label: provider.label });\n\n\t\t\tconst accessRequests = this._sessionAccessRequestItems.get(id) || {};\n\t\t\tObject.keys(accessRequests).forEach(extensionId => {\n\t\t\t\tthis.removeAccessRequest(id, extensionId);\n\t\t\t});\n\t\t}\n\n\t\tif (!this._authenticationProviders.size) {\n\t\t\tthis._placeholderMenuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'noAuthenticationProviders',\n\t\t\t\t\ttitle: nls.localize('loading', \"Loading...\"),\n\t\t\t\t\tprecondition: ContextKeyExpr.false()\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tasync sessionsUpdate(id: string, event: AuthenticationSessionsChangeEvent): Promise<void> {\n\t\tconst provider = this._authenticationProviders.get(id);\n\t\tif (provider) {\n\t\t\tthis._onDidChangeSessions.fire({ providerId: id, label: provider.label, event: event });\n\n\t\t\tif (event.added) {\n\t\t\t\tawait this.updateNewSessionRequests(provider, event.added);\n\t\t\t}\n\n\t\t\tif (event.removed) {\n\t\t\t\tawait this.updateAccessRequests(id, event.removed);\n\t\t\t}\n\n\t\t\tthis.updateBadgeCount();\n\t\t}\n\t}\n\n\tprivate async updateNewSessionRequests(provider: MainThreadAuthenticationProvider, addedSessions: readonly AuthenticationSession[]): Promise<void> {\n\t\tconst existingRequestsForProvider = this._signInRequestItems.get(provider.id);\n\t\tif (!existingRequestsForProvider) {\n\t\t\treturn;\n\t\t}\n\n\t\tObject.keys(existingRequestsForProvider).forEach(requestedScopes => {\n\t\t\tif (addedSessions.some(session => session.scopes.slice().sort().join('') === requestedScopes)) {\n\t\t\t\tconst sessionRequest = existingRequestsForProvider[requestedScopes];\n\t\t\t\tsessionRequest?.disposables.forEach(item => item.dispose());\n\n\t\t\t\tdelete existingRequestsForProvider[requestedScopes];\n\t\t\t\tif (Object.keys(existingRequestsForProvider).length === 0) {\n\t\t\t\t\tthis._signInRequestItems.delete(provider.id);\n\t\t\t\t} else {\n\t\t\t\t\tthis._signInRequestItems.set(provider.id, existingRequestsForProvider);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async updateAccessRequests(providerId: string, removedSessions: readonly AuthenticationSession[]) {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId);\n\t\tif (providerRequests) {\n\t\t\tObject.keys(providerRequests).forEach(extensionId => {\n\t\t\t\tremovedSessions.forEach(removed => {\n\t\t\t\t\tconst indexOfSession = providerRequests[extensionId].possibleSessions.findIndex(session => session.id === removed.id);\n\t\t\t\t\tif (indexOfSession) {\n\t\t\t\t\t\tproviderRequests[extensionId].possibleSessions.splice(indexOfSession, 1);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!providerRequests[extensionId].possibleSessions.length) {\n\t\t\t\t\tthis.removeAccessRequest(providerId, extensionId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate updateBadgeCount(): void {\n\t\tthis._accountBadgeDisposable.clear();\n\n\t\tlet numberOfRequests = 0;\n\t\tthis._signInRequestItems.forEach(providerRequests => {\n\t\t\tObject.keys(providerRequests).forEach(request => {\n\t\t\t\tnumberOfRequests += providerRequests[request].requestingExtensionIds.length;\n\t\t\t});\n\t\t});\n\n\t\tthis._sessionAccessRequestItems.forEach(accessRequest => {\n\t\t\tnumberOfRequests += Object.keys(accessRequest).length;\n\t\t});\n\n\t\tif (numberOfRequests > 0) {\n\t\t\tconst badge = new NumberBadge(numberOfRequests, () => nls.localize('sign in', \"Sign in requested\"));\n\t\t\tthis._accountBadgeDisposable.value = this.activityService.showAccountsActivity({ badge });\n\t\t}\n\t}\n\n\tprivate removeAccessRequest(providerId: string, extensionId: string): void {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId) || {};\n\t\tif (providerRequests[extensionId]) {\n\t\t\tproviderRequests[extensionId].disposables.forEach(d => d.dispose());\n\t\t\tdelete providerRequests[extensionId];\n\t\t\tthis.updateBadgeCount();\n\t\t}\n\t}\n\n\t/**\n\t * Check extension access to an account\n\t * @param providerId The id of the authentication provider\n\t * @param accountName The account name that access is checked for\n\t * @param extensionId The id of the extension requesting access\n\t * @returns Returns true or false if the user has opted to permanently grant or disallow access, and undefined\n\t * if they haven't made a choice yet\n\t */\n\tisAccessAllowed(providerId: string, accountName: string, extensionId: string): boolean | undefined {\n\t\tconst allowList = readAllowedExtensions(this.storageService, providerId, accountName);\n\t\tconst extensionData = allowList.find(extension => extension.id === extensionId);\n\t\tif (extensionData) {\n\t\t\t// This property didn't exist on this data previously, inclusion in the list at all indicates allowance\n\t\t\treturn extensionData.allowed !== undefined\n\t\t\t\t? extensionData.allowed\n\t\t\t\t: true;\n\t\t}\n\n\t\tconst remoteConnection = this.remoteAgentService.getConnection();\n\t\tconst isVSO = remoteConnection !== null\n\t\t\t? remoteConnection.remoteAuthority.startsWith('vsonline') || remoteConnection.remoteAuthority.startsWith('codespaces')\n\t\t\t: isWeb;\n\n\t\tif (isVSO && VSO_ALLOWED_EXTENSIONS.includes(extensionId)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tasync updatedAllowedExtension(providerId: string, accountName: string, extensionId: string, extensionName: string, isAllowed: boolean): Promise<void> {\n\t\tconst allowList = readAllowedExtensions(this.storageService, providerId, accountName);\n\t\tconst index = allowList.findIndex(extension => extension.id === extensionId);\n\t\tif (index === -1) {\n\t\t\tallowList.push({ id: extensionId, name: extensionName, allowed: isAllowed });\n\t\t} else {\n\t\t\tallowList[index].allowed = isAllowed;\n\t\t}\n\n\t\tawait this.storageService.store(`${providerId}-${accountName}`, JSON.stringify(allowList), StorageScope.GLOBAL, StorageTarget.USER);\n\t}\n\n\tasync showGetSessionPrompt(providerId: string, accountName: string, extensionId: string, extensionName: string): Promise<boolean> {\n\t\tconst providerName = this.getLabel(providerId);\n\t\tconst { choice } = await this.dialogService.show(\n\t\t\tSeverity.Info,\n\t\t\tnls.localize('confirmAuthenticationAccess', \"The extension '{0}' wants to access the {1} account '{2}'.\", extensionName, providerName, accountName),\n\t\t\t[nls.localize('allow', \"Allow\"), nls.localize('deny', \"Deny\"), nls.localize('cancel', \"Cancel\")],\n\t\t\t{\n\t\t\t\tcancelId: 2\n\t\t\t}\n\t\t);\n\n\t\tconst cancelled = choice === 2;\n\t\tconst allowed = choice === 0;\n\t\tif (!cancelled) {\n\t\t\tthis.updatedAllowedExtension(providerId, accountName, extensionId, extensionName, allowed);\n\t\t\tthis.removeAccessRequest(providerId, extensionId);\n\t\t}\n\n\t\treturn allowed;\n\t}\n\n\tasync selectSession(providerId: string, extensionId: string, extensionName: string, scopes: string[], availableSessions: AuthenticationSession[]): Promise<AuthenticationSession> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// This function should be used only when there are sessions to disambiguate.\n\t\t\tif (!availableSessions.length) {\n\t\t\t\treject('No available sessions');\n\t\t\t}\n\n\t\t\tconst quickPick = this.quickInputService.createQuickPick<{ label: string, session?: AuthenticationSession }>();\n\t\t\tquickPick.ignoreFocusOut = true;\n\t\t\tconst items: { label: string, session?: AuthenticationSession }[] = availableSessions.map(session => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: session.account.label,\n\t\t\t\t\tsession: session\n\t\t\t\t};\n\t\t\t});\n\n\t\t\titems.push({\n\t\t\t\tlabel: nls.localize('useOtherAccount', \"Sign in to another account\")\n\t\t\t});\n\n\t\t\tconst providerName = this.getLabel(providerId);\n\n\t\t\tquickPick.items = items;\n\n\t\t\tquickPick.title = nls.localize(\n\t\t\t\t{\n\t\t\t\t\tkey: 'selectAccount',\n\t\t\t\t\tcomment: ['The placeholder {0} is the name of an extension. {1} is the name of the type of account, such as Microsoft or GitHub.']\n\t\t\t\t},\n\t\t\t\t\"The extension '{0}' wants to access a {1} account\",\n\t\t\t\textensionName,\n\t\t\t\tproviderName);\n\t\t\tquickPick.placeholder = nls.localize('getSessionPlateholder', \"Select an account for '{0}' to use or Esc to cancel\", extensionName);\n\n\t\t\tquickPick.onDidAccept(async _ => {\n\t\t\t\tconst session = quickPick.selectedItems[0].session ?? await this.createSession(providerId, scopes);\n\t\t\t\tconst accountName = session.account.label;\n\n\t\t\t\tthis.updatedAllowedExtension(providerId, accountName, extensionId, extensionName, true);\n\n\t\t\t\tthis.removeAccessRequest(providerId, extensionId);\n\t\t\t\tthis.storageService.store(`${extensionName}-${providerId}`, session.id, StorageScope.GLOBAL, StorageTarget.MACHINE);\n\n\t\t\t\tquickPick.dispose();\n\t\t\t\tresolve(session);\n\t\t\t});\n\n\t\t\tquickPick.onDidHide(_ => {\n\t\t\t\tif (!quickPick.selectedItems[0]) {\n\t\t\t\t\treject('User did not consent to account access');\n\t\t\t\t}\n\n\t\t\t\tquickPick.dispose();\n\t\t\t});\n\n\t\t\tquickPick.show();\n\t\t});\n\t}\n\n\tasync completeSessionAccessRequest(providerId: string, extensionId: string, extensionName: string, scopes: string[]): Promise<void> {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId) || {};\n\t\tconst existingRequest = providerRequests[extensionId];\n\t\tif (!existingRequest) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst possibleSessions = existingRequest.possibleSessions;\n\t\tconst supportsMultipleAccounts = this.supportsMultipleAccounts(providerId);\n\n\t\tlet session: AuthenticationSession | undefined;\n\t\tif (supportsMultipleAccounts) {\n\t\t\ttry {\n\t\t\t\tsession = await this.selectSession(providerId, extensionId, extensionName, scopes, possibleSessions);\n\t\t\t} catch (_) {\n\t\t\t\t// ignore cancel\n\t\t\t}\n\t\t} else {\n\t\t\tconst approved = await this.showGetSessionPrompt(providerId, possibleSessions[0].account.label, extensionId, extensionName);\n\t\t\tif (approved) {\n\t\t\t\tsession = possibleSessions[0];\n\t\t\t}\n\t\t}\n\n\t\tif (session) {\n\t\t\taddAccountUsage(this.storageService, providerId, session.account.label, extensionId, extensionName);\n\t\t\tconst providerName = this.getLabel(providerId);\n\t\t\tthis._onDidChangeSessions.fire({ providerId, label: providerName, event: { added: [], removed: [], changed: [session] } });\n\t\t}\n\t}\n\n\trequestSessionAccess(providerId: string, extensionId: string, extensionName: string, scopes: string[], possibleSessions: AuthenticationSession[]): void {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId) || {};\n\t\tconst hasExistingRequest = providerRequests[extensionId];\n\t\tif (hasExistingRequest) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\tgroup: '3_accessRequests',\n\t\t\tcommand: {\n\t\t\t\tid: `${providerId}${extensionId}Access`,\n\t\t\t\ttitle: nls.localize({\n\t\t\t\t\tkey: 'accessRequest',\n\t\t\t\t\tcomment: ['The placeholder {0} will be replaced with an extension name. (1) is to indicate that this menu item contributes to a badge count']\n\t\t\t\t},\n\t\t\t\t\t\"Grant access to {0}... (1)\", extensionName)\n\t\t\t}\n\t\t});\n\n\t\tconst accessCommand = CommandsRegistry.registerCommand({\n\t\t\tid: `${providerId}${extensionId}Access`,\n\t\t\thandler: async (accessor) => {\n\t\t\t\tconst authenticationService = accessor.get(IAuthenticationService);\n\t\t\t\tauthenticationService.completeSessionAccessRequest(providerId, extensionId, extensionName, scopes);\n\t\t\t}\n\t\t});\n\n\t\tproviderRequests[extensionId] = { possibleSessions, disposables: [menuItem, accessCommand] };\n\t\tthis._sessionAccessRequestItems.set(providerId, providerRequests);\n\t\tthis.updateBadgeCount();\n\t}\n\n\tasync requestNewSession(providerId: string, scopes: string[], extensionId: string, extensionName: string): Promise<void> {\n\t\tlet provider = this._authenticationProviders.get(providerId);\n\t\tif (!provider) {\n\t\t\t// Activate has already been called for the authentication provider, but it cannot block on registering itself\n\t\t\t// since this is sync and returns a disposable. So, wait for registration event to fire that indicates the\n\t\t\t// provider is now in the map.\n\t\t\tawait new Promise<void>((resolve, _) => {\n\t\t\t\tthis.onDidRegisterAuthenticationProvider(e => {\n\t\t\t\t\tif (e.id === providerId) {\n\t\t\t\t\t\tprovider = this._authenticationProviders.get(providerId);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (provider) {\n\t\t\tconst providerRequests = this._signInRequestItems.get(providerId);\n\t\t\tconst scopesList = scopes.sort().join('');\n\t\t\tconst extensionHasExistingRequest = providerRequests\n\t\t\t\t&& providerRequests[scopesList]\n\t\t\t\t&& providerRequests[scopesList].requestingExtensionIds.includes(extensionId);\n\n\t\t\tif (extensionHasExistingRequest) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst menuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\t\tgroup: '2_signInRequests',\n\t\t\t\tcommand: {\n\t\t\t\t\tid: `${extensionId}signIn`,\n\t\t\t\t\ttitle: nls.localize(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'signInRequest',\n\t\t\t\t\t\t\tcomment: ['The placeholder {0} will be replaced with an extension name. (1) is to indicate that this menu item contributes to a badge count.']\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"Sign in to use {0} (1)\",\n\t\t\t\t\t\textensionName)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst signInCommand = CommandsRegistry.registerCommand({\n\t\t\t\tid: `${extensionId}signIn`,\n\t\t\t\thandler: async (accessor) => {\n\t\t\t\t\tconst authenticationService = accessor.get(IAuthenticationService);\n\t\t\t\t\tconst storageService = accessor.get(IStorageService);\n\t\t\t\t\tconst session = await authenticationService.createSession(providerId, scopes);\n\n\t\t\t\t\t// Add extension to allow list since user explicitly signed in on behalf of it\n\t\t\t\t\tthis.updatedAllowedExtension(providerId, session.account.label, extensionId, extensionName, true);\n\n\t\t\t\t\t// And also set it as the preferred account for the extension\n\t\t\t\t\tstorageService.store(`${extensionName}-${providerId}`, session.id, StorageScope.GLOBAL, StorageTarget.MACHINE);\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tif (providerRequests) {\n\t\t\t\tconst existingRequest = providerRequests[scopesList] || { disposables: [], requestingExtensionIds: [] };\n\n\t\t\t\tproviderRequests[scopesList] = {\n\t\t\t\t\tdisposables: [...existingRequest.disposables, menuItem, signInCommand],\n\t\t\t\t\trequestingExtensionIds: [...existingRequest.requestingExtensionIds, extensionId]\n\t\t\t\t};\n\t\t\t\tthis._signInRequestItems.set(providerId, providerRequests);\n\t\t\t} else {\n\t\t\t\tthis._signInRequestItems.set(providerId, {\n\t\t\t\t\t[scopesList]: {\n\t\t\t\t\t\tdisposables: [menuItem, signInCommand],\n\t\t\t\t\t\trequestingExtensionIds: [extensionId]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.updateBadgeCount();\n\t\t}\n\t}\n\tgetLabel(id: string): string {\n\t\tconst authProvider = this._authenticationProviders.get(id);\n\t\tif (authProvider) {\n\t\t\treturn authProvider.label;\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tsupportsMultipleAccounts(id: string): boolean {\n\t\tconst authProvider = this._authenticationProviders.get(id);\n\t\tif (authProvider) {\n\t\t\treturn authProvider.supportsMultipleAccounts;\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tprivate async tryActivateProvider(providerId: string, activateImmediate: boolean): Promise<MainThreadAuthenticationProvider> {\n\t\tawait this.extensionService.activateByEvent(getAuthenticationProviderActivationEvent(providerId), activateImmediate ? ActivationKind.Immediate : ActivationKind.Normal);\n\t\tlet provider = this._authenticationProviders.get(providerId);\n\t\tif (provider) {\n\t\t\treturn provider;\n\t\t}\n\n\t\t// When activate has completed, the extension has made the call to `registerAuthenticationProvider`.\n\t\t// However, activate cannot block on this, so the renderer may not have gotten the event yet.\n\t\tconst didRegister: Promise<MainThreadAuthenticationProvider> = new Promise((resolve, _) => {\n\t\t\tthis.onDidRegisterAuthenticationProvider(e => {\n\t\t\t\tif (e.id === providerId) {\n\t\t\t\t\tprovider = this._authenticationProviders.get(providerId);\n\t\t\t\t\tif (provider) {\n\t\t\t\t\t\tresolve(provider);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`No authentication provider '${providerId}' is currently registered.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconst didTimeout: Promise<MainThreadAuthenticationProvider> = new Promise((_, reject) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\treject();\n\t\t\t}, 5000);\n\t\t});\n\n\t\treturn Promise.race([didRegister, didTimeout]);\n\t}\n\n\tasync getSessions(id: string, scopes?: string[], activateImmediate: boolean = false): Promise<ReadonlyArray<AuthenticationSession>> {\n\t\ttry {\n\t\t\tconst authProvider = this._authenticationProviders.get(id) || await this.tryActivateProvider(id, activateImmediate);\n\t\t\treturn await authProvider.getSessions(scopes);\n\t\t} catch (_) {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync createSession(id: string, scopes: string[], activateImmediate: boolean = false): Promise<AuthenticationSession> {\n\t\ttry {\n\t\t\tconst authProvider = this._authenticationProviders.get(id) || await this.tryActivateProvider(id, activateImmediate);\n\t\t\treturn await authProvider.createSession(scopes);\n\t\t} catch (_) {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync removeSession(id: string, sessionId: string): Promise<void> {\n\t\tconst authProvider = this._authenticationProviders.get(id);\n\t\tif (authProvider) {\n\t\t\treturn authProvider.removeSession(sessionId);\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync manageTrustedExtensionsForAccount(id: string, accountName: string): Promise<void> {\n\t\tconst authProvider = this._authenticationProviders.get(id);\n\t\tif (authProvider) {\n\t\t\treturn authProvider.manageTrustedExtensions(accountName);\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync removeAccountSessions(id: string, accountName: string, sessions: AuthenticationSession[]): Promise<void> {\n\t\tconst authProvider = this._authenticationProviders.get(id);\n\t\tif (authProvider) {\n\t\t\treturn authProvider.removeAccountSessions(accountName, sessions);\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n}\n\nregisterSingleton(IAuthenticationService, AuthenticationService);\n"]}