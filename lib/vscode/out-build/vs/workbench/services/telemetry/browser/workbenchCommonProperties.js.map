{"version":3,"file":"workbenchCommonProperties.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/telemetry/browser/workbenchCommonProperties.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IASzF,KAAK,UAAU,gCAAgC,CACrD,cAA+B,EAC/B,MAA0B,EAC1B,OAA2B,EAC3B,eAAwB,EACxB,2BAA0D;QAE1D,MAAM,MAAM,GAA4C,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC5E,MAAM,gBAAgB,GAAG,cAAc,CAAC,GAAG,CAAC,sCAA0B,iBAAuB,CAAC;QAC9F,MAAM,eAAe,GAAG,cAAc,CAAC,GAAG,CAAC,qCAAyB,iBAAuB,CAAC;QAE5F,IAAI,SAAS,GAAG,cAAc,CAAC,GAAG,CAAC,wBAAY,iBAAsB,CAAC;QACtE,IAAI,CAAC,SAAS,EAAE;YACf,SAAS,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;YAChC,cAAc,CAAC,KAAK,CAAC,wBAAY,EAAE,SAAS,kCAA6C,CAAC;SAC1F;QAED;;;WAGG;QACH,mHAAmH;QACnH,MAAM,CAAC,yBAAyB,CAAC,GAAG,gBAAgB,CAAC;QACrD,kHAAkH;QAClH,MAAM,CAAC,wBAAwB,CAAC,GAAG,eAAe,IAAI,EAAE,CAAC;QACzD,+GAA+G;QAC/G,MAAM,CAAC,qBAAqB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC;QAC7D,wHAAwH;QACxH,MAAM,CAAC,wBAAwB,CAAC,GAAG,CAAA,GAAA,qCAAoB,CAAA,CAAC,eAAe,CAAC,CAAC;QAEzE,2JAA2J;QAC3J,MAAM,CAAC,kBAAkB,CAAC,GAAG,SAAS,CAAC;QACvC,qGAAqG;QACrG,MAAM,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,YAAY,EAAE,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QACvD,4GAA4G;QAC5G,MAAM,CAAC,YAAY,CAAC,GAAG,MAAM,CAAC;QAC9B,mGAAmG;QACnG,MAAM,CAAC,SAAS,CAAC,GAAG,OAAO,CAAC;QAC5B,2GAA2G;QAC3G,MAAM,CAAC,iBAAiB,CAAC,GAAG,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACzE,gHAAgH;QAChH,MAAM,CAAC,gBAAgB,CAAC,GAAG,KAAK,CAAC;QACjC,4GAA4G;QAC5G,MAAM,CAAC,kBAAkB,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC;QAEhD,sDAAsD;QACtD,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC7B,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE;YAC/B,qGAAqG;YACrG,WAAW,EAAE;gBACZ,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,IAAI,EAAE;gBACrB,UAAU,EAAE,IAAI;aAChB;YACD,+IAA+I;YAC/I,8BAA8B,EAAE;gBAC/B,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS;gBACjC,UAAU,EAAE,IAAI;aAChB;YACD,kIAAkI;YAClI,iBAAiB,EAAE;gBAClB,GAAG,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE;gBAChB,UAAU,EAAE,IAAI;aAChB;SACD,CAAC,CAAC;QAEH,IAAI,2BAA2B,EAAE;YAChC,CAAA,GAAA,eAAK,CAAA,CAAC,MAAM,EAAE,2BAA2B,EAAE,CAAC,CAAC;SAC7C;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IAvED,4EAuEC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport * as Platform from 'vs/base/common/platform';\nimport * as uuid from 'vs/base/common/uuid';\nimport { cleanRemoteAuthority } from 'vs/platform/telemetry/common/telemetryUtils';\nimport { mixin } from 'vs/base/common/objects';\nimport { firstSessionDateStorageKey, lastSessionDateStorageKey, machineIdKey } from 'vs/platform/telemetry/common/telemetry';\n\nexport async function resolveWorkbenchCommonProperties(\n\tstorageService: IStorageService,\n\tcommit: string | undefined,\n\tversion: string | undefined,\n\tremoteAuthority?: string,\n\tresolveAdditionalProperties?: () => { [key: string]: any }\n): Promise<{ [name: string]: string | undefined }> {\n\tconst result: { [name: string]: string | undefined; } = Object.create(null);\n\tconst firstSessionDate = storageService.get(firstSessionDateStorageKey, StorageScope.GLOBAL)!;\n\tconst lastSessionDate = storageService.get(lastSessionDateStorageKey, StorageScope.GLOBAL)!;\n\n\tlet machineId = storageService.get(machineIdKey, StorageScope.GLOBAL);\n\tif (!machineId) {\n\t\tmachineId = uuid.generateUuid();\n\t\tstorageService.store(machineIdKey, machineId, StorageScope.GLOBAL, StorageTarget.MACHINE);\n\t}\n\n\t/**\n\t * Note: In the web, session date information is fetched from browser storage, so these dates are tied to a specific\n\t * browser and not the machine overall.\n\t */\n\t// __GDPR__COMMON__ \"common.firstSessionDate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.firstSessionDate'] = firstSessionDate;\n\t// __GDPR__COMMON__ \"common.lastSessionDate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.lastSessionDate'] = lastSessionDate || '';\n\t// __GDPR__COMMON__ \"common.isNewSession\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.isNewSession'] = !lastSessionDate ? '1' : '0';\n\t// __GDPR__COMMON__ \"common.remoteAuthority\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.remoteAuthority'] = cleanRemoteAuthority(remoteAuthority);\n\n\t// __GDPR__COMMON__ \"common.machineId\" : { \"endPoint\": \"MacAddressHash\", \"classification\": \"EndUserPseudonymizedInformation\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.machineId'] = machineId;\n\t// __GDPR__COMMON__ \"sessionID\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['sessionID'] = uuid.generateUuid() + Date.now();\n\t// __GDPR__COMMON__ \"commitHash\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['commitHash'] = commit;\n\t// __GDPR__COMMON__ \"version\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['version'] = version;\n\t// __GDPR__COMMON__ \"common.platform\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.platform'] = Platform.PlatformToString(Platform.platform);\n\t// __GDPR__COMMON__ \"common.product\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.product'] = 'web';\n\t// __GDPR__COMMON__ \"common.userAgent\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.userAgent'] = Platform.userAgent;\n\n\t// dynamic properties which value differs on each call\n\tlet seq = 0;\n\tconst startTime = Date.now();\n\tObject.defineProperties(result, {\n\t\t// __GDPR__COMMON__ \"timestamp\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t'timestamp': {\n\t\t\tget: () => new Date(),\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.timesincesessionstart\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.timesincesessionstart': {\n\t\t\tget: () => Date.now() - startTime,\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.sequence\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.sequence': {\n\t\t\tget: () => seq++,\n\t\t\tenumerable: true\n\t\t}\n\t});\n\n\tif (resolveAdditionalProperties) {\n\t\tmixin(result, resolveAdditionalProperties());\n\t}\n\n\treturn result;\n}\n\n"]}