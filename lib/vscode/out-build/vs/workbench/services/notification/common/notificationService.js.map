{"version":3,"sources":["vs/workbench/services/notification/common/notificationService.ts"],"names":[],"mappings":"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","file":"notificationService.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { INotificationService, INotification, INotificationHandle, Severity, NotificationMessage, INotificationActions, IPromptChoice, IPromptOptions, IStatusMessageOptions, NoOpNotification, NeverShowAgainScope, NotificationsFilter } from 'vs/platform/notification/common/notification';\nimport { NotificationsModel, ChoiceAction, NotificationChangeType } from 'vs/workbench/common/notifications';\nimport { Disposable, DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { IAction, Action } from 'vs/base/common/actions';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\n\nexport class NotificationService extends Disposable implements INotificationService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\treadonly model = this._register(new NotificationsModel());\n\n\tprivate readonly _onDidAddNotification = this._register(new Emitter<INotification>());\n\treadonly onDidAddNotification = this._onDidAddNotification.event;\n\n\tprivate readonly _onDidRemoveNotification = this._register(new Emitter<INotification>());\n\treadonly onDidRemoveNotification = this._onDidRemoveNotification.event;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.model.onDidChangeNotification(e => {\n\t\t\tswitch (e.kind) {\n\t\t\t\tcase NotificationChangeType.ADD:\n\t\t\t\tcase NotificationChangeType.REMOVE: {\n\t\t\t\t\tconst notification: INotification = {\n\t\t\t\t\t\tmessage: e.item.message.original,\n\t\t\t\t\t\tseverity: e.item.severity,\n\t\t\t\t\t\tsource: typeof e.item.sourceId === 'string' && typeof e.item.source === 'string' ? { id: e.item.sourceId, label: e.item.source } : e.item.source,\n\t\t\t\t\t\tsilent: e.item.silent\n\t\t\t\t\t};\n\n\t\t\t\t\tif (e.kind === NotificationChangeType.ADD) {\n\t\t\t\t\t\tthis._onDidAddNotification.fire(notification);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.kind === NotificationChangeType.REMOVE) {\n\t\t\t\t\t\tthis._onDidRemoveNotification.fire(notification);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tsetFilter(filter: NotificationsFilter): void {\n\t\tthis.model.setFilter(filter);\n\t}\n\n\tinfo(message: NotificationMessage | NotificationMessage[]): void {\n\t\tif (Array.isArray(message)) {\n\t\t\tmessage.forEach(m => this.info(m));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model.addNotification({ severity: Severity.Info, message });\n\t}\n\n\twarn(message: NotificationMessage | NotificationMessage[]): void {\n\t\tif (Array.isArray(message)) {\n\t\t\tmessage.forEach(m => this.warn(m));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model.addNotification({ severity: Severity.Warning, message });\n\t}\n\n\terror(message: NotificationMessage | NotificationMessage[]): void {\n\t\tif (Array.isArray(message)) {\n\t\t\tmessage.forEach(m => this.error(m));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model.addNotification({ severity: Severity.Error, message });\n\t}\n\n\tnotify(notification: INotification): INotificationHandle {\n\t\tconst toDispose = new DisposableStore();\n\n\t\t// Handle neverShowAgain option accordingly\n\t\tlet handle: INotificationHandle;\n\t\tif (notification.neverShowAgain) {\n\t\t\tconst scope = notification.neverShowAgain.scope === NeverShowAgainScope.WORKSPACE ? StorageScope.WORKSPACE : StorageScope.GLOBAL;\n\t\t\tconst id = notification.neverShowAgain.id;\n\n\t\t\t// If the user already picked to not show the notification\n\t\t\t// again, we return with a no-op notification here\n\t\t\tif (this.storageService.getBoolean(id, scope)) {\n\t\t\t\treturn new NoOpNotification();\n\t\t\t}\n\n\t\t\tconst neverShowAgainAction = toDispose.add(new Action(\n\t\t\t\t'workbench.notification.neverShowAgain',\n\t\t\t\tlocalize('neverShowAgain', \"Don't Show Again\"),\n\t\t\t\tundefined, true, async () => {\n\n\t\t\t\t\t// Close notification\n\t\t\t\t\thandle.close();\n\n\t\t\t\t\t// Remember choice\n\t\t\t\t\tthis.storageService.store(id, true, scope, StorageTarget.USER);\n\t\t\t\t}));\n\n\t\t\t// Insert as primary or secondary action\n\t\t\tconst actions = {\n\t\t\t\tprimary: notification.actions?.primary || [],\n\t\t\t\tsecondary: notification.actions?.secondary || []\n\t\t\t};\n\t\t\tif (!notification.neverShowAgain.isSecondary) {\n\t\t\t\tactions.primary = [neverShowAgainAction, ...actions.primary]; // action comes first\n\t\t\t} else {\n\t\t\t\tactions.secondary = [...actions.secondary, neverShowAgainAction]; // actions comes last\n\t\t\t}\n\n\t\t\tnotification.actions = actions;\n\t\t}\n\n\t\t// Show notification\n\t\thandle = this.model.addNotification(notification);\n\n\t\t// Cleanup when notification gets disposed\n\t\tEvent.once(handle.onDidClose)(() => toDispose.dispose());\n\n\t\treturn handle;\n\t}\n\n\tprompt(severity: Severity, message: string, choices: IPromptChoice[], options?: IPromptOptions): INotificationHandle {\n\t\tconst toDispose = new DisposableStore();\n\n\t\t// Handle neverShowAgain option accordingly\n\t\tif (options?.neverShowAgain) {\n\t\t\tconst scope = options.neverShowAgain.scope === NeverShowAgainScope.WORKSPACE ? StorageScope.WORKSPACE : StorageScope.GLOBAL;\n\t\t\tconst id = options.neverShowAgain.id;\n\n\t\t\t// If the user already picked to not show the notification\n\t\t\t// again, we return with a no-op notification here\n\t\t\tif (this.storageService.getBoolean(id, scope)) {\n\t\t\t\treturn new NoOpNotification();\n\t\t\t}\n\n\t\t\tconst neverShowAgainChoice = {\n\t\t\t\tlabel: localize('neverShowAgain', \"Don't Show Again\"),\n\t\t\t\trun: () => this.storageService.store(id, true, scope, StorageTarget.USER),\n\t\t\t\tisSecondary: options.neverShowAgain.isSecondary\n\t\t\t};\n\n\t\t\t// Insert as primary or secondary action\n\t\t\tif (!options.neverShowAgain.isSecondary) {\n\t\t\t\tchoices = [neverShowAgainChoice, ...choices]; // action comes first\n\t\t\t} else {\n\t\t\t\tchoices = [...choices, neverShowAgainChoice]; // actions comes last\n\t\t\t}\n\t\t}\n\n\t\tlet choiceClicked = false;\n\t\tlet handle: INotificationHandle;\n\n\t\t// Convert choices into primary/secondary actions\n\t\tconst primaryActions: IAction[] = [];\n\t\tconst secondaryActions: IAction[] = [];\n\t\tchoices.forEach((choice, index) => {\n\t\t\tconst action = new ChoiceAction(`workbench.dialog.choice.${index}`, choice);\n\t\t\tif (!choice.isSecondary) {\n\t\t\t\tprimaryActions.push(action);\n\t\t\t} else {\n\t\t\t\tsecondaryActions.push(action);\n\t\t\t}\n\n\t\t\t// React to action being clicked\n\t\t\ttoDispose.add(action.onDidRun(() => {\n\t\t\t\tchoiceClicked = true;\n\n\t\t\t\t// Close notification unless we are told to keep open\n\t\t\t\tif (!choice.keepOpen) {\n\t\t\t\t\thandle.close();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\ttoDispose.add(action);\n\t\t});\n\n\t\t// Show notification with actions\n\t\tconst actions: INotificationActions = { primary: primaryActions, secondary: secondaryActions };\n\t\thandle = this.notify({ severity, message, actions, sticky: options?.sticky, silent: options?.silent });\n\n\t\tEvent.once(handle.onDidClose)(() => {\n\n\t\t\t// Cleanup when notification gets disposed\n\t\t\ttoDispose.dispose();\n\n\t\t\t// Indicate cancellation to the outside if no action was executed\n\t\t\tif (options && typeof options.onCancel === 'function' && !choiceClicked) {\n\t\t\t\toptions.onCancel();\n\t\t\t}\n\t\t});\n\n\t\treturn handle;\n\t}\n\n\tstatus(message: NotificationMessage, options?: IStatusMessageOptions): IDisposable {\n\t\treturn this.model.showStatusMessage(message, options);\n\t}\n}\n\nregisterSingleton(INotificationService, NotificationService, true);\n"]}