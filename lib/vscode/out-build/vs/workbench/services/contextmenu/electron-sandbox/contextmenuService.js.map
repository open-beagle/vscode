{"version":3,"file":"contextmenuService.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/contextmenu/electron-sandbox/contextmenuService.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction, IActionRunner, ActionRunner, WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification, Separator, SubmenuAction } from 'vs/base/common/actions';\nimport * as dom from 'vs/base/browser/dom';\nimport { IContextMenuService, IContextViewService } from 'vs/platform/contextview/browser/contextView';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { getZoomFactor } from 'vs/base/browser/browser';\nimport { unmnemonicLabel } from 'vs/base/common/labels';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IContextMenuDelegate, IContextMenuEvent } from 'vs/base/browser/contextmenu';\nimport { once } from 'vs/base/common/functional';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IContextMenuItem } from 'vs/base/parts/contextmenu/common/contextmenu';\nimport { popup } from 'vs/base/parts/contextmenu/electron-sandbox/contextmenu';\nimport { getTitleBarStyle } from 'vs/platform/windows/common/windows';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { ContextMenuService as HTMLContextMenuService } from 'vs/platform/contextview/browser/contextMenuService';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { stripIcons } from 'vs/base/common/iconLabels';\nimport { coalesce } from 'vs/base/common/arrays';\n\nexport class ContextMenuService extends Disposable implements IContextMenuService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate impl: IContextMenuService;\n\n\tconstructor(\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IContextViewService contextViewService: IContextViewService,\n\t\t@IThemeService themeService: IThemeService\n\t) {\n\t\tsuper();\n\n\t\t// Custom context menu: Linux/Windows if custom title is enabled\n\t\tif (!isMacintosh && getTitleBarStyle(configurationService) === 'custom') {\n\t\t\tthis.impl = new HTMLContextMenuService(telemetryService, notificationService, contextViewService, keybindingService, themeService);\n\t\t}\n\n\t\t// Native context menu: otherwise\n\t\telse {\n\t\t\tthis.impl = new NativeContextMenuService(notificationService, telemetryService, keybindingService);\n\t\t}\n\t}\n\n\tshowContextMenu(delegate: IContextMenuDelegate): void {\n\t\tthis.impl.showContextMenu(delegate);\n\t}\n}\n\nclass NativeContextMenuService extends Disposable implements IContextMenuService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService\n\t) {\n\t\tsuper();\n\t}\n\n\tshowContextMenu(delegate: IContextMenuDelegate): void {\n\t\tconst actions = delegate.getActions();\n\t\tif (actions.length) {\n\t\t\tconst onHide = once(() => {\n\t\t\t\tif (delegate.onHide) {\n\t\t\t\t\tdelegate.onHide(false);\n\t\t\t\t}\n\n\t\t\t\tdom.ModifierKeyEmitter.getInstance().resetKeyStatus();\n\t\t\t});\n\n\t\t\tconst menu = this.createMenu(delegate, actions, onHide);\n\t\t\tconst anchor = delegate.getAnchor();\n\n\t\t\tlet x: number;\n\t\t\tlet y: number;\n\n\t\t\tconst zoom = getZoomFactor();\n\t\t\tif (dom.isHTMLElement(anchor)) {\n\t\t\t\tconst elementPosition = dom.getDomNodePagePosition(anchor);\n\n\t\t\t\tx = elementPosition.left;\n\t\t\t\ty = elementPosition.top + elementPosition.height;\n\n\t\t\t\t// Shift macOS menus by a few pixels below elements\n\t\t\t\t// to account for extra padding on top of native menu\n\t\t\t\t// https://github.com/microsoft/vscode/issues/84231\n\t\t\t\tif (isMacintosh) {\n\t\t\t\t\ty += 4 / zoom;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst pos: { x: number; y: number; } = anchor;\n\t\t\t\tx = pos.x + 1; /* prevent first item from being selected automatically under mouse */\n\t\t\t\ty = pos.y;\n\t\t\t}\n\n\t\t\tx *= zoom;\n\t\t\ty *= zoom;\n\n\t\t\tpopup(menu, {\n\t\t\t\tx: Math.floor(x),\n\t\t\t\ty: Math.floor(y),\n\t\t\t\tpositioningItem: delegate.autoSelectFirstItem ? 0 : undefined,\n\t\t\t}, () => onHide());\n\t\t}\n\t}\n\n\tprivate createMenu(delegate: IContextMenuDelegate, entries: readonly IAction[], onHide: () => void, submenuIds = new Set<string>()): IContextMenuItem[] {\n\t\tconst actionRunner = delegate.actionRunner || new ActionRunner();\n\t\treturn coalesce(entries.map(entry => this.createMenuItem(delegate, entry, actionRunner, onHide, submenuIds)));\n\t}\n\n\tprivate createMenuItem(delegate: IContextMenuDelegate, entry: IAction, actionRunner: IActionRunner, onHide: () => void, submenuIds: Set<string>): IContextMenuItem | undefined {\n\t\t// Separator\n\t\tif (entry instanceof Separator) {\n\t\t\treturn { type: 'separator' };\n\t\t}\n\n\t\t// Submenu\n\t\tif (entry instanceof SubmenuAction) {\n\t\t\tif (submenuIds.has(entry.id)) {\n\t\t\t\tconsole.warn(`Found submenu cycle: ${entry.id}`);\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlabel: unmnemonicLabel(stripIcons(entry.label)).trim(),\n\t\t\t\tsubmenu: this.createMenu(delegate, entry.actions, onHide, new Set([...submenuIds, entry.id]))\n\t\t\t};\n\t\t}\n\n\t\t// Normal Menu Item\n\t\telse {\n\t\t\tlet type: 'radio' | 'checkbox' | undefined = undefined;\n\t\t\tif (!!entry.checked) {\n\t\t\t\tif (typeof delegate.getCheckedActionsRepresentation === 'function') {\n\t\t\t\t\ttype = delegate.getCheckedActionsRepresentation(entry);\n\t\t\t\t} else {\n\t\t\t\t\ttype = 'checkbox';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst item: IContextMenuItem = {\n\t\t\t\tlabel: unmnemonicLabel(stripIcons(entry.label)).trim(),\n\t\t\t\tchecked: !!entry.checked,\n\t\t\t\ttype,\n\t\t\t\tenabled: !!entry.enabled,\n\t\t\t\tclick: event => {\n\n\t\t\t\t\t// To preserve pre-electron-2.x behaviour, we first trigger\n\t\t\t\t\t// the onHide callback and then the action.\n\t\t\t\t\t// Fixes https://github.com/microsoft/vscode/issues/45601\n\t\t\t\t\tonHide();\n\n\t\t\t\t\t// Run action which will close the menu\n\t\t\t\t\tthis.runAction(actionRunner, entry, delegate, event);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst keybinding = !!delegate.getKeyBinding ? delegate.getKeyBinding(entry) : this.keybindingService.lookupKeybinding(entry.id);\n\t\t\tif (keybinding) {\n\t\t\t\tconst electronAccelerator = keybinding.getElectronAccelerator();\n\t\t\t\tif (electronAccelerator) {\n\t\t\t\t\titem.accelerator = electronAccelerator;\n\t\t\t\t} else {\n\t\t\t\t\tconst label = keybinding.getLabel();\n\t\t\t\t\tif (label) {\n\t\t\t\t\t\titem.label = `${item.label} [${label}]`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tprivate async runAction(actionRunner: IActionRunner, actionToRun: IAction, delegate: IContextMenuDelegate, event: IContextMenuEvent): Promise<void> {\n\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: actionToRun.id, from: 'contextMenu' });\n\n\t\tconst context = delegate.getActionsContext ? delegate.getActionsContext(event) : undefined;\n\n\t\tconst runnable = actionRunner.run(actionToRun, context);\n\t\ttry {\n\t\t\tawait runnable;\n\t\t} catch (error) {\n\t\t\tthis.notificationService.error(error);\n\t\t}\n\t}\n}\n\nregisterSingleton(IContextMenuService, ContextMenuService, true);\n"]}