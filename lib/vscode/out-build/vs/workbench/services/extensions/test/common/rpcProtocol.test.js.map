{"version":3,"file":"rpcProtocol.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/extensions/test/common/rpcProtocol.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;IAUhG,KAAK,CAAC,aAAa,EAAE,GAAG,EAAE;QAEzB,MAAM,sBAAsB;YAA5B;gBAGkB,eAAU,GAAG,IAAI,eAAO,EAAY,CAAC;gBACtC,cAAS,GAAoB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;YAWpE,CAAC;YATO,OAAO,CAAC,KAA6B;gBAC3C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACpB,CAAC;YAEM,IAAI,CAAC,MAAgB;gBAC3B,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE;oBAC3B,IAAI,CAAC,KAAM,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACrC,CAAC,CAAC,CAAC;YACJ,CAAC;SACD;QAED,IAAI,QAAmC,CAAC;QACxC,IAAI,MAAc,CAAC;QACnB,MAAM,MAAM;YACX,EAAE,CAAC,EAAO,EAAE,EAAO;gBAClB,OAAO,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;YACrD,CAAC;SACD;QAED,KAAK,CAAC,GAAG,EAAE;YACV,IAAI,UAAU,GAAG,IAAI,sBAAsB,EAAE,CAAC;YAC9C,IAAI,UAAU,GAAG,IAAI,sBAAsB,EAAE,CAAC;YAC9C,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAC/B,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAE/B,IAAI,CAAC,GAAG,IAAI,yBAAW,CAAC,UAAU,CAAC,CAAC;YACpC,IAAI,CAAC,GAAG,IAAI,yBAAW,CAAC,UAAU,CAAC,CAAC;YAEpC,MAAM,WAAW,GAAG,IAAI,iCAAe,CAAS,KAAK,EAAE,IAAI,CAAC,CAAC;YAC7D,MAAM,SAAS,GAAG,IAAI,MAAM,EAAE,CAAC;YAC/B,CAAC,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;YAC9B,MAAM,GAAG,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,aAAa,EAAE,UAAU,IAAI;YACjC,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC;YAC/C,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAW,EAAE,EAAE;gBACpC,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;gBAC3B,IAAI,CAAC,IAAI,CAAC,CAAC;YACZ,CAAC,EAAE,IAAI,CAAC,CAAC;QACV,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,4BAA4B,EAAE,UAAU,IAAI;YAChD,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE,GAAG,CAAC,CAAC;YAC3C,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAW,EAAE,EAAE;gBACpC,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;gBACnC,IAAI,CAAC,IAAI,CAAC,CAAC;YACZ,CAAC,EAAE,IAAI,CAAC,CAAC;QACV,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,4BAA4B,EAAE,UAAU,IAAI;YAChD,QAAQ,GAAG,CAAC,EAAY,EAAE,EAAU,EAAE,EAAE;gBACvC,MAAM,CAAC,EAAE,CAAC,EAAE,YAAY,iBAAQ,CAAC,CAAC;gBAClC,OAAO,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YACtB,CAAC,CAAC;YACF,IAAI,CAAC,GAAG,iBAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC1B,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAChB,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAW,EAAE,EAAE;gBACpC,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;gBAC3B,IAAI,CAAC,IAAI,CAAC,CAAC;YACZ,CAAC,EAAE,IAAI,CAAC,CAAC;QACV,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,oBAAoB,EAAE,UAAU,IAAI;YACxC,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE;gBACrC,IAAI,CAAC,GAAG,iBAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC1B,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBAChB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBAChB,OAAO,CAAC,CAAC;YACV,CAAC,CAAC;YACF,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAa,EAAE,EAAE;gBACtC,MAAM,CAAC,EAAE,CAAC,GAAG,YAAY,iBAAQ,CAAC,CAAC;gBACnC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrC,IAAI,CAAC,IAAI,CAAC,CAAC;YACZ,CAAC,EAAE,IAAI,CAAC,CAAC;QACV,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,gDAAgD,EAAE,UAAU,IAAI;YACpE,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC;YAC/C,IAAI,CAAC,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,gCAAiB,CAAC,SAAS,CAAC,CAAC;YAClD,CAAC,CAAC,IAAI,CAAC,CAAC,GAAW,EAAE,EAAE;gBACtB,MAAM,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;YAC1C,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;gBACV,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBAChB,IAAI,CAAC,IAAI,CAAC,CAAC;YACZ,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,gCAAgC,EAAE,UAAU,IAAI;YACpD,QAAQ,GAAG,CAAC,EAAU,EAAE,KAAwB,EAAE,EAAE;gBACnD,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;gBACnB,OAAO,EAAE,GAAG,CAAC,CAAC;YACf,CAAC,CAAC;YACF,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,gCAAiB,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,GAAW,EAAE,EAAE;gBACzD,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;gBAC3B,IAAI,CAAC,IAAI,CAAC,CAAC;YACZ,CAAC,EAAE,IAAI,CAAC,CAAC;QACV,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,iDAAiD,EAAE,UAAU,IAAI;YACrE,iFAAiF;YACjF,QAAQ,GAAG,CAAC,EAAU,EAAE,KAAwB,EAAE,EAAE;gBACnD,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;oBACtC,KAAK,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,EAAE;wBACnC,OAAO,CAAC,CAAC,CAAC,CAAC;oBACZ,CAAC,CAAC,CAAC;gBACJ,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC;YACF,IAAI,WAAW,GAAG,IAAI,sCAAuB,EAAE,CAAC;YAChD,IAAI,CAAC,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC;YACxC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAW,EAAE,EAAE;gBACtB,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;gBACV,MAAM,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YACzC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACjB,WAAW,CAAC,MAAM,EAAE,CAAC;QACtB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mBAAmB,EAAE,UAAU,IAAI;YACvC,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE;gBACrC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;YACzB,CAAC,CAAC;YACF,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC5B,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3B,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;gBACV,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YACzC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,eAAe,EAAE,UAAU,IAAI;YACnC,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE;gBACrC,OAAO,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YAClC,CAAC,CAAC;YACF,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC5B,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3B,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;gBACV,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;YACpC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,qDAAqD,EAAE,UAAU,IAAI;YACzE,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE;gBACrC,IAAI,QAAQ,GAAQ,EAAE,CAAC;gBACvB,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC;gBACzB,OAAO,QAAQ,CAAC;YACjB,CAAC,CAAC;YACF,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC5B,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;YAC/B,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;gBACV,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3B,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,8CAA8C,EAAE,UAAU,IAAI;YAClE,QAAQ,GAAG,CAAC,EAAU,EAAE,EAAU,EAAE,EAAE;gBACrC,4CAA4C;gBAC5C,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;YAC1B,CAAC,CAAC;YACF,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC5B,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3B,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;gBACV,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YACtC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,oCAAoC,EAAE;YAC1C,QAAQ,GAAG,CAAC,EAAO,EAAE,EAAO,EAAE,EAAE;gBAC/B,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,EAAE,WAAW,CAAC,CAAC;gBAC3C,MAAM,CAAC,WAAW,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;gBAC7B,OAAO,CAAC,CAAC;YACV,CAAC,CAAC;YACF,OAAO,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC9C,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,kFAAkF,EAAE,GAAG,EAAE;YAC7F,IAAI,SAAS,GAAG,EAAE,CAAC;YACb,SAAU,CAAC,IAAI,GAAG,SAAS,CAAC;YAElC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE;gBAClB,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;YAC3B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IMessagePassingProtocol } from 'vs/base/parts/ipc/common/ipc';\nimport { ProxyIdentifier } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport { RPCProtocol } from 'vs/workbench/services/extensions/common/rpcProtocol';\nimport { VSBuffer } from 'vs/base/common/buffer';\n\nsuite('RPCProtocol', () => {\n\n\tclass MessagePassingProtocol implements IMessagePassingProtocol {\n\t\tprivate _pair?: MessagePassingProtocol;\n\n\t\tprivate readonly _onMessage = new Emitter<VSBuffer>();\n\t\tpublic readonly onMessage: Event<VSBuffer> = this._onMessage.event;\n\n\t\tpublic setPair(other: MessagePassingProtocol) {\n\t\t\tthis._pair = other;\n\t\t}\n\n\t\tpublic send(buffer: VSBuffer): void {\n\t\t\tPromise.resolve().then(() => {\n\t\t\t\tthis._pair!._onMessage.fire(buffer);\n\t\t\t});\n\t\t}\n\t}\n\n\tlet delegate: (a1: any, a2: any) => any;\n\tlet bProxy: BClass;\n\tclass BClass {\n\t\t$m(a1: any, a2: any): Promise<any> {\n\t\t\treturn Promise.resolve(delegate.call(null, a1, a2));\n\t\t}\n\t}\n\n\tsetup(() => {\n\t\tlet a_protocol = new MessagePassingProtocol();\n\t\tlet b_protocol = new MessagePassingProtocol();\n\t\ta_protocol.setPair(b_protocol);\n\t\tb_protocol.setPair(a_protocol);\n\n\t\tlet A = new RPCProtocol(a_protocol);\n\t\tlet B = new RPCProtocol(b_protocol);\n\n\t\tconst bIdentifier = new ProxyIdentifier<BClass>(false, 'bb');\n\t\tconst bInstance = new BClass();\n\t\tB.set(bIdentifier, bInstance);\n\t\tbProxy = A.getProxy(bIdentifier);\n\t});\n\n\ttest('simple call', function (done) {\n\t\tdelegate = (a1: number, a2: number) => a1 + a2;\n\t\tbProxy.$m(4, 1).then((res: number) => {\n\t\t\tassert.strictEqual(res, 5);\n\t\t\tdone(null);\n\t\t}, done);\n\t});\n\n\ttest('simple call without result', function (done) {\n\t\tdelegate = (a1: number, a2: number) => { };\n\t\tbProxy.$m(4, 1).then((res: number) => {\n\t\t\tassert.strictEqual(res, undefined);\n\t\t\tdone(null);\n\t\t}, done);\n\t});\n\n\ttest('passing buffer as argument', function (done) {\n\t\tdelegate = (a1: VSBuffer, a2: number) => {\n\t\t\tassert.ok(a1 instanceof VSBuffer);\n\t\t\treturn a1.buffer[a2];\n\t\t};\n\t\tlet b = VSBuffer.alloc(4);\n\t\tb.buffer[0] = 1;\n\t\tb.buffer[1] = 2;\n\t\tb.buffer[2] = 3;\n\t\tb.buffer[3] = 4;\n\t\tbProxy.$m(b, 2).then((res: number) => {\n\t\t\tassert.strictEqual(res, 3);\n\t\t\tdone(null);\n\t\t}, done);\n\t});\n\n\ttest('returning a buffer', function (done) {\n\t\tdelegate = (a1: number, a2: number) => {\n\t\t\tlet b = VSBuffer.alloc(4);\n\t\t\tb.buffer[0] = 1;\n\t\t\tb.buffer[1] = 2;\n\t\t\tb.buffer[2] = 3;\n\t\t\tb.buffer[3] = 4;\n\t\t\treturn b;\n\t\t};\n\t\tbProxy.$m(4, 1).then((res: VSBuffer) => {\n\t\t\tassert.ok(res instanceof VSBuffer);\n\t\t\tassert.strictEqual(res.buffer[0], 1);\n\t\t\tassert.strictEqual(res.buffer[1], 2);\n\t\t\tassert.strictEqual(res.buffer[2], 3);\n\t\t\tassert.strictEqual(res.buffer[3], 4);\n\t\t\tdone(null);\n\t\t}, done);\n\t});\n\n\ttest('cancelling a call via CancellationToken before', function (done) {\n\t\tdelegate = (a1: number, a2: number) => a1 + a2;\n\t\tlet p = bProxy.$m(4, CancellationToken.Cancelled);\n\t\tp.then((res: number) => {\n\t\t\tassert.fail('should not receive result');\n\t\t}, (err) => {\n\t\t\tassert.ok(true);\n\t\t\tdone(null);\n\t\t});\n\t});\n\n\ttest('passing CancellationToken.None', function (done) {\n\t\tdelegate = (a1: number, token: CancellationToken) => {\n\t\t\tassert.ok(!!token);\n\t\t\treturn a1 + 1;\n\t\t};\n\t\tbProxy.$m(4, CancellationToken.None).then((res: number) => {\n\t\t\tassert.strictEqual(res, 5);\n\t\t\tdone(null);\n\t\t}, done);\n\t});\n\n\ttest('cancelling a call via CancellationToken quickly', function (done) {\n\t\t// this is an implementation which, when cancellation is triggered, will return 7\n\t\tdelegate = (a1: number, token: CancellationToken) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\ttoken.onCancellationRequested((e) => {\n\t\t\t\t\tresolve(7);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tlet tokenSource = new CancellationTokenSource();\n\t\tlet p = bProxy.$m(4, tokenSource.token);\n\t\tp.then((res: number) => {\n\t\t\tassert.strictEqual(res, 7);\n\t\t}, (err) => {\n\t\t\tassert.fail('should not receive error');\n\t\t}).finally(done);\n\t\ttokenSource.cancel();\n\t});\n\n\ttest('throwing an error', function (done) {\n\t\tdelegate = (a1: number, a2: number) => {\n\t\t\tthrow new Error(`nope`);\n\t\t};\n\t\tbProxy.$m(4, 1).then((res) => {\n\t\t\tassert.fail('unexpected');\n\t\t}, (err) => {\n\t\t\tassert.strictEqual(err.message, 'nope');\n\t\t}).finally(done);\n\t});\n\n\ttest('error promise', function (done) {\n\t\tdelegate = (a1: number, a2: number) => {\n\t\t\treturn Promise.reject(undefined);\n\t\t};\n\t\tbProxy.$m(4, 1).then((res) => {\n\t\t\tassert.fail('unexpected');\n\t\t}, (err) => {\n\t\t\tassert.strictEqual(err, undefined);\n\t\t}).finally(done);\n\t});\n\n\ttest('issue #60450: Converting circular structure to JSON', function (done) {\n\t\tdelegate = (a1: number, a2: number) => {\n\t\t\tlet circular = <any>{};\n\t\t\tcircular.self = circular;\n\t\t\treturn circular;\n\t\t};\n\t\tbProxy.$m(4, 1).then((res) => {\n\t\t\tassert.strictEqual(res, null);\n\t\t}, (err) => {\n\t\t\tassert.fail('unexpected');\n\t\t}).finally(done);\n\t});\n\n\ttest('issue #72798: null errors are hard to digest', function (done) {\n\t\tdelegate = (a1: number, a2: number) => {\n\t\t\t// eslint-disable-next-line no-throw-literal\n\t\t\tthrow { 'what': 'what' };\n\t\t};\n\t\tbProxy.$m(4, 1).then((res) => {\n\t\t\tassert.fail('unexpected');\n\t\t}, (err) => {\n\t\t\tassert.strictEqual(err.what, 'what');\n\t\t}).finally(done);\n\t});\n\n\ttest('undefined arguments arrive as null', function () {\n\t\tdelegate = (a1: any, a2: any) => {\n\t\t\tassert.strictEqual(typeof a1, 'undefined');\n\t\t\tassert.strictEqual(a2, null);\n\t\t\treturn 7;\n\t\t};\n\t\treturn bProxy.$m(undefined, null).then((res) => {\n\t\t\tassert.strictEqual(res, 7);\n\t\t});\n\t});\n\n\ttest('issue #81424: SerializeRequest should throw if an argument can not be serialized', () => {\n\t\tlet badObject = {};\n\t\t(<any>badObject).loop = badObject;\n\n\t\tassert.throws(() => {\n\t\t\tbProxy.$m(badObject, '2');\n\t\t});\n\t});\n});\n"]}