{"version":3,"file":"rpcProtocol.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/extensions/common/rpcProtocol.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { CharCode } from 'vs/base/common/charCode';\nimport * as errors from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IURITransformer, transformIncomingURIs } from 'vs/base/common/uriIpc';\nimport { IMessagePassingProtocol } from 'vs/base/parts/ipc/common/ipc';\nimport { LazyPromise } from 'vs/workbench/services/extensions/common/lazyPromise';\nimport { IRPCProtocol, ProxyIdentifier, getStringIdentifierForProxy } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport { VSBuffer } from 'vs/base/common/buffer';\n\nexport interface JSONStringifyReplacer {\n\t(key: string, value: any): any;\n}\n\nfunction safeStringify(obj: any, replacer: JSONStringifyReplacer | null): string {\n\ttry {\n\t\treturn JSON.stringify(obj, <(key: string, value: any) => any>replacer);\n\t} catch (err) {\n\t\treturn 'null';\n\t}\n}\n\nfunction stringify(obj: any, replacer: JSONStringifyReplacer | null): string {\n\treturn JSON.stringify(obj, <(key: string, value: any) => any>replacer);\n}\n\nfunction createURIReplacer(transformer: IURITransformer | null): JSONStringifyReplacer | null {\n\tif (!transformer) {\n\t\treturn null;\n\t}\n\treturn (key: string, value: any): any => {\n\t\tif (value && value.$mid === 1) {\n\t\t\treturn transformer.transformOutgoing(value);\n\t\t}\n\t\treturn value;\n\t};\n}\n\nexport const enum RequestInitiator {\n\tLocalSide = 0,\n\tOtherSide = 1\n}\n\nexport const enum ResponsiveState {\n\tResponsive = 0,\n\tUnresponsive = 1\n}\n\nexport interface IRPCProtocolLogger {\n\tlogIncoming(msgLength: number, req: number, initiator: RequestInitiator, str: string, data?: any): void;\n\tlogOutgoing(msgLength: number, req: number, initiator: RequestInitiator, str: string, data?: any): void;\n}\n\nconst noop = () => { };\n\nconst _RPCProtocolSymbol = Symbol.for('rpcProtocol');\nconst _RPCProxySymbol = Symbol.for('rpcProxy');\n\nexport class RPCProtocol extends Disposable implements IRPCProtocol {\n\n\t[_RPCProtocolSymbol] = true;\n\n\tprivate static readonly UNRESPONSIVE_TIME = 3 * 1000; // 3s\n\n\tprivate readonly _onDidChangeResponsiveState: Emitter<ResponsiveState> = this._register(new Emitter<ResponsiveState>());\n\tpublic readonly onDidChangeResponsiveState: Event<ResponsiveState> = this._onDidChangeResponsiveState.event;\n\n\tprivate readonly _protocol: IMessagePassingProtocol;\n\tprivate readonly _logger: IRPCProtocolLogger | null;\n\tprivate readonly _uriTransformer: IURITransformer | null;\n\tprivate readonly _uriReplacer: JSONStringifyReplacer | null;\n\tprivate _isDisposed: boolean;\n\tprivate readonly _locals: any[];\n\tprivate readonly _proxies: any[];\n\tprivate _lastMessageId: number;\n\tprivate readonly _cancelInvokedHandlers: { [req: string]: () => void; };\n\tprivate readonly _pendingRPCReplies: { [msgId: string]: LazyPromise; };\n\tprivate _responsiveState: ResponsiveState;\n\tprivate _unacknowledgedCount: number;\n\tprivate _unresponsiveTime: number;\n\tprivate _asyncCheckUresponsive: RunOnceScheduler;\n\n\tconstructor(protocol: IMessagePassingProtocol, logger: IRPCProtocolLogger | null = null, transformer: IURITransformer | null = null) {\n\t\tsuper();\n\t\tthis._protocol = protocol;\n\t\tthis._logger = logger;\n\t\tthis._uriTransformer = transformer;\n\t\tthis._uriReplacer = createURIReplacer(this._uriTransformer);\n\t\tthis._isDisposed = false;\n\t\tthis._locals = [];\n\t\tthis._proxies = [];\n\t\tfor (let i = 0, len = ProxyIdentifier.count; i < len; i++) {\n\t\t\tthis._locals[i] = null;\n\t\t\tthis._proxies[i] = null;\n\t\t}\n\t\tthis._lastMessageId = 0;\n\t\tthis._cancelInvokedHandlers = Object.create(null);\n\t\tthis._pendingRPCReplies = {};\n\t\tthis._responsiveState = ResponsiveState.Responsive;\n\t\tthis._unacknowledgedCount = 0;\n\t\tthis._unresponsiveTime = 0;\n\t\tthis._asyncCheckUresponsive = this._register(new RunOnceScheduler(() => this._checkUnresponsive(), 1000));\n\t\tthis._protocol.onMessage((msg) => this._receiveOneMessage(msg));\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._isDisposed = true;\n\n\t\t// Release all outstanding promises with a canceled error\n\t\tObject.keys(this._pendingRPCReplies).forEach((msgId) => {\n\t\t\tconst pending = this._pendingRPCReplies[msgId];\n\t\t\tpending.resolveErr(errors.canceled());\n\t\t});\n\t}\n\n\tpublic drain(): Promise<void> {\n\t\tif (typeof this._protocol.drain === 'function') {\n\t\t\treturn this._protocol.drain();\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tprivate _onWillSendRequest(req: number): void {\n\t\tif (this._unacknowledgedCount === 0) {\n\t\t\t// Since this is the first request we are sending in a while,\n\t\t\t// mark this moment as the start for the countdown to unresponsive time\n\t\t\tthis._unresponsiveTime = Date.now() + RPCProtocol.UNRESPONSIVE_TIME;\n\t\t}\n\t\tthis._unacknowledgedCount++;\n\t\tif (!this._asyncCheckUresponsive.isScheduled()) {\n\t\t\tthis._asyncCheckUresponsive.schedule();\n\t\t}\n\t}\n\n\tprivate _onDidReceiveAcknowledge(req: number): void {\n\t\t// The next possible unresponsive time is now + delta.\n\t\tthis._unresponsiveTime = Date.now() + RPCProtocol.UNRESPONSIVE_TIME;\n\t\tthis._unacknowledgedCount--;\n\t\tif (this._unacknowledgedCount === 0) {\n\t\t\t// No more need to check for unresponsive\n\t\t\tthis._asyncCheckUresponsive.cancel();\n\t\t}\n\t\t// The ext host is responsive!\n\t\tthis._setResponsiveState(ResponsiveState.Responsive);\n\t}\n\n\tprivate _checkUnresponsive(): void {\n\t\tif (this._unacknowledgedCount === 0) {\n\t\t\t// Not waiting for anything => cannot say if it is responsive or not\n\t\t\treturn;\n\t\t}\n\n\t\tif (Date.now() > this._unresponsiveTime) {\n\t\t\t// Unresponsive!!\n\t\t\tthis._setResponsiveState(ResponsiveState.Unresponsive);\n\t\t} else {\n\t\t\t// Not (yet) unresponsive, be sure to check again soon\n\t\t\tthis._asyncCheckUresponsive.schedule();\n\t\t}\n\t}\n\n\tprivate _setResponsiveState(newResponsiveState: ResponsiveState): void {\n\t\tif (this._responsiveState === newResponsiveState) {\n\t\t\t// no change\n\t\t\treturn;\n\t\t}\n\t\tthis._responsiveState = newResponsiveState;\n\t\tthis._onDidChangeResponsiveState.fire(this._responsiveState);\n\t}\n\n\tpublic get responsiveState(): ResponsiveState {\n\t\treturn this._responsiveState;\n\t}\n\n\tpublic transformIncomingURIs<T>(obj: T): T {\n\t\tif (!this._uriTransformer) {\n\t\t\treturn obj;\n\t\t}\n\t\treturn transformIncomingURIs(obj, this._uriTransformer);\n\t}\n\n\tpublic getProxy<T>(identifier: ProxyIdentifier<T>): T {\n\t\tconst { nid: rpcId, sid } = identifier;\n\t\tif (!this._proxies[rpcId]) {\n\t\t\tthis._proxies[rpcId] = this._createProxy(rpcId, sid);\n\t\t}\n\t\treturn this._proxies[rpcId];\n\t}\n\n\tprivate _createProxy<T>(rpcId: number, debugName: string): T {\n\t\tlet handler = {\n\t\t\tget: (target: any, name: PropertyKey) => {\n\t\t\t\tif (typeof name === 'string' && !target[name] && name.charCodeAt(0) === CharCode.DollarSign) {\n\t\t\t\t\ttarget[name] = (...myArgs: any[]) => {\n\t\t\t\t\t\treturn this._remoteCall(rpcId, name, myArgs);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (name === _RPCProxySymbol) {\n\t\t\t\t\treturn debugName;\n\t\t\t\t}\n\t\t\t\treturn target[name];\n\t\t\t}\n\t\t};\n\t\treturn new Proxy(Object.create(null), handler);\n\t}\n\n\tpublic set<T, R extends T>(identifier: ProxyIdentifier<T>, value: R): R {\n\t\tthis._locals[identifier.nid] = value;\n\t\treturn value;\n\t}\n\n\tpublic assertRegistered(identifiers: ProxyIdentifier<any>[]): void {\n\t\tfor (let i = 0, len = identifiers.length; i < len; i++) {\n\t\t\tconst identifier = identifiers[i];\n\t\t\tif (!this._locals[identifier.nid]) {\n\t\t\t\tthrow new Error(`Missing actor ${identifier.sid} (isMain: ${identifier.isMain})`);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _receiveOneMessage(rawmsg: VSBuffer): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst msgLength = rawmsg.byteLength;\n\t\tconst buff = MessageBuffer.read(rawmsg, 0);\n\t\tconst messageType = <MessageType>buff.readUInt8();\n\t\tconst req = buff.readUInt32();\n\n\t\tswitch (messageType) {\n\t\t\tcase MessageType.RequestJSONArgs:\n\t\t\tcase MessageType.RequestJSONArgsWithCancellation: {\n\t\t\t\tlet { rpcId, method, args } = MessageIO.deserializeRequestJSONArgs(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\targs = transformIncomingURIs(args, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveRequest(msgLength, req, rpcId, method, args, (messageType === MessageType.RequestJSONArgsWithCancellation));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.RequestMixedArgs:\n\t\t\tcase MessageType.RequestMixedArgsWithCancellation: {\n\t\t\t\tlet { rpcId, method, args } = MessageIO.deserializeRequestMixedArgs(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\targs = transformIncomingURIs(args, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveRequest(msgLength, req, rpcId, method, args, (messageType === MessageType.RequestMixedArgsWithCancellation));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.Acknowledged: {\n\t\t\t\tif (this._logger) {\n\t\t\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.LocalSide, `ack`);\n\t\t\t\t}\n\t\t\t\tthis._onDidReceiveAcknowledge(req);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.Cancel: {\n\t\t\t\tthis._receiveCancel(msgLength, req);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyOKEmpty: {\n\t\t\t\tthis._receiveReply(msgLength, req, undefined);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyOKJSON: {\n\t\t\t\tlet value = MessageIO.deserializeReplyOKJSON(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\tvalue = transformIncomingURIs(value, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveReply(msgLength, req, value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyOKVSBuffer: {\n\t\t\t\tlet value = MessageIO.deserializeReplyOKVSBuffer(buff);\n\t\t\t\tthis._receiveReply(msgLength, req, value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyErrError: {\n\t\t\t\tlet err = MessageIO.deserializeReplyErrError(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\terr = transformIncomingURIs(err, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveReplyErr(msgLength, req, err);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyErrEmpty: {\n\t\t\t\tthis._receiveReplyErr(msgLength, req, undefined);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.error(`received unexpected message`);\n\t\t\t\tconsole.error(rawmsg);\n\t\t}\n\t}\n\n\tprivate _receiveRequest(msgLength: number, req: number, rpcId: number, method: string, args: any[], usesCancellationToken: boolean): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.OtherSide, `receiveRequest ${getStringIdentifierForProxy(rpcId)}.${method}(`, args);\n\t\t}\n\t\tconst callId = String(req);\n\n\t\tlet promise: Promise<any>;\n\t\tlet cancel: () => void;\n\t\tif (usesCancellationToken) {\n\t\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\t\t\targs.push(cancellationTokenSource.token);\n\t\t\tpromise = this._invokeHandler(rpcId, method, args);\n\t\t\tcancel = () => cancellationTokenSource.cancel();\n\t\t} else {\n\t\t\t// cannot be cancelled\n\t\t\tpromise = this._invokeHandler(rpcId, method, args);\n\t\t\tcancel = noop;\n\t\t}\n\n\t\tthis._cancelInvokedHandlers[callId] = cancel;\n\n\t\t// Acknowledge the request\n\t\tconst msg = MessageIO.serializeAcknowledged(req);\n\t\tif (this._logger) {\n\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.OtherSide, `ack`);\n\t\t}\n\t\tthis._protocol.send(msg);\n\n\t\tpromise.then((r) => {\n\t\t\tdelete this._cancelInvokedHandlers[callId];\n\t\t\tconst msg = MessageIO.serializeReplyOK(req, r, this._uriReplacer);\n\t\t\tif (this._logger) {\n\t\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.OtherSide, `reply:`, r);\n\t\t\t}\n\t\t\tthis._protocol.send(msg);\n\t\t}, (err) => {\n\t\t\tdelete this._cancelInvokedHandlers[callId];\n\t\t\tconst msg = MessageIO.serializeReplyErr(req, err);\n\t\t\tif (this._logger) {\n\t\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.OtherSide, `replyErr:`, err);\n\t\t\t}\n\t\t\tthis._protocol.send(msg);\n\t\t});\n\t}\n\n\tprivate _receiveCancel(msgLength: number, req: number): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.OtherSide, `receiveCancel`);\n\t\t}\n\t\tconst callId = String(req);\n\t\tif (this._cancelInvokedHandlers[callId]) {\n\t\t\tthis._cancelInvokedHandlers[callId]();\n\t\t}\n\t}\n\n\tprivate _receiveReply(msgLength: number, req: number, value: any): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.LocalSide, `receiveReply:`, value);\n\t\t}\n\t\tconst callId = String(req);\n\t\tif (!this._pendingRPCReplies.hasOwnProperty(callId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pendingReply = this._pendingRPCReplies[callId];\n\t\tdelete this._pendingRPCReplies[callId];\n\n\t\tpendingReply.resolveOk(value);\n\t}\n\n\tprivate _receiveReplyErr(msgLength: number, req: number, value: any): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.LocalSide, `receiveReplyErr:`, value);\n\t\t}\n\n\t\tconst callId = String(req);\n\t\tif (!this._pendingRPCReplies.hasOwnProperty(callId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pendingReply = this._pendingRPCReplies[callId];\n\t\tdelete this._pendingRPCReplies[callId];\n\n\t\tlet err: any = undefined;\n\t\tif (value) {\n\t\t\tif (value.$isError) {\n\t\t\t\terr = new Error();\n\t\t\t\terr.name = value.name;\n\t\t\t\terr.message = value.message;\n\t\t\t\terr.stack = value.stack;\n\t\t\t} else {\n\t\t\t\terr = value;\n\t\t\t}\n\t\t}\n\t\tpendingReply.resolveErr(err);\n\t}\n\n\tprivate _invokeHandler(rpcId: number, methodName: string, args: any[]): Promise<any> {\n\t\ttry {\n\t\t\treturn Promise.resolve(this._doInvokeHandler(rpcId, methodName, args));\n\t\t} catch (err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\t}\n\n\tprivate _doInvokeHandler(rpcId: number, methodName: string, args: any[]): any {\n\t\tconst actor = this._locals[rpcId];\n\t\tif (!actor) {\n\t\t\tthrow new Error('Unknown actor ' + getStringIdentifierForProxy(rpcId));\n\t\t}\n\t\tlet method = actor[methodName];\n\t\tif (typeof method !== 'function') {\n\t\t\tthrow new Error('Unknown method ' + methodName + ' on actor ' + getStringIdentifierForProxy(rpcId));\n\t\t}\n\t\treturn method.apply(actor, args);\n\t}\n\n\tprivate _remoteCall(rpcId: number, methodName: string, args: any[]): Promise<any> {\n\t\tif (this._isDisposed) {\n\t\t\treturn Promise.reject<any>(errors.canceled());\n\t\t}\n\t\tlet cancellationToken: CancellationToken | null = null;\n\t\tif (args.length > 0 && CancellationToken.isCancellationToken(args[args.length - 1])) {\n\t\t\tcancellationToken = args.pop();\n\t\t}\n\n\t\tif (cancellationToken && cancellationToken.isCancellationRequested) {\n\t\t\t// No need to do anything...\n\t\t\treturn Promise.reject<any>(errors.canceled());\n\t\t}\n\n\t\tconst serializedRequestArguments = MessageIO.serializeRequestArguments(args, this._uriReplacer);\n\n\t\tconst req = ++this._lastMessageId;\n\t\tconst callId = String(req);\n\t\tconst result = new LazyPromise();\n\n\t\tif (cancellationToken) {\n\t\t\tcancellationToken.onCancellationRequested(() => {\n\t\t\t\tconst msg = MessageIO.serializeCancel(req);\n\t\t\t\tif (this._logger) {\n\t\t\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.LocalSide, `cancel`);\n\t\t\t\t}\n\t\t\t\tthis._protocol.send(MessageIO.serializeCancel(req));\n\t\t\t});\n\t\t}\n\n\t\tthis._pendingRPCReplies[callId] = result;\n\t\tthis._onWillSendRequest(req);\n\t\tconst msg = MessageIO.serializeRequest(req, rpcId, methodName, serializedRequestArguments, !!cancellationToken);\n\t\tif (this._logger) {\n\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.LocalSide, `request: ${getStringIdentifierForProxy(rpcId)}.${methodName}(`, args);\n\t\t}\n\t\tthis._protocol.send(msg);\n\t\treturn result;\n\t}\n}\n\nclass MessageBuffer {\n\n\tpublic static alloc(type: MessageType, req: number, messageSize: number): MessageBuffer {\n\t\tlet result = new MessageBuffer(VSBuffer.alloc(messageSize + 1 /* type */ + 4 /* req */), 0);\n\t\tresult.writeUInt8(type);\n\t\tresult.writeUInt32(req);\n\t\treturn result;\n\t}\n\n\tpublic static read(buff: VSBuffer, offset: number): MessageBuffer {\n\t\treturn new MessageBuffer(buff, offset);\n\t}\n\n\tprivate _buff: VSBuffer;\n\tprivate _offset: number;\n\n\tpublic get buffer(): VSBuffer {\n\t\treturn this._buff;\n\t}\n\n\tprivate constructor(buff: VSBuffer, offset: number) {\n\t\tthis._buff = buff;\n\t\tthis._offset = offset;\n\t}\n\n\tpublic static sizeUInt8(): number {\n\t\treturn 1;\n\t}\n\n\tpublic writeUInt8(n: number): void {\n\t\tthis._buff.writeUInt8(n, this._offset); this._offset += 1;\n\t}\n\n\tpublic readUInt8(): number {\n\t\tconst n = this._buff.readUInt8(this._offset); this._offset += 1;\n\t\treturn n;\n\t}\n\n\tpublic writeUInt32(n: number): void {\n\t\tthis._buff.writeUInt32BE(n, this._offset); this._offset += 4;\n\t}\n\n\tpublic readUInt32(): number {\n\t\tconst n = this._buff.readUInt32BE(this._offset); this._offset += 4;\n\t\treturn n;\n\t}\n\n\tpublic static sizeShortString(str: VSBuffer): number {\n\t\treturn 1 /* string length */ + str.byteLength /* actual string */;\n\t}\n\n\tpublic writeShortString(str: VSBuffer): void {\n\t\tthis._buff.writeUInt8(str.byteLength, this._offset); this._offset += 1;\n\t\tthis._buff.set(str, this._offset); this._offset += str.byteLength;\n\t}\n\n\tpublic readShortString(): string {\n\t\tconst strByteLength = this._buff.readUInt8(this._offset); this._offset += 1;\n\t\tconst strBuff = this._buff.slice(this._offset, this._offset + strByteLength);\n\t\tconst str = strBuff.toString(); this._offset += strByteLength;\n\t\treturn str;\n\t}\n\n\tpublic static sizeLongString(str: VSBuffer): number {\n\t\treturn 4 /* string length */ + str.byteLength /* actual string */;\n\t}\n\n\tpublic writeLongString(str: VSBuffer): void {\n\t\tthis._buff.writeUInt32BE(str.byteLength, this._offset); this._offset += 4;\n\t\tthis._buff.set(str, this._offset); this._offset += str.byteLength;\n\t}\n\n\tpublic readLongString(): string {\n\t\tconst strByteLength = this._buff.readUInt32BE(this._offset); this._offset += 4;\n\t\tconst strBuff = this._buff.slice(this._offset, this._offset + strByteLength);\n\t\tconst str = strBuff.toString(); this._offset += strByteLength;\n\t\treturn str;\n\t}\n\n\tpublic writeBuffer(buff: VSBuffer): void {\n\t\tthis._buff.writeUInt32BE(buff.byteLength, this._offset); this._offset += 4;\n\t\tthis._buff.set(buff, this._offset); this._offset += buff.byteLength;\n\t}\n\n\tpublic static sizeVSBuffer(buff: VSBuffer): number {\n\t\treturn 4 /* buffer length */ + buff.byteLength /* actual buffer */;\n\t}\n\n\tpublic writeVSBuffer(buff: VSBuffer): void {\n\t\tthis._buff.writeUInt32BE(buff.byteLength, this._offset); this._offset += 4;\n\t\tthis._buff.set(buff, this._offset); this._offset += buff.byteLength;\n\t}\n\n\tpublic readVSBuffer(): VSBuffer {\n\t\tconst buffLength = this._buff.readUInt32BE(this._offset); this._offset += 4;\n\t\tconst buff = this._buff.slice(this._offset, this._offset + buffLength); this._offset += buffLength;\n\t\treturn buff;\n\t}\n\n\tpublic static sizeMixedArray(arr: VSBuffer[], arrType: ArgType[]): number {\n\t\tlet size = 0;\n\t\tsize += 1; // arr length\n\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\tconst el = arr[i];\n\t\t\tconst elType = arrType[i];\n\t\t\tsize += 1; // arg type\n\t\t\tswitch (elType) {\n\t\t\t\tcase ArgType.String:\n\t\t\t\t\tsize += this.sizeLongString(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.VSBuffer:\n\t\t\t\t\tsize += this.sizeVSBuffer(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.Undefined:\n\t\t\t\t\t// empty...\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn size;\n\t}\n\n\tpublic writeMixedArray(arr: VSBuffer[], arrType: ArgType[]): void {\n\t\tthis._buff.writeUInt8(arr.length, this._offset); this._offset += 1;\n\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\tconst el = arr[i];\n\t\t\tconst elType = arrType[i];\n\t\t\tswitch (elType) {\n\t\t\t\tcase ArgType.String:\n\t\t\t\t\tthis.writeUInt8(ArgType.String);\n\t\t\t\t\tthis.writeLongString(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.VSBuffer:\n\t\t\t\t\tthis.writeUInt8(ArgType.VSBuffer);\n\t\t\t\t\tthis.writeVSBuffer(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.Undefined:\n\t\t\t\t\tthis.writeUInt8(ArgType.Undefined);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic readMixedArray(): Array<string | VSBuffer | undefined> {\n\t\tconst arrLen = this._buff.readUInt8(this._offset); this._offset += 1;\n\t\tlet arr: Array<string | VSBuffer | undefined> = new Array(arrLen);\n\t\tfor (let i = 0; i < arrLen; i++) {\n\t\t\tconst argType = <ArgType>this.readUInt8();\n\t\t\tswitch (argType) {\n\t\t\t\tcase ArgType.String:\n\t\t\t\t\tarr[i] = this.readLongString();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.VSBuffer:\n\t\t\t\t\tarr[i] = this.readVSBuffer();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.Undefined:\n\t\t\t\t\tarr[i] = undefined;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn arr;\n\t}\n}\n\ntype SerializedRequestArguments = { type: 'mixed'; args: VSBuffer[]; argsType: ArgType[]; } | { type: 'simple'; args: string; };\n\nclass MessageIO {\n\n\tprivate static _arrayContainsBufferOrUndefined(arr: any[]): boolean {\n\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\tif (arr[i] instanceof VSBuffer) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (typeof arr[i] === 'undefined') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic static serializeRequestArguments(args: any[], replacer: JSONStringifyReplacer | null): SerializedRequestArguments {\n\t\tif (this._arrayContainsBufferOrUndefined(args)) {\n\t\t\tlet massagedArgs: VSBuffer[] = [];\n\t\t\tlet massagedArgsType: ArgType[] = [];\n\t\t\tfor (let i = 0, len = args.length; i < len; i++) {\n\t\t\t\tconst arg = args[i];\n\t\t\t\tif (arg instanceof VSBuffer) {\n\t\t\t\t\tmassagedArgs[i] = arg;\n\t\t\t\t\tmassagedArgsType[i] = ArgType.VSBuffer;\n\t\t\t\t} else if (typeof arg === 'undefined') {\n\t\t\t\t\tmassagedArgs[i] = VSBuffer.alloc(0);\n\t\t\t\t\tmassagedArgsType[i] = ArgType.Undefined;\n\t\t\t\t} else {\n\t\t\t\t\tmassagedArgs[i] = VSBuffer.fromString(stringify(arg, replacer));\n\t\t\t\t\tmassagedArgsType[i] = ArgType.String;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\ttype: 'mixed',\n\t\t\t\targs: massagedArgs,\n\t\t\t\targsType: massagedArgsType\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\ttype: 'simple',\n\t\t\targs: stringify(args, replacer)\n\t\t};\n\t}\n\n\tpublic static serializeRequest(req: number, rpcId: number, method: string, serializedArgs: SerializedRequestArguments, usesCancellationToken: boolean): VSBuffer {\n\t\tif (serializedArgs.type === 'mixed') {\n\t\t\treturn this._requestMixedArgs(req, rpcId, method, serializedArgs.args, serializedArgs.argsType, usesCancellationToken);\n\t\t}\n\t\treturn this._requestJSONArgs(req, rpcId, method, serializedArgs.args, usesCancellationToken);\n\t}\n\n\tprivate static _requestJSONArgs(req: number, rpcId: number, method: string, args: string, usesCancellationToken: boolean): VSBuffer {\n\t\tconst methodBuff = VSBuffer.fromString(method);\n\t\tconst argsBuff = VSBuffer.fromString(args);\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeUInt8();\n\t\tlen += MessageBuffer.sizeShortString(methodBuff);\n\t\tlen += MessageBuffer.sizeLongString(argsBuff);\n\n\t\tlet result = MessageBuffer.alloc(usesCancellationToken ? MessageType.RequestJSONArgsWithCancellation : MessageType.RequestJSONArgs, req, len);\n\t\tresult.writeUInt8(rpcId);\n\t\tresult.writeShortString(methodBuff);\n\t\tresult.writeLongString(argsBuff);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeRequestJSONArgs(buff: MessageBuffer): { rpcId: number; method: string; args: any[]; } {\n\t\tconst rpcId = buff.readUInt8();\n\t\tconst method = buff.readShortString();\n\t\tconst args = buff.readLongString();\n\t\treturn {\n\t\t\trpcId: rpcId,\n\t\t\tmethod: method,\n\t\t\targs: JSON.parse(args)\n\t\t};\n\t}\n\n\tprivate static _requestMixedArgs(req: number, rpcId: number, method: string, args: VSBuffer[], argsType: ArgType[], usesCancellationToken: boolean): VSBuffer {\n\t\tconst methodBuff = VSBuffer.fromString(method);\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeUInt8();\n\t\tlen += MessageBuffer.sizeShortString(methodBuff);\n\t\tlen += MessageBuffer.sizeMixedArray(args, argsType);\n\n\t\tlet result = MessageBuffer.alloc(usesCancellationToken ? MessageType.RequestMixedArgsWithCancellation : MessageType.RequestMixedArgs, req, len);\n\t\tresult.writeUInt8(rpcId);\n\t\tresult.writeShortString(methodBuff);\n\t\tresult.writeMixedArray(args, argsType);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeRequestMixedArgs(buff: MessageBuffer): { rpcId: number; method: string; args: any[]; } {\n\t\tconst rpcId = buff.readUInt8();\n\t\tconst method = buff.readShortString();\n\t\tconst rawargs = buff.readMixedArray();\n\t\tconst args: any[] = new Array(rawargs.length);\n\t\tfor (let i = 0, len = rawargs.length; i < len; i++) {\n\t\t\tconst rawarg = rawargs[i];\n\t\t\tif (typeof rawarg === 'string') {\n\t\t\t\targs[i] = JSON.parse(rawarg);\n\t\t\t} else {\n\t\t\t\targs[i] = rawarg;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\trpcId: rpcId,\n\t\t\tmethod: method,\n\t\t\targs: args\n\t\t};\n\t}\n\n\tpublic static serializeAcknowledged(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.Acknowledged, req, 0).buffer;\n\t}\n\n\tpublic static serializeCancel(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.Cancel, req, 0).buffer;\n\t}\n\n\tpublic static serializeReplyOK(req: number, res: any, replacer: JSONStringifyReplacer | null): VSBuffer {\n\t\tif (typeof res === 'undefined') {\n\t\t\treturn this._serializeReplyOKEmpty(req);\n\t\t}\n\t\tif (res instanceof VSBuffer) {\n\t\t\treturn this._serializeReplyOKVSBuffer(req, res);\n\t\t}\n\t\treturn this._serializeReplyOKJSON(req, safeStringify(res, replacer));\n\t}\n\n\tprivate static _serializeReplyOKEmpty(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.ReplyOKEmpty, req, 0).buffer;\n\t}\n\n\tprivate static _serializeReplyOKVSBuffer(req: number, res: VSBuffer): VSBuffer {\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeVSBuffer(res);\n\n\t\tlet result = MessageBuffer.alloc(MessageType.ReplyOKVSBuffer, req, len);\n\t\tresult.writeVSBuffer(res);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeReplyOKVSBuffer(buff: MessageBuffer): VSBuffer {\n\t\treturn buff.readVSBuffer();\n\t}\n\n\tprivate static _serializeReplyOKJSON(req: number, res: string): VSBuffer {\n\t\tconst resBuff = VSBuffer.fromString(res);\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeLongString(resBuff);\n\n\t\tlet result = MessageBuffer.alloc(MessageType.ReplyOKJSON, req, len);\n\t\tresult.writeLongString(resBuff);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeReplyOKJSON(buff: MessageBuffer): any {\n\t\tconst res = buff.readLongString();\n\t\treturn JSON.parse(res);\n\t}\n\n\tpublic static serializeReplyErr(req: number, err: any): VSBuffer {\n\t\tif (err) {\n\t\t\treturn this._serializeReplyErrEror(req, err);\n\t\t}\n\t\treturn this._serializeReplyErrEmpty(req);\n\t}\n\n\tprivate static _serializeReplyErrEror(req: number, _err: Error): VSBuffer {\n\t\tconst errBuff = VSBuffer.fromString(safeStringify(errors.transformErrorForSerialization(_err), null));\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeLongString(errBuff);\n\n\t\tlet result = MessageBuffer.alloc(MessageType.ReplyErrError, req, len);\n\t\tresult.writeLongString(errBuff);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeReplyErrError(buff: MessageBuffer): Error {\n\t\tconst err = buff.readLongString();\n\t\treturn JSON.parse(err);\n\t}\n\n\tprivate static _serializeReplyErrEmpty(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.ReplyErrEmpty, req, 0).buffer;\n\t}\n}\n\nconst enum MessageType {\n\tRequestJSONArgs = 1,\n\tRequestJSONArgsWithCancellation = 2,\n\tRequestMixedArgs = 3,\n\tRequestMixedArgsWithCancellation = 4,\n\tAcknowledged = 5,\n\tCancel = 6,\n\tReplyOKEmpty = 7,\n\tReplyOKVSBuffer = 8,\n\tReplyOKJSON = 9,\n\tReplyErrError = 10,\n\tReplyErrEmpty = 11,\n}\n\nconst enum ArgType {\n\tString = 1,\n\tVSBuffer = 2,\n\tUndefined = 3\n}\n"]}