{"version":3,"file":"decorationsService.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/decorations/test/browser/decorationsService.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { DecorationsService } from 'vs/workbench/services/decorations/browser/decorationsService';\nimport { IDecorationsProvider, IDecorationData } from 'vs/workbench/services/decorations/browser/decorations';\nimport { URI } from 'vs/base/common/uri';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport * as resources from 'vs/base/common/resources';\nimport { TestThemeService } from 'vs/platform/theme/test/common/testThemeService';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { mock } from 'vs/base/test/common/mock';\nimport { IUriIdentityService } from 'vs/workbench/services/uriIdentity/common/uriIdentity';\n\nsuite('DecorationsService', function () {\n\n\tlet service: DecorationsService;\n\n\tsetup(function () {\n\t\tif (service) {\n\t\t\tservice.dispose();\n\t\t}\n\t\tservice = new DecorationsService(\n\t\t\tnew TestThemeService(),\n\t\t\tnew class extends mock<IUriIdentityService>() {\n\t\t\t\toverride extUri = resources.extUri;\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Async provider, async/evented result', function () {\n\n\t\tlet uri = URI.parse('foo:bar');\n\t\tlet callCounter = 0;\n\n\t\tservice.registerDecorationsProvider(new class implements IDecorationsProvider {\n\t\t\treadonly label: string = 'Test';\n\t\t\treadonly onDidChange: Event<readonly URI[]> = Event.None;\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\tcallCounter += 1;\n\t\t\t\treturn new Promise<IDecorationData>(resolve => {\n\t\t\t\t\tsetTimeout(() => resolve({\n\t\t\t\t\t\tcolor: 'someBlue',\n\t\t\t\t\t\ttooltip: 'T'\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// trigger -> async\n\t\tassert.strictEqual(service.getDecoration(uri, false), undefined);\n\t\tassert.strictEqual(callCounter, 1);\n\n\t\t// event when result is computed\n\t\treturn Event.toPromise(service.onDidChangeDecorations).then(e => {\n\t\t\tassert.strictEqual(e.affectsResource(uri), true);\n\n\t\t\t// sync result\n\t\t\tassert.deepStrictEqual(service.getDecoration(uri, false)!.tooltip, 'T');\n\t\t\tassert.strictEqual(callCounter, 1);\n\t\t});\n\t});\n\n\ttest('Sync provider, sync result', function () {\n\n\t\tlet uri = URI.parse('foo:bar');\n\t\tlet callCounter = 0;\n\n\t\tservice.registerDecorationsProvider(new class implements IDecorationsProvider {\n\t\t\treadonly label: string = 'Test';\n\t\t\treadonly onDidChange: Event<readonly URI[]> = Event.None;\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\tcallCounter += 1;\n\t\t\t\treturn { color: 'someBlue', tooltip: 'Z' };\n\t\t\t}\n\t\t});\n\n\t\t// trigger -> sync\n\t\tassert.deepStrictEqual(service.getDecoration(uri, false)!.tooltip, 'Z');\n\t\tassert.strictEqual(callCounter, 1);\n\t});\n\n\ttest('Clear decorations on provider dispose', async function () {\n\t\tlet uri = URI.parse('foo:bar');\n\t\tlet callCounter = 0;\n\n\t\tlet reg = service.registerDecorationsProvider(new class implements IDecorationsProvider {\n\t\t\treadonly label: string = 'Test';\n\t\t\treadonly onDidChange: Event<readonly URI[]> = Event.None;\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\tcallCounter += 1;\n\t\t\t\treturn { color: 'someBlue', tooltip: 'J' };\n\t\t\t}\n\t\t});\n\n\t\t// trigger -> sync\n\t\tassert.deepStrictEqual(service.getDecoration(uri, false)!.tooltip, 'J');\n\t\tassert.strictEqual(callCounter, 1);\n\n\t\t// un-register -> ensure good event\n\t\tlet didSeeEvent = false;\n\t\tlet p = new Promise<void>(resolve => {\n\t\t\tservice.onDidChangeDecorations(e => {\n\t\t\t\tassert.strictEqual(e.affectsResource(uri), true);\n\t\t\t\tassert.deepStrictEqual(service.getDecoration(uri, false), undefined);\n\t\t\t\tassert.strictEqual(callCounter, 1);\n\t\t\t\tdidSeeEvent = true;\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t\treg.dispose(); // will clear all data\n\t\tawait p;\n\t\tassert.strictEqual(didSeeEvent, true);\n\t});\n\n\ttest('No default bubbling', function () {\n\n\t\tlet reg = service.registerDecorationsProvider({\n\t\t\tlabel: 'Test',\n\t\t\tonDidChange: Event.None,\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\treturn uri.path.match(/\\.txt/)\n\t\t\t\t\t? { tooltip: '.txt', weight: 17 }\n\t\t\t\t\t: undefined;\n\t\t\t}\n\t\t});\n\n\t\tlet childUri = URI.parse('file:///some/path/some/file.txt');\n\n\t\tlet deco = service.getDecoration(childUri, false)!;\n\t\tassert.strictEqual(deco.tooltip, '.txt');\n\n\t\tdeco = service.getDecoration(childUri.with({ path: 'some/path/' }), true)!;\n\t\tassert.strictEqual(deco, undefined);\n\t\treg.dispose();\n\n\t\t// bubble\n\t\treg = service.registerDecorationsProvider({\n\t\t\tlabel: 'Test',\n\t\t\tonDidChange: Event.None,\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\treturn uri.path.match(/\\.txt/)\n\t\t\t\t\t? { tooltip: '.txt.bubble', weight: 71, bubble: true }\n\t\t\t\t\t: undefined;\n\t\t\t}\n\t\t});\n\n\t\tdeco = service.getDecoration(childUri, false)!;\n\t\tassert.strictEqual(deco.tooltip, '.txt.bubble');\n\n\t\tdeco = service.getDecoration(childUri.with({ path: 'some/path/' }), true)!;\n\t\tassert.strictEqual(typeof deco.tooltip, 'string');\n\t});\n\n\ttest('Decorations not showing up for second root folder #48502', async function () {\n\n\t\tlet cancelCount = 0;\n\t\tlet winjsCancelCount = 0;\n\t\tlet callCount = 0;\n\n\t\tlet provider = new class implements IDecorationsProvider {\n\n\t\t\t_onDidChange = new Emitter<URI[]>();\n\t\t\tonDidChange: Event<readonly URI[]> = this._onDidChange.event;\n\n\t\t\tlabel: string = 'foo';\n\n\t\t\tprovideDecorations(uri: URI, token: CancellationToken): Promise<IDecorationData> {\n\n\t\t\t\ttoken.onCancellationRequested(() => {\n\t\t\t\t\tcancelCount += 1;\n\t\t\t\t});\n\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tcallCount += 1;\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tresolve({ letter: 'foo' });\n\t\t\t\t\t}, 10);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tlet reg = service.registerDecorationsProvider(provider);\n\n\t\tconst uri = URI.parse('foo://bar');\n\t\tservice.getDecoration(uri, false);\n\n\t\tprovider._onDidChange.fire([uri]);\n\t\tservice.getDecoration(uri, false);\n\n\t\tassert.strictEqual(cancelCount, 1);\n\t\tassert.strictEqual(winjsCancelCount, 0);\n\t\tassert.strictEqual(callCount, 2);\n\n\t\treg.dispose();\n\t});\n\n\ttest('Decorations not bubbling... #48745', function () {\n\n\t\tlet reg = service.registerDecorationsProvider({\n\t\t\tlabel: 'Test',\n\t\t\tonDidChange: Event.None,\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\tif (uri.path.match(/hello$/)) {\n\t\t\t\t\treturn { tooltip: 'FOO', weight: 17, bubble: true };\n\t\t\t\t} else {\n\t\t\t\t\treturn new Promise<IDecorationData>(_resolve => { });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlet data1 = service.getDecoration(URI.parse('a:b/'), true);\n\t\tassert.ok(!data1);\n\n\t\tlet data2 = service.getDecoration(URI.parse('a:b/c.hello'), false)!;\n\t\tassert.ok(data2.tooltip);\n\n\t\tlet data3 = service.getDecoration(URI.parse('a:b/'), true);\n\t\tassert.ok(data3);\n\n\n\t\treg.dispose();\n\t});\n\n\ttest('Folder decorations don\\'t go away when file with problems is deleted #61919 (part1)', function () {\n\n\t\tlet emitter = new Emitter<URI[]>();\n\t\tlet gone = false;\n\t\tlet reg = service.registerDecorationsProvider({\n\t\t\tlabel: 'Test',\n\t\t\tonDidChange: emitter.event,\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\tif (!gone && uri.path.match(/file.ts$/)) {\n\t\t\t\t\treturn { tooltip: 'FOO', weight: 17, bubble: true };\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\tlet uri = URI.parse('foo:/folder/file.ts');\n\t\tlet uri2 = URI.parse('foo:/folder/');\n\t\tlet data = service.getDecoration(uri, true)!;\n\t\tassert.strictEqual(data.tooltip, 'FOO');\n\n\t\tdata = service.getDecoration(uri2, true)!;\n\t\tassert.ok(data.tooltip); // emphazied items...\n\n\t\tgone = true;\n\t\temitter.fire([uri]);\n\n\t\tdata = service.getDecoration(uri, true)!;\n\t\tassert.strictEqual(data, undefined);\n\n\t\tdata = service.getDecoration(uri2, true)!;\n\t\tassert.strictEqual(data, undefined);\n\n\t\treg.dispose();\n\t});\n\n\ttest('Folder decorations don\\'t go away when file with problems is deleted #61919 (part2)', function () {\n\n\t\tlet emitter = new Emitter<URI[]>();\n\t\tlet gone = false;\n\t\tlet reg = service.registerDecorationsProvider({\n\t\t\tlabel: 'Test',\n\t\t\tonDidChange: emitter.event,\n\t\t\tprovideDecorations(uri: URI) {\n\t\t\t\tif (!gone && uri.path.match(/file.ts$/)) {\n\t\t\t\t\treturn { tooltip: 'FOO', weight: 17, bubble: true };\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\tlet uri = URI.parse('foo:/folder/file.ts');\n\t\tlet uri2 = URI.parse('foo:/folder/');\n\t\tlet data = service.getDecoration(uri, true)!;\n\t\tassert.strictEqual(data.tooltip, 'FOO');\n\n\t\tdata = service.getDecoration(uri2, true)!;\n\t\tassert.ok(data.tooltip); // emphazied items...\n\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tlet l = service.onDidChangeDecorations(e => {\n\t\t\t\tl.dispose();\n\t\t\t\ttry {\n\t\t\t\t\tassert.ok(e.affectsResource(uri));\n\t\t\t\t\tassert.ok(e.affectsResource(uri2));\n\t\t\t\t\tresolve();\n\t\t\t\t\treg.dispose();\n\t\t\t\t} catch (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t\treg.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t\tgone = true;\n\t\t\temitter.fire([uri]);\n\t\t});\n\t});\n});\n"]}