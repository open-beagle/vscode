{"version":3,"file":"workingCopyBackupTracker.test.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/workbench/services/workingCopy/test/electron-browser/workingCopyBackupTracker.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { tmpdir } from 'os';\nimport { promises } from 'fs';\nimport { join } from 'vs/base/common/path';\nimport { rimraf, writeFile } from 'vs/base/node/pfs';\nimport { URI } from 'vs/base/common/uri';\nimport { flakySuite, getRandomTestPath } from 'vs/base/test/node/testUtils';\nimport { hash } from 'vs/base/common/hash';\nimport { NativeWorkingCopyBackupTracker } from 'vs/workbench/services/workingCopy/electron-sandbox/workingCopyBackupTracker';\nimport { TextFileEditorModelManager } from 'vs/workbench/services/textfile/common/textFileEditorModelManager';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { EditorPart } from 'vs/workbench/browser/parts/editor/editorPart';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { EditorService } from 'vs/workbench/services/editor/browser/editorService';\nimport { IWorkingCopyBackupService } from 'vs/workbench/services/workingCopy/common/workingCopyBackup';\nimport { NodeTestWorkingCopyBackupService } from 'vs/workbench/services/workingCopy/test/electron-browser/workingCopyBackupService.test';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { toResource } from 'vs/base/test/common/utils';\nimport { IFilesConfigurationService } from 'vs/workbench/services/filesConfiguration/common/filesConfigurationService';\nimport { IWorkingCopyService } from 'vs/workbench/services/workingCopy/common/workingCopyService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { HotExitConfiguration } from 'vs/platform/files/common/files';\nimport { ShutdownReason, ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { IFileDialogService, ConfirmResult, IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { INativeHostService } from 'vs/platform/native/electron-sandbox/native';\nimport { WorkingCopyBackupTracker } from 'vs/workbench/services/workingCopy/common/workingCopyBackupTracker';\nimport { workbenchInstantiationService, TestServiceAccessor } from 'vs/workbench/test/electron-browser/workbenchTestServices';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { TestConfigurationService } from 'vs/platform/configuration/test/common/testConfigurationService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { createEditorPart, registerTestFileEditor, TestBeforeShutdownEvent, TestFilesConfigurationService } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { MockContextKeyService } from 'vs/platform/keybinding/test/common/mockKeybindingService';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { Workspace } from 'vs/platform/workspace/test/common/testWorkspace';\nimport { IProgressService } from 'vs/platform/progress/common/progress';\nimport { IWorkingCopyEditorService } from 'vs/workbench/services/workingCopy/common/workingCopyEditorService';\nimport { TestWorkingCopy } from 'vs/workbench/test/common/workbenchTestServices';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IWorkingCopyBackup } from 'vs/workbench/services/workingCopy/common/workingCopy';\n\nflakySuite('WorkingCopyBackupTracker (native)', function () {\n\n\tclass TestBackupTracker extends NativeWorkingCopyBackupTracker {\n\n\t\tconstructor(\n\t\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t\t@IFileDialogService fileDialogService: IFileDialogService,\n\t\t\t@IDialogService dialogService: IDialogService,\n\t\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t\t@INativeHostService nativeHostService: INativeHostService,\n\t\t\t@ILogService logService: ILogService,\n\t\t\t@IEditorService editorService: IEditorService,\n\t\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t\t@IProgressService progressService: IProgressService,\n\t\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService,\n\t\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService\n\t\t) {\n\t\t\tsuper(workingCopyBackupService, filesConfigurationService, workingCopyService, lifecycleService, fileDialogService, dialogService, contextService, nativeHostService, logService, environmentService, progressService, editorGroupService, workingCopyEditorService, editorService);\n\t\t}\n\n\t\tprotected override getBackupScheduleDelay(): number {\n\t\t\treturn 10; // Reduce timeout for tests\n\t\t}\n\n\t\toverride dispose() {\n\t\t\tsuper.dispose();\n\n\t\t\tfor (const [_, disposable] of this.pendingBackups) {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tlet testDir: string;\n\tlet backupHome: string;\n\tlet workspaceBackupPath: string;\n\n\tlet accessor: TestServiceAccessor;\n\tconst disposables = new DisposableStore();\n\n\tsetup(async () => {\n\t\ttestDir = getRandomTestPath(tmpdir(), 'vsctests', 'backuprestorer');\n\t\tbackupHome = join(testDir, 'Backups');\n\t\tconst workspacesJsonPath = join(backupHome, 'workspaces.json');\n\n\t\tconst workspaceResource = URI.file(isWindows ? 'c:\\\\workspace' : '/workspace');\n\t\tworkspaceBackupPath = join(backupHome, hash(workspaceResource.fsPath).toString(16));\n\n\t\tconst instantiationService = workbenchInstantiationService();\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add((<TextFileEditorModelManager>accessor.textFileService.files));\n\n\t\tdisposables.add(registerTestFileEditor());\n\n\t\tawait promises.mkdir(backupHome, { recursive: true });\n\t\tawait promises.mkdir(workspaceBackupPath, { recursive: true });\n\n\t\treturn writeFile(workspacesJsonPath, '');\n\t});\n\n\tteardown(async () => {\n\t\tdisposables.clear();\n\n\t\treturn rimraf(testDir);\n\t});\n\n\tasync function createTracker(autoSaveEnabled = false): Promise<{ accessor: TestServiceAccessor, part: EditorPart, tracker: WorkingCopyBackupTracker, instantiationService: IInstantiationService, cleanup: () => Promise<void> }> {\n\t\tconst workingCopyBackupService = new NodeTestWorkingCopyBackupService(testDir, workspaceBackupPath);\n\t\tconst instantiationService = workbenchInstantiationService();\n\t\tinstantiationService.stub(IWorkingCopyBackupService, workingCopyBackupService);\n\n\t\tconst configurationService = new TestConfigurationService();\n\t\tif (autoSaveEnabled) {\n\t\t\tconfigurationService.setUserConfiguration('files', { autoSave: 'afterDelay', autoSaveDelay: 1 });\n\t\t}\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\n\t\tinstantiationService.stub(IFilesConfigurationService, new TestFilesConfigurationService(\n\t\t\t<IContextKeyService>instantiationService.createInstance(MockContextKeyService),\n\t\t\tconfigurationService\n\t\t));\n\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService: EditorService = instantiationService.createInstance(EditorService);\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\n\t\tconst tracker = instantiationService.createInstance(TestBackupTracker);\n\n\t\tconst cleanup = async () => {\n\t\t\t// File changes could also schedule some backup operations so we need to wait for them before finishing the test\n\t\t\tawait accessor.workingCopyBackupService.waitForAllBackups();\n\n\t\t\tpart.dispose();\n\t\t\ttracker.dispose();\n\t\t};\n\n\t\treturn { accessor, part, tracker, instantiationService, cleanup };\n\t}\n\n\ttest('Track backups (file, auto save off)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), false);\n\t});\n\n\ttest('Track backups (file, auto save on)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), true);\n\t});\n\n\tasync function trackBackupsTest(resource: URI, autoSave: boolean) {\n\t\tconst { accessor, cleanup } = await createTracker(autoSave);\n\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst fileModel = accessor.textFileService.files.get(resource);\n\t\tassert.ok(fileModel);\n\t\tfileModel.textEditorModel?.setValue('Super Good');\n\n\t\tawait accessor.workingCopyBackupService.joinBackupResource();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), true);\n\n\t\tfileModel.dispose();\n\n\t\tawait accessor.workingCopyBackupService.joinDiscardBackup();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), false);\n\n\t\tawait cleanup();\n\t}\n\n\ttest('onWillShutdown - no veto if no dirty files', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if user cancels (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\t\taccessor.filesConfigurationService.onFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto if auto save is on', async function () {\n\t\tconst { accessor, cleanup } = await createTracker(true /* auto save enabled */);\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto and backups cleaned up if user does not want to save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.DONT_SAVE);\n\t\taccessor.filesConfigurationService.onFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedBackups.length > 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.SAVE);\n\t\taccessor.filesConfigurationService.onFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!model?.isDirty());\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\taccessor.workingCopyService.registerWorkingCopy(this);\n\t\t\t}\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tconst customWorkingCopy = new TestBackupWorkingCopy(resource);\n\t\tcustomWorkingCopy.setDirty(true);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tawait cleanup();\n\t});\n\n\tsuite('Hot Exit', () => {\n\t\tsuite('\"onExit\" setting', () => {\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tasync function hotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.onFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tawait model?.resolve();\n\t\t\tmodel?.textEditorModel?.setValue('foo');\n\t\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\t});\n});\n"]}