{"version":3,"sources":["vs/workbench/services/host/browser/browserHostService.ts"],"names":[],"mappings":"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","file":"browserHostService.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { ILayoutService } from 'vs/platform/layout/browser/layoutService';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IWindowSettings, IWindowOpenable, IOpenWindowOptions, isFolderToOpen, isWorkspaceToOpen, isFileToOpen, IOpenEmptyWindowOptions, IPathData, IFileToOpen } from 'vs/platform/windows/common/windows';\nimport { pathsToEditors } from 'vs/workbench/common/editor';\nimport { whenEditorClosed } from 'vs/workbench/browser/editor';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IModifierKeyStatus, ModifierKeyEmitter, trackFocus } from 'vs/base/browser/dom';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\nimport { domEvent } from 'vs/base/browser/event';\nimport { memoize } from 'vs/base/common/decorators';\nimport { parseLineAndColumnAware } from 'vs/base/common/extpath';\nimport { IWorkspaceFolderCreationData } from 'vs/platform/workspaces/common/workspaces';\nimport { IWorkspaceEditingService } from 'vs/workbench/services/workspaces/common/workspaceEditing';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { BeforeShutdownEvent, ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { getWorkspaceIdentifier } from 'vs/workbench/services/workspaces/browser/workspaces';\nimport { localize } from 'vs/nls';\nimport Severity from 'vs/base/common/severity';\nimport { IDialogService } from 'vs/platform/dialogs/common/dialogs';\n\n/**\n * A workspace to open in the workbench can either be:\n * - a workspace file with 0-N folders (via `workspaceUri`)\n * - a single folder (via `folderUri`)\n * - empty (via `undefined`)\n */\nexport type IWorkspace = { workspaceUri: URI } | { folderUri: URI } | undefined;\n\nexport interface IWorkspaceProvider {\n\n\t/**\n\t * The initial workspace to open.\n\t */\n\treadonly workspace: IWorkspace;\n\n\t/**\n\t * Arbitrary payload from the `IWorkspaceProvider.open` call.\n\t */\n\treadonly payload?: object;\n\n\t/**\n\t * Return `true` if the provided [workspace](#IWorkspaceProvider.workspace) is trusted, `false` if not trusted, `undefined` if unknown.\n\t */\n\treadonly trusted: boolean | undefined;\n\n\t/**\n\t * Asks to open a workspace in the current or a new window.\n\t *\n\t * @param workspace the workspace to open.\n\t * @param options optional options for the workspace to open.\n\t * - `reuse`: whether to open inside the current window or a new window\n\t * - `payload`: arbitrary payload that should be made available\n\t * to the opening window via the `IWorkspaceProvider.payload` property.\n\t * @param payload optional payload to send to the workspace to open.\n\t *\n\t * @returns true if successfully opened, false otherwise.\n\t */\n\topen(workspace: IWorkspace, options?: { reuse?: boolean, payload?: object }): Promise<boolean>;\n}\n\nenum HostShutdownReason {\n\n\t/**\n\t * An unknown shutdown reason.\n\t */\n\tUnknown = 1,\n\n\t/**\n\t * A shutdown that was potentially triggered by keyboard use.\n\t */\n\tKeyboard = 2,\n\n\t/**\n\t * An explicit shutdown via code.\n\t */\n\tApi = 3\n}\n\nexport class BrowserHostService extends Disposable implements IHostService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate workspaceProvider: IWorkspaceProvider;\n\n\tprivate shutdownReason = HostShutdownReason.Unknown;\n\n\tconstructor(\n\t\t@ILayoutService private readonly layoutService: ILayoutService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IDialogService private readonly dialogService: IDialogService\n\t) {\n\t\tsuper();\n\n\t\tif (environmentService.options && environmentService.options.workspaceProvider) {\n\t\t\tthis.workspaceProvider = environmentService.options.workspaceProvider;\n\t\t} else {\n\t\t\tthis.workspaceProvider = new class implements IWorkspaceProvider {\n\t\t\t\treadonly workspace = undefined;\n\t\t\t\treadonly trusted = undefined;\n\t\t\t\tasync open() { return true; }\n\t\t\t};\n\t\t}\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Veto shutdown depending on `window.confirmBeforeClose` setting\n\t\tthis._register(this.lifecycleService.onBeforeShutdown(e => this.onBeforeShutdown(e)));\n\n\t\t// Track modifier keys to detect keybinding usage\n\t\tthis._register(ModifierKeyEmitter.getInstance().event(e => this.updateShutdownReasonFromEvent(e)));\n\t}\n\n\tprivate onBeforeShutdown(e: BeforeShutdownEvent): void {\n\t\tswitch (this.shutdownReason) {\n\n\t\t\t// Unknown / Keyboard shows veto depending on setting\n\t\t\tcase HostShutdownReason.Unknown:\n\t\t\tcase HostShutdownReason.Keyboard:\n\t\t\t\tconst confirmBeforeClose = this.configurationService.getValue<'always' | 'keyboardOnly' | 'never'>('window.confirmBeforeClose');\n\t\t\t\tif (confirmBeforeClose === 'always' || (confirmBeforeClose === 'keyboardOnly' && this.shutdownReason === HostShutdownReason.Keyboard)) {\n\t\t\t\t\te.veto(true, 'veto.confirmBeforeClose');\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\t// Api never shows veto\n\t\t\tcase HostShutdownReason.Api:\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Unset for next shutdown\n\t\tthis.shutdownReason = HostShutdownReason.Unknown;\n\t}\n\n\tprivate updateShutdownReasonFromEvent(e: IModifierKeyStatus): void {\n\t\tif (this.shutdownReason === HostShutdownReason.Api) {\n\t\t\treturn; // do not overwrite any explicitly set shutdown reason\n\t\t}\n\n\t\tif (ModifierKeyEmitter.getInstance().isModifierPressed) {\n\t\t\tthis.shutdownReason = HostShutdownReason.Keyboard;\n\t\t} else {\n\t\t\tthis.shutdownReason = HostShutdownReason.Unknown;\n\t\t}\n\t}\n\n\t//#region Focus\n\n\t@memoize\n\tget onDidChangeFocus(): Event<boolean> {\n\t\tconst focusTracker = this._register(trackFocus(window));\n\n\t\treturn Event.latch(Event.any(\n\t\t\tEvent.map(focusTracker.onDidFocus, () => this.hasFocus),\n\t\t\tEvent.map(focusTracker.onDidBlur, () => this.hasFocus),\n\t\t\tEvent.map(domEvent(window.document, 'visibilitychange'), () => this.hasFocus)\n\t\t));\n\t}\n\n\tget hasFocus(): boolean {\n\t\treturn document.hasFocus();\n\t}\n\n\tasync hadLastFocus(): Promise<boolean> {\n\t\treturn true;\n\t}\n\n\tasync focus(): Promise<void> {\n\t\twindow.focus();\n\t}\n\n\t//#endregion\n\n\n\t//#region Window\n\n\topenWindow(options?: IOpenEmptyWindowOptions): Promise<void>;\n\topenWindow(toOpen: IWindowOpenable[], options?: IOpenWindowOptions): Promise<void>;\n\topenWindow(arg1?: IOpenEmptyWindowOptions | IWindowOpenable[], arg2?: IOpenWindowOptions): Promise<void> {\n\t\tif (Array.isArray(arg1)) {\n\t\t\treturn this.doOpenWindow(arg1, arg2);\n\t\t}\n\n\t\treturn this.doOpenEmptyWindow(arg1);\n\t}\n\n\tprivate async doOpenWindow(toOpen: IWindowOpenable[], options?: IOpenWindowOptions): Promise<void> {\n\t\tconst payload = this.preservePayload();\n\t\tconst fileOpenables: IFileToOpen[] = [];\n\t\tconst foldersToAdd: IWorkspaceFolderCreationData[] = [];\n\n\t\tfor (const openable of toOpen) {\n\t\t\topenable.label = openable.label || this.getRecentLabel(openable);\n\n\t\t\t// Folder\n\t\t\tif (isFolderToOpen(openable)) {\n\t\t\t\tif (options?.addMode) {\n\t\t\t\t\tfoldersToAdd.push(({ uri: openable.folderUri }));\n\t\t\t\t} else {\n\t\t\t\t\tthis.doOpen({ folderUri: openable.folderUri }, { reuse: this.shouldReuse(options, false /* no file */), payload });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Workspace\n\t\t\telse if (isWorkspaceToOpen(openable)) {\n\t\t\t\tthis.doOpen({ workspaceUri: openable.workspaceUri }, { reuse: this.shouldReuse(options, false /* no file */), payload });\n\t\t\t}\n\n\t\t\t// File (handled later in bulk)\n\t\t\telse if (isFileToOpen(openable)) {\n\t\t\t\tfileOpenables.push(openable);\n\t\t\t}\n\t\t}\n\n\t\t// Handle Folders to Add\n\t\tif (foldersToAdd.length > 0) {\n\t\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\t\tconst workspaceEditingService: IWorkspaceEditingService = accessor.get(IWorkspaceEditingService);  // avoid heavy dependencies (https://github.com/microsoft/vscode/issues/108522)\n\t\t\t\tworkspaceEditingService.addFolders(foldersToAdd);\n\t\t\t});\n\t\t}\n\n\t\t// Handle Files\n\t\tif (fileOpenables.length > 0) {\n\t\t\tthis.instantiationService.invokeFunction(async accessor => {\n\t\t\t\tconst editorService = accessor.get(IEditorService); // avoid heavy dependencies (https://github.com/microsoft/vscode/issues/108522)\n\n\t\t\t\t// Support diffMode\n\t\t\t\tif (options?.diffMode && fileOpenables.length === 2) {\n\t\t\t\t\tconst editors = await pathsToEditors(fileOpenables, this.fileService);\n\t\t\t\t\tif (editors.length !== 2 || !editors[0].resource || !editors[1].resource) {\n\t\t\t\t\t\treturn; // invalid resources\n\t\t\t\t\t}\n\n\t\t\t\t\t// Same Window: open via editor service in current window\n\t\t\t\t\tif (this.shouldReuse(options, true /* file */)) {\n\t\t\t\t\t\teditorService.openEditor({\n\t\t\t\t\t\t\tleftResource: editors[0].resource,\n\t\t\t\t\t\t\trightResource: editors[1].resource,\n\t\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// New Window: open into empty window\n\t\t\t\t\telse {\n\t\t\t\t\t\tconst environment = new Map<string, string>();\n\t\t\t\t\t\tenvironment.set('diffFileSecondary', editors[0].resource.toString());\n\t\t\t\t\t\tenvironment.set('diffFilePrimary', editors[1].resource.toString());\n\n\t\t\t\t\t\tthis.doOpen(undefined, { payload: Array.from(environment.entries()) });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Just open normally\n\t\t\t\telse {\n\t\t\t\t\tfor (const openable of fileOpenables) {\n\n\t\t\t\t\t\t// Same Window: open via editor service in current window\n\t\t\t\t\t\tif (this.shouldReuse(options, true /* file */)) {\n\t\t\t\t\t\t\tlet openables: IPathData[] = [];\n\n\t\t\t\t\t\t\t// Support: --goto parameter to open on line/col\n\t\t\t\t\t\t\tif (options?.gotoLineMode) {\n\t\t\t\t\t\t\t\tconst pathColumnAware = parseLineAndColumnAware(openable.fileUri.path);\n\t\t\t\t\t\t\t\topenables = [{\n\t\t\t\t\t\t\t\t\tfileUri: openable.fileUri.with({ path: pathColumnAware.path }),\n\t\t\t\t\t\t\t\t\tlineNumber: pathColumnAware.line,\n\t\t\t\t\t\t\t\t\tcolumnNumber: pathColumnAware.column\n\t\t\t\t\t\t\t\t}];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topenables = [openable];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teditorService.openEditors(await pathsToEditors(openables, this.fileService));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// New Window: open into empty window\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tconst environment = new Map<string, string>();\n\t\t\t\t\t\t\tenvironment.set('openFile', openable.fileUri.toString());\n\n\t\t\t\t\t\t\tif (options?.gotoLineMode) {\n\t\t\t\t\t\t\t\tenvironment.set('gotoLineMode', 'true');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.doOpen(undefined, { payload: Array.from(environment.entries()) });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Support wait mode\n\t\t\t\tconst waitMarkerFileURI = options?.waitMarkerFileURI;\n\t\t\t\tif (waitMarkerFileURI) {\n\t\t\t\t\t(async () => {\n\n\t\t\t\t\t\t// Wait for the resources to be closed in the text editor...\n\t\t\t\t\t\tawait this.instantiationService.invokeFunction(accessor => whenEditorClosed(accessor, fileOpenables.map(fileOpenable => fileOpenable.fileUri)));\n\n\t\t\t\t\t\t// ...before deleting the wait marker file\n\t\t\t\t\t\tawait this.fileService.del(waitMarkerFileURI);\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate preservePayload(): Array<unknown> | undefined {\n\n\t\t// Selectively copy payload: for now only extension debugging properties are considered\n\t\tlet newPayload: Array<unknown> | undefined = undefined;\n\t\tif (this.environmentService.extensionDevelopmentLocationURI) {\n\t\t\tnewPayload = new Array();\n\n\t\t\tnewPayload.push(['extensionDevelopmentPath', this.environmentService.extensionDevelopmentLocationURI.toString()]);\n\n\t\t\tif (this.environmentService.debugExtensionHost.debugId) {\n\t\t\t\tnewPayload.push(['debugId', this.environmentService.debugExtensionHost.debugId]);\n\t\t\t}\n\n\t\t\tif (this.environmentService.debugExtensionHost.port) {\n\t\t\t\tnewPayload.push(['inspect-brk-extensions', String(this.environmentService.debugExtensionHost.port)]);\n\t\t\t}\n\t\t}\n\n\t\treturn newPayload;\n\t}\n\n\tprivate getRecentLabel(openable: IWindowOpenable): string {\n\t\tif (isFolderToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel(openable.folderUri, { verbose: true });\n\t\t}\n\n\t\tif (isWorkspaceToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel(getWorkspaceIdentifier(openable.workspaceUri), { verbose: true });\n\t\t}\n\n\t\treturn this.labelService.getUriLabel(openable.fileUri);\n\t}\n\n\tprivate shouldReuse(options: IOpenWindowOptions = Object.create(null), isFile: boolean): boolean {\n\t\tif (options.waitMarkerFileURI) {\n\t\t\treturn true; // always handle --wait in same window\n\t\t}\n\n\t\tconst windowConfig = this.configurationService.getValue<IWindowSettings | undefined>('window');\n\t\tconst openInNewWindowConfig = isFile ? (windowConfig?.openFilesInNewWindow || 'off' /* default */) : (windowConfig?.openFoldersInNewWindow || 'default' /* default */);\n\n\t\tlet openInNewWindow = (options.preferNewWindow || !!options.forceNewWindow) && !options.forceReuseWindow;\n\t\tif (!options.forceNewWindow && !options.forceReuseWindow && (openInNewWindowConfig === 'on' || openInNewWindowConfig === 'off')) {\n\t\t\topenInNewWindow = (openInNewWindowConfig === 'on');\n\t\t}\n\n\t\treturn !openInNewWindow;\n\t}\n\n\tprivate async doOpenEmptyWindow(options?: IOpenEmptyWindowOptions): Promise<void> {\n\t\treturn this.doOpen(undefined, { reuse: options?.forceReuseWindow });\n\t}\n\n\tprivate async doOpen(workspace: IWorkspace, options?: { reuse?: boolean, payload?: object }): Promise<void> {\n\n\t\t// We know that `workspaceProvider.open` will trigger a shutdown\n\t\t// with `options.reuse` so we update `shutdownReason` to reflect that\n\t\tif (options?.reuse) {\n\t\t\tthis.shutdownReason = HostShutdownReason.Api;\n\t\t}\n\n\t\tconst opened = await this.workspaceProvider.open(workspace, options);\n\t\tif (!opened) {\n\t\t\tconst showResult = await this.dialogService.show(Severity.Warning, localize('unableToOpenExternal', \"The browser interrupted the opening of a new tab or window. Press 'Open' to open it anyway.\"), [localize('open', \"Open\"), localize('cancel', \"Cancel\")], { cancelId: 2 });\n\t\t\tif (showResult.choice === 0) {\n\t\t\t\tawait this.workspaceProvider.open(workspace, options);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync toggleFullScreen(): Promise<void> {\n\t\tconst target = this.layoutService.container;\n\n\t\t// Chromium\n\t\tif (document.fullscreen !== undefined) {\n\t\t\tif (!document.fullscreen) {\n\t\t\t\ttry {\n\t\t\t\t\treturn await target.requestFullscreen();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.warn('toggleFullScreen(): requestFullscreen failed'); // https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullscreen\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\treturn await document.exitFullscreen();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.warn('toggleFullScreen(): exitFullscreen failed');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Safari and Edge 14 are all using webkit prefix\n\t\tif ((<any>document).webkitIsFullScreen !== undefined) {\n\t\t\ttry {\n\t\t\t\tif (!(<any>document).webkitIsFullScreen) {\n\t\t\t\t\t(<any>target).webkitRequestFullscreen(); // it's async, but doesn't return a real promise.\n\t\t\t\t} else {\n\t\t\t\t\t(<any>document).webkitExitFullscreen(); // it's async, but doesn't return a real promise.\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\tthis.logService.warn('toggleFullScreen(): requestFullscreen/exitFullscreen failed');\n\t\t\t}\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region Lifecycle\n\n\tasync restart(): Promise<void> {\n\t\tthis.reload();\n\t}\n\n\tasync reload(): Promise<void> {\n\t\tthis.withExpectedShutdown(() => {\n\t\t\twindow.location.reload();\n\t\t});\n\t}\n\n\tasync close(): Promise<void> {\n\t\tthis.withExpectedShutdown(() => {\n\t\t\twindow.close();\n\t\t});\n\t}\n\n\tprivate withExpectedShutdown(callback: () => void): void {\n\n\t\t// Update shutdown reason in a way that we do not show a dialog\n\t\tthis.shutdownReason = HostShutdownReason.Api;\n\n\t\tcallback();\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(IHostService, BrowserHostService, true);\n"]}