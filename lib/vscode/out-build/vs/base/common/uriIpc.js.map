{"version":3,"file":"uriIpc.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/base/common/uriIpc.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { MarshalledObject } from 'vs/base/common/marshalling';\nimport { Schemas } from './network';\n\nexport interface IURITransformer {\n\ttransformIncoming(uri: UriComponents): UriComponents;\n\ttransformOutgoing(uri: UriComponents): UriComponents;\n\ttransformOutgoingURI(uri: URI): URI;\n\ttransformOutgoingScheme(scheme: string): string;\n}\n\nexport interface UriParts {\n\tscheme: string;\n\tauthority?: string;\n\tpath?: string;\n}\n\nexport interface IRawURITransformer {\n\ttransformIncoming(uri: UriParts): UriParts;\n\ttransformOutgoing(uri: UriParts): UriParts;\n\ttransformOutgoingScheme(scheme: string): string;\n}\n\nfunction toJSON(uri: URI): UriComponents {\n\treturn <UriComponents><any>uri.toJSON();\n}\n\nexport class URITransformer implements IURITransformer {\n\n\tconstructor(private readonly remoteAuthority: string) {\n\t}\n\n\t// NOTE@coder: Coming in from the browser it'll be vscode-remote so it needs\n\t// to be transformed into file.\n\tpublic transformIncoming(uri: UriComponents): UriComponents {\n\t\treturn uri.scheme === Schemas.vscodeRemote\n\t\t\t? toJSON(URI.file(uri.path))\n\t\t\t: uri;\n\t}\n\n\t// NOTE@coder: Going out to the browser it'll be file so it needs to be\n\t// transformed into vscode-remote.\n\tpublic transformOutgoing(uri: UriComponents): UriComponents {\n\t\treturn uri.scheme === Schemas.file\n\t\t\t? toJSON(URI.from({ authority: this.remoteAuthority, scheme: Schemas.vscodeRemote, path: uri.path }))\n\t\t\t: uri;\n\t}\n\n\tpublic transformOutgoingURI(uri: URI): URI {\n\t\treturn uri.scheme === Schemas.file\n\t\t\t? URI.from({ authority: this.remoteAuthority, scheme: Schemas.vscodeRemote, path:uri.path })\n\t\t\t: uri;\n\t}\n\n\tpublic transformOutgoingScheme(scheme: string): string {\n\t\treturn scheme === Schemas.file\n\t\t\t? Schemas.vscodeRemote\n\t\t\t: scheme;\n\t}\n}\n\nexport const DefaultURITransformer: IURITransformer = new class {\n\ttransformIncoming(uri: UriComponents) {\n\t\treturn uri;\n\t}\n\n\ttransformOutgoing(uri: UriComponents): UriComponents {\n\t\treturn uri;\n\t}\n\n\ttransformOutgoingURI(uri: URI): URI {\n\t\treturn uri;\n\t}\n\n\ttransformOutgoingScheme(scheme: string): string {\n\t\treturn scheme;\n\t}\n};\n\nfunction _transformOutgoingURIs(obj: any, transformer: IURITransformer, depth: number): any {\n\n\tif (!obj || depth > 200) {\n\t\treturn null;\n\t}\n\n\tif (typeof obj === 'object') {\n\t\tif (obj instanceof URI) {\n\t\t\treturn transformer.transformOutgoing(obj);\n\t\t}\n\n\t\t// walk object (or array)\n\t\tfor (let key in obj) {\n\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\tconst r = _transformOutgoingURIs(obj[key], transformer, depth + 1);\n\t\t\t\tif (r !== null) {\n\t\t\t\t\tobj[key] = r;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport function transformOutgoingURIs<T>(obj: T, transformer: IURITransformer): T {\n\tconst result = _transformOutgoingURIs(obj, transformer, 0);\n\tif (result === null) {\n\t\t// no change\n\t\treturn obj;\n\t}\n\treturn result;\n}\n\n\nfunction _transformIncomingURIs(obj: any, transformer: IURITransformer, revive: boolean, depth: number): any {\n\n\tif (!obj || depth > 200) {\n\t\treturn null;\n\t}\n\n\tif (typeof obj === 'object') {\n\n\t\tif ((<MarshalledObject>obj).$mid === 1) {\n\t\t\treturn revive ? URI.revive(transformer.transformIncoming(obj)) : transformer.transformIncoming(obj);\n\t\t}\n\n\t\t// walk object (or array)\n\t\tfor (let key in obj) {\n\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\tconst r = _transformIncomingURIs(obj[key], transformer, revive, depth + 1);\n\t\t\t\tif (r !== null) {\n\t\t\t\t\tobj[key] = r;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport function transformIncomingURIs<T>(obj: T, transformer: IURITransformer): T {\n\tconst result = _transformIncomingURIs(obj, transformer, false, 0);\n\tif (result === null) {\n\t\t// no change\n\t\treturn obj;\n\t}\n\treturn result;\n}\n\nexport function transformAndReviveIncomingURIs<T>(obj: T, transformer: IURITransformer): T {\n\tconst result = _transformIncomingURIs(obj, transformer, true, 0);\n\tif (result === null) {\n\t\t// no change\n\t\treturn obj;\n\t}\n\treturn result;\n}\n"]}