{"version":3,"file":"commonProperties.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/platform/telemetry/common/commonProperties.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IAQhG,SAAS,iBAAiB,CAAC,QAAgB;QAC1C,IAAI,mBAAQ,kBAAmB,IAAI,iBAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YACpE,OAAO,YAAY,CAAC;SACpB;QAED,OAAO,SAAS,CAAC;IAClB,CAAC;IAEM,KAAK,UAAU,uBAAuB,CAC5C,WAAyB,EACzB,OAAe,EACf,QAAgB,EAChB,IAAY,EACZ,MAA0B,EAC1B,OAA2B,EAC3B,SAA6B,EAC7B,mBAAyC,EACzC,iBAAyB,EACzB,OAAgB;QAEhB,MAAM,MAAM,GAAsD,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAEtF,2JAA2J;QAC3J,MAAM,CAAC,kBAAkB,CAAC,GAAG,SAAS,CAAC;QACvC,qGAAqG;QACrG,MAAM,CAAC,WAAW,CAAC,GAAG,CAAA,GAAA,mBAAY,CAAA,EAAE,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAClD,4GAA4G;QAC5G,MAAM,CAAC,YAAY,CAAC,GAAG,MAAM,CAAC;QAC9B,mGAAmG;QACnG,MAAM,CAAC,SAAS,CAAC,GAAG,OAAO,CAAC;QAC5B,kHAAkH;QAClH,MAAM,CAAC,wBAAwB,CAAC,GAAG,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,4BAA4B,EAAE,QAAQ,CAAC,CAAC;QACnG,2GAA2G;QAC3G,MAAM,CAAC,iBAAiB,CAAC,GAAG,CAAA,GAAA,2BAAgB,CAAA,CAAC,mBAAQ,CAAC,CAAC;QACvD,qHAAqH;QACrH,MAAM,CAAC,qBAAqB,CAAC,GAAG,kBAAY,CAAC;QAC7C,iHAAiH;QACjH,MAAM,CAAC,iBAAiB,CAAC,GAAG,IAAI,CAAC;QACjC,gHAAgH;QAChH,MAAM,CAAC,gBAAgB,CAAC,GAAG,OAAO,IAAI,SAAS,CAAC;QAEhD,MAAM,YAAY,GAAG,6BAA6B,CAAC,mBAAmB,IAAI,EAAE,CAAC,CAAC;QAC9E,IAAI,YAAY,EAAE;YACjB,sIAAsI;YACtI,MAAM,CAAC,qBAAqB,CAAC,GAAG,YAAY,CAAC;SAC7C;QAED,sDAAsD;QACtD,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC7B,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE;YAC/B,qGAAqG;YACrG,WAAW,EAAE;gBACZ,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,IAAI,EAAE;gBACrB,UAAU,EAAE,IAAI;aAChB;YACD,+IAA+I;YAC/I,8BAA8B,EAAE;gBAC/B,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS;gBACjC,UAAU,EAAE,IAAI;aAChB;YACD,kIAAkI;YAClI,iBAAiB,EAAE;gBAClB,GAAG,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE;gBAChB,UAAU,EAAE,IAAI;aAChB;SACD,CAAC,CAAC;QAEH,IAAI,sBAAW,EAAE;YAChB,uGAAuG;YACvG,MAAM,CAAC,aAAa,CAAC,GAAG,MAAM,CAAC;SAC/B;QAED,MAAM,cAAc,GAAG,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QAEnD,IAAI,cAAc,EAAE;YACnB,iHAAiH;YACjH,MAAM,CAAC,uBAAuB,CAAC,GAAG,cAAc,CAAC;SACjD;QAED,IAAI;YACH,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,QAAQ,CAAC,SAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAEzE,yGAAyG;YACzG,MAAM,CAAC,eAAe,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;SACjE;QAAC,OAAO,KAAK,EAAE;YACf,eAAe;SACf;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IAlFD,0DAkFC;IAED,SAAS,6BAA6B,CAAC,UAA6B;QACnE,MAAM,aAAa,GAAG,aAAG,CAAC,eAAe,CAAC,CAAC;QAC3C,IAAI,CAAC,aAAa,EAAE;YACnB,OAAO,KAAK,CAAC;SACb;QAED,MAAM,MAAM,GAAG,aAAa,CAAC,WAAW,EAAE,CAAC;QAC3C,OAAO,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,KAAK,UAAU,CAAC,CAAC;IAC7D,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { isLinuxSnap, PlatformToString, platform, Platform } from 'vs/base/common/platform';\nimport { platform as nodePlatform, env } from 'vs/base/common/process';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { URI } from 'vs/base/common/uri';\n\nfunction getPlatformDetail(hostname: string): string | undefined {\n\tif (platform === Platform.Linux && /^penguin(\\.|$)/i.test(hostname)) {\n\t\treturn 'chromebook';\n\t}\n\n\treturn undefined;\n}\n\nexport async function resolveCommonProperties(\n\tfileService: IFileService,\n\trelease: string,\n\thostname: string,\n\tarch: string,\n\tcommit: string | undefined,\n\tversion: string | undefined,\n\tmachineId: string | undefined,\n\tmsftInternalDomains: string[] | undefined,\n\tinstallSourcePath: string,\n\tproduct?: string\n): Promise<{ [name: string]: string | boolean | undefined; }> {\n\tconst result: { [name: string]: string | boolean | undefined; } = Object.create(null);\n\n\t// __GDPR__COMMON__ \"common.machineId\" : { \"endPoint\": \"MacAddressHash\", \"classification\": \"EndUserPseudonymizedInformation\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.machineId'] = machineId;\n\t// __GDPR__COMMON__ \"sessionID\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['sessionID'] = generateUuid() + Date.now();\n\t// __GDPR__COMMON__ \"commitHash\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['commitHash'] = commit;\n\t// __GDPR__COMMON__ \"version\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['version'] = version;\n\t// __GDPR__COMMON__ \"common.platformVersion\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.platformVersion'] = (release || '').replace(/^(\\d+)(\\.\\d+)?(\\.\\d+)?(.*)/, '$1$2$3');\n\t// __GDPR__COMMON__ \"common.platform\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.platform'] = PlatformToString(platform);\n\t// __GDPR__COMMON__ \"common.nodePlatform\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.nodePlatform'] = nodePlatform;\n\t// __GDPR__COMMON__ \"common.nodeArch\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.nodeArch'] = arch;\n\t// __GDPR__COMMON__ \"common.product\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.product'] = product || 'desktop';\n\n\tconst msftInternal = verifyMicrosoftInternalDomain(msftInternalDomains || []);\n\tif (msftInternal) {\n\t\t// __GDPR__COMMON__ \"common.msftInternal\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\tresult['common.msftInternal'] = msftInternal;\n\t}\n\n\t// dynamic properties which value differs on each call\n\tlet seq = 0;\n\tconst startTime = Date.now();\n\tObject.defineProperties(result, {\n\t\t// __GDPR__COMMON__ \"timestamp\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t'timestamp': {\n\t\t\tget: () => new Date(),\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.timesincesessionstart\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.timesincesessionstart': {\n\t\t\tget: () => Date.now() - startTime,\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.sequence\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.sequence': {\n\t\t\tget: () => seq++,\n\t\t\tenumerable: true\n\t\t}\n\t});\n\n\tif (isLinuxSnap) {\n\t\t// __GDPR__COMMON__ \"common.snap\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\tresult['common.snap'] = 'true';\n\t}\n\n\tconst platformDetail = getPlatformDetail(hostname);\n\n\tif (platformDetail) {\n\t\t// __GDPR__COMMON__ \"common.platformDetail\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\tresult['common.platformDetail'] = platformDetail;\n\t}\n\n\ttry {\n\t\tconst contents = await fileService.readFile(URI.file(installSourcePath));\n\n\t\t// __GDPR__COMMON__ \"common.source\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\tresult['common.source'] = contents.value.toString().slice(0, 30);\n\t} catch (error) {\n\t\t// ignore error\n\t}\n\n\treturn result;\n}\n\nfunction verifyMicrosoftInternalDomain(domainList: readonly string[]): boolean {\n\tconst userDnsDomain = env['USERDNSDOMAIN'];\n\tif (!userDnsDomain) {\n\t\treturn false;\n\t}\n\n\tconst domain = userDnsDomain.toLowerCase();\n\treturn domainList.some(msftDomain => domain === msftDomain);\n}\n"]}