{"version":3,"sources":["vs/platform/userDataSync/common/userDataSync.ts"],"names":[],"mappings":"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","file":"userDataSync.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Event } from 'vs/base/common/event';\nimport { IExtensionIdentifier, EXTENSION_IDENTIFIER_PATTERN } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IConfigurationRegistry, Extensions as ConfigurationExtensions, ConfigurationScope, allSettings } from 'vs/platform/configuration/common/configurationRegistry';\nimport { localize } from 'vs/nls';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { IJSONContributionRegistry, Extensions as JSONExtensions } from 'vs/platform/jsonschemas/common/jsonContributionRegistry';\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IStringDictionary } from 'vs/base/common/collections';\nimport { FormattingOptions } from 'vs/base/common/jsonFormatter';\nimport { URI } from 'vs/base/common/uri';\nimport { joinPath, isEqualOrParent } from 'vs/base/common/resources';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { distinct } from 'vs/base/common/arrays';\nimport { isArray, isString, isObject } from 'vs/base/common/types';\nimport { IHeaders } from 'vs/base/parts/request/common/request';\n\nexport const CONFIGURATION_SYNC_STORE_KEY = 'configurationSync.store';\n\nexport function getDisallowedIgnoredSettings(): string[] {\n\tconst allSettings = Registry.as<IConfigurationRegistry>(ConfigurationExtensions.Configuration).getConfigurationProperties();\n\treturn Object.keys(allSettings).filter(setting => !!allSettings[setting].disallowSyncIgnore);\n}\n\nexport function getDefaultIgnoredSettings(): string[] {\n\tconst allSettings = Registry.as<IConfigurationRegistry>(ConfigurationExtensions.Configuration).getConfigurationProperties();\n\tconst ignoreSyncSettings = Object.keys(allSettings).filter(setting => !!allSettings[setting].ignoreSync);\n\tconst machineSettings = Object.keys(allSettings).filter(setting => allSettings[setting].scope === ConfigurationScope.MACHINE || allSettings[setting].scope === ConfigurationScope.MACHINE_OVERRIDABLE);\n\tconst disallowedSettings = getDisallowedIgnoredSettings();\n\treturn distinct([CONFIGURATION_SYNC_STORE_KEY, ...ignoreSyncSettings, ...machineSettings, ...disallowedSettings]);\n}\n\nexport function registerConfiguration(): IDisposable {\n\tconst ignoredSettingsSchemaId = 'vscode://schemas/ignoredSettings';\n\tconst configurationRegistry = Registry.as<IConfigurationRegistry>(ConfigurationExtensions.Configuration);\n\tconfigurationRegistry.registerConfiguration({\n\t\tid: 'settingsSync',\n\t\torder: 30,\n\t\ttitle: localize('settings sync', \"Settings Sync\"),\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\t'settingsSync.keybindingsPerPlatform': {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdescription: localize('settingsSync.keybindingsPerPlatform', \"Synchronize keybindings for each platform.\"),\n\t\t\t\tdefault: true,\n\t\t\t\tscope: ConfigurationScope.APPLICATION,\n\t\t\t\ttags: ['sync', 'usesOnlineServices']\n\t\t\t},\n\t\t\t'settingsSync.ignoredExtensions': {\n\t\t\t\t'type': 'array',\n\t\t\t\tmarkdownDescription: localize('settingsSync.ignoredExtensions', \"List of extensions to be ignored while synchronizing. The identifier of an extension is always `${publisher}.${name}`. For example: `vscode.csharp`.\"),\n\t\t\t\titems: [{\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tpattern: EXTENSION_IDENTIFIER_PATTERN,\n\t\t\t\t\terrorMessage: localize('app.extension.identifier.errorMessage', \"Expected format '${publisher}.${name}'. Example: 'vscode.csharp'.\")\n\t\t\t\t}],\n\t\t\t\t'default': [],\n\t\t\t\t'scope': ConfigurationScope.APPLICATION,\n\t\t\t\tuniqueItems: true,\n\t\t\t\tdisallowSyncIgnore: true,\n\t\t\t\ttags: ['sync', 'usesOnlineServices']\n\t\t\t},\n\t\t\t'settingsSync.ignoredSettings': {\n\t\t\t\t'type': 'array',\n\t\t\t\tdescription: localize('settingsSync.ignoredSettings', \"Configure settings to be ignored while synchronizing.\"),\n\t\t\t\t'default': [],\n\t\t\t\t'scope': ConfigurationScope.APPLICATION,\n\t\t\t\t$ref: ignoredSettingsSchemaId,\n\t\t\t\tadditionalProperties: true,\n\t\t\t\tuniqueItems: true,\n\t\t\t\tdisallowSyncIgnore: true,\n\t\t\t\ttags: ['sync', 'usesOnlineServices']\n\t\t\t}\n\t\t}\n\t});\n\tconst jsonRegistry = Registry.as<IJSONContributionRegistry>(JSONExtensions.JSONContribution);\n\tconst registerIgnoredSettingsSchema = () => {\n\t\tconst disallowedIgnoredSettings = getDisallowedIgnoredSettings();\n\t\tconst defaultIgnoredSettings = getDefaultIgnoredSettings().filter(s => s !== CONFIGURATION_SYNC_STORE_KEY);\n\t\tconst settings = Object.keys(allSettings.properties).filter(setting => defaultIgnoredSettings.indexOf(setting) === -1);\n\t\tconst ignoredSettings = defaultIgnoredSettings.filter(setting => disallowedIgnoredSettings.indexOf(setting) === -1);\n\t\tconst ignoredSettingsSchema: IJSONSchema = {\n\t\t\titems: {\n\t\t\t\ttype: 'string',\n\t\t\t\tenum: [...settings, ...ignoredSettings.map(setting => `-${setting}`)]\n\t\t\t},\n\t\t};\n\t\tjsonRegistry.registerSchema(ignoredSettingsSchemaId, ignoredSettingsSchema);\n\t};\n\treturn configurationRegistry.onDidUpdateConfiguration(() => registerIgnoredSettingsSchema());\n}\n\n// #region User Data Sync Store\n\nexport interface IUserData {\n\tref: string;\n\tcontent: string | null;\n}\n\nexport type IAuthenticationProvider = { id: string, scopes: string[] };\n\nexport interface IUserDataSyncStore {\n\treadonly url: URI;\n\treadonly type: UserDataSyncStoreType;\n\treadonly defaultUrl: URI;\n\treadonly stableUrl: URI;\n\treadonly insidersUrl: URI;\n\treadonly canSwitch: boolean;\n\treadonly authenticationProviders: IAuthenticationProvider[];\n}\n\nexport function isAuthenticationProvider(thing: any): thing is IAuthenticationProvider {\n\treturn thing\n\t\t&& isObject(thing)\n\t\t&& isString(thing.id)\n\t\t&& isArray(thing.scopes);\n}\n\nexport const enum SyncResource {\n\tSettings = 'settings',\n\tKeybindings = 'keybindings',\n\tSnippets = 'snippets',\n\tExtensions = 'extensions',\n\tGlobalState = 'globalState'\n}\nexport const ALL_SYNC_RESOURCES: SyncResource[] = [SyncResource.Settings, SyncResource.Keybindings, SyncResource.Snippets, SyncResource.Extensions, SyncResource.GlobalState];\n\nexport interface IUserDataManifest {\n\tlatest?: Record<ServerResource, string>\n\tsession: string;\n}\n\nexport interface IResourceRefHandle {\n\tref: string;\n\tcreated: number;\n}\n\nexport type ServerResource = SyncResource | 'machines';\nexport type UserDataSyncStoreType = 'insiders' | 'stable';\n\nexport const IUserDataSyncStoreManagementService = createDecorator<IUserDataSyncStoreManagementService>('IUserDataSyncStoreManagementService');\nexport interface IUserDataSyncStoreManagementService {\n\treadonly _serviceBrand: undefined;\n\treadonly onDidChangeUserDataSyncStore: Event<void>;\n\treadonly userDataSyncStore: IUserDataSyncStore | undefined;\n\tswitch(type: UserDataSyncStoreType): Promise<void>;\n\tgetPreviousUserDataSyncStore(): Promise<IUserDataSyncStore | undefined>;\n}\n\nexport interface IUserDataSyncStoreClient {\n\treadonly onDidChangeDonotMakeRequestsUntil: Event<void>;\n\treadonly donotMakeRequestsUntil: Date | undefined;\n\n\treadonly onTokenFailed: Event<void>;\n\treadonly onTokenSucceed: Event<void>;\n\tsetAuthToken(token: string, type: string): void;\n\n\t// Sync requests\n\tmanifest(headers?: IHeaders): Promise<IUserDataManifest | null>;\n\tread(resource: ServerResource, oldValue: IUserData | null, headers?: IHeaders): Promise<IUserData>;\n\twrite(resource: ServerResource, content: string, ref: string | null, headers?: IHeaders): Promise<string>;\n\tclear(): Promise<void>;\n\tdelete(resource: ServerResource): Promise<void>;\n\n\tgetAllRefs(resource: ServerResource): Promise<IResourceRefHandle[]>;\n\tresolveContent(resource: ServerResource, ref: string): Promise<string | null>;\n}\n\nexport const IUserDataSyncStoreService = createDecorator<IUserDataSyncStoreService>('IUserDataSyncStoreService');\nexport interface IUserDataSyncStoreService extends IUserDataSyncStoreClient {\n\treadonly _serviceBrand: undefined;\n}\n\nexport const IUserDataSyncBackupStoreService = createDecorator<IUserDataSyncBackupStoreService>('IUserDataSyncBackupStoreService');\nexport interface IUserDataSyncBackupStoreService {\n\treadonly _serviceBrand: undefined;\n\tbackup(resource: SyncResource, content: string): Promise<void>;\n\tgetAllRefs(resource: SyncResource): Promise<IResourceRefHandle[]>;\n\tresolveContent(resource: SyncResource, ref?: string): Promise<string | null>;\n}\n\n//#endregion\n\n// #region User Data Sync Headers\n\nexport const HEADER_OPERATION_ID = 'x-operation-id';\nexport const HEADER_EXECUTION_ID = 'X-Execution-Id';\n\nexport function createSyncHeaders(executionId: string): IHeaders {\n\tconst headers: IHeaders = {};\n\theaders[HEADER_EXECUTION_ID] = executionId;\n\treturn headers;\n}\n\n//#endregion\n\n// #region User Data Sync Error\n\nexport enum UserDataSyncErrorCode {\n\t// Client Errors (>= 400 )\n\tUnauthorized = 'Unauthorized', /* 401 */\n\tConflict = 'Conflict', /* 409 */\n\tGone = 'Gone', /* 410 */\n\tPreconditionFailed = 'PreconditionFailed', /* 412 */\n\tTooLarge = 'TooLarge', /* 413 */\n\tUpgradeRequired = 'UpgradeRequired', /* 426 */\n\tPreconditionRequired = 'PreconditionRequired', /* 428 */\n\tTooManyRequests = 'RemoteTooManyRequests', /* 429 */\n\tTooManyRequestsAndRetryAfter = 'TooManyRequestsAndRetryAfter', /* 429 + Retry-After */\n\n\t// Local Errors\n\tRequestFailed = 'RequestFailed',\n\tRequestCanceled = 'RequestCanceled',\n\tRequestTimeout = 'RequestTimeout',\n\tNoRef = 'NoRef',\n\tTurnedOff = 'TurnedOff',\n\tSessionExpired = 'SessionExpired',\n\tServiceChanged = 'ServiceChanged',\n\tDefaultServiceChanged = 'DefaultServiceChanged',\n\tLocalTooManyRequests = 'LocalTooManyRequests',\n\tLocalPreconditionFailed = 'LocalPreconditionFailed',\n\tLocalInvalidContent = 'LocalInvalidContent',\n\tLocalError = 'LocalError',\n\tIncompatibleLocalContent = 'IncompatibleLocalContent',\n\tIncompatibleRemoteContent = 'IncompatibleRemoteContent',\n\tUnresolvedConflicts = 'UnresolvedConflicts',\n\n\tUnknown = 'Unknown',\n}\n\nexport class UserDataSyncError extends Error {\n\n\tconstructor(\n\t\tmessage: string,\n\t\treadonly code: UserDataSyncErrorCode,\n\t\treadonly resource?: SyncResource,\n\t\treadonly operationId?: string\n\t) {\n\t\tsuper(message);\n\t\tthis.name = `${this.code} (UserDataSyncError) syncResource:${this.resource || 'unknown'} operationId:${this.operationId || 'unknown'}`;\n\t}\n\n}\n\nexport class UserDataSyncStoreError extends UserDataSyncError {\n\tconstructor(message: string, readonly url: string, code: UserDataSyncErrorCode, operationId: string | undefined) {\n\t\tsuper(message, code, undefined, operationId);\n\t}\n}\n\nexport class UserDataAutoSyncError extends UserDataSyncError {\n\tconstructor(message: string, code: UserDataSyncErrorCode) {\n\t\tsuper(message, code);\n\t}\n}\n\nexport namespace UserDataSyncError {\n\n\texport function toUserDataSyncError(error: Error): UserDataSyncError {\n\t\tif (error instanceof UserDataSyncError) {\n\t\t\treturn error;\n\t\t}\n\t\tconst match = /^(.+) \\(UserDataSyncError\\) syncResource:(.+) operationId:(.+)$/.exec(error.name);\n\t\tif (match && match[1]) {\n\t\t\tconst syncResource = match[2] === 'unknown' ? undefined : match[2] as SyncResource;\n\t\t\tconst operationId = match[3] === 'unknown' ? undefined : match[3];\n\t\t\treturn new UserDataSyncError(error.message, <UserDataSyncErrorCode>match[1], syncResource, operationId);\n\t\t}\n\t\treturn new UserDataSyncError(error.message, UserDataSyncErrorCode.Unknown);\n\t}\n\n}\n\n//#endregion\n\n// #region User Data Synchroniser\n\nexport interface ISyncExtension {\n\tidentifier: IExtensionIdentifier;\n\tversion?: string;\n\tdisabled?: boolean;\n\tinstalled?: boolean;\n\tstate?: IStringDictionary<any>;\n}\n\nexport interface ISyncExtensionWithVersion extends ISyncExtension {\n\tversion: string;\n}\n\nexport interface IStorageValue {\n\tversion: number;\n\tvalue: string;\n}\n\nexport interface IGlobalState {\n\tstorage: IStringDictionary<IStorageValue>;\n}\n\nexport const enum SyncStatus {\n\tUninitialized = 'uninitialized',\n\tIdle = 'idle',\n\tSyncing = 'syncing',\n\tHasConflicts = 'hasConflicts',\n}\n\nexport interface ISyncResourceHandle {\n\tcreated: number;\n\turi: URI;\n}\n\nexport interface IRemoteUserData {\n\tref: string;\n\tsyncData: ISyncData | null;\n}\n\nexport interface ISyncData {\n\tversion: number;\n\tmachineId?: string;\n\tcontent: string;\n}\n\nexport const enum Change {\n\tNone,\n\tAdded,\n\tModified,\n\tDeleted,\n}\n\nexport const enum MergeState {\n\tPreview = 'preview',\n\tConflict = 'conflict',\n\tAccepted = 'accepted',\n}\n\nexport interface IResourcePreview {\n\treadonly remoteResource: URI;\n\treadonly localResource: URI;\n\treadonly previewResource: URI;\n\treadonly acceptedResource: URI;\n\treadonly localChange: Change;\n\treadonly remoteChange: Change;\n\treadonly mergeState: MergeState;\n}\n\nexport interface ISyncResourcePreview {\n\treadonly isLastSyncFromCurrentMachine: boolean;\n\treadonly resourcePreviews: IResourcePreview[];\n}\n\nexport interface IUserDataInitializer {\n\tinitialize(userData: IUserData): Promise<void>;\n}\n\nexport interface IUserDataSynchroniser {\n\n\treadonly resource: SyncResource;\n\treadonly status: SyncStatus;\n\treadonly onDidChangeStatus: Event<SyncStatus>;\n\n\treadonly conflicts: IResourcePreview[];\n\treadonly onDidChangeConflicts: Event<IResourcePreview[]>;\n\n\treadonly onDidChangeLocal: Event<void>;\n\n\tsync(manifest: IUserDataManifest | null, headers: IHeaders): Promise<void>;\n\treplace(uri: URI): Promise<boolean>;\n\tstop(): Promise<void>;\n\n\tpreview(manifest: IUserDataManifest | null, headers: IHeaders): Promise<ISyncResourcePreview | null>;\n\taccept(resource: URI, content?: string | null): Promise<ISyncResourcePreview | null>;\n\tmerge(resource: URI): Promise<ISyncResourcePreview | null>;\n\tdiscard(resource: URI): Promise<ISyncResourcePreview | null>;\n\tapply(force: boolean, headers: IHeaders): Promise<ISyncResourcePreview | null>;\n\n\thasPreviouslySynced(): Promise<boolean>;\n\thasLocalData(): Promise<boolean>;\n\tresetLocal(): Promise<void>;\n\n\tresolveContent(resource: URI): Promise<string | null>;\n\tgetRemoteSyncResourceHandles(): Promise<ISyncResourceHandle[]>;\n\tgetLocalSyncResourceHandles(): Promise<ISyncResourceHandle[]>;\n\tgetAssociatedResources(syncResourceHandle: ISyncResourceHandle): Promise<{ resource: URI, comparableResource: URI }[]>;\n\tgetMachineId(syncResourceHandle: ISyncResourceHandle): Promise<string | undefined>;\n}\n\n//#endregion\n\n// #region keys synced only in web\n\nexport const SYNC_SERVICE_URL_TYPE = 'sync.store.url.type';\nexport function getEnablementKey(resource: SyncResource) { return `sync.enable.${resource}`; }\n\n// #endregion\n\n// #region User Data Sync Services\n\nexport const IUserDataSyncResourceEnablementService = createDecorator<IUserDataSyncResourceEnablementService>('IUserDataSyncResourceEnablementService');\nexport interface IUserDataSyncResourceEnablementService {\n\t_serviceBrand: any;\n\n\treadonly onDidChangeResourceEnablement: Event<[SyncResource, boolean]>;\n\tisResourceEnabled(resource: SyncResource): boolean;\n\tsetResourceEnablement(resource: SyncResource, enabled: boolean): void;\n\n\tgetResourceSyncStateVersion(resource: SyncResource): string | undefined;\n}\n\nexport interface ISyncTask {\n\treadonly manifest: IUserDataManifest | null;\n\trun(): Promise<void>;\n\tstop(): Promise<void>;\n}\n\nexport interface IManualSyncTask extends IDisposable {\n\treadonly id: string;\n\treadonly status: SyncStatus;\n\treadonly manifest: IUserDataManifest | null;\n\treadonly onSynchronizeResources: Event<[SyncResource, URI[]][]>;\n\tpreview(): Promise<[SyncResource, ISyncResourcePreview][]>;\n\taccept(resource: URI, content?: string | null): Promise<[SyncResource, ISyncResourcePreview][]>;\n\tmerge(resource?: URI): Promise<[SyncResource, ISyncResourcePreview][]>;\n\tdiscard(resource: URI): Promise<[SyncResource, ISyncResourcePreview][]>;\n\tdiscardConflicts(): Promise<[SyncResource, ISyncResourcePreview][]>;\n\tapply(): Promise<[SyncResource, ISyncResourcePreview][]>;\n\tpull(): Promise<void>;\n\tpush(): Promise<void>;\n\tstop(): Promise<void>;\n}\n\nexport const IUserDataSyncService = createDecorator<IUserDataSyncService>('IUserDataSyncService');\nexport interface IUserDataSyncService {\n\t_serviceBrand: any;\n\n\treadonly status: SyncStatus;\n\treadonly onDidChangeStatus: Event<SyncStatus>;\n\n\treadonly conflicts: [SyncResource, IResourcePreview[]][];\n\treadonly onDidChangeConflicts: Event<[SyncResource, IResourcePreview[]][]>;\n\n\treadonly onDidChangeLocal: Event<SyncResource>;\n\treadonly onSyncErrors: Event<[SyncResource, UserDataSyncError][]>;\n\n\treadonly lastSyncTime: number | undefined;\n\treadonly onDidChangeLastSyncTime: Event<number>;\n\n\treadonly onDidResetRemote: Event<void>;\n\treadonly onDidResetLocal: Event<void>;\n\n\tcreateSyncTask(disableCache?: boolean): Promise<ISyncTask>;\n\tcreateManualSyncTask(): Promise<IManualSyncTask>;\n\n\treplace(uri: URI): Promise<void>;\n\treset(): Promise<void>;\n\tresetRemote(): Promise<void>;\n\tresetLocal(): Promise<void>;\n\n\thasLocalData(): Promise<boolean>;\n\thasPreviouslySynced(): Promise<boolean>;\n\tresolveContent(resource: URI): Promise<string | null>;\n\taccept(resource: SyncResource, conflictResource: URI, content: string | null | undefined, apply: boolean): Promise<void>;\n\n\tgetLocalSyncResourceHandles(resource: SyncResource): Promise<ISyncResourceHandle[]>;\n\tgetRemoteSyncResourceHandles(resource: SyncResource): Promise<ISyncResourceHandle[]>;\n\tgetAssociatedResources(resource: SyncResource, syncResourceHandle: ISyncResourceHandle): Promise<{ resource: URI, comparableResource: URI }[]>;\n\tgetMachineId(resource: SyncResource, syncResourceHandle: ISyncResourceHandle): Promise<string | undefined>;\n}\n\nexport const IUserDataAutoSyncEnablementService = createDecorator<IUserDataAutoSyncEnablementService>('IUserDataAutoSyncEnablementService');\nexport interface IUserDataAutoSyncEnablementService {\n\t_serviceBrand: any;\n\treadonly onDidChangeEnablement: Event<boolean>;\n\tisEnabled(): boolean;\n\tcanToggleEnablement(): boolean;\n}\n\nexport const IUserDataAutoSyncService = createDecorator<IUserDataAutoSyncService>('IUserDataAutoSyncService');\nexport interface IUserDataAutoSyncService {\n\t_serviceBrand: any;\n\treadonly onError: Event<UserDataSyncError>;\n\tturnOn(): Promise<void>;\n\tturnOff(everywhere: boolean): Promise<void>;\n\ttriggerSync(sources: string[], hasToLimitSync: boolean, disableCache: boolean): Promise<void>;\n}\n\nexport const IUserDataSyncUtilService = createDecorator<IUserDataSyncUtilService>('IUserDataSyncUtilService');\nexport interface IUserDataSyncUtilService {\n\treadonly _serviceBrand: undefined;\n\tresolveUserBindings(userbindings: string[]): Promise<IStringDictionary<string>>;\n\tresolveFormattingOptions(resource: URI): Promise<FormattingOptions>;\n\tresolveDefaultIgnoredSettings(): Promise<string[]>;\n}\n\nexport const IUserDataSyncLogService = createDecorator<IUserDataSyncLogService>('IUserDataSyncLogService');\nexport interface IUserDataSyncLogService extends ILogService { }\n\nexport interface IConflictSetting {\n\tkey: string;\n\tlocalValue: any | undefined;\n\tremoteValue: any | undefined;\n}\n\n//#endregion\n\nexport const USER_DATA_SYNC_SCHEME = 'vscode-userdata-sync';\nexport const PREVIEW_DIR_NAME = 'preview';\nexport function getSyncResourceFromLocalPreview(localPreview: URI, environmentService: IEnvironmentService): SyncResource | undefined {\n\tif (localPreview.scheme === USER_DATA_SYNC_SCHEME) {\n\t\treturn undefined;\n\t}\n\tlocalPreview = localPreview.with({ scheme: environmentService.userDataSyncHome.scheme });\n\treturn ALL_SYNC_RESOURCES.filter(syncResource => isEqualOrParent(localPreview, joinPath(environmentService.userDataSyncHome, syncResource, PREVIEW_DIR_NAME)))[0];\n}\n"]}