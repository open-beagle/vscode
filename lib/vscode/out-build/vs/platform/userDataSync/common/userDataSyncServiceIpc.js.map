{"version":3,"file":"userDataSyncServiceIpc.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/platform/userDataSync/common/userDataSyncServiceIpc.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IServerChannel, IChannel } from 'vs/base/parts/ipc/common/ipc';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IUserDataSyncService, IManualSyncTask, IUserDataManifest, SyncStatus, IResourcePreview, ISyncResourceHandle, ISyncResourcePreview, ISyncTask, SyncResource, UserDataSyncError } from 'vs/platform/userDataSync/common/userDataSync';\nimport { URI } from 'vs/base/common/uri';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { isArray } from 'vs/base/common/types';\n\ntype ManualSyncTaskEvent<T> = { manualSyncTaskId: string, data: T };\n\nexport class UserDataSyncChannel implements IServerChannel {\n\n\tprivate readonly manualSyncTasks = new Map<string, { manualSyncTask: IManualSyncTask, disposables: DisposableStore }>();\n\tprivate readonly onManualSynchronizeResources = new Emitter<ManualSyncTaskEvent<[SyncResource, URI[]][]>>();\n\n\tconstructor(private readonly service: IUserDataSyncService, private readonly logService: ILogService) { }\n\n\tlisten(_: unknown, event: string): Event<any> {\n\t\tswitch (event) {\n\t\t\t// sync\n\t\t\tcase 'onDidChangeStatus': return this.service.onDidChangeStatus;\n\t\t\tcase 'onDidChangeConflicts': return this.service.onDidChangeConflicts;\n\t\t\tcase 'onDidChangeLocal': return this.service.onDidChangeLocal;\n\t\t\tcase 'onDidChangeLastSyncTime': return this.service.onDidChangeLastSyncTime;\n\t\t\tcase 'onSyncErrors': return this.service.onSyncErrors;\n\t\t\tcase 'onDidResetLocal': return this.service.onDidResetLocal;\n\t\t\tcase 'onDidResetRemote': return this.service.onDidResetRemote;\n\n\t\t\t// manual sync\n\t\t\tcase 'manualSync/onSynchronizeResources': return this.onManualSynchronizeResources.event;\n\t\t}\n\n\t\tthrow new Error(`Event not found: ${event}`);\n\t}\n\n\tasync call(context: any, command: string, args?: any): Promise<any> {\n\t\ttry {\n\t\t\tconst result = await this._call(context, command, args);\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tprivate async _call(context: any, command: string, args?: any): Promise<any> {\n\t\tswitch (command) {\n\n\t\t\t// sync\n\t\t\tcase '_getInitialData': return Promise.resolve([this.service.status, this.service.conflicts, this.service.lastSyncTime]);\n\t\t\tcase 'replace': return this.service.replace(URI.revive(args[0]));\n\t\t\tcase 'reset': return this.service.reset();\n\t\t\tcase 'resetRemote': return this.service.resetRemote();\n\t\t\tcase 'resetLocal': return this.service.resetLocal();\n\t\t\tcase 'hasPreviouslySynced': return this.service.hasPreviouslySynced();\n\t\t\tcase 'hasLocalData': return this.service.hasLocalData();\n\t\t\tcase 'accept': return this.service.accept(args[0], URI.revive(args[1]), args[2], args[3]);\n\t\t\tcase 'resolveContent': return this.service.resolveContent(URI.revive(args[0]));\n\t\t\tcase 'getLocalSyncResourceHandles': return this.service.getLocalSyncResourceHandles(args[0]);\n\t\t\tcase 'getRemoteSyncResourceHandles': return this.service.getRemoteSyncResourceHandles(args[0]);\n\t\t\tcase 'getAssociatedResources': return this.service.getAssociatedResources(args[0], { created: args[1].created, uri: URI.revive(args[1].uri) });\n\t\t\tcase 'getMachineId': return this.service.getMachineId(args[0], { created: args[1].created, uri: URI.revive(args[1].uri) });\n\n\t\t\tcase 'createManualSyncTask': return this.createManualSyncTask();\n\t\t}\n\n\t\t// manual sync\n\t\tif (command.startsWith('manualSync/')) {\n\t\t\tconst manualSyncTaskCommand = command.substring('manualSync/'.length);\n\t\t\tconst manualSyncTaskId = args[0];\n\t\t\tconst manualSyncTask = this.getManualSyncTask(manualSyncTaskId);\n\t\t\targs = (<Array<any>>args).slice(1);\n\n\t\t\tswitch (manualSyncTaskCommand) {\n\t\t\t\tcase 'preview': return manualSyncTask.preview();\n\t\t\t\tcase 'accept': return manualSyncTask.accept(URI.revive(args[0]), args[1]);\n\t\t\t\tcase 'merge': return manualSyncTask.merge(URI.revive(args[0]));\n\t\t\t\tcase 'discard': return manualSyncTask.discard(URI.revive(args[0]));\n\t\t\t\tcase 'discardConflicts': return manualSyncTask.discardConflicts();\n\t\t\t\tcase 'apply': return manualSyncTask.apply();\n\t\t\t\tcase 'pull': return manualSyncTask.pull();\n\t\t\t\tcase 'push': return manualSyncTask.push();\n\t\t\t\tcase 'stop': return manualSyncTask.stop();\n\t\t\t\tcase '_getStatus': return manualSyncTask.status;\n\t\t\t\tcase 'dispose': return this.disposeManualSyncTask(manualSyncTask);\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('Invalid call');\n\t}\n\n\tprivate getManualSyncTask(manualSyncTaskId: string): IManualSyncTask {\n\t\tconst value = this.manualSyncTasks.get(this.createKey(manualSyncTaskId));\n\t\tif (!value) {\n\t\t\tthrow new Error(`Manual sync taks not found: ${manualSyncTaskId}`);\n\t\t}\n\t\treturn value.manualSyncTask;\n\t}\n\n\tprivate async createManualSyncTask(): Promise<{ id: string, manifest: IUserDataManifest | null, status: SyncStatus }> {\n\t\tconst disposables = new DisposableStore();\n\t\tconst manualSyncTask = disposables.add(await this.service.createManualSyncTask());\n\t\tdisposables.add(manualSyncTask.onSynchronizeResources(synchronizeResources => this.onManualSynchronizeResources.fire({ manualSyncTaskId: manualSyncTask.id, data: synchronizeResources })));\n\t\tthis.manualSyncTasks.set(this.createKey(manualSyncTask.id), { manualSyncTask, disposables });\n\t\treturn { id: manualSyncTask.id, manifest: manualSyncTask.manifest, status: manualSyncTask.status };\n\t}\n\n\tprivate disposeManualSyncTask(manualSyncTask: IManualSyncTask): void {\n\t\tmanualSyncTask.dispose();\n\t\tconst key = this.createKey(manualSyncTask.id);\n\t\tthis.manualSyncTasks.get(key)?.disposables.dispose();\n\t\tthis.manualSyncTasks.delete(key);\n\t}\n\n\tprivate createKey(manualSyncTaskId: string): string { return `manualSyncTask-${manualSyncTaskId}`; }\n\n}\n\nexport class UserDataSyncChannelClient extends Disposable implements IUserDataSyncService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly channel: IChannel;\n\n\tprivate _status: SyncStatus = SyncStatus.Uninitialized;\n\tget status(): SyncStatus { return this._status; }\n\tprivate _onDidChangeStatus: Emitter<SyncStatus> = this._register(new Emitter<SyncStatus>());\n\treadonly onDidChangeStatus: Event<SyncStatus> = this._onDidChangeStatus.event;\n\n\tget onDidChangeLocal(): Event<SyncResource> { return this.channel.listen<SyncResource>('onDidChangeLocal'); }\n\n\tprivate _conflicts: [SyncResource, IResourcePreview[]][] = [];\n\tget conflicts(): [SyncResource, IResourcePreview[]][] { return this._conflicts; }\n\tprivate _onDidChangeConflicts: Emitter<[SyncResource, IResourcePreview[]][]> = this._register(new Emitter<[SyncResource, IResourcePreview[]][]>());\n\treadonly onDidChangeConflicts: Event<[SyncResource, IResourcePreview[]][]> = this._onDidChangeConflicts.event;\n\n\tprivate _lastSyncTime: number | undefined = undefined;\n\tget lastSyncTime(): number | undefined { return this._lastSyncTime; }\n\tprivate _onDidChangeLastSyncTime: Emitter<number> = this._register(new Emitter<number>());\n\treadonly onDidChangeLastSyncTime: Event<number> = this._onDidChangeLastSyncTime.event;\n\n\tprivate _onSyncErrors: Emitter<[SyncResource, UserDataSyncError][]> = this._register(new Emitter<[SyncResource, UserDataSyncError][]>());\n\treadonly onSyncErrors: Event<[SyncResource, UserDataSyncError][]> = this._onSyncErrors.event;\n\n\tget onDidResetLocal(): Event<void> { return this.channel.listen<void>('onDidResetLocal'); }\n\tget onDidResetRemote(): Event<void> { return this.channel.listen<void>('onDidResetRemote'); }\n\n\tconstructor(userDataSyncChannel: IChannel) {\n\t\tsuper();\n\t\tthis.channel = {\n\t\t\tcall<T>(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T> {\n\t\t\t\treturn userDataSyncChannel.call(command, arg, cancellationToken)\n\t\t\t\t\t.then(null, error => { throw UserDataSyncError.toUserDataSyncError(error); });\n\t\t\t},\n\t\t\tlisten<T>(event: string, arg?: any): Event<T> {\n\t\t\t\treturn userDataSyncChannel.listen(event, arg);\n\t\t\t}\n\t\t};\n\t\tthis.channel.call<[SyncStatus, [SyncResource, IResourcePreview[]][], number | undefined]>('_getInitialData').then(([status, conflicts, lastSyncTime]) => {\n\t\t\tthis.updateStatus(status);\n\t\t\tthis.updateConflicts(conflicts);\n\t\t\tif (lastSyncTime) {\n\t\t\t\tthis.updateLastSyncTime(lastSyncTime);\n\t\t\t}\n\t\t\tthis._register(this.channel.listen<SyncStatus>('onDidChangeStatus')(status => this.updateStatus(status)));\n\t\t\tthis._register(this.channel.listen<number>('onDidChangeLastSyncTime')(lastSyncTime => this.updateLastSyncTime(lastSyncTime)));\n\t\t});\n\t\tthis._register(this.channel.listen<[SyncResource, IResourcePreview[]][]>('onDidChangeConflicts')(conflicts => this.updateConflicts(conflicts)));\n\t\tthis._register(this.channel.listen<[SyncResource, Error][]>('onSyncErrors')(errors => this._onSyncErrors.fire(errors.map(([source, error]) => ([source, UserDataSyncError.toUserDataSyncError(error)])))));\n\t}\n\n\tcreateSyncTask(): Promise<ISyncTask> {\n\t\tthrow new Error('not supported');\n\t}\n\n\tasync createManualSyncTask(): Promise<IManualSyncTask> {\n\t\tconst { id, manifest, status } = await this.channel.call<{ id: string, manifest: IUserDataManifest | null, status: SyncStatus }>('createManualSyncTask');\n\t\tconst that = this;\n\t\tconst manualSyncTaskChannelClient = new ManualSyncTaskChannelClient(id, manifest, status, {\n\t\t\tasync call<T>(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T> {\n\t\t\t\treturn that.channel.call<T>(`manualSync/${command}`, [id, ...(isArray(arg) ? arg : [arg])], cancellationToken);\n\t\t\t},\n\t\t\tlisten<T>(event: string, arg?: any): Event<T> {\n\t\t\t\treturn Event.map(\n\t\t\t\t\tEvent.filter(that.channel.listen<{ manualSyncTaskId: string, data: T }>(`manualSync/${event}`, arg), e => !manualSyncTaskChannelClient.isDiposed() && e.manualSyncTaskId === id),\n\t\t\t\t\te => e.data);\n\t\t\t}\n\t\t});\n\t\treturn manualSyncTaskChannelClient;\n\t}\n\n\treplace(uri: URI): Promise<void> {\n\t\treturn this.channel.call('replace', [uri]);\n\t}\n\n\treset(): Promise<void> {\n\t\treturn this.channel.call('reset');\n\t}\n\n\tresetRemote(): Promise<void> {\n\t\treturn this.channel.call('resetRemote');\n\t}\n\n\tresetLocal(): Promise<void> {\n\t\treturn this.channel.call('resetLocal');\n\t}\n\n\thasPreviouslySynced(): Promise<boolean> {\n\t\treturn this.channel.call('hasPreviouslySynced');\n\t}\n\n\thasLocalData(): Promise<boolean> {\n\t\treturn this.channel.call('hasLocalData');\n\t}\n\n\taccept(syncResource: SyncResource, resource: URI, content: string | null, apply: boolean): Promise<void> {\n\t\treturn this.channel.call('accept', [syncResource, resource, content, apply]);\n\t}\n\n\tresolveContent(resource: URI): Promise<string | null> {\n\t\treturn this.channel.call('resolveContent', [resource]);\n\t}\n\n\tasync getLocalSyncResourceHandles(resource: SyncResource): Promise<ISyncResourceHandle[]> {\n\t\tconst handles = await this.channel.call<ISyncResourceHandle[]>('getLocalSyncResourceHandles', [resource]);\n\t\treturn handles.map(({ created, uri }) => ({ created, uri: URI.revive(uri) }));\n\t}\n\n\tasync getRemoteSyncResourceHandles(resource: SyncResource): Promise<ISyncResourceHandle[]> {\n\t\tconst handles = await this.channel.call<ISyncResourceHandle[]>('getRemoteSyncResourceHandles', [resource]);\n\t\treturn handles.map(({ created, uri }) => ({ created, uri: URI.revive(uri) }));\n\t}\n\n\tasync getAssociatedResources(resource: SyncResource, syncResourceHandle: ISyncResourceHandle): Promise<{ resource: URI, comparableResource: URI }[]> {\n\t\tconst result = await this.channel.call<{ resource: URI, comparableResource: URI }[]>('getAssociatedResources', [resource, syncResourceHandle]);\n\t\treturn result.map(({ resource, comparableResource }) => ({ resource: URI.revive(resource), comparableResource: URI.revive(comparableResource) }));\n\t}\n\n\tasync getMachineId(resource: SyncResource, syncResourceHandle: ISyncResourceHandle): Promise<string | undefined> {\n\t\treturn this.channel.call<string | undefined>('getMachineId', [resource, syncResourceHandle]);\n\t}\n\n\tprivate async updateStatus(status: SyncStatus): Promise<void> {\n\t\tthis._status = status;\n\t\tthis._onDidChangeStatus.fire(status);\n\t}\n\n\tprivate async updateConflicts(conflicts: [SyncResource, IResourcePreview[]][]): Promise<void> {\n\t\t// Revive URIs\n\t\tthis._conflicts = conflicts.map(([syncResource, conflicts]) =>\n\t\t([\n\t\t\tsyncResource,\n\t\t\tconflicts.map(r =>\n\t\t\t({\n\t\t\t\t...r,\n\t\t\t\tlocalResource: URI.revive(r.localResource),\n\t\t\t\tremoteResource: URI.revive(r.remoteResource),\n\t\t\t\tpreviewResource: URI.revive(r.previewResource),\n\t\t\t}))\n\t\t]));\n\t\tthis._onDidChangeConflicts.fire(this._conflicts);\n\t}\n\n\tprivate updateLastSyncTime(lastSyncTime: number): void {\n\t\tif (this._lastSyncTime !== lastSyncTime) {\n\t\t\tthis._lastSyncTime = lastSyncTime;\n\t\t\tthis._onDidChangeLastSyncTime.fire(lastSyncTime);\n\t\t}\n\t}\n}\n\nclass ManualSyncTaskChannelClient extends Disposable implements IManualSyncTask {\n\n\tprivate readonly channel: IChannel;\n\n\tget onSynchronizeResources(): Event<[SyncResource, URI[]][]> { return this.channel.listen<[SyncResource, URI[]][]>('onSynchronizeResources'); }\n\n\tprivate _status: SyncStatus;\n\tget status(): SyncStatus { return this._status; }\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly manifest: IUserDataManifest | null,\n\t\tstatus: SyncStatus,\n\t\tmanualSyncTaskChannel: IChannel\n\t) {\n\t\tsuper();\n\t\tthis._status = status;\n\t\tconst that = this;\n\t\tthis.channel = {\n\t\t\tasync call<T>(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T> {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await manualSyncTaskChannel.call<T>(command, arg, cancellationToken);\n\t\t\t\t\tif (!that.isDiposed()) {\n\t\t\t\t\t\tthat._status = await manualSyncTaskChannel.call<SyncStatus>('_getStatus');\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow UserDataSyncError.toUserDataSyncError(error);\n\t\t\t\t}\n\t\t\t},\n\t\t\tlisten<T>(event: string, arg?: any): Event<T> {\n\t\t\t\treturn manualSyncTaskChannel.listen(event, arg);\n\t\t\t}\n\t\t};\n\t}\n\n\tasync preview(): Promise<[SyncResource, ISyncResourcePreview][]> {\n\t\tconst previews = await this.channel.call<[SyncResource, ISyncResourcePreview][]>('preview');\n\t\treturn this.deserializePreviews(previews);\n\t}\n\n\tasync accept(resource: URI, content?: string | null): Promise<[SyncResource, ISyncResourcePreview][]> {\n\t\tconst previews = await this.channel.call<[SyncResource, ISyncResourcePreview][]>('accept', [resource, content]);\n\t\treturn this.deserializePreviews(previews);\n\t}\n\n\tasync merge(resource?: URI): Promise<[SyncResource, ISyncResourcePreview][]> {\n\t\tconst previews = await this.channel.call<[SyncResource, ISyncResourcePreview][]>('merge', [resource]);\n\t\treturn this.deserializePreviews(previews);\n\t}\n\n\tasync discard(resource: URI): Promise<[SyncResource, ISyncResourcePreview][]> {\n\t\tconst previews = await this.channel.call<[SyncResource, ISyncResourcePreview][]>('discard', [resource]);\n\t\treturn this.deserializePreviews(previews);\n\t}\n\n\tasync discardConflicts(): Promise<[SyncResource, ISyncResourcePreview][]> {\n\t\tconst previews = await this.channel.call<[SyncResource, ISyncResourcePreview][]>('discardConflicts');\n\t\treturn this.deserializePreviews(previews);\n\t}\n\n\tasync apply(): Promise<[SyncResource, ISyncResourcePreview][]> {\n\t\tconst previews = await this.channel.call<[SyncResource, ISyncResourcePreview][]>('apply');\n\t\treturn this.deserializePreviews(previews);\n\t}\n\n\tpull(): Promise<void> {\n\t\treturn this.channel.call('pull');\n\t}\n\n\tpush(): Promise<void> {\n\t\treturn this.channel.call('push');\n\t}\n\n\tstop(): Promise<void> {\n\t\treturn this.channel.call('stop');\n\t}\n\n\tprivate _disposed = false;\n\tisDiposed() { return this._disposed; }\n\n\toverride dispose(): void {\n\t\tthis._disposed = true;\n\t\tthis.channel.call('dispose');\n\t}\n\n\tprivate deserializePreviews(previews: [SyncResource, ISyncResourcePreview][]): [SyncResource, ISyncResourcePreview][] {\n\t\treturn previews.map(([syncResource, preview]) =>\n\t\t([\n\t\t\tsyncResource,\n\t\t\t{\n\t\t\t\tisLastSyncFromCurrentMachine: preview.isLastSyncFromCurrentMachine,\n\t\t\t\tresourcePreviews: preview.resourcePreviews.map(r => ({\n\t\t\t\t\t...r,\n\t\t\t\t\tlocalResource: URI.revive(r.localResource),\n\t\t\t\t\tremoteResource: URI.revive(r.remoteResource),\n\t\t\t\t\tpreviewResource: URI.revive(r.previewResource),\n\t\t\t\t\tacceptedResource: URI.revive(r.acceptedResource),\n\t\t\t\t}))\n\t\t\t}\n\t\t]));\n\t}\n}\n\n"]}