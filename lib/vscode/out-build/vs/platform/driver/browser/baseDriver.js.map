{"version":3,"file":"baseDriver.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/platform/driver/browser/baseDriver.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getTopLeftOffset, getClientArea } from 'vs/base/browser/dom';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { IElement, IWindowDriver } from 'vs/platform/driver/common/driver';\n\nfunction serializeElement(element: Element, recursive: boolean): IElement {\n\tconst attributes = Object.create(null);\n\n\tfor (let j = 0; j < element.attributes.length; j++) {\n\t\tconst attr = element.attributes.item(j);\n\t\tif (attr) {\n\t\t\tattributes[attr.name] = attr.value;\n\t\t}\n\t}\n\n\tconst children: IElement[] = [];\n\n\tif (recursive) {\n\t\tfor (let i = 0; i < element.children.length; i++) {\n\t\t\tconst child = element.children.item(i);\n\t\t\tif (child) {\n\t\t\t\tchildren.push(serializeElement(child, true));\n\t\t\t}\n\t\t}\n\t}\n\n\tconst { left, top } = getTopLeftOffset(element as HTMLElement);\n\n\treturn {\n\t\ttagName: element.tagName,\n\t\tclassName: element.className,\n\t\ttextContent: element.textContent || '',\n\t\tattributes,\n\t\tchildren,\n\t\tleft,\n\t\ttop\n\t};\n}\n\nexport abstract class BaseWindowDriver implements IWindowDriver {\n\n\tabstract click(selector: string, xoffset?: number, yoffset?: number): Promise<void>;\n\tabstract doubleClick(selector: string): Promise<void>;\n\n\tasync setValue(selector: string, text: string): Promise<void> {\n\t\tconst element = document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\treturn Promise.reject(new Error(`Element not found: ${selector}`));\n\t\t}\n\n\t\tconst inputElement = element as HTMLInputElement;\n\t\tinputElement.value = text;\n\n\t\tconst event = new Event('input', { bubbles: true, cancelable: true });\n\t\tinputElement.dispatchEvent(event);\n\t}\n\n\tasync getTitle(): Promise<string> {\n\t\treturn document.title;\n\t}\n\n\tasync isActiveElement(selector: string): Promise<boolean> {\n\t\tconst element = document.querySelector(selector);\n\n\t\tif (element !== document.activeElement) {\n\t\t\tconst chain: string[] = [];\n\t\t\tlet el = document.activeElement;\n\n\t\t\twhile (el) {\n\t\t\t\tconst tagName = el.tagName;\n\t\t\t\tconst id = el.id ? `#${el.id}` : '';\n\t\t\t\tconst classes = coalesce(el.className.split(/\\s+/g).map(c => c.trim())).map(c => `.${c}`).join('');\n\t\t\t\tchain.unshift(`${tagName}${id}${classes}`);\n\n\t\t\t\tel = el.parentElement;\n\t\t\t}\n\n\t\t\tthrow new Error(`Active element not found. Current active element is '${chain.join(' > ')}'. Looking for ${selector}`);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync getElements(selector: string, recursive: boolean): Promise<IElement[]> {\n\t\tconst query = document.querySelectorAll(selector);\n\t\tconst result: IElement[] = [];\n\n\t\tfor (let i = 0; i < query.length; i++) {\n\t\t\tconst element = query.item(i);\n\t\t\tresult.push(serializeElement(element, recursive));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tasync getElementXY(selector: string, xoffset?: number, yoffset?: number): Promise<{ x: number; y: number; }> {\n\t\tconst offset = typeof xoffset === 'number' && typeof yoffset === 'number' ? { x: xoffset, y: yoffset } : undefined;\n\t\treturn this._getElementXY(selector, offset);\n\t}\n\n\tasync typeInEditor(selector: string, text: string): Promise<void> {\n\t\tconst element = document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\tthrow new Error(`Editor not found: ${selector}`);\n\t\t}\n\n\t\tconst textarea = element as HTMLTextAreaElement;\n\t\tconst start = textarea.selectionStart;\n\t\tconst newStart = start + text.length;\n\t\tconst value = textarea.value;\n\t\tconst newValue = value.substr(0, start) + text + value.substr(start);\n\n\t\ttextarea.value = newValue;\n\t\ttextarea.setSelectionRange(newStart, newStart);\n\n\t\tconst event = new Event('input', { 'bubbles': true, 'cancelable': true });\n\t\ttextarea.dispatchEvent(event);\n\t}\n\n\tasync getTerminalBuffer(selector: string): Promise<string[]> {\n\t\tconst element = document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\tthrow new Error(`Terminal not found: ${selector}`);\n\t\t}\n\n\t\tconst xterm = (element as any).xterm;\n\n\t\tif (!xterm) {\n\t\t\tthrow new Error(`Xterm not found: ${selector}`);\n\t\t}\n\n\t\tconst lines: string[] = [];\n\n\t\tfor (let i = 0; i < xterm.buffer.length; i++) {\n\t\t\tlines.push(xterm.buffer.getLine(i)!.translateToString(true));\n\t\t}\n\n\t\treturn lines;\n\t}\n\n\tasync writeInTerminal(selector: string, text: string): Promise<void> {\n\t\tconst element = document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\tthrow new Error(`Element not found: ${selector}`);\n\t\t}\n\n\t\tconst xterm = (element as any).xterm;\n\n\t\tif (!xterm) {\n\t\t\tthrow new Error(`Xterm not found: ${selector}`);\n\t\t}\n\n\t\txterm._core._coreService.triggerDataEvent(text);\n\t}\n\n\tprotected async _getElementXY(selector: string, offset?: { x: number, y: number }): Promise<{ x: number; y: number; }> {\n\t\tconst element = document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\treturn Promise.reject(new Error(`Element not found: ${selector}`));\n\t\t}\n\n\t\tconst { left, top } = getTopLeftOffset(element as HTMLElement);\n\t\tconst { width, height } = getClientArea(element as HTMLElement);\n\t\tlet x: number, y: number;\n\n\t\tif (offset) {\n\t\t\tx = left + offset.x;\n\t\t\ty = top + offset.y;\n\t\t} else {\n\t\t\tx = left + (width / 2);\n\t\t\ty = top + (height / 2);\n\t\t}\n\n\t\tx = Math.round(x);\n\t\ty = Math.round(y);\n\n\t\treturn { x, y };\n\t}\n\n\tabstract openDevTools(): Promise<void>;\n}\n"]}