{"version":3,"file":"contextMenuHandler.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/platform/contextview/browser/contextMenuHandler.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./contextMenuHandler';\n\nimport { ActionRunner, IRunEvent, WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification } from 'vs/base/common/actions';\nimport { combinedDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { Menu } from 'vs/base/browser/ui/menu/menu';\nimport { IContextViewService } from 'vs/platform/contextview/browser/contextView';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { IContextMenuDelegate } from 'vs/base/browser/contextmenu';\nimport { EventType, $, isHTMLElement } from 'vs/base/browser/dom';\nimport { attachMenuStyler } from 'vs/platform/theme/common/styler';\nimport { domEvent } from 'vs/base/browser/event';\nimport { StandardMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { isPromiseCanceledError } from 'vs/base/common/errors';\n\nexport interface IContextMenuHandlerOptions {\n\tblockMouse: boolean;\n}\n\nexport class ContextMenuHandler {\n\tprivate focusToReturn: HTMLElement | null = null;\n\tprivate block: HTMLElement | null = null;\n\tprivate options: IContextMenuHandlerOptions = { blockMouse: true };\n\n\tconstructor(\n\t\tprivate contextViewService: IContextViewService,\n\t\tprivate telemetryService: ITelemetryService,\n\t\tprivate notificationService: INotificationService,\n\t\tprivate keybindingService: IKeybindingService,\n\t\tprivate themeService: IThemeService\n\t) { }\n\n\tconfigure(options: IContextMenuHandlerOptions): void {\n\t\tthis.options = options;\n\t}\n\n\tshowContextMenu(delegate: IContextMenuDelegate): void {\n\t\tconst actions = delegate.getActions();\n\t\tif (!actions.length) {\n\t\t\treturn; // Don't render an empty context menu\n\t\t}\n\n\t\tthis.focusToReturn = document.activeElement as HTMLElement;\n\n\t\tlet menu: Menu | undefined;\n\n\t\tlet shadowRootElement = isHTMLElement(delegate.domForShadowRoot) ? delegate.domForShadowRoot : undefined;\n\t\tthis.contextViewService.showContextView({\n\t\t\tgetAnchor: () => delegate.getAnchor(),\n\t\t\tcanRelayout: false,\n\t\t\tanchorAlignment: delegate.anchorAlignment,\n\t\t\tanchorAxisAlignment: delegate.anchorAxisAlignment,\n\n\t\t\trender: (container) => {\n\t\t\t\tlet className = delegate.getMenuClassName ? delegate.getMenuClassName() : '';\n\n\t\t\t\tif (className) {\n\t\t\t\t\tcontainer.className += ' ' + className;\n\t\t\t\t}\n\n\t\t\t\t// Render invisible div to block mouse interaction in the rest of the UI\n\t\t\t\tif (this.options.blockMouse) {\n\t\t\t\t\tthis.block = container.appendChild($('.context-view-block'));\n\t\t\t\t\tthis.block.style.position = 'fixed';\n\t\t\t\t\tthis.block.style.cursor = 'initial';\n\t\t\t\t\tthis.block.style.left = '0';\n\t\t\t\t\tthis.block.style.top = '0';\n\t\t\t\t\tthis.block.style.width = '100%';\n\t\t\t\t\tthis.block.style.height = '100%';\n\t\t\t\t\tthis.block.style.zIndex = '-1';\n\t\t\t\t\tdomEvent(this.block, EventType.MOUSE_DOWN)((e: MouseEvent) => e.stopPropagation());\n\t\t\t\t}\n\n\t\t\t\tconst menuDisposables = new DisposableStore();\n\n\t\t\t\tconst actionRunner = delegate.actionRunner || new ActionRunner();\n\t\t\t\tactionRunner.onBeforeRun(this.onActionRun, this, menuDisposables);\n\t\t\t\tactionRunner.onDidRun(this.onDidActionRun, this, menuDisposables);\n\t\t\t\tmenu = new Menu(container, actions, {\n\t\t\t\t\tactionViewItemProvider: delegate.getActionViewItem,\n\t\t\t\t\tcontext: delegate.getActionsContext ? delegate.getActionsContext() : null,\n\t\t\t\t\tactionRunner,\n\t\t\t\t\tgetKeyBinding: delegate.getKeyBinding ? delegate.getKeyBinding : action => this.keybindingService.lookupKeybinding(action.id)\n\t\t\t\t});\n\n\t\t\t\tmenuDisposables.add(attachMenuStyler(menu, this.themeService));\n\n\t\t\t\tmenu.onDidCancel(() => this.contextViewService.hideContextView(true), null, menuDisposables);\n\t\t\t\tmenu.onDidBlur(() => this.contextViewService.hideContextView(true), null, menuDisposables);\n\t\t\t\tdomEvent(window, EventType.BLUR)(() => { this.contextViewService.hideContextView(true); }, null, menuDisposables);\n\t\t\t\tdomEvent(window, EventType.MOUSE_DOWN)((e: MouseEvent) => {\n\t\t\t\t\tif (e.defaultPrevented) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet event = new StandardMouseEvent(e);\n\t\t\t\t\tlet element: HTMLElement | null = event.target;\n\n\t\t\t\t\t// Don't do anything as we are likely creating a context menu\n\t\t\t\t\tif (event.rightButton) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (element) {\n\t\t\t\t\t\tif (element === container) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\telement = element.parentElement;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.contextViewService.hideContextView(true);\n\t\t\t\t}, null, menuDisposables);\n\n\t\t\t\treturn combinedDisposable(menuDisposables, menu);\n\t\t\t},\n\n\t\t\tfocus: () => {\n\t\t\t\tif (menu) {\n\t\t\t\t\tmenu.focus(!!delegate.autoSelectFirstItem);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonHide: (didCancel?: boolean) => {\n\t\t\t\tif (delegate.onHide) {\n\t\t\t\t\tdelegate.onHide(!!didCancel);\n\t\t\t\t}\n\n\t\t\t\tif (this.block) {\n\t\t\t\t\tthis.block.remove();\n\t\t\t\t\tthis.block = null;\n\t\t\t\t}\n\n\t\t\t\tif (this.focusToReturn) {\n\t\t\t\t\tthis.focusToReturn.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t}, shadowRootElement, !!shadowRootElement);\n\t}\n\n\tprivate onActionRun(e: IRunEvent): void {\n\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: e.action.id, from: 'contextMenu' });\n\n\t\tthis.contextViewService.hideContextView(false);\n\n\t\t// Restore focus here\n\t\tif (this.focusToReturn) {\n\t\t\tthis.focusToReturn.focus();\n\t\t}\n\t}\n\n\tprivate onDidActionRun(e: IRunEvent): void {\n\t\tif (e.error && !isPromiseCanceledError(e.error)) {\n\t\t\tthis.notificationService.error(e.error);\n\t\t}\n\t}\n}\n"]}