{"version":3,"file":"remoteAgentConnection.js","sourceRoot":"file:///go/src/gitlab.wodcloud.com/cloud/vscode/lib/vscode/src","sources":["vs/platform/remote/common/remoteAgentConnection.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Client, PersistentProtocol, ISocket, ProtocolConstants } from 'vs/base/parts/ipc/common/ipc.net';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { RemoteAgentConnectionContext } from 'vs/platform/remote/common/remoteAgentEnvironment';\nimport { Disposable, DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { Emitter } from 'vs/base/common/event';\nimport { RemoteAuthorityResolverError } from 'vs/platform/remote/common/remoteAuthorityResolver';\nimport { isPromiseCanceledError, onUnexpectedError } from 'vs/base/common/errors';\nimport { ISignService } from 'vs/platform/sign/common/sign';\nimport { CancelablePromise, createCancelablePromise } from 'vs/base/common/async';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IIPCLogger } from 'vs/base/parts/ipc/common/ipc';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\n\nconst RECONNECT_TIMEOUT = 30 * 1000 /* 30s */;\n\nexport const enum ConnectionType {\n\tManagement = 1,\n\tExtensionHost = 2,\n\tTunnel = 3,\n}\n\nfunction connectionTypeToString(connectionType: ConnectionType): string {\n\tswitch (connectionType) {\n\t\tcase ConnectionType.Management:\n\t\t\treturn 'Management';\n\t\tcase ConnectionType.ExtensionHost:\n\t\t\treturn 'ExtensionHost';\n\t\tcase ConnectionType.Tunnel:\n\t\t\treturn 'Tunnel';\n\t}\n}\n\nexport interface AuthRequest {\n\ttype: 'auth';\n\tauth: string;\n}\n\nexport interface SignRequest {\n\ttype: 'sign';\n\tdata: string;\n}\n\nexport interface ConnectionTypeRequest {\n\ttype: 'connectionType';\n\tcommit?: string;\n\tsignedData?: string;\n\tdesiredConnectionType?: ConnectionType;\n\targs?: any;\n}\n\nexport interface ErrorMessage {\n\ttype: 'error';\n\treason: string;\n}\n\nexport interface OKMessage {\n\ttype: 'ok';\n}\n\nexport type HandshakeMessage = AuthRequest | SignRequest | ConnectionTypeRequest | ErrorMessage | OKMessage;\n\n\ninterface ISimpleConnectionOptions {\n\tcommit: string | undefined;\n\thost: string;\n\tport: number;\n\tconnectionToken: string | undefined;\n\treconnectionToken: string;\n\treconnectionProtocol: PersistentProtocol | null;\n\tsocketFactory: ISocketFactory;\n\tsignService: ISignService;\n\tlogService: ILogService;\n}\n\nexport interface IConnectCallback {\n\t(err: any | undefined, socket: ISocket | undefined): void;\n}\n\nexport interface ISocketFactory {\n\tconnect(host: string, port: number, query: string, callback: IConnectCallback): void;\n}\n\nfunction createTimeoutCancellation(millis: number): CancellationToken {\n\tconst source = new CancellationTokenSource();\n\tsetTimeout(() => source.cancel(), millis);\n\treturn source.token;\n}\n\nfunction combineTimeoutCancellation(a: CancellationToken, b: CancellationToken): CancellationToken {\n\tif (a.isCancellationRequested || b.isCancellationRequested) {\n\t\treturn CancellationToken.Cancelled;\n\t}\n\tconst source = new CancellationTokenSource();\n\ta.onCancellationRequested(() => source.cancel());\n\tb.onCancellationRequested(() => source.cancel());\n\treturn source.token;\n}\n\nclass PromiseWithTimeout<T> {\n\n\tprivate _state: 'pending' | 'resolved' | 'rejected' | 'timedout';\n\tprivate readonly _disposables: DisposableStore;\n\tpublic readonly promise: Promise<T>;\n\tprivate _resolvePromise!: (value: T) => void;\n\tprivate _rejectPromise!: (err: any) => void;\n\n\tpublic get didTimeout(): boolean {\n\t\treturn (this._state === 'timedout');\n\t}\n\n\tconstructor(timeoutCancellationToken: CancellationToken) {\n\t\tthis._state = 'pending';\n\t\tthis._disposables = new DisposableStore();\n\t\tthis.promise = new Promise<T>((resolve, reject) => {\n\t\t\tthis._resolvePromise = resolve;\n\t\t\tthis._rejectPromise = reject;\n\t\t});\n\n\t\tif (timeoutCancellationToken.isCancellationRequested) {\n\t\t\tthis._timeout();\n\t\t} else {\n\t\t\tthis._disposables.add(timeoutCancellationToken.onCancellationRequested(() => this._timeout()));\n\t\t}\n\t}\n\n\tpublic registerDisposable(disposable: IDisposable): void {\n\t\tif (this._state === 'pending') {\n\t\t\tthis._disposables.add(disposable);\n\t\t} else {\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n\n\tprivate _timeout(): void {\n\t\tif (this._state !== 'pending') {\n\t\t\treturn;\n\t\t}\n\t\tthis._disposables.dispose();\n\t\tthis._state = 'timedout';\n\t\tthis._rejectPromise(this._createTimeoutError());\n\t}\n\n\tprivate _createTimeoutError(): Error {\n\t\tconst err: any = new Error('Time limit reached');\n\t\terr.code = 'ETIMEDOUT';\n\t\terr.syscall = 'connect';\n\t\treturn err;\n\t}\n\n\tpublic resolve(value: T): void {\n\t\tif (this._state !== 'pending') {\n\t\t\treturn;\n\t\t}\n\t\tthis._disposables.dispose();\n\t\tthis._state = 'resolved';\n\t\tthis._resolvePromise(value);\n\t}\n\n\tpublic reject(err: any): void {\n\t\tif (this._state !== 'pending') {\n\t\t\treturn;\n\t\t}\n\t\tthis._disposables.dispose();\n\t\tthis._state = 'rejected';\n\t\tthis._rejectPromise(err);\n\t}\n}\n\nfunction readOneControlMessage<T>(protocol: PersistentProtocol, timeoutCancellationToken: CancellationToken): Promise<T> {\n\tconst result = new PromiseWithTimeout<T>(timeoutCancellationToken);\n\tresult.registerDisposable(protocol.onControlMessage(raw => {\n\t\tconst msg: T = JSON.parse(raw.toString());\n\t\tconst error = getErrorFromMessage(msg);\n\t\tif (error) {\n\t\t\tresult.reject(error);\n\t\t} else {\n\t\t\tresult.resolve(msg);\n\t\t}\n\t}));\n\treturn result.promise;\n}\n\nfunction createSocket(logService: ILogService, socketFactory: ISocketFactory, host: string, port: number, query: string, timeoutCancellationToken: CancellationToken): Promise<ISocket> {\n\tconst result = new PromiseWithTimeout<ISocket>(timeoutCancellationToken);\n\tsocketFactory.connect(host, port, query, (err: any, socket: ISocket | undefined) => {\n\t\tif (result.didTimeout) {\n\t\t\tif (err) {\n\t\t\t\tlogService.error(err);\n\t\t\t}\n\t\t\tsocket?.dispose();\n\t\t} else {\n\t\t\tif (err || !socket) {\n\t\t\t\tresult.reject(err);\n\t\t\t} else {\n\t\t\t\tresult.resolve(socket);\n\t\t\t}\n\t\t}\n\t});\n\treturn result.promise;\n}\n\nfunction raceWithTimeoutCancellation<T>(promise: Promise<T>, timeoutCancellationToken: CancellationToken): Promise<T> {\n\tconst result = new PromiseWithTimeout<T>(timeoutCancellationToken);\n\tpromise.then(\n\t\t(res) => {\n\t\t\tif (!result.didTimeout) {\n\t\t\t\tresult.resolve(res);\n\t\t\t}\n\t\t},\n\t\t(err) => {\n\t\t\tif (!result.didTimeout) {\n\t\t\t\tresult.reject(err);\n\t\t\t}\n\t\t}\n\t);\n\treturn result.promise;\n}\n\nasync function connectToRemoteExtensionHostAgent(options: ISimpleConnectionOptions, connectionType: ConnectionType, args: any | undefined, timeoutCancellationToken: CancellationToken): Promise<{ protocol: PersistentProtocol; ownsProtocol: boolean; }> {\n\tconst logPrefix = connectLogPrefix(options, connectionType);\n\n\toptions.logService.trace(`${logPrefix} 1/6. invoking socketFactory.connect().`);\n\n\tlet socket: ISocket;\n\ttry {\n\t\t// NOTE@coder: Add connection type to the socket. This is so they can be\n\t\t// distinguished by the backend.\n\t\tsocket = await createSocket(options.logService, options.socketFactory, options.host, options.port, `type=${connectionTypeToString(connectionType)}&reconnectionToken=${options.reconnectionToken}&reconnection=${options.reconnectionProtocol ? 'true' : 'false'}`, timeoutCancellationToken);\n\t} catch (error) {\n\t\toptions.logService.error(`${logPrefix} socketFactory.connect() failed or timed out. Error:`);\n\t\toptions.logService.error(error);\n\t\tthrow error;\n\t}\n\n\toptions.logService.trace(`${logPrefix} 2/6. socketFactory.connect() was successful.`);\n\n\tlet protocol: PersistentProtocol;\n\tlet ownsProtocol: boolean;\n\tif (options.reconnectionProtocol) {\n\t\toptions.reconnectionProtocol.beginAcceptReconnection(socket, null);\n\t\tprotocol = options.reconnectionProtocol;\n\t\townsProtocol = false;\n\t} else {\n\t\tprotocol = new PersistentProtocol(socket, null);\n\t\townsProtocol = true;\n\t}\n\n\toptions.logService.trace(`${logPrefix} 3/6. sending AuthRequest control message.`);\n\tconst authRequest: AuthRequest = {\n\t\ttype: 'auth',\n\t\tauth: options.connectionToken || '00000000000000000000'\n\t};\n\tprotocol.sendControl(VSBuffer.fromString(JSON.stringify(authRequest)));\n\n\ttry {\n\t\tconst msg = await readOneControlMessage<HandshakeMessage>(protocol, combineTimeoutCancellation(timeoutCancellationToken, createTimeoutCancellation(10000)));\n\n\t\tif (msg.type !== 'sign' || typeof msg.data !== 'string') {\n\t\t\tconst error: any = new Error('Unexpected handshake message');\n\t\t\terror.code = 'VSCODE_CONNECTION_ERROR';\n\t\t\tthrow error;\n\t\t}\n\n\t\toptions.logService.trace(`${logPrefix} 4/6. received SignRequest control message.`);\n\n\t\tconst signed = await raceWithTimeoutCancellation(options.signService.sign(msg.data), timeoutCancellationToken);\n\t\tconst connTypeRequest: ConnectionTypeRequest = {\n\t\t\ttype: 'connectionType',\n\t\t\tcommit: options.commit,\n\t\t\tsignedData: signed,\n\t\t\tdesiredConnectionType: connectionType\n\t\t};\n\t\tif (args) {\n\t\t\tconnTypeRequest.args = args;\n\t\t}\n\n\t\toptions.logService.trace(`${logPrefix} 5/6. sending ConnectionTypeRequest control message.`);\n\t\tprotocol.sendControl(VSBuffer.fromString(JSON.stringify(connTypeRequest)));\n\n\t\treturn { protocol, ownsProtocol };\n\n\t} catch (error) {\n\t\tif (error && error.code === 'ETIMEDOUT') {\n\t\t\toptions.logService.error(`${logPrefix} the handshake timed out. Error:`);\n\t\t\toptions.logService.error(error);\n\t\t}\n\t\tif (error && error.code === 'VSCODE_CONNECTION_ERROR') {\n\t\t\toptions.logService.error(`${logPrefix} received error control message when negotiating connection. Error:`);\n\t\t\toptions.logService.error(error);\n\t\t}\n\t\tif (ownsProtocol) {\n\t\t\tsafeDisposeProtocolAndSocket(protocol);\n\t\t}\n\t\tthrow error;\n\t}\n}\n\ninterface IManagementConnectionResult {\n\tprotocol: PersistentProtocol;\n}\n\nasync function connectToRemoteExtensionHostAgentAndReadOneMessage<T>(options: ISimpleConnectionOptions, connectionType: ConnectionType, args: any | undefined, timeoutCancellationToken: CancellationToken): Promise<{ protocol: PersistentProtocol; firstMessage: T; }> {\n\tconst startTime = Date.now();\n\tconst logPrefix = connectLogPrefix(options, connectionType);\n\tconst { protocol, ownsProtocol } = await connectToRemoteExtensionHostAgent(options, connectionType, args, timeoutCancellationToken);\n\tconst result = new PromiseWithTimeout<{ protocol: PersistentProtocol; firstMessage: T; }>(timeoutCancellationToken);\n\tresult.registerDisposable(protocol.onControlMessage(raw => {\n\t\tconst msg: T = JSON.parse(raw.toString());\n\t\tconst error = getErrorFromMessage(msg);\n\t\tif (error) {\n\t\t\toptions.logService.error(`${logPrefix} received error control message when negotiating connection. Error:`);\n\t\t\toptions.logService.error(error);\n\t\t\tif (ownsProtocol) {\n\t\t\t\tsafeDisposeProtocolAndSocket(protocol);\n\t\t\t}\n\t\t\tresult.reject(error);\n\t\t} else {\n\t\t\tif (options.reconnectionProtocol) {\n\t\t\t\toptions.reconnectionProtocol.endAcceptReconnection();\n\t\t\t}\n\t\t\toptions.logService.trace(`${logPrefix} 6/6. handshake finished, connection is up and running after ${logElapsed(startTime)}!`);\n\t\t\tresult.resolve({ protocol, firstMessage: msg });\n\t\t}\n\t}));\n\treturn result.promise;\n}\n\nasync function doConnectRemoteAgentManagement(options: ISimpleConnectionOptions, timeoutCancellationToken: CancellationToken): Promise<IManagementConnectionResult> {\n\tconst { protocol } = await connectToRemoteExtensionHostAgentAndReadOneMessage(options, ConnectionType.Management, undefined, timeoutCancellationToken);\n\treturn { protocol };\n}\n\nexport interface IRemoteExtensionHostStartParams {\n\tlanguage: string;\n\tdebugId?: string;\n\tbreak?: boolean;\n\tport?: number | null;\n\tenv?: { [key: string]: string | null };\n}\n\ninterface IExtensionHostConnectionResult {\n\tprotocol: PersistentProtocol;\n\tdebugPort?: number;\n}\n\nasync function doConnectRemoteAgentExtensionHost(options: ISimpleConnectionOptions, startArguments: IRemoteExtensionHostStartParams, timeoutCancellationToken: CancellationToken): Promise<IExtensionHostConnectionResult> {\n\tconst { protocol, firstMessage } = await connectToRemoteExtensionHostAgentAndReadOneMessage<{ debugPort?: number; }>(options, ConnectionType.ExtensionHost, startArguments, timeoutCancellationToken);\n\tconst debugPort = firstMessage && firstMessage.debugPort;\n\treturn { protocol, debugPort };\n}\n\nexport interface ITunnelConnectionStartParams {\n\tport: number;\n}\n\nasync function doConnectRemoteAgentTunnel(options: ISimpleConnectionOptions, startParams: ITunnelConnectionStartParams, timeoutCancellationToken: CancellationToken): Promise<PersistentProtocol> {\n\tconst startTime = Date.now();\n\tconst logPrefix = connectLogPrefix(options, ConnectionType.Tunnel);\n\tconst { protocol } = await connectToRemoteExtensionHostAgent(options, ConnectionType.Tunnel, startParams, timeoutCancellationToken);\n\toptions.logService.trace(`${logPrefix} 6/6. handshake finished, connection is up and running after ${logElapsed(startTime)}!`);\n\treturn protocol;\n}\n\nexport interface IConnectionOptions {\n\tcommit: string | undefined;\n\tsocketFactory: ISocketFactory;\n\taddressProvider: IAddressProvider;\n\tsignService: ISignService;\n\tlogService: ILogService;\n\tipcLogger: IIPCLogger | null;\n}\n\nasync function resolveConnectionOptions(options: IConnectionOptions, reconnectionToken: string, reconnectionProtocol: PersistentProtocol | null): Promise<ISimpleConnectionOptions> {\n\tconst { host, port, connectionToken } = await options.addressProvider.getAddress();\n\treturn {\n\t\tcommit: options.commit,\n\t\thost: host,\n\t\tport: port,\n\t\tconnectionToken: connectionToken,\n\t\treconnectionToken: reconnectionToken,\n\t\treconnectionProtocol: reconnectionProtocol,\n\t\tsocketFactory: options.socketFactory,\n\t\tsignService: options.signService,\n\t\tlogService: options.logService\n\t};\n}\n\nexport interface IAddress {\n\thost: string;\n\tport: number;\n\tconnectionToken: string | undefined;\n}\n\nexport interface IAddressProvider {\n\tgetAddress(): Promise<IAddress>;\n}\n\nexport async function connectRemoteAgentManagement(options: IConnectionOptions, remoteAuthority: string, clientId: string): Promise<ManagementPersistentConnection> {\n\ttry {\n\t\tconst reconnectionToken = generateUuid();\n\t\tconst simpleOptions = await resolveConnectionOptions(options, reconnectionToken, null);\n\t\tconst { protocol } = await doConnectRemoteAgentManagement(simpleOptions, CancellationToken.None);\n\t\treturn new ManagementPersistentConnection(options, remoteAuthority, clientId, reconnectionToken, protocol);\n\t} catch (err) {\n\t\toptions.logService.error(`[remote-connection] An error occurred in the very first connect attempt, it will be treated as a permanent error! Error:`);\n\t\toptions.logService.error(err);\n\t\tPersistentConnection.triggerPermanentFailure(0, 0, RemoteAuthorityResolverError.isHandled(err));\n\t\tthrow err;\n\t}\n}\n\nexport async function connectRemoteAgentExtensionHost(options: IConnectionOptions, startArguments: IRemoteExtensionHostStartParams): Promise<ExtensionHostPersistentConnection> {\n\ttry {\n\t\tconst reconnectionToken = generateUuid();\n\t\tconst simpleOptions = await resolveConnectionOptions(options, reconnectionToken, null);\n\t\tconst { protocol, debugPort } = await doConnectRemoteAgentExtensionHost(simpleOptions, startArguments, CancellationToken.None);\n\t\treturn new ExtensionHostPersistentConnection(options, startArguments, reconnectionToken, protocol, debugPort);\n\t} catch (err) {\n\t\toptions.logService.error(`[remote-connection] An error occurred in the very first connect attempt, it will be treated as a permanent error! Error:`);\n\t\toptions.logService.error(err);\n\t\tPersistentConnection.triggerPermanentFailure(0, 0, RemoteAuthorityResolverError.isHandled(err));\n\t\tthrow err;\n\t}\n}\n\nexport async function connectRemoteAgentTunnel(options: IConnectionOptions, tunnelRemotePort: number): Promise<PersistentProtocol> {\n\tconst simpleOptions = await resolveConnectionOptions(options, generateUuid(), null);\n\tconst protocol = await doConnectRemoteAgentTunnel(simpleOptions, { port: tunnelRemotePort }, CancellationToken.None);\n\treturn protocol;\n}\n\nfunction sleep(seconds: number): CancelablePromise<void> {\n\treturn createCancelablePromise(token => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst timeout = setTimeout(resolve, seconds * 1000);\n\t\t\ttoken.onCancellationRequested(() => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t});\n}\n\nexport const enum PersistentConnectionEventType {\n\tConnectionLost,\n\tReconnectionWait,\n\tReconnectionRunning,\n\tReconnectionPermanentFailure,\n\tConnectionGain\n}\nexport class ConnectionLostEvent {\n\tpublic readonly type = PersistentConnectionEventType.ConnectionLost;\n\tconstructor(\n\t\tpublic readonly reconnectionToken: string,\n\t\tpublic readonly millisSinceLastIncomingData: number\n\t) { }\n}\nexport class ReconnectionWaitEvent {\n\tpublic readonly type = PersistentConnectionEventType.ReconnectionWait;\n\tconstructor(\n\t\tpublic readonly reconnectionToken: string,\n\t\tpublic readonly millisSinceLastIncomingData: number,\n\t\tpublic readonly durationSeconds: number,\n\t\tprivate readonly cancellableTimer: CancelablePromise<void>\n\t) { }\n\n\tpublic skipWait(): void {\n\t\tthis.cancellableTimer.cancel();\n\t}\n}\nexport class ReconnectionRunningEvent {\n\tpublic readonly type = PersistentConnectionEventType.ReconnectionRunning;\n\tconstructor(\n\t\tpublic readonly reconnectionToken: string,\n\t\tpublic readonly millisSinceLastIncomingData: number,\n\t\tpublic readonly attempt: number\n\t) { }\n}\nexport class ConnectionGainEvent {\n\tpublic readonly type = PersistentConnectionEventType.ConnectionGain;\n\tconstructor(\n\t\tpublic readonly reconnectionToken: string,\n\t\tpublic readonly millisSinceLastIncomingData: number,\n\t\tpublic readonly attempt: number\n\t) { }\n}\nexport class ReconnectionPermanentFailureEvent {\n\tpublic readonly type = PersistentConnectionEventType.ReconnectionPermanentFailure;\n\tconstructor(\n\t\tpublic readonly reconnectionToken: string,\n\t\tpublic readonly millisSinceLastIncomingData: number,\n\t\tpublic readonly attempt: number,\n\t\tpublic readonly handled: boolean\n\t) { }\n}\nexport type PersistentConnectionEvent = ConnectionGainEvent | ConnectionLostEvent | ReconnectionWaitEvent | ReconnectionRunningEvent | ReconnectionPermanentFailureEvent;\n\nabstract class PersistentConnection extends Disposable {\n\n\tpublic static triggerPermanentFailure(millisSinceLastIncomingData: number, attempt: number, handled: boolean): void {\n\t\tthis._permanentFailure = true;\n\t\tthis._permanentFailureMillisSinceLastIncomingData = millisSinceLastIncomingData;\n\t\tthis._permanentFailureAttempt = attempt;\n\t\tthis._permanentFailureHandled = handled;\n\t\tthis._instances.forEach(instance => instance._gotoPermanentFailure(this._permanentFailureMillisSinceLastIncomingData, this._permanentFailureAttempt, this._permanentFailureHandled));\n\t}\n\tprivate static _permanentFailure: boolean = false;\n\tprivate static _permanentFailureMillisSinceLastIncomingData: number = 0;\n\tprivate static _permanentFailureAttempt: number = 0;\n\tprivate static _permanentFailureHandled: boolean = false;\n\tprivate static _instances: PersistentConnection[] = [];\n\n\tprivate readonly _onDidStateChange = this._register(new Emitter<PersistentConnectionEvent>());\n\tpublic readonly onDidStateChange = this._onDidStateChange.event;\n\n\tprotected readonly _options: IConnectionOptions;\n\tpublic readonly reconnectionToken: string;\n\tpublic readonly protocol: PersistentProtocol;\n\n\tprivate _isReconnecting: boolean;\n\n\tconstructor(private readonly _connectionType: ConnectionType, options: IConnectionOptions, reconnectionToken: string, protocol: PersistentProtocol) {\n\t\tsuper();\n\t\tthis._options = options;\n\t\tthis.reconnectionToken = reconnectionToken;\n\t\tthis.protocol = protocol;\n\t\tthis._isReconnecting = false;\n\n\t\tthis._onDidStateChange.fire(new ConnectionGainEvent(this.reconnectionToken, 0, 0));\n\n\t\tthis._register(protocol.onSocketClose(() => this._beginReconnecting()));\n\t\tthis._register(protocol.onSocketTimeout(() => this._beginReconnecting()));\n\n\t\tPersistentConnection._instances.push(this);\n\n\t\tif (PersistentConnection._permanentFailure) {\n\t\t\tthis._gotoPermanentFailure(PersistentConnection._permanentFailureMillisSinceLastIncomingData, PersistentConnection._permanentFailureAttempt, PersistentConnection._permanentFailureHandled);\n\t\t}\n\t}\n\n\tprivate async _beginReconnecting(): Promise<void> {\n\t\t// Only have one reconnection loop active at a time.\n\t\tif (this._isReconnecting) {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tthis._isReconnecting = true;\n\t\t\tawait this._runReconnectingLoop();\n\t\t} finally {\n\t\t\tthis._isReconnecting = false;\n\t\t}\n\t}\n\n\tprivate async _runReconnectingLoop(): Promise<void> {\n\t\tif (PersistentConnection._permanentFailure) {\n\t\t\t// no more attempts!\n\t\t\treturn;\n\t\t}\n\t\tconst logPrefix = commonLogPrefix(this._connectionType, this.reconnectionToken, true);\n\t\tthis._options.logService.info(`${logPrefix} starting reconnecting loop. You can get more information with the trace log level.`);\n\t\tthis._onDidStateChange.fire(new ConnectionLostEvent(this.reconnectionToken, this.protocol.getMillisSinceLastIncomingData()));\n\t\tconst TIMES = [0, 5, 5, 10, 10, 10, 10, 10, 30];\n\t\tconst disconnectStartTime = Date.now();\n\t\tlet attempt = -1;\n\t\tdo {\n\t\t\tattempt++;\n\t\t\tconst waitTime = (attempt < TIMES.length ? TIMES[attempt] : TIMES[TIMES.length - 1]);\n\t\t\ttry {\n\t\t\t\tif (waitTime > 0) {\n\t\t\t\t\tconst sleepPromise = sleep(waitTime);\n\t\t\t\t\tthis._onDidStateChange.fire(new ReconnectionWaitEvent(this.reconnectionToken, this.protocol.getMillisSinceLastIncomingData(), waitTime, sleepPromise));\n\n\t\t\t\t\tthis._options.logService.info(`${logPrefix} waiting for ${waitTime} seconds before reconnecting...`);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait sleepPromise;\n\t\t\t\t\t} catch { } // User canceled timer\n\t\t\t\t}\n\n\t\t\t\tif (PersistentConnection._permanentFailure) {\n\t\t\t\t\tthis._options.logService.error(`${logPrefix} permanent failure occurred while running the reconnecting loop.`);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// connection was lost, let's try to re-establish it\n\t\t\t\tthis._onDidStateChange.fire(new ReconnectionRunningEvent(this.reconnectionToken, this.protocol.getMillisSinceLastIncomingData(), attempt + 1));\n\t\t\t\tthis._options.logService.info(`${logPrefix} resolving connection...`);\n\t\t\t\tconst simpleOptions = await resolveConnectionOptions(this._options, this.reconnectionToken, this.protocol);\n\t\t\t\tthis._options.logService.info(`${logPrefix} connecting to ${simpleOptions.host}:${simpleOptions.port}...`);\n\t\t\t\tawait this._reconnect(simpleOptions, createTimeoutCancellation(RECONNECT_TIMEOUT));\n\t\t\t\tthis._options.logService.info(`${logPrefix} reconnected!`);\n\t\t\t\tthis._onDidStateChange.fire(new ConnectionGainEvent(this.reconnectionToken, this.protocol.getMillisSinceLastIncomingData(), attempt + 1));\n\n\t\t\t\tbreak;\n\t\t\t} catch (err) {\n\t\t\t\tif (err.code === 'VSCODE_CONNECTION_ERROR') {\n\t\t\t\t\tthis._options.logService.error(`${logPrefix} A permanent error occurred in the reconnecting loop! Will give up now! Error:`);\n\t\t\t\t\tthis._options.logService.error(err);\n\t\t\t\t\tPersistentConnection.triggerPermanentFailure(this.protocol.getMillisSinceLastIncomingData(), attempt + 1, false);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (Date.now() - disconnectStartTime > ProtocolConstants.ReconnectionGraceTime) {\n\t\t\t\t\tthis._options.logService.error(`${logPrefix} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time has expired! Will give up now! Error:`);\n\t\t\t\t\tthis._options.logService.error(err);\n\t\t\t\t\tPersistentConnection.triggerPermanentFailure(this.protocol.getMillisSinceLastIncomingData(), attempt + 1, false);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (RemoteAuthorityResolverError.isTemporarilyNotAvailable(err)) {\n\t\t\t\t\tthis._options.logService.info(`${logPrefix} A temporarily not available error occurred while trying to reconnect, will try again...`);\n\t\t\t\t\tthis._options.logService.trace(err);\n\t\t\t\t\t// try again!\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif ((err.code === 'ETIMEDOUT' || err.code === 'ENETUNREACH' || err.code === 'ECONNREFUSED' || err.code === 'ECONNRESET') && err.syscall === 'connect') {\n\t\t\t\t\tthis._options.logService.info(`${logPrefix} A network error occurred while trying to reconnect, will try again...`);\n\t\t\t\t\tthis._options.logService.trace(err);\n\t\t\t\t\t// try again!\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (isPromiseCanceledError(err)) {\n\t\t\t\t\tthis._options.logService.info(`${logPrefix} A promise cancelation error occurred while trying to reconnect, will try again...`);\n\t\t\t\t\tthis._options.logService.trace(err);\n\t\t\t\t\t// try again!\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (err instanceof RemoteAuthorityResolverError) {\n\t\t\t\t\tthis._options.logService.error(`${logPrefix} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`);\n\t\t\t\t\tthis._options.logService.error(err);\n\t\t\t\t\tPersistentConnection.triggerPermanentFailure(this.protocol.getMillisSinceLastIncomingData(), attempt + 1, RemoteAuthorityResolverError.isHandled(err));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis._options.logService.error(`${logPrefix} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`);\n\t\t\t\tthis._options.logService.error(err);\n\t\t\t\tPersistentConnection.triggerPermanentFailure(this.protocol.getMillisSinceLastIncomingData(), attempt + 1, false);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while (!PersistentConnection._permanentFailure);\n\t}\n\n\tprivate _gotoPermanentFailure(millisSinceLastIncomingData: number, attempt: number, handled: boolean): void {\n\t\tthis._onDidStateChange.fire(new ReconnectionPermanentFailureEvent(this.reconnectionToken, millisSinceLastIncomingData, attempt, handled));\n\t\tsafeDisposeProtocolAndSocket(this.protocol);\n\t}\n\n\tprotected abstract _reconnect(options: ISimpleConnectionOptions, timeoutCancellationToken: CancellationToken): Promise<void>;\n}\n\nexport class ManagementPersistentConnection extends PersistentConnection {\n\n\tpublic readonly client: Client<RemoteAgentConnectionContext>;\n\n\tconstructor(options: IConnectionOptions, remoteAuthority: string, clientId: string, reconnectionToken: string, protocol: PersistentProtocol) {\n\t\tsuper(ConnectionType.Management, options, reconnectionToken, protocol);\n\t\tthis.client = this._register(new Client<RemoteAgentConnectionContext>(protocol, {\n\t\t\tremoteAuthority: remoteAuthority,\n\t\t\tclientId: clientId\n\t\t}, options.ipcLogger));\n\t}\n\n\tprotected async _reconnect(options: ISimpleConnectionOptions, timeoutCancellationToken: CancellationToken): Promise<void> {\n\t\tawait doConnectRemoteAgentManagement(options, timeoutCancellationToken);\n\t}\n}\n\nexport class ExtensionHostPersistentConnection extends PersistentConnection {\n\n\tprivate readonly _startArguments: IRemoteExtensionHostStartParams;\n\tpublic readonly debugPort: number | undefined;\n\n\tconstructor(options: IConnectionOptions, startArguments: IRemoteExtensionHostStartParams, reconnectionToken: string, protocol: PersistentProtocol, debugPort: number | undefined) {\n\t\tsuper(ConnectionType.ExtensionHost, options, reconnectionToken, protocol);\n\t\tthis._startArguments = startArguments;\n\t\tthis.debugPort = debugPort;\n\t}\n\n\tprotected async _reconnect(options: ISimpleConnectionOptions, timeoutCancellationToken: CancellationToken): Promise<void> {\n\t\tawait doConnectRemoteAgentExtensionHost(options, this._startArguments, timeoutCancellationToken);\n\t}\n}\n\nfunction safeDisposeProtocolAndSocket(protocol: PersistentProtocol): void {\n\ttry {\n\t\tprotocol.acceptDisconnect();\n\t\tconst socket = protocol.getSocket();\n\t\tprotocol.dispose();\n\t\tsocket.dispose();\n\t} catch (err) {\n\t\tonUnexpectedError(err);\n\t}\n}\n\nfunction getErrorFromMessage(msg: any): Error | null {\n\tif (msg && msg.type === 'error') {\n\t\tconst error = new Error(`Connection error: ${msg.reason}`);\n\t\t(<any>error).code = 'VSCODE_CONNECTION_ERROR';\n\t\treturn error;\n\t}\n\treturn null;\n}\n\nfunction stringRightPad(str: string, len: number): string {\n\twhile (str.length < len) {\n\t\tstr += ' ';\n\t}\n\treturn str;\n}\n\nfunction commonLogPrefix(connectionType: ConnectionType, reconnectionToken: string, isReconnect: boolean): string {\n\treturn `[remote-connection][${stringRightPad(connectionTypeToString(connectionType), 13)}][${reconnectionToken.substr(0, 5)}…][${isReconnect ? 'reconnect' : 'initial'}]`;\n}\n\nfunction connectLogPrefix(options: ISimpleConnectionOptions, connectionType: ConnectionType): string {\n\treturn `${commonLogPrefix(connectionType, options.reconnectionToken, !!options.reconnectionProtocol)}[${options.host}:${options.port}]`;\n}\n\nfunction logElapsed(startTime: number): string {\n\treturn `${Date.now() - startTime} ms`;\n}\n"]}